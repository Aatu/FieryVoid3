(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{153:function(e,t,n){e.exports=n(313)},313:function(e,t,n){"use strict";n.r(t);var i={};n.r(i),n.d(i,"blue",(function(){return H})),n.d(i,"darkBlue",(function(){return L})),n.d(i,"border",(function(){return B})),n.d(i,"borderDark",(function(){return _})),n.d(i,"text",(function(){return U})),n.d(i,"textDanger",(function(){return N})),n.d(i,"lightBlue",(function(){return V})),n.d(i,"systemWindowBorder",(function(){return G})),n.d(i,"systemBorder",(function(){return q})),n.d(i,"systemWindowPrimaryBorder",(function(){return W})),n.d(i,"tooltipButtonColor",(function(){return Z}));var a={};n.r(a),n.d(a,"Arrow",(function(){return K})),n.d(a,"ArrowSmall",(function(){return X})),n.d(a,"Roll",(function(){return Y})),n.d(a,"X",(function(){return Q})),n.d(a,"Evade",(function(){return J})),n.d(a,"Pivot",(function(){return $})),n.d(a,"Cancel",(function(){return ee})),n.d(a,"CheckMark",(function(){return te})),n.d(a,"Play",(function(){return ne})),n.d(a,"Pause",(function(){return ie})),n.d(a,"Replay",(function(){return ae}));var r={};n.r(r),n.d(r,"login",(function(){return Oi})),n.d(r,"register",(function(){return wi})),n.d(r,"getCurrentUser",(function(){return ki})),n.d(r,"logout",(function(){return ji}));var s={};n.r(s),n.d(s,"ThrustChannelHeatIncreased",(function(){return _a})),n.d(s,"ForcedOfflineOverheat",(function(){return La})),n.d(s,"ForcedOffline",(function(){return Fa})),n.d(s,"LoadingTimeIncreased",(function(){return za})),n.d(s,"OutputReduced2",(function(){return Ca})),n.d(s,"OutputReduced4",(function(){return Ea})),n.d(s,"OutputReduced6",(function(){return Pa})),n.d(s,"OutputReduced8",(function(){return Da})),n.d(s,"OutputReduced",(function(){return Sa}));var o={};n.r(o),n.d(o,"Torpedo158MSV2",(function(){return yr})),n.d(o,"Torpedo158MSV",(function(){return gr})),n.d(o,"Torpedo158Nuclear",(function(){return Or})),n.d(o,"Torpedo72MSV",(function(){return kr})),n.d(o,"Torpedo72HE",(function(){return jr})),n.d(o,"Torpedo158HE",(function(){return Sr}));var u={};n.r(u),n.d(u,"Ammo30mm",(function(){return Cr})),n.d(u,"Ammo85mmHE",(function(){return Tr})),n.d(u,"Ammo85mmAP",(function(){return Er})),n.d(u,"Ammo140mmAP",(function(){return Ar})),n.d(u,"Ammo140mmHE",(function(){return Pr})),n.d(u,"Ammo120mmAP",(function(){return Ir})),n.d(u,"Ammo120mmHE",(function(){return Dr}));var c={};n.r(c),n.d(c,"Gunship",(function(){return Ws})),n.d(c,"Rhino",(function(){return qs})),n.d(c,"Capital",(function(){return Zs})),n.d(c,"Caliope",(function(){return Qs})),n.d(c,"Fulcrum",(function(){return $s})),n.d(c,"Mouros",(function(){return eo})),n.d(c,"Impetous",(function(){return to})),n.d(c,"Haka",(function(){return Xs}));var l={};n.r(l),n.d(l,"ManeuveringThruster",(function(){return lm})),n.d(l,"Thruster",(function(){return hm})),n.d(l,"ManeuveringThrusterLeft",(function(){return dm})),n.d(l,"ManeuveringThrusterRight",(function(){return mm}));var h={};n.r(h),n.d(h,"Engine",(function(){return fm}));var d={};n.r(d),n.d(d,"Reactor",(function(){return rm}));var m={};n.r(m),n.d(m,"Structure",(function(){return Br}));var f={};n.r(f),n.d(f,"EwArray",(function(){return pm})),n.d(f,"CQEWArray",(function(){return vm})),n.d(f,"ElintArray",(function(){return gm})),n.d(f,"OEWArray",(function(){return ym}));var p={};n.r(p),n.d(p,"CoilgunLightFixed",(function(){return km})),n.d(p,"RailgunTurreted64gw",(function(){return Sm})),n.d(p,"RailgunTurreted32gw",(function(){return xm})),n.d(p,"MediumCoilcunTurretedUC",(function(){return jm}));var v={};n.r(v),n.d(v,"RailgunFixed120mm",(function(){return Am})),n.d(v,"RailgunTurreted2x140mm",(function(){return Pm})),n.d(v,"RailgunTurreted140mmUC",(function(){return Im}));var g={};n.r(g),n.d(g,"TorpedoLauncher158",(function(){return Rm})),n.d(g,"TorpedoLauncherDual72",(function(){return Fm})),n.d(g,"TorpedoLauncherDual158",(function(){return Hm})),n.d(g,"TorpedoLauncherQuadruple158",(function(){return Lm}));var y={};n.r(y),n.d(y,"Radiator",(function(){return Um})),n.d(y,"HeatSink",(function(){return Nm})),n.d(y,"Radiator5x40",(function(){return Vm})),n.d(y,"Radiator10x40",(function(){return Gm})),n.d(y,"Radiator10x50",(function(){return Wm}));var b={};n.r(b),n.d(b,"UcRhino",(function(){return Km})),n.d(b,"Haka",(function(){return Xm}));var O={};n.r(O),n.d(O,"TestShip",(function(){return Ym}));var w={};n.r(w),n.d(w,"Caliope",(function(){return Qm})),n.d(w,"Mouros",(function(){return Jm})),n.d(w,"Fulcrum",(function(){return $m}));var k={};n.r(k),n.d(k,"Impetous",(function(){return tf}));var j=n(0),S=n.n(j),x=n(142),C=n.n(x),T=n(1),E=n(2),A=n(4),P=n(3),I=n(5),D=n(13),M=n(31),z=n(46),R=n(8),F=n(7),H="#deebff",L="#04161C",B="#496791",_="#37465a",U="#DEEBFF",N="#da5656",V="#6daaff",G="#6e6c6c",W="#aaaaaa",q="#bebebe",Z="#3b3b60",K=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props.size,t=void 0===e?"90%":e;return j.createElement("svg",{id:"arrow",xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 32.75 32.75"},j.createElement("path",{id:"svg-path",d:"M30.434,15.938c-0.791,0.933-1.917,1.411-3.052,1.411c-0.913,0-1.834-0.312-2.587-0.951l-4.421-3.753V28.75 c0,2.209-1.791,4-4,4c-2.209,0-4-1.791-4-4V12.646l-4.42,3.754c-1.683,1.431-4.208,1.226-5.639-0.459 c-1.43-1.684-1.224-4.208,0.46-5.638l11.01-9.351c1.493-1.27,3.686-1.27,5.178,0l11.011,9.351 C31.658,11.73,31.863,14.255,30.434,15.938z"}))}}]),t}(j.Component),X=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=void 0===t?"#fff":t,i=e.size,a=void 0===i?"100%":i;return j.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Capa_1",width:a,height:a,viewBox:"0 0 438.533 438.533"},j.createElement("path",{id:"svg-path",d:"M409.133,109.203c-19.608-33.592-46.205-60.189-79.798-79.796C295.736,9.801,259.058,0,219.273,0 c-39.781,0-76.47,9.801-110.063,29.407c-33.595,19.604-60.192,46.201-79.8,79.796C9.801,142.8,0,179.489,0,219.267 c0,39.78,9.804,76.463,29.407,110.062c19.607,33.592,46.204,60.189,79.799,79.798c33.597,19.605,70.283,29.407,110.063,29.407 s76.47-9.802,110.065-29.407c33.593-19.602,60.189-46.206,79.795-79.798c19.603-33.596,29.403-70.284,29.403-110.062 C438.533,179.485,428.732,142.795,409.133,109.203z M334.332,232.111L204.71,361.736c-3.617,3.613-7.896,5.428-12.847,5.428 c-4.952,0-9.235-1.814-12.85-5.428l-29.121-29.13c-3.617-3.613-5.426-7.898-5.426-12.847c0-4.941,1.809-9.232,5.426-12.847 l87.653-87.646l-87.657-87.65c-3.617-3.612-5.426-7.898-5.426-12.845c0-4.949,1.809-9.231,5.426-12.847l29.121-29.13 c3.619-3.615,7.898-5.424,12.85-5.424c4.95,0,9.233,1.809,12.85,5.424l129.622,129.621c3.613,3.614,5.42,7.898,5.42,12.847 C339.752,224.213,337.945,228.498,334.332,232.111z",fill:n}))}}]),t}(j.Component),Y=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=void 0===t?"#fff":t,i=e.size,a=void 0===i?"100%":i;return j.createElement("svg",{id:"roll",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 420.995 420.995",width:a,height:a},j.createElement("g",{fill:"#010002"},j.createElement("path",{id:"svg-path",d:"M127.505,196.313c22.15,0,27.45-12.827,11.77-28.458l-31.165-31.197 c4.406-6.194,9.234-12.006,14.599-17.257c1.878-1.788,3.796-3.512,5.763-5.17c2.3-2.008,4.715-3.861,7.145-5.698 c2.146-1.561,4.292-3.146,6.487-4.593c3.65-2.341,7.364-4.511,11.226-6.454c1.723-0.87,3.438-1.626,5.194-2.439 c4.04-1.837,8.202-3.471,12.494-4.926c0.845-0.236,1.626-0.602,2.463-0.845c5.194-1.561,10.478-2.707,15.875-3.617 c1.39-0.244,2.78-0.455,4.17-0.634c5.601-0.764,11.25-1.301,17.013-1.301c0.179,0,0.358,0.065,0.536,0.065 c4.113,0,8.096,0.171,12.103,0.593c1.967,0.187,3.861,0.585,5.763,0.862c2.292,0.358,4.552,0.593,6.755,1.024 c1.626,0.366,3.195,0.813,4.771,1.203c2.552,0.602,5.154,1.211,7.657,2.016c1.138,0.333,2.235,0.813,3.349,1.179 c2.991,1.032,5.918,2.057,8.787,3.325c14.534,6.218,27.946,15.2,39.464,26.735c12.372,12.315,21.85,26.784,28.182,42.927 c6.942,17.607,26.776,26.223,44.358,19.313c17.623-6.901,26.255-26.751,19.305-44.317c-9.779-24.987-24.435-47.325-43.447-66.329 c-17.322-17.289-37.416-30.775-59.143-40.399c-0.301-0.154-0.536-0.333-0.845-0.455c-0.252-0.122-0.488-0.187-0.732-0.301 c-4.885-2.089-9.868-3.894-14.932-5.584c-1.211-0.423-2.382-0.935-3.617-1.292c-4.804-1.52-9.665-2.731-14.55-3.812 c-1.544-0.366-3.073-0.87-4.617-1.171c-4.885-0.992-9.836-1.65-14.81-2.252c-1.544-0.187-3.048-0.553-4.625-0.732 c-6.519-0.634-13.152-0.975-19.785-0.975c-0.358,0-0.788,0.065-1.179,0.065c-5.462,0-10.835,0.309-16.151,0.788 c-1.861,0.13-3.739,0.366-5.601,0.602c-4.081,0.488-8.12,1.097-12.128,1.821c-1.813,0.301-3.585,0.626-5.373,0.992 c-5.064,1.057-10.136,2.325-15.054,3.78c-0.463,0.146-0.943,0.236-1.423,0.382c-5.796,1.756-11.469,3.837-17.013,6.096 c-0.585,0.219-1.089,0.488-1.634,0.699c-5.259,2.227-10.437,4.674-15.452,7.332c-0.333,0.154-0.658,0.325-1.016,0.504 C95.69,50.6,75.409,67.191,58.997,87.602l-30.539-30.58C12.803,41.391,0,46.674,0,68.825v87.211 c0,22.183,18.102,40.277,40.228,40.277C40.228,196.313,127.505,196.313,127.505,196.313z",fill:n}),j.createElement("path",{id:"svg-path",d:"M380.783,224.706h-87.268c-22.118,0-27.393,12.786-11.77,28.45l31.197,31.206 c-4.406,6.121-9.161,11.86-14.542,17.111c-1.902,1.861-3.894,3.642-5.918,5.357c-2.235,1.935-4.536,3.715-6.844,5.43 c-2.3,1.691-4.593,3.406-6.999,4.926c-3.536,2.252-7.153,4.373-10.9,6.235c-1.74,0.894-3.495,1.723-5.267,2.536 c-4.024,1.821-8.12,3.438-12.282,4.828c-0.91,0.301-1.756,0.658-2.658,0.91c-5.162,1.593-10.445,2.715-15.843,3.617 c-1.39,0.236-2.812,0.423-4.202,0.658c-5.568,0.699-11.217,1.203-16.948,1.203c-4.284,0-8.511-0.179-12.729-0.602 c-1.788-0.179-3.56-0.536-5.316-0.788c-2.406-0.301-4.82-0.658-7.243-1.122c-1.504-0.26-3.016-0.788-4.519-1.105 c-2.626-0.675-5.251-1.276-7.852-2.065c-1.146-0.366-2.268-0.845-3.438-1.203c-2.894-1.024-5.763-2.048-8.633-3.284 c-14.534-6.243-27.97-15.2-39.489-26.702c-12.404-12.429-21.874-26.881-28.214-42.96c-6.877-17.623-26.767-26.255-44.358-19.346 c-17.566,6.917-26.263,26.767-19.313,44.39c9.803,24.857,24.435,47.186,43.504,66.248c17.322,17.33,37.391,30.848,59.144,40.383 c0.301,0.171,0.545,0.358,0.813,0.455c0.236,0.146,0.496,0.203,0.707,0.293c4.999,2.187,10.136,4.056,15.314,5.771 c1.097,0.358,2.113,0.813,3.211,1.154c4.975,1.561,10.047,2.772,15.135,3.95c1.333,0.317,2.658,0.723,4.048,0.992 c5.121,1.089,10.405,1.813,15.688,2.414c1.26,0.179,2.463,0.455,3.707,0.569c6.544,0.634,13.12,1.032,19.793,1.032 c0.358,0,0.691-0.073,1.049-0.073c5.527-0.033,10.99-0.325,16.387-0.813c1.788-0.154,3.601-0.366,5.406-0.577 c4.17-0.504,8.299-1.105,12.396-1.845c1.723-0.293,3.406-0.626,5.105-0.984c5.243-1.065,10.437-2.357,15.509-3.894 c0.358-0.057,0.658-0.163,1.024-0.236c5.82-1.756,11.591-3.869,17.2-6.153l1.325-0.585c5.373-2.219,10.616-4.731,15.753-7.446 c0.268-0.154,0.545-0.301,0.845-0.455c22.809-12.193,43.09-28.783,59.509-49.21l30.539,30.531 c15.664,15.696,28.45,10.372,28.45-11.762v-87.187C421.011,242.801,402.901,224.706,380.783,224.706z",fill:n})))}}]),t}(j.Component),Q=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=void 0===t?"#fff":t,i=e.size,a=void 0===i?"80%":i;return j.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Capa_1",width:a,height:a,viewBox:"0 0 348.333 348.334"},j.createElement("path",{id:"svg-path",d:"M336.559,68.611L231.016,174.165l105.543,105.549c15.699,15.705,15.699,41.145,0,56.85 c-7.844,7.844-18.128,11.769-28.407,11.769c-10.296,0-20.581-3.919-28.419-11.769L174.167,231.003L68.609,336.563 c-7.843,7.844-18.128,11.769-28.416,11.769c-10.285,0-20.563-3.919-28.413-11.769c-15.699-15.698-15.699-41.139,0-56.85 l105.54-105.549L11.774,68.611c-15.699-15.699-15.699-41.145,0-56.844c15.696-15.687,41.127-15.687,56.829,0l105.563,105.554 L279.721,11.767c15.705-15.687,41.139-15.687,56.832,0C352.258,27.466,352.258,52.912,336.559,68.611z",fill:n}))}}]),t}(j.Component),J=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=void 0===t?"#fff":t,i=e.size,a=void 0===i?"100%":i;return j.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:a,height:a},j.createElement("path",{id:"svg-path",d:"M501.608,384.478L320.497,51.476C291.376,2.451,220.139,2.41,191.21,52.003L10.647,383.951 c-29.706,49.989,6.259,113.291,64.482,113.291h361.689C495.436,497.242,530.688,433.393,501.608,384.478z M331,332.242 c0,22.516-23.688,36.693-43.403,26.836L211,320.787v101.455c0,8.284-6.716,15-15,15h-30c-8.284,0-15-6.716-15-15v-150 c0-22.516,23.69-36.667,43.418-26.836L271,283.698V182.242c0-8.286,6.716-15,15-15h30c8.284,0,15,6.714,15,15V332.242z",fill:n}))}}]),t}(j.Component),$=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=void 0===t?"#fff":t,i=e.size,a=void 0===i?"100%":i;return j.createElement("svg",{id:"pivot",xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 511.612 511.612"},j.createElement("path",{id:"svg-path",d:"M433.822,126.876l-113.28-113.28c-18.048-18.112-49.632-18.144-67.744,0c-18.752,18.752-18.752,49.312,0,68.064 l29.984,29.952h-18.976c-110.272,0-200,89.728-200,200s89.728,200,200,200h8c8.832,0,16-7.168,16-16v-64c0-8.832-7.168-16-16-16 h-8c-57.344,0-104-46.656-104-104s46.656-104,104-104h21.216l-32.224,32.192c-18.752,18.784-18.752,49.312,0,68.064 c17.984,17.952,50.304,17.536,67.744,0l113.312-113.28c8.864-8.896,13.952-21.152,13.952-33.696 C447.806,148.444,442.974,136.476,433.822,126.876z",fill:n}))}}]),t}(j.Component),ee=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=void 0===t?"#fff":t,i=e.size,a=void 0===i?"90%":i;return j.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",id:"cancel",viewBox:"0 0 512 512",width:a,height:a},j.createElement("path",{id:"svg-path",d:"M256,0C114.833,0,0,114.844,0,256s114.833,256,256,256s256-114.844,256-256S397.167,0,256,0z M256,426.667 c-94.104,0-170.667-76.563-170.667-170.667c0-31.596,8.785-61.112,23.814-86.52L342.52,402.853 C317.112,417.882,287.596,426.667,256,426.667z M402.853,342.52L169.48,109.147c25.408-15.029,54.923-23.814,86.52-23.814 c94.104,0,170.667,76.563,170.667,170.667C426.667,287.596,417.882,317.112,402.853,342.52z",fill:n}))}}]),t}(j.Component),te=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=void 0===t?"#fff":t,i=e.size,a=void 0===i?"90%":i;return j.createElement("svg",{id:"CheckMark",xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 442.533 442.533"},j.createElement("path",{d:"M434.539,98.499l-38.828-38.828c-5.324-5.328-11.799-7.993-19.41-7.993c-7.618,0-14.093,2.665-19.417,7.993L169.59,247.248 l-83.939-84.225c-5.33-5.33-11.801-7.992-19.412-7.992c-7.616,0-14.087,2.662-19.417,7.992L7.994,201.852 C2.664,207.181,0,213.654,0,221.269c0,7.609,2.664,14.088,7.994,19.416l103.351,103.349l38.831,38.828 c5.327,5.332,11.8,7.994,19.414,7.994c7.611,0,14.084-2.669,19.414-7.994l38.83-38.828L434.539,137.33 c5.325-5.33,7.994-11.802,7.994-19.417C442.537,110.302,439.864,103.829,434.539,98.499z",fill:n}))}}]),t}(j.Component),ne=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=void 0===t?"#fff":t,i=e.size,a=void 0===i?"100%":i;return S.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 373.008 373.008"},S.a.createElement("path",{d:"M61.792 2.588A19.258 19.258 0 0171.444 0c3.33 0 6.663.864 9.655 2.588l230.116 167.2a19.327 19.327 0 019.656 16.719 19.293 19.293 0 01-9.656 16.713L81.099 370.427a19.336 19.336 0 01-19.302 0 19.333 19.333 0 01-9.66-16.724V19.305a19.308 19.308 0 019.655-16.717z",fill:n}))}}]),t}(S.a.PureComponent),ie=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=void 0===t?"#fff":t,i=e.size,a=void 0===i?"100%":i;return S.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 792 792"},S.a.createElement("path",{d:"M282.856 0H169.714c-31.228 0-56.571 25.344-56.571 56.571v678.857c0 31.228 25.344 56.571 56.571 56.571h113.143c31.256 0 56.572-25.315 56.572-56.571V56.571C339.428 25.344 314.112 0 282.856 0zm339.429 0H509.143c-31.256 0-56.572 25.344-56.572 56.571v678.857c0 31.228 25.316 56.571 56.572 56.571h113.143c31.256 0 56.572-25.315 56.572-56.571V56.571C678.857 25.344 653.541 0 622.285 0z",fill:n}))}}]),t}(S.a.PureComponent),ae=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=void 0===t?"#fff":t,i=e.size,a=void 0===i?"100%":i;return S.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 400.548 400.548"},S.a.createElement("path",{d:"M383.86 99.79a27.04 27.04 0 00-29.466 5.86l-51.507 51.512v-31.397c0-22.359-18.13-40.491-40.493-40.491H40.493C18.131 85.274 0 103.406 0 125.765v149.018c0 22.359 18.131 40.491 40.493 40.491h221.901c22.363 0 40.493-18.132 40.493-40.491v-31.398l51.507 51.512a27.04 27.04 0 0019.126 7.924c3.481 0 6.995-.678 10.34-2.063a27.04 27.04 0 0016.688-24.978V124.767A27.037 27.037 0 00383.86 99.79zM190.309 210.764l-55.191 42.403a13.21 13.21 0 01-8.06 2.738 13.223 13.223 0 01-13.226-13.228V157.87a13.22 13.22 0 017.38-11.864 13.22 13.22 0 0113.905 1.375l55.191 42.402a13.228 13.228 0 01.001 20.981z",fill:n}))}}]),t}(S.a.PureComponent);function re(){var e=Object(R.a)(['\n  position: relative;\n  box-sizing: border-box;\n  width: 30px;\n  height: 30px;\n\n  background-color: "transparent";\n  background-image: ',";\n  background-size: cover;\n  display: flex;\n  align-items: flex-end;\n  justify-content: center;\n  font-family: arial;\n  font-size: 10px;\n"]);return re=function(){return e},e}var se=F.b.div(re(),(function(e){return"url(".concat(e.background,")")}));function oe(){var e=Object(R.a)(["\n  display: flex;\n  margin: 0 8px;\n  flex-grow: 1;\n  flex-basis: calc(50% - 16px);\n"]);return oe=function(){return e},e}function ue(){var e=Object(R.a)(["\n  flex-grow: 1;\n  justify-content: flex-end;\n"]);return ue=function(){return e},e}function ce(){var e=Object(R.a)(["\n  display: flex;\n  margin: 0;\n  padding: 0;\n  flex-wrap: wrap;\n"]);return ce=function(){return e},e}function le(){var e=Object(R.a)(["\n  ","\n  ","\n  border-radius: 5px;\n  margin: 30px auto;\n"]);return le=function(){return e},e}function he(){var e=Object(R.a)(["\n  ","\n  background-color: ","\n"]);return he=function(){return e},e}function de(){var e=Object(R.a)(["\n  width: 500px;\n"]);return de=function(){return e},e}function me(){var e=Object(R.a)(["\n  padding: 10px;\n"]);return me=function(){return e},e}function fe(){var e=Object(R.a)(["\n  border-radius: 30px 0px 0px 30px;\n  box-shadow: 5px 5px 10px black;\n"]);return fe=function(){return e},e}function pe(){var e=Object(R.a)(["\n  border-radius: 0px 0px 30px 30px;\n  box-shadow: 5px 5px 10px black;\n"]);return pe=function(){return e},e}function ve(){var e=Object(R.a)(["\n  border-radius: 0px 0px 30px 0px;\n  box-shadow: 5px 5px 10px black;\n"]);return ve=function(){return e},e}function ge(){var e=Object(R.a)(["\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  right: 0;\n  top: 0;\n  z-index: 99999;\n  background-color: rgba(0, 0, 0, 0.5);\n"]);return ge=function(){return e},e}function ye(){var e=Object(R.a)(["\n  display: flex;\n  flex-direction: column;\n  border: 1px solid #496791;\n  color: #deebff;\n  background-color: #0a3340;\n  font-family: arial;\n  margin-bottom: 10px;\n\n  :last-child {\n    margin-bottom: 0;\n  }\n"]);return ye=function(){return e},e}var be=F.b.div(ye()),Oe=(F.b.div(ge()),Object(F.b)(be)(ve()),Object(F.b)(be)(pe()),Object(F.b)(be)(fe()),Object(F.a)(me())),we=Object(F.a)(de()),ke=Object(F.b)(be)(he(),Oe,L),je=Object(F.b)(be)(le(),Oe,we),Se=F.b.div(ce()),xe=Object(F.b)(Se)(ue()),Ce=F.b.div(oe());function Te(){var e=Object(R.a)(["\n  color: ",";\n  padding: 0;\n  margin: 0;\n  padding-left: 5px;\n"]);return Te=function(){return e},e}function Ee(){var e=Object(R.a)(["\n  display: flex;\n  font-family: arial;\n  font-size: 12px;\n  color: #deebff;\n  padding: 10px;\n"]);return Ee=function(){return e},e}function Ae(){var e=Object(R.a)(["\n  font-family: arial;\n  font-size: 12px;\n  color: #deebff;\n  padding: 10px;\n"]);return Ae=function(){return e},e}F.b.p(Ae());var Pe=F.b.span(Ee()),Ie=F.b.span(Te(),V);function De(){var e=Object(R.a)(["\n  font-weight: normal;\n"]);return De=function(){return e},e}function Me(){var e=Object(R.a)(["\n  font-family: arial;\n  font-size: 16px;\n  text-transform: uppercase;\n  color: #deebff;\n  padding: 10px;\n  font-weight: bold;\n"]);return Me=function(){return e},e}var ze=F.b.span(Me()),Re=Object(F.b)(ze)(De());function Fe(){var e=Object(R.a)(["\n  ","\n\n  &:hover {\n    text-shadow: white 0 0 10px, white 0 0 3px;\n    opacity: 2;\n    ","\n    color: #deebff;\n  }\n"]);return Fe=function(){return e},e}var He=Object(F.a)(Fe(),(function(e){return!e.disabled&&"cursor: pointer;"}),(function(e){return e.disabled&&"opacity: 0.5;"}));function Le(){var e=Object(R.a)(["\n  color: ",";\n  font-size: 12px;\n  height: 18px;\n  overflow: hidden;\n  font-weight: bolder;\n"]);return Le=function(){return e},e}var Be=Object(F.b)(Se)(Le(),i.textDanger);function _e(){var e=Object(R.a)(["\n  display: flex;\n  color: #0a3340;\n  background-color: white;\n  padding: 3px 6px;\n  border: 1px solid #04161c;\n  border-radius: 3px;\n  width: calc(70% - 12px);\n  height: 16px;\n\n  min-width: 150px;\n  max-width: 100%;\n  flex-grow: 1;\n"]);return _e=function(){return e},e}function Ue(){var e=Object(R.a)(["\n  display: flex;\n  max-width: 300px;\n  color: #deebff;\n  align-items: center;\n  padding: 4px 10px 4px 0;\n"]);return Ue=function(){return e},e}function Ne(){var e=Object(R.a)(["\n  position: relative;\n  display: flex;\n  flex: 1 1 100%;\n  margin: 0;\n  padding: 0;\n  flex-wrap: wrap;\n  align-items: center;\n"]);return Ne=function(){return e},e}function Ve(){var e=Object(R.a)(["\n  display: flex;\n  box-sizing: border-box;\n  flex-direction: column;\n  flex-grow: 1;\n  margin: 5px 0px;\n"]);return Ve=function(){return e},e}var Ge=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.label,i=e.type,a=e.value,r=e.placeholder,s=e.onKeyDown,o=e.onChange,u=e.error,c=Object(D.a)(e,["id","label","type","value","placeholder","onKeyDown","onChange","error"]);return j.createElement(We,null,j.createElement(qe,null,n&&j.createElement(Ze,{htmlFor:t},n),j.createElement(Ke,Object.assign({id:t,type:i||"text",value:a,placeholder:r,onKeyDown:s,onChange:o,tabIndex:"0"},c))),j.createElement(Be,null,u))}}]),t}(j.Component),We=F.b.div(Ve()),qe=F.b.div(Ne()),Ze=F.b.div(Ue()),Ke=F.b.input(_e());function Xe(){var e=Object(R.a)(["\n  border: none;\n  width: 40px;\n  height: 40px;\n  background-color: transparent;\n  margin: 0;\n  cursor: pointer;\n  background-image: ",";\n  background-size: cover;\n  opacity: 0.5;\n  filter: brightness(3) grayscale(100%);\n\n  ","\n\n  ","\n\n  &:hover {\n    ","\n  }\n\n  &:focus {\n    outline: 0;\n  }\n\n  svg #svg-path {\n    fill: white;\n    ","\n  }\n"]);return Xe=function(){return e},e}function Ye(){var e=Object(R.a)(["\n  opacity: 1;\n  filter: brightness(5) grayscale(100%);\n"]);return Ye=function(){return e},e}function Qe(){var e=Object(R.a)(["\n  filter: brightness(0.25) grayscale(100%);\n"]);return Qe=function(){return e},e}function Je(){var e=Object(R.a)(["\n  filter: brightness(5) grayscale(100%);\n  opacity: 1;\n"]);return Je=function(){return e},e}function $e(){var e=Object(R.a)(["\n  margin: 0 8px;\n  display: flex;\n"]);return $e=function(){return e},e}function et(){var e=Object(R.a)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  width: 100%;\n"]);return et=function(){return e},e}function tt(){var e=Object(R.a)(["\n  justify-content: center;\n  "," {\n    padding-right: 0;\n  }\n"]);return tt=function(){return e},e}function nt(){var e=Object(R.a)(["\n        border: 1px solid white;\n      "]);return nt=function(){return e},e}function it(){var e=Object(R.a)(["\n      cursor: pointer;\n      color: white;\n      background-color: ",";\n      border: 1px solid black;\n    "]);return it=function(){return e},e}function at(){var e=Object(R.a)(["\n  display: flex;\n  box-sizing: border-box;\n  margin: 2px 8px;\n\n  ","\n  font-weight: ",";\n  font-size: ",";\n  ",";\n  text-align: left;\n  color: #5e85bc;\n  font-family: arial;\n  \n  ","\n\n  &:hover {\n    ","\n  }\n"]);return at=function(){return e},e}function rt(){var e=Object(R.a)(["\n  padding-right: 5px;\n  color: white;\n"]);return rt=function(){return e},e}function st(){var e=Object(R.a)(["\n  display: flex;\n  border-bottom: 1px solid #aaaaaa;\n  width: calc(100% - 16px);\n  margin: 5px 8px;\n  font-weight: bold;\n  font-size: 12px;\n  color: white;\n"]);return st=function(){return e},e}function ot(){var e=Object(R.a)(["\n  display: flex;\n  justify-content: space-between;\n  text-transform: uppercase;\n  border-bottom: 1px solid #aaaaaa;\n  width: calc(100% - 16px);\n  margin: 5px 8px;\n  font-weight: bold;\n  font-size: 12px;\n"]);return ot=function(){return e},e}function ut(){var e=Object(R.a)(["\n  color: ",";\n"]);return ut=function(){return e},e}function ct(){var e=Object(R.a)(["\n  position: absolute;\n  z-index: 20000;\n  ","\n  text-align: left;\n  filter: brightness(1);\n"]);return ct=function(){return e},e}function lt(){var e=Object(R.a)(["\n  z-index: 7001;\n  position: absolute;\n"]);return lt=function(){return e},e}function ht(){var e=Object(R.a)(["\n  opacity: 0.95;\n  text-align: center;\n  font-family: arial;\n  font-size: 12px;\n  color: white;\n  background-color: black;\n  border-radius: 7px;\n  -moz-border-radius: 7px;\n  -webkit-border-radius: 7px;\n  padding: 3px 8px 8px 8px;\n  border: 1px solid #121212;\n  filter: brightness(1);\n  cursor: initial;\n"]);return ht=function(){return e},e}var dt=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.className;return j.createElement("div",{className:n},t)}}]),t}(j.Component),mt=Object(F.b)(dt)(ht()),ft=Object(F.b)(mt)(lt()),pt=Object(F.b)(ft)(ct(),(function(e){return Object.keys(e.position).reduce((function(t,n){return t+"\n"+n+":"+e.position[n]+"px;"}),"")})),vt=F.b.div(ut(),i.lightBlue),gt=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.element,n=e.children,i=Object(D.a)(e,["element","children"]);return j.createElement(pt,Object.assign({position:function(e){var t=e.getBoundingClientRect?e.getBoundingClientRect():e.get(0).getBoundingClientRect(),n={};return t.top>window.innerHeight/2?n.bottom=32:n.top=32,t.left>window.innerWidth/2?n.right=0:n.left=0,n}(t)},i),n)}}]),t}(j.Component),yt=F.b.div(ot()),bt=F.b.div(st()),Ot=F.b.div(rt()),wt=F.b.div(at(),(function(e){return e.noMargin&&"margin: 0;"}),(function(e){return e.important?"bold":"inherit"}),(function(e){return e.important?"14px":"11px"}),(function(e){return e.space&&"margin-top: 14px"}),(function(e){return e.clickable&&Object(F.a)(it(),Z)}),(function(e){return e.clickable&&Object(F.a)(nt())})),kt=Object(F.b)(wt)(tt(),Ot),jt=F.b.div(et()),St=F.b.div($e()),xt=Object(F.a)(Je()),Ct=Object(F.a)(Qe()),Tt=Object(F.a)(Ye()),Et=F.b.button(Xe(),(function(e){return e.img&&"url(".concat(e.img,")")}),(function(e){return e.selected&&!e.disabled&&xt}),(function(e){return e.disabled&&Ct}),(function(e){return!e.disabled&&Tt}),(function(e){return e.disabled&&"fill:#ff0000;"})),At=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t.sort((function(e,t){return!e.sort&&t.sort?1:e.sort&&!t.sort?-1:e.sort>t.sort?1:e.sort<t.sort?-1:0})).map((function(t,i){var a=t.value,r=t.header;return a&&a.replace&&(a=a.replace(/<br>/gm,"\n")),j.createElement(wt,{noMargin:""!==n,key:"shiptoolitip-".concat(i,"-").concat(n)},r&&j.createElement(Ot,null,r,": "),a&&Array.isArray(a)&&j.createElement(jt,null,e(a,n+"-"+i)),a&&!Array.isArray(a)&&j.createElement(vt,null,a))}))};function Pt(){var e=Object(R.a)(["\n  display: flex;\n  cursor: pointer;\n  position: relative;\n  margin: 3px 5px;\n\n  ","\n"]);return Pt=function(){return e},e}function It(){var e=Object(R.a)(["\n  width: 25px;\n  height: 25px;\n"]);return It=function(){return e},e}function Dt(){var e=Object(R.a)(["\n  display: flex;\n  text-transform: uppercase;\n  color: #0a3340;\n  border: 1px solid black;\n  background-color: #6792ce;\n  max-width: 240px;\n  justify-content: center;\n  box-shadow: 2px 3px 5px 2px rgba(0, 0, 0, 0.5);\n  border-radius: 1px;\n  padding: 3px;\n  font-weight: bold;\n  font-size: 16px;\n\n  &:hover,\n  &:active {\n    box-shadow: 0px 0px 3px 3px rgba(222, 235, 255, 0.5);\n    color: #0a3340;\n    background-color: #deebff;\n  }\n"]);return Dt=function(){return e},e}function Mt(){var e=Object(R.a)(["\n  display: flex;\n  border: 0;\n  padding: 3px;\n  font-weight: bold;\n  font-size: 16px;\n  background-color: transparent;\n\n  &:hover,\n  &:active {\n    color: #0a3340;\n  }\n"]);return Mt=function(){return e},e}function zt(){var e=Object(R.a)(["\n  background-color: #222;\n  padding: 5px 0px;\n  color: white;\n  text-decoration: none;\n  font-family: arial;\n  font-size: 12px;\n  text-transform: uppercase;\n  display: flex;\n  flex-grow: 1;\n  flex-basis: 100%;\n  border: none;\n  margin: 0;\n\n  justify-content: center;\n\n  &:hover,\n  &:active {\n    background-color: #deebff;\n    color: black;\n    text-decoration: none;\n  }\n"]);return zt=function(){return e},e}function Rt(){var e=Object(R.a)(["\n  display: inline;\n  border: none;\n  background-color: transparent;\n  color: #deebff;\n\n  &:hover,\n  &:active {\n    text-shadow: white 0 0 10px, white 0 0 3px;\n    opacity: 2;\n    color: #deebff;\n  }\n"]);return Rt=function(){return e},e}var Ft=Object(F.a)(Rt()),Ht=Object(F.a)(zt()),Lt=Object(F.a)(Mt()),Bt=Object(F.a)(Dt()),_t=F.b.div(It()),Ut=F.b.button(Pt(),(function(e){if(e.icon)return Lt;switch(e.buttonStyle){case"text":return Ft;case"button-grey":return Ht;default:return Bt}})),Nt=function(e){return S.a.createElement(Ut,e,e.icon&&S.a.createElement(_t,null,S.a.createElement(e.icon,{color:"#deebff"})),e.children)};function Vt(){var e=Object(R.a)(["\n  text-decoration: none;\n"]);return Vt=function(){return e},e}var Gt=Object(F.b)(z.b)(Vt()),Wt=n(6),qt=n(9),Zt=n.n(qt),Kt=n(19),Xt=new Kt.Color(0,138/255,1),Yt=new Kt.Color(196/255,39/255,39/255),Qt=Xt.clone().multiplyScalar(1.5),Jt=Yt.clone().multiplyScalar(1.5),$t=new Kt.Color(160/255,150/255,250/255),en=new Kt.Color(1,40/255,40/255),tn=[[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:0,r:1},{q:1,r:1}],[{q:1,r:0},{q:0,r:-1},{q:-1,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}]],nn=function(){function e(t,n){if(Object(T.a)(this,e),void 0===t&&console.trace(),t instanceof e||void 0!==t.q&&void 0!==t.r){var i=t;this.q=i.q,this.r=i.r}else this.q=t,this.r=n}return Object(E.a)(e,[{key:"getNeighbours",value:function(){var t=[];return tn[1&this.r].forEach((function(n){t.push(this.add(new e(n)))}),this),t}},{key:"getNeighbourAtHeading",value:function(t){return t>=330||t<=30?this.add(new e(1,0)):t>=150&&t<=210?this.add(new e(-1,0)):t>30&&t<90?this.add(new e(1,-1)):t>=90&&t<150?this.add(new e(0,-1)):t>210&&t<=270?this.add(new e(0,1)):t>270&&t<330?this.add(new e(1,1)):void 0}},{key:"add",value:function(e){return this.toCube().add(e.toCube()).toOffset()}},{key:"subtract",value:function(e){return this.toCube().subtract(e.toCube()).toOffset()}},{key:"scale",value:function(e){return this.toCube().scale(e).toOffset()}},{key:"moveToDirection",value:function(e,t){return this.toCube().moveToDirection(e,t).toOffset()}},{key:"equals",value:function(e){return this.q===e.q&&this.r===e.r}},{key:"getNeighbourAtDirection",value:function(e){return this.getNeighbours()[e]}},{key:"distanceTo",value:function(e){return this.toCube().distanceTo(e.toCube())}},{key:"ring",value:function(e){return this.toCube().ring(e).map((function(e){return e.toOffset()}))}},{key:"spiral",value:function(e){return this.toCube().spiral(e).map((function(e){return e.toOffset()}))}},{key:"clone",value:function(){return new e(this)}},{key:"toCube",value:function(){var e=this.q-(this.r+(1&this.r))/2,t=this.r;return new on(e,-e-t,t).round()}},{key:"drawLine",value:function(e,t){return this.toCube().drawLine(e.toCube(),t).map((function(e){return e.toOffset()}))}},{key:"toString",value:function(){return"(".concat(this.q,", ").concat(this.r,")")}},{key:"rotate",value:function(e){return this.toCube().rotate(e).toOffset()}},{key:"normalize",value:function(){return this.toCube().normalize().toOffset()}}]),e}(),an=function(e,t,n){return e+(t-e)*n},rn=function(e,t,n){return new sn(an(e.x,t.x,n),an(e.y,t.y,n),an(e.z,t.z,n))},sn=function(){function e(t,n,i){if(Object(T.a)(this,e),t instanceof e||void 0!==t.x&&void 0!==t.y&&void 0!==t.z){var a=t;this.x=this._formatNumber(a.x),this.y=this._formatNumber(a.y),this.z=this._formatNumber(a.z)}else this.x=this._formatNumber(t),this.y=this._formatNumber(n),this.z=this._formatNumber(i);this.neighbours=[{x:1,y:-1,z:0},{x:1,y:0,z:-1},{x:0,y:1,z:-1},{x:-1,y:1,z:0},{x:-1,y:0,z:1},{x:0,y:-1,z:1}],this._validate()}return Object(E.a)(e,[{key:"round",value:function(){if(this.x%1===0&&this.y%1===0&&this.z%1===0)return this;var t=Math.round(this.x),n=Math.round(this.y),i=Math.round(this.z),a=Math.abs(t-this.x),r=Math.abs(n-this.y),s=Math.abs(i-this.z);return a>r&&a>s?t=-n-i:r>s?n=-t-i:i=-t-n,new e(t,n,i)}},{key:"_validate",value:function(){if(Math.abs(this.x+this.y+this.z)>.001)throw new Error("Invalid Cube coordinates: ("+this.x+", "+this.y+", "+this.z+")")}},{key:"getNeighbours",value:function(){var t=[];return this.neighbours.forEach((function(n){t.push(this.add(new e(n)))}),this),t}},{key:"moveToDirection",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.add(new e(this.neighbours[t]).scale(n))}},{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)}},{key:"subtract",value:function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)}},{key:"scale",value:function(t){return new e(this.x*t,this.y*t,this.z*t)}},{key:"distanceTo",value:function(e){return Math.max(Math.abs(this.x-e.x),Math.abs(this.y-e.y),Math.abs(this.z-e.z))}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}},{key:"clone",value:function(){return new e(this)}},{key:"getFacing",value:function(e){var t=-1,n=e.subtract(this);return this.neighbours.some((function(e,i){return!!n.equals(e)&&(t=i,!0)})),t}},{key:"ring",value:function(e){var t=[];if(0===e)return t;for(var n=this.moveToDirection(4,e),i=0;i<6;i++)for(var a=0;a<e;a++)t.push(n),n=n.moveToDirection(i);return t}},{key:"spiral",value:function(e){for(var t=[this.clone()],n=1;n<=e;n++)t=t.concat(this.ring(n));return t}},{key:"toOffset",value:function(){var e=this.x+(this.z+(1&this.z))/2,t=this.z;return new nn(e,t)}},{key:"toString",value:function(){return"("+this.x+","+this.y+","+this.z+")"}},{key:"_formatNumber",value:function(e){return parseFloat(e.toFixed(4))}},{key:"normalize",value:function(){return this.drawLine(new e(0,0,0),1)[0]}},{key:"drawLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.distanceTo(e);null===t&&(t=n);for(var i=[],a=t;a>=0;a--)i.push(rn(e,this,1/n*a).round());return i}},{key:"rotate",value:function(t){for(var n,i=this;t--;)i=new e(-(n=i).y,-n.z,-n.x);return i}}]),e}(),on=sn,un={Cube:on,Offset:nn},cn=function(e){return e||(e=12.5),e*Math.sin(30/180*Math.PI)},ln=function(e){return e||(e=12.5),e*Math.cos(30/180*Math.PI)},hn=function(e){return e||(e=12.5),e+2*cn(e)},dn=function(e){return e||(e=12.5),2*ln(e)},mn=cn,fn=ln,pn=hn,vn=dn,gn=function(e){return e||(e=12.5),Math.floor(e+hn(e))},yn=function(e){return e||(e=12.5),2*dn(e)},bn=function(e){return dn()*(e+.5)},On=function(e){var t=Math.floor(e/2)*(hn()+12.5);return e%2!==0&&(t+=hn()),t},wn=function(e,t,n,i){return void 0!==t.x&&void 0!==e.x&&(n=t.x,i=t.y,t=e.y,e=e.x),Math.sqrt(Math.pow(n-e,2)+Math.pow(i-t,2))},kn=function(e){var t,n,i,a,r=function(e){for(var t=0,n=1779033703^e.length;t<e.length;t++)n=(n=Math.imul(n^e.charCodeAt(t),3432918353))<<13|n>>>19;return function(){return n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),(n^=n>>>16)>>>0}}(e);return t=r(),n=r(),i=r(),a=r(),function(){var e=n<<9,r=5*t;return a^=n,n^=i^=t,t^=a,i^=e,a=a<<11|a>>>21,((r=9*(r<<7|r>>>25))>>>0)/4294967296}},jn=function(e,t){return e+(t%=360)>360?t-(360-e):e+t<0?360+(e+t):e+t},Sn=function e(t,n){return t+n>5?e(0,t+n-6):t+n<0?e(6,t+n):t+n},xn=function(e,t,n,i,a){t=-t;var r=n+e*Math.cos(t*Math.PI/180),s=i+e*Math.sin(t*Math.PI/180);return a?{x:r,y:s}:{x:Math.round(r),y:Math.round(s)}},Cn=function(e){return e*(180/Math.PI)},Tn=function(e){return e/(180/Math.PI)},En=function(e,t){var n=Cn(Math.atan2(t.y-e.y,t.x-e.x));return n=n>0?360-n:Math.abs(n)},An=function(e){switch(e){case 0:return 0;case 1:return 60;case 2:return 120;case 3:return 180;case 4:return 240;default:return 300}},Pn=function(e){switch(e){case 0:return 0;case 60:return 1;case 120:return 2;case 180:return 3;case 240:return 4;default:return 5}},In=function(e){do{if(e.userData.icon)return e.userData.icon;e=e.parent}while(e.parent);return null},Dn=new(function(){function e(){Object(T.a)(this,e),this.hexlenght=12.5,this.width=0,this.height=0,this.zoom=1,this.camera=null,this.scene=null,this.raycaster=new Kt.Raycaster}return Object(E.a)(e,[{key:"init",value:function(e,t){this.camera=e,this.scene=t}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this.width=t,this.height=n}},{key:"onZoom",value:function(e){this.zoom=e}},{key:"fromHexToViewport",value:function(e){return this.fromGameToViewPort(this.fromHexToGame(e))}},{key:"getHexHeightViewport",value:function(){return pn()/this.zoom}},{key:"getHexDistance",value:function(){var e=new un.Offset(0,0),t=e.getNeighbourAtDirection(0);return wn(this.fromHexToGame(e),this.fromHexToGame(t))}},{key:"fromGameToHex",value:function(e){e||console.trace();var t=(1/3*Math.sqrt(3)*e.x-1/3*e.y)/this.hexlenght,n=2/3*e.y/this.hexlenght,i=-t-n;return new un.Cube(t,i,n).round().toOffset()}},{key:"fromHexToGame",value:function(e){e instanceof un.Cube&&(e=e.toOffset()),e instanceof un.Offset||(e=new un.Offset(e.q,e.r));var t=this.hexlenght*Math.sqrt(3)*(e.q-.5*(1&e.r)),n=3*this.hexlenght/2*e.r;return new Rn(t,n,0)}},{key:"fromViewPortToGame",value:function(e){var t={x:0,y:0,z:0};return this.raycaster.setFromCamera({x:e.xR,y:e.yR},this.camera.getCamera()),this.raycaster.intersectObjects(this.scene.children,!0).forEach((function(e){"hexgrid"===e.object.name&&(t.x=e.point.x,t.y=e.point.y,t.z=e.point.z)})),t}},{key:"getEntitiesIntersected",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=[];this.raycaster.setFromCamera({x:e.xR,y:e.yR},this.camera.getCamera());var n=this.raycaster.intersectObjects(this.scene.children,!0);return n.forEach((function(e){if("hexgrid"!==e.object.name){var n=In(e.object);n&&!t.includes(n)&&t.push(n)}})),t}},{key:"fromGameToViewPort",value:function(e){var t=new Kt.Vector3;return t.set(e.x,e.y,e.z||0),t.project(this.camera.getCamera()),t.x=Math.round((t.x+1)*this.width/2),t.y=Math.round((1-t.y)*this.height/2),t.z=0,{x:t.x,y:t.y}}}]),e}()),Mn=new Kt.Vector3,zn=new Kt.Vector3,Rn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(T.a)(this,e),t instanceof Kt.Vector3||t instanceof e?(this.x=t.x,this.y=t.y,this.z=t.z):t instanceof Kt.Vector2?(this.x=t.x,this.y=t.y,this.z=0):"object"===typeof t?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0):(this.x=t,this.y=n,this.z=i)}return Object(E.a)(e,[{key:"clone",value:function(){return new e(this.x,this.y,this.z)}},{key:"serialize",value:function(){return{x:this.x,y:this.y,z:this.z}}},{key:"setX",value:function(t){return new e(t,this.y,this.z)}},{key:"setY",value:function(t){return new e(this.x,t,this.z)}},{key:"setZ",value:function(t){return new e(this.x,this.y,t)}},{key:"setFromAngle",value:function(t){return new e(Math.cos(Tn(t)),Math.sin(Tn(t))).normalize()}},{key:"distanceTo",value:function(t){return t=new e(t),Mn.set(this.x,this.y,this.z),zn.set(t.x,t.y,t.z),Mn.distanceTo(zn)}},{key:"add",value:function(t){return t=new e(t),Mn.set(this.x,this.y,this.z),zn.set(t.x,t.y,t.z),Mn.add(zn),new e(Mn.x,Mn.y,Mn.z)}},{key:"dot",value:function(e){return Mn.set(this.x,this.y,this.z),zn.set(e.x,e.y,e.z),Mn.dot(zn)}},{key:"subtract",value:function(e){return this.sub(e)}},{key:"sub",value:function(t){return t=new e(t),Mn.set(this.x,this.y,this.z),zn.set(t.x,t.y,t.z),Mn.sub(zn),new e(Mn.x,Mn.y,Mn.z)}},{key:"normalize",value:function(){return Mn.set(this.x,this.y,this.z),Mn.normalize(),new e(Mn.x,Mn.y,Mn.z)}},{key:"multiplyScalar",value:function(t){return Mn.set(this.x,this.y,this.z),Mn.multiplyScalar(t),new e(Mn.x,Mn.y,Mn.z)}},{key:"length",value:function(){return Mn.set(this.x,this.y,this.z),Mn.length()}},{key:"applyMatrix4",value:function(t){return Mn.set(this.x,this.y,this.z),new e(Mn.applyMatrix4(t))}},{key:"equals",value:function(e){return!!e&&(this.x===e.x&&this.y===e.y&&this.z===e.z)}},{key:"round",value:function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}},{key:"roundToHexCenter",value:function(){return Dn.fromHexToGame(Dn.fromGameToHex(this))}},{key:"toString",value:function(){return"(x:".concat(this.x,", y:").concat(this.y,", z:").concat(this.z,")")}},{key:"toThree",value:function(){return new Kt.Vector3(this.x,this.y,this.z)}}]),e}(),Fn=function(){function e(t){Object(T.a)(this,e),this.getRandom=t||Math.random,this.active=!1,this.started=!1,this.done=!1}return Object(E.a)(e,[{key:"start",value:function(){this.active=!0}},{key:"stop",value:function(){this.active=!1}},{key:"setIsDone",value:function(e){return this.done=e,this}},{key:"setStartCallback",value:function(e){return this.startCallback=e,this}},{key:"setDoneCallback",value:function(e){return this.doneCallback=e,this}},{key:"callStartCallback",value:function(e){!this.started&&e>this.time&&(this.startCallback&&this.startCallback(),this.started=!0)}},{key:"callDoneCallback",value:function(e){e>this.time+this.duration&&!this.done&&(this.doneCallback&&this.doneCallback(),this.done=!0)}},{key:"getDuration",value:function(){return 0}},{key:"deactivate",value:function(){}},{key:"reset",value:function(){}},{key:"cleanUp",value:function(){}},{key:"update",value:function(e){}},{key:"render",value:function(e,t,n,i,a){}},{key:"getRandomPosition",value:function(e){return new Rn(this.getRandom()*e-.5*e,this.getRandom()*e-.5*e,this.getRandom()*e-.5*e)}}]),e}(),Hn=function(e,t,n,i){i=[].concat(i);var a=e.attributes[n].array;i.forEach((function(e,n){a[t*i.length+n]=e})),e.attributes[n].needsUpdate=!0},Ln=function(){function e(t,n){Object(T.a)(this,e),this.material=t,this.geometry=n,this.index=0,this.texture={gas:0,bolt:1,glow:2,ring:3,starLine:4}}return Object(E.a)(e,[{key:"create",value:function(e){return this.index=e,this}},{key:"setInitialValues",value:function(){return this.setPosition({x:0,y:0,z:0}),this.setColor(new Wt.Color(0,0,0)),this.setOpacity(0),this.setFadeIn(0,0),this.setFadeOut(0,0),this.setSize(0),this.setSizeChange(0),this.setAngle(0),this.setAngleChange(0),this.setActivationTime(0),this.setVelocity(new Wt.Vector3(0,0,0)),this.setAcceleration(new Wt.Vector3(0,0,0)),this.setTexture(this.texture.glow),this}},{key:"setSine",value:function(e,t){var n=Math.floor(e)+t;return Hn(this.geometry,this.index,"sine",n),this}},{key:"setTexture",value:function(e){return Hn(this.geometry,this.index,"textureNumber",e),this}},{key:"setSize",value:function(e){return Hn(this.geometry,this.index,"size",e),this}},{key:"setSizeChange",value:function(e){return Hn(this.geometry,this.index,"sizeChange",e),this}},{key:"setColor",value:function(e){return Hn(this.geometry,this.index,"color",[e.r,e.g,e.b]),this}},{key:"setOpacity",value:function(e){return Hn(this.geometry,this.index,"opacity",e),this}},{key:"setFadeIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return Hn(this.geometry,this.index,"fadeInTime",e),Hn(this.geometry,this.index,"fadeInSpeed",t),this}},{key:"setFadeOut",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return Hn(this.geometry,this.index,"fadeOutTime",e),Hn(this.geometry,this.index,"fadeOutSpeed",t),this}},{key:"setPosition",value:function(e){return Hn(this.geometry,this.index,"position",[e.x,e.y,e.z]),this}},{key:"setAngle",value:function(e){return Hn(this.geometry,this.index,"angle",Tn(e)),this}},{key:"setAngleChange",value:function(e){return Hn(this.geometry,this.index,"angleChange",Tn(e)),this}},{key:"setVelocity",value:function(e){return Hn(this.geometry,this.index,"velocity",[e.x,e.y,e.z]),this}},{key:"setAcceleration",value:function(e){return Hn(this.geometry,this.index,"acceleration",[e.x,e.y,e.z]),this}},{key:"deactivate",value:function(){return this.setInitialValues(),this}},{key:"setActivationTime",value:function(e){return Hn(this.geometry,this.index,"activationGameTime",e),this}}]),e}(),Bn="\n    attribute vec3 color;\n    attribute float opacity;\n    attribute float fadeInTime;\n    attribute float fadeInSpeed;\n    attribute float fadeOutTime;\n    attribute float fadeOutSpeed;\n    attribute float size;\n    attribute float sizeChange;\n    attribute float angle;\n    attribute float angleChange;\n    attribute vec3 velocity;\n    attribute vec3 acceleration;\n    attribute float activationGameTime;\n    attribute float textureNumber;\n    attribute float sine;\n    uniform float zoomLevel;\n    uniform float gameTime;\n    varying vec4  vColor;\n    varying float vAngle;\n    varying float textureN;\n    void main()\n    {\n        float elapsedTime = gameTime - activationGameTime;\n\n        if (elapsedTime < 0.0 || (fadeOutTime > 0.0 && gameTime - (fadeOutTime + fadeOutSpeed) > 0.0)) {\n            gl_PointSize = 0.0;\n            gl_Position = vec4( 0.0, 0.0, 0.0, 1.0 );\n            vColor = vec4(0.0, 0.0, 0.0, 0.0);\n            textureN = textureNumber;\n            return;\n        }\n\n        float currentOpacity = 0.0;\n        if (fadeInSpeed == 0.0) {\n            currentOpacity = opacity;\n        }\n\n\n        if (fadeInSpeed > 0.0 && gameTime > fadeInTime)\n        {\n            float fadeIn = (gameTime - fadeInTime) / fadeInSpeed;\n        if (fadeIn > 1.0) fadeIn = 1.0;\n            currentOpacity =  opacity * fadeIn;\n        }\n\n        if (fadeOutSpeed > 0.0 && gameTime > fadeOutTime)\n        {\n            float fadeOut = (gameTime - fadeOutTime) / fadeOutSpeed;\n        if (fadeOut > 1.0) fadeOut = 1.0;\n            currentOpacity =  currentOpacity * (1.0 - fadeOut);\n        }\n\n        if ( currentOpacity > 0.0 && elapsedTime >= 0.0)\n        {\n            float sineAmplitude = sine - floor(sine);\n            float sineFrequency = floor(sine);\n\n            if (sineFrequency > 0.0) {\n                currentOpacity *= (sineAmplitude * 0.5 * sin(elapsedTime/sineFrequency) + sineAmplitude);\n            }\n\n            \n            if (zoomLevel < 1.0) {\n                currentOpacity += (1.0 - zoomLevel) * 0.5;\n            }\n            \n            vColor = vec4( color, currentOpacity );\n        } else {\n            vColor = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n\n        \n        vAngle = angle + angleChange * elapsedTime;\n        textureN = textureNumber;\n\n        vec3 displacement = velocity * elapsedTime;\n        vec3 accelerationDisplacement  = elapsedTime * elapsedTime * 0.5 * acceleration;\n\n        vec3 modPos = position + displacement + accelerationDisplacement;\n\n\n        gl_PointSize = clamp(size + (sizeChange * elapsedTime), 0.0, 1024.0) * zoomLevel;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( modPos, 1.0 );\n    }\n",_n="\n    uniform sampler2D texture;\n    varying vec4 vColor;\n    varying float vAngle;\n    varying float textureN;\n    void main()\n    {\n        gl_FragColor = vColor;\n        if (gl_FragColor.a == 0.0) {\n            return;\n        }\n\n        float c = cos(vAngle);\n        float s = sin(vAngle);\n        float textureAmount = 8.0;\n        vec2 tPos = vec2((mod(textureN, textureAmount) * (1.0 / textureAmount)), (floor(textureN / textureAmount) * (1.0 / textureAmount)));\n\n        vec2 pos = vec2(gl_PointCoord.x, gl_PointCoord.y);\n        vec2 tCen = vec2(0.5, 0.5);\n\n        vec2 rPos = vec2(\n            tCen.x + c * (pos.x - tCen.x) - s * (pos.y - tCen.y),\n            tCen.y + s * (pos.x - tCen.x) + c * (pos.y - tCen.y)\n        );\n\n        rPos = clamp(rPos, 0.0, 1.0);\n\n        vec2 finalPos = vec2(\n            (rPos.x / textureAmount + tPos.x),\n            1.0 - (rPos.y / textureAmount + tPos.y)\n        );\n\n        vec4 rotatedTexture = texture2D(texture, finalPos);\n        gl_FragColor = gl_FragColor * rotatedTexture;\n    }\n",Un="\n    uniform sampler2D texture;\n    uniform float overlayAlpha;\n    uniform vec3 overlayColor;\n    uniform float opacity;\n\n    varying vec2 vUv;\n\n    void main() {\n        vec4 textureColor = texture2D(texture, vUv);\n        vec4 finalColor = textureColor;\n\n        if (overlayAlpha > 0.0 && textureColor.a > 0.0){\n            //finalColor = vec4(overlayColor, textureColor.a);\n            //finalColor = mix(textureColor, overlayColor, overlayAlpha);\n            //finalColor = (1.0 - t1.a) * t0 + t1.a * t1;\n            finalColor = (1.0 - overlayAlpha) * textureColor + overlayAlpha * vec4(overlayColor, 1.0);\n            finalColor.a = textureColor.a;\n        }\n\n        if (finalColor.a > 0.0) {\n            finalColor.a *= opacity;\n        }\n\n        gl_FragColor = finalColor;\n    }\n",Nn="\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);\n    }\n",Vn="\n    precision highp float;\n    uniform mat4 modelMatrix;\n    uniform mat4 viewMatrix;\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n    uniform vec3 color;\n    uniform float opacity;\n    attribute vec3 position;\n    attribute vec2 uv;\n    varying vec2 vUv;\n    varying float vOpacity;\n    varying vec3 vColor;\n\n    void main() {\n       \n        vUv = uv;\n        vOpacity = opacity;\n        vColor = color;\n        /*\n        vPulse = pulse;\n        vDashRatio = dashRatio;\n        */\n       \n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n    }\n",Gn="\n    precision highp float;\n    uniform sampler2D map;\n    uniform float textureRepeat;\n    uniform vec2 pulse;\n    uniform float time;\n    varying vec2 vUv;\n    varying float vOpacity;\n    varying vec3 vColor;\n\n    vec4 getPulse(vec4 color) {\n        float pulseAmount = pulse.x;\n        float pulseSpeed = pulse.y;\n\n        if (pulseAmount == 0.0 || pulseSpeed == 0.0) {\n            return color;\n        }\n\n        float pulseTime = mod(time * pulseSpeed, 1.0);\n        float y = mod(vUv.y * pulseAmount, 1.0);\n   \n        float diff = y - pulseTime;\n        if (diff < 0.0) {\n            diff = 1.0 + diff;\n        }\n\n        if (diff > 0.9) {\n            diff = 1.0 - ((diff - 0.9) * 10.0);\n        }\n    \n        color.a *= 1.0 + (diff);\n\n        return color;\n    }\n\n    vec4 repeatTexture() {\n        vec2 textureUv = vec2(\n            vUv.x,\n            vUv.y * textureRepeat\n        );\n\n        return texture2D(map, textureUv);\n    }\n\n    void main() {\n       \n      \n        float finalOpacity = repeatTexture().a * vOpacity;\n        vec4 finalColor = vec4(vColor, finalOpacity);\n        gl_FragColor = getPulse(finalColor);\n        \n    }\n",Wn=(new Wt.TextureLoader).load("/img/effect/effectTextures1024.png"),qn=function(e){function t(e,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(T.a)(this,t),i=Object(A.a)(this,Object(P.a)(t).call(this));var r=a.blending||Wt.AdditiveBlending;n||(n=1e3),i.scene=e,i.free=[];for(var s=0;s<n;s++)i.free.push(s);i.effects=0;var o={gameTime:{type:"f",value:0},zoomLevel:{type:"f",value:1},texture:{type:"t",value:Wn}};for(i.particleGeometry=new Wt.BufferGeometry,i.particleGeometry.addAttribute("position",new Wt.Float32BufferAttribute(new Float32Array(3*n),3).setDynamic(!0)),i.particleGeometry.addAttribute("size",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),i.particleGeometry.addAttribute("sizeChange",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),i.particleGeometry.addAttribute("color",new Wt.Float32BufferAttribute(new Float32Array(3*n),3).setDynamic(!0)),i.particleGeometry.addAttribute("opacity",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),i.particleGeometry.addAttribute("fadeInTime",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),i.particleGeometry.addAttribute("fadeInSpeed",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),i.particleGeometry.addAttribute("fadeOutTime",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),i.particleGeometry.addAttribute("fadeOutSpeed",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),i.particleGeometry.addAttribute("activationGameTime",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),i.particleGeometry.addAttribute("velocity",new Wt.Float32BufferAttribute(new Float32Array(3*n),3).setDynamic(!0)),i.particleGeometry.addAttribute("acceleration",new Wt.Float32BufferAttribute(new Float32Array(3*n),3).setDynamic(!0)),i.particleGeometry.addAttribute("textureNumber",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),i.particleGeometry.addAttribute("angle",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),i.particleGeometry.addAttribute("angleChange",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),i.particleGeometry.addAttribute("sine",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),i.particleGeometry.dynamic=!0,i.particleGeometry.setDrawRange(0,n),i.particleMaterial=new Wt.ShaderMaterial({uniforms:o,vertexShader:Bn,fragmentShader:_n,transparent:!0,blending:r,depthWrite:!1,depthTest:!1}),i.flyParticle=new Ln(i.particleMaterial,i.particleGeometry);n--;)i.flyParticle.create(n).setInitialValues();return i.mesh=new Wt.Points(i.particleGeometry,i.particleMaterial),i.mesh.position.set(0,0,0),i.mesh.frustumCulled=!1,i.needsUpdate=!1,i.scene.add(i.mesh),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"cleanUp",value:function(){this.mesh.material.dispose(),this.scene.remove(this.mesh)}},{key:"render",value:function(e){var t=e.total,n=e.zoom;this.particleMaterial.uniforms.gameTime.value=t,this.particleMaterial.uniforms.zoomLevel.value=1/n,this.mesh.material.needsUpdate=!0}},{key:"hasFree",value:function(){return this.free.length>0}},{key:"getParticle",value:function(){if(0===this.free.length)return!1;var e=this.free.pop();return this.flyParticle.create(e)}},{key:"freeParticles",value:function(e){(e=[].concat(e)).forEach((function(e){this.flyParticle.create(e).setInitialValues()}),this),this.free=this.free.concat(e)}}]),t}(Fn),Zn=function(){function e(t){Object(T.a)(this,e),this.boltContainer=t,this.index=null}return Object(E.a)(e,[{key:"setIndex",value:function(e){return this.index=e,this}},{key:"setOpacity",value:function(e){return this.boltContainer.setOpacity(this.index,e),this}},{key:"setPosition",value:function(e){return this.boltContainer.setPosition(this.index,e),this}},{key:"setScale",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.boltContainer.setScale(this.index,{x:e,y:t,z:t}),this}},{key:"setRotation",value:function(e){var t=new Wt.Quaternion;return t.setFromUnitVectors(new Wt.Vector3(1,0,0).normalize(),new Rn(e).normalize()),this.boltContainer.setQuaternion(this.index,t),this}},{key:"unsetTexture",value:function(){return this.boltContainer.setTexture(this.index,-1),this}},{key:"setGasTexture",value:function(){return this.boltContainer.setTexture(this.index,0),this}},{key:"setBoltTexture",value:function(){return this.boltContainer.setTexture(this.index,1),this}},{key:"setHaloTexture",value:function(){return this.boltContainer.setTexture(this.index,2),this}},{key:"setRayTexture",value:function(){return this.boltContainer.setTexture(this.index,3),this}},{key:"setColor",value:function(e){return this.boltContainer.setColor(this.index,e),this}},{key:"setVelocity",value:function(e){return this.boltContainer.setVelocity(this.index,e),this}},{key:"setActivationTime",value:function(e){return this.boltContainer.setActivationTime(this.index,e),this}},{key:"setDeactivationTime",value:function(e,t){return this.boltContainer.setDeactivationTime(this.index,e,t),this}}]),e}(),Kn=function(){function e(t,n,i,a,r,s,o,u,c,l,h,d,m,f){Object(T.a)(this,e),this.amount=h,this.offsetAttribute=t,this.opacityAttribute=n,this.textureNumberAttribute=i,this.scaleAttribute=a,this.quaternionAttribute=r,this.colorAttribute=s,this.velocityAttribute=o,this.activationGameTimeAttribute=u,this.deactivationGameTimeAttribute=c,this.deactivationFadeAttribute=l,this.mesh=d,this.scene=m,this.numberCreated=f,this.free=[];for(var p=0;p<this.amount;p++)this.free.push(p);this.flyBolt=new Zn(this)}return Object(E.a)(e,[{key:"setPosition",value:function(e){this.mesh.position.set(e.x,e.y,0)}},{key:"setRenderOrder",value:function(e){}},{key:"hasFree",value:function(){return this.free.length>0}},{key:"discard",value:function(){this.scene.remove(this.mesh)}},{key:"resetIndex",value:function(){this.used=0}},{key:"unassignEverything",value:function(){for(var e=[],t=0;t<this.amount;t++)e.push(0);this.opacityAttribute.setArray(e),this.opacityAttribute.needsUpdate=!0,this.used=0}},{key:"freeParticles",value:function(e){var t=this;(e=(e=[].concat(e)).filter((function(e){return!t.free.includes(e)}))).forEach((function(e){this.opacityAttribute.setX(e,0)}),this),this.opacityAttribute.needsUpdate=!0,this.free=this.free.concat(e)}},{key:"getParticle",value:function(){if(0===this.free.length)throw new Error("Container is full");return this.flyBolt.setIndex(this.free.pop())}},{key:"setOpacity",value:function(e,t){this.opacityAttribute.setX(e,t),this.opacityAttribute.needsUpdate=!0}},{key:"setPosition",value:function(e,t){this.offsetAttribute.setXYZ(e,t.x,t.y,t.z),this.offsetAttribute.needsUpdate=!0}},{key:"setScale",value:function(e,t){this.scaleAttribute.setXYZ(e,t.x,t.y,t.z),this.scaleAttribute.needsUpdate=!0}},{key:"setQuaternion",value:function(e,t){this.quaternionAttribute.setXYZW(e,t.x,t.y,t.z,t.w),this.quaternionAttribute.needsUpdate=!0}},{key:"setTexture",value:function(e,t){this.textureNumberAttribute.setX(e,t),this.textureNumberAttribute.needsUpdate=!0}},{key:"setColor",value:function(e,t){this.colorAttribute.setXYZ(e,t.r,t.g,t.b),this.colorAttribute.needsUpdate=!0}},{key:"setVelocity",value:function(e,t){this.velocityAttribute.setXYZ(e,t.x,t.y,t.z),this.velocityAttribute.needsUpdate=!0}},{key:"setActivationTime",value:function(e,t){this.activationGameTimeAttribute.setX(e,t),this.activationGameTimeAttribute.needsUpdate=!0}},{key:"setDeactivationTime",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deactivationGameTimeAttribute.setX(e,t),this.deactivationFadeAttribute.setX(e,n),this.deactivationGameTimeAttribute.needsUpdate=!0,this.deactivationFadeAttribute.needsUpdate=!0}}]),e}(),Xn=new(n(145).a),Yn=[],Qn=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=new Map,i=new Map,a=e.scene.clone(),r=e.animations;return Jn(e.scene,a,(function(e,t){n.set(t,e),i.set(e,t)})),a.traverse((function(e){if(e.isSkinnedMesh){var t=e,a=n.get(e),r=a.skeleton.bones;t.skeleton=a.skeleton.clone(),t.bindMatrix.copy(a.bindMatrix),t.skeleton.bones=r.map((function(e){return i.get(e)})),t.bind(t.skeleton,t.bindMatrix)}})),t&&a.traverse((function(e){e.isMesh&&(e.material=e.material.clone())})),{scene:a,animations:r}},Jn=function e(t,n,i){i(t,n);for(var a=0;a<t.children.length;a++)e(t.children[a],n.children[a],i)},$n=function(e){var t,n,i,a;return Zt.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(t=Yn.find((function(t){return t.url===e})))){r.next=6;break}return r.next=4,Zt.a.awrap(t.value);case 4:return n=r.sent,r.abrupt("return",Qn(n));case 6:return i={url:e,value:new Promise((function(t,n){Xn.load(e,(function(e){t(e)}))}))},Yn.push(i),r.next=10,Zt.a.awrap(i.value);case 10:return a=r.sent,r.abrupt("return",Qn(a));case 12:case"end":return r.stop()}}))},ei=null,ti=0,ni=function(){function e(t){var n=this;Object(T.a)(this,e),this.scene=t,this.ready=new Promise((function(e){return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(ei){t.next=4;break}return t.next=3,Zt.a.awrap(n.loadCube());case 3:ei=t.sent;case 4:e(!0);case 5:case"end":return t.stop()}}))}));var i=(new Wt.TextureLoader).load("/img/effect/effectTextures1024.png");this.material=new Wt.RawShaderMaterial({uniforms:{map:{value:i},gameTime:{type:"f",value:0},zoomLevel:{type:"f",value:0}},transparent:!0,depthWrite:!1,depthTest:!1,side:Wt.DoubleSide,blending:Wt.AdditiveBlending,vertexShader:"\n    precision highp float;\n    uniform mat4 modelMatrix;\n    uniform mat4 viewMatrix;\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n    uniform float gameTime;\n    uniform float zoomLevel;\n    attribute vec3 position;\n    attribute vec3 offset;\n    attribute float opacity;\n    attribute vec2 uv;\n    attribute float textureNumber;\n    attribute vec3 scale;\n    attribute vec4 quaternion;\n    attribute vec3 color;\n    attribute vec3 velocity;\n    attribute float activationGameTime;\n    attribute float deactivationGameTime;\n    attribute float deactivationFade;\n    varying float vActivationGameTime;\n    varying float vDeactivationGameTime;\n    varying vec3 vColor;\n    varying vec2 vUv;\n    varying float vOpacity;\n\n    float getScale() {\n        return 1.0;\n    }\n\n    vec2 resolveUv() {\n        float textureAmount = 8.0;\n        vec2 tPos = vec2(\n            (mod(textureNumber, textureAmount) * (1.0 / textureAmount)),\n            (floor(textureNumber / textureAmount) * (1.0 / textureAmount))\n        );\n        \n        vec2 finalPos = vec2((uv.x / textureAmount + tPos.x), 1.0 - (uv.y / textureAmount + tPos.y));\n\n        return finalPos;\n    }\n\n    // http://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/\n    vec3 applyQuaternionToVector(vec3 v ){\n        return v + 2.0 * cross( quaternion.xyz, cross( quaternion.xyz, v ) + quaternion.w * v );\n    }\n\n    float getTimeToEnd() {\n        float speed = length(velocity);\n\n        if (speed > 0.0) {  \n            float length = scale.x;\n            float timeToEnd = length / speed;\n            return timeToEnd ;\n        } else {  \n            return 0.0;\n        }\n    }\n\n    float getFadeOpacity() {\n\n        if (deactivationFade == 0.0) {\n            return 1.0;\n        }\n\n        if (gameTime < (deactivationGameTime - deactivationFade)) {\n            return 1.0;\n        }\n\n        float fade = gameTime - (deactivationGameTime - deactivationFade);\n\n        if (fade > deactivationFade) {\n            fade = deactivationFade;\n        }\n\n        float ratio = fade / deactivationFade;\n\n        return 1.0 - ratio;\n        \n    }\n\n    int active(float vertexDeltaTime) {\n        if (opacity == 0.0) {\n            return 0;\n        }\n\n        if (activationGameTime > gameTime) {\n            return 0;\n        }\n\n        if (deactivationGameTime + vertexDeltaTime < gameTime) {\n            return 0;\n        }\n        \n        return 1;\n    }\n\n    void main() {\n\n        float timeToEnd = getTimeToEnd();\n\n        if (active(timeToEnd) == 0) {\n            gl_Position = vec4(0.0);\n            vOpacity = 0.0;\n            return;\n        }\n\n        float currentOpacity = opacity;\n\n        if (zoomLevel < 1.0) {\n            currentOpacity += (1.0 - zoomLevel) * 0.5;\n        }\n\n        float elapsedTime = gameTime - activationGameTime;\n\n        vOpacity = currentOpacity * getFadeOpacity();\n        vUv = resolveUv();\n        vColor = color;\n        vActivationGameTime = activationGameTime + timeToEnd * uv.y;\n        vDeactivationGameTime = deactivationGameTime + timeToEnd * uv.y;\n        \n\n        \n        gl_Position = projectionMatrix * modelViewMatrix * vec4((offset + velocity * elapsedTime) + applyQuaternionToVector(position * scale), 1.0 );      \n     \n        //gl_Position = projectionMatrix * modelViewMatrix * vec4( offset + applyQuaternionToVector(position) * scale, 1.0 );      \n      }\n\n",fragmentShader:"\n    precision highp float;\n    uniform sampler2D map;\n    uniform float gameTime;\n    varying vec2 vUv;\n    varying float vOpacity;\n    varying vec3 vColor;\n    varying float vActivationGameTime;\n    varying float vDeactivationGameTime;\n\n    void main() {\n        if (vOpacity == 0.0) {\n            discard;\n        }\n\n        if (vActivationGameTime > gameTime) {\n            discard;\n        }\n\n        if (vDeactivationGameTime < gameTime) {\n            discard;\n        }\n\n        vec4 finalColor = vec4(vColor.rgb, texture2D(map, vUv).a * vOpacity);\n        gl_FragColor = finalColor;\n    }\n"}),this.start=Date.now()/3e3}return Object(E.a)(e,[{key:"render",value:function(e){var t=e.total,n=e.zoom;this.material.uniforms.gameTime.value=t,this.material.uniforms.zoomLevel.value=1/n,this.material.needsUpdate=!0}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;return this.makeInstanced(ei,e)}},{key:"loadCube",value:function(){var e,t;return Zt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(!ei){n.next=2;break}return n.abrupt("return",ei);case 2:return n.next=4,Zt.a.awrap($n("/img/3d/effect/bolt/scene.gltf"));case 4:return e=n.sent,t=e.scene.children[0].geometry,ei=t,n.abrupt("return",ei);case 8:case"end":return n.stop()}}))}},{key:"makeInstanced",value:function(e,t){var n,i,a,r,s,o,u,c,l,h;e=e.clone();var d=new Wt.InstancedBufferGeometry;d.index=e.index,d.attributes.position=e.attributes.position,d.attributes.uv=e.attributes.uv;for(var m=[],f=[],p=[],v=[],g=[],y=[],b=[],O=[],w=[],k=[],j=0;j<t;j++)m.push(0,0,.5),f.push(0),p.push(-1),v.push(1,1,1),g.push(0,1,0,0),y.push(0,0,0),b.push(0,0,0),O.push(0),w.push(0),k.push(0);n=new Wt.InstancedBufferAttribute(new Float32Array(m),3).setDynamic(!0),i=new Wt.InstancedBufferAttribute(new Float32Array(f),1).setDynamic(!0),a=new Wt.InstancedBufferAttribute(new Float32Array(p),1).setDynamic(!0),r=new Wt.InstancedBufferAttribute(new Float32Array(v),3).setDynamic(!0),s=new Wt.InstancedBufferAttribute(new Float32Array(g),4).setDynamic(!0),o=new Wt.InstancedBufferAttribute(new Float32Array(y),3).setDynamic(!0),u=new Wt.InstancedBufferAttribute(new Float32Array(b),3).setDynamic(!0),c=new Wt.InstancedBufferAttribute(new Float32Array(O),1).setDynamic(!0),l=new Wt.InstancedBufferAttribute(new Float32Array(w),1).setDynamic(!0),h=new Wt.InstancedBufferAttribute(new Float32Array(k),1).setDynamic(!0),d.addAttribute("offset",n),d.addAttribute("opacity",i),d.addAttribute("textureNumber",a),d.addAttribute("scale",r),d.addAttribute("quaternion",s),d.addAttribute("color",o),d.addAttribute("velocity",u),d.addAttribute("activationGameTime",c),d.addAttribute("deactivationGameTime",l),d.addAttribute("deactivationFade",h);var S=new Wt.Mesh(d,this.material);return S.frustumCulled=!1,this.scene.add(S),ti++,new Kn(n,i,a,r,s,o,u,c,l,h,t,S,this.scene,ti)}}]),e}(),ii=function(){function e(t,n){var i=this;Object(T.a)(this,e),this.scene=t,this.defaultParticleAmount=n,this.boltInstanceFactory=new ni(this.scene),this.reservations=[],this.emitters={star:[],bolt:[],effect:[]},this._isReady=!1,this.readyPromise=new Promise((function(e){return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Zt.a.awrap(i.boltInstanceFactory.ready);case 2:i._isReady=!0,e(!0);case 4:case"end":return t.stop()}}))}))}return Object(E.a)(e,[{key:"ready",value:function(){return this.readyPromise}},{key:"isReady",value:function(){return this._isReady}},{key:"createParticleEmitter",value:function(e){switch(e){case"star":return this.createStarParticleEmitter();case"bolt":return this.createBoltParticleEmitter();case"effect":default:return this.createEffectParticleEmitter()}}},{key:"createStarParticleEmitter",value:function(){return new oi(this.scene,this.defaultParticleAmount)}},{key:"createEffectParticleEmitter",value:function(){return new qn(this.scene,this.defaultParticleAmount)}},{key:"createBoltParticleEmitter",value:function(){return this.boltInstanceFactory.create(this.defaultParticleAmount)}},{key:"getParticle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"effect",n=this.emitters[t].find((function(e){return e.hasFree()}));n||(n=this.createParticleEmitter(t),this.emitters[t].push(n));var i=n.getParticle();return this.reservations.push({reserver:e,emitter:n,index:i.index}),i}},{key:"getStarParticle",value:function(e){return this.getParticle(e,"star")}},{key:"getBoltParticle",value:function(e){return this.getParticle(e,"bolt")}},{key:"getEffectParticle",value:function(e){return this.getParticle(e,"effect")}},{key:"cleanUp",value:function(){this.emitters.star.forEach((function(e){e.cleanUp()})),this.emitters.bolt.forEach((function(e){e.cleanUp()})),this.emitters.effect.forEach((function(e){e.cleanUp()})),this.emitters={star:[],bolt:[],effect:[]}}},{key:"release",value:function(e){this.reservations.forEach((function(t){t.reserver===e&&t.emitter.freeParticles(t.index)}))}},{key:"render",value:function(e){this.emitters.star.forEach((function(t){t.render(e)})),this.emitters.effect.forEach((function(t){t.render(e)})),this.boltInstanceFactory.render(e)}}]),e}(),ai=function(e,t,n,i){i=[].concat(i);var a=e.attributes[n].array;i.forEach((function(e,n){a[t*i.length+n]=e})),e.attributes[n].needsUpdate=!0},ri=function(){function e(t,n){Object(T.a)(this,e),this.material=t,this.geometry=n,this.index=0,this.texture={gas:0,bolt:1,glow:2,ring:3,starLine:4}}return Object(E.a)(e,[{key:"create",value:function(e){return this.index=e,this}},{key:"setInitialValues",value:function(){return this.setPosition({x:0,y:0}),this.setColor(new Wt.Color(0,0,0)),this.setOpacity(0),this.setSize(0),this.setSizeChange(0),this.setAngle(0),this.setAngleChange(0),this.setActivationTime(0),this.setTexture(this.texture.glow),this.setParallaxFactor(0),this.setSineFrequency(0),this.setSineAmplitude(1),this}},{key:"setTexture",value:function(e){return ai(this.geometry,this.index,"textureNumber",e),this}},{key:"setParallaxFactor",value:function(e){return ai(this.geometry,this.index,"parallaxFactor",-1+e),this}},{key:"setSineFrequency",value:function(e){return ai(this.geometry,this.index,"sineFrequency",e),this}},{key:"setSineAmplitude",value:function(e){return ai(this.geometry,this.index,"sineAmplitude",e),this}},{key:"setSize",value:function(e){return ai(this.geometry,this.index,"size",e),this}},{key:"setSizeChange",value:function(e){return ai(this.geometry,this.index,"sizeChange",e),this}},{key:"setColor",value:function(e){return ai(this.geometry,this.index,"color",[e.r,e.g,e.b]),this}},{key:"setOpacity",value:function(e){return ai(this.geometry,this.index,"opacity",e),this}},{key:"setPosition",value:function(e){return ai(this.geometry,this.index,"position",[e.x,e.y,e.z||0]),this}},{key:"setAngle",value:function(e){return ai(this.geometry,this.index,"angle",Tn(e)),this}},{key:"setAngleChange",value:function(e){return ai(this.geometry,this.index,"angleChange",Tn(e)),this}},{key:"deactivate",value:function(){return this.setInitialValues(),this}},{key:"setActivationTime",value:function(e){return ai(this.geometry,this.index,"activationGameTime",e),this}}]),e}(),si=(new Wt.TextureLoader).load("/img/effect/effectTextures1024.png"),oi=function(e){function t(e,n,i){var a;Object(T.a)(this,t),a=Object(A.a)(this,Object(P.a)(t).call(this)),i||(i={});var r=i.blending||Wt.AdditiveBlending;n||(n=1e3),a.scene=e,a.free=[];for(var s=0;s<n;s++)a.free.push(s);a.effects=0;var o={gameTime:{type:"f",value:0},texture:{type:"t",value:si}};for(a.particleGeometry=new Wt.BufferGeometry,a.particleGeometry.addAttribute("position",new Wt.Float32BufferAttribute(new Float32Array(3*n),3).setDynamic(!0)),a.particleGeometry.addAttribute("size",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),a.particleGeometry.addAttribute("sizeChange",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),a.particleGeometry.addAttribute("color",new Wt.Float32BufferAttribute(new Float32Array(3*n),3).setDynamic(!0)),a.particleGeometry.addAttribute("opacity",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),a.particleGeometry.addAttribute("activationGameTime",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),a.particleGeometry.addAttribute("textureNumber",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),a.particleGeometry.addAttribute("angle",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),a.particleGeometry.addAttribute("angleChange",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),a.particleGeometry.addAttribute("parallaxFactor",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),a.particleGeometry.addAttribute("sineFrequency",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),a.particleGeometry.addAttribute("sineAmplitude",new Wt.Float32BufferAttribute(new Float32Array(n),1).setDynamic(!0)),a.particleGeometry.dynamic=!0,a.particleGeometry.setDrawRange(0,n),a.particleMaterial=new Wt.ShaderMaterial({uniforms:o,vertexShader:"\n    attribute vec3 color;\n    attribute float opacity;\n    attribute float size;\n    attribute float sizeChange;\n    attribute float angle;\n    attribute float angleChange;\n    attribute float activationGameTime;\n    attribute float textureNumber;\n    attribute float parallaxFactor;\n    attribute float sineFrequency;\n    attribute float sineAmplitude;\n    uniform float gameTime;\n    varying vec4  vColor;\n    varying float vAngle;\n    varying float textureN;\n    void main()\n    {\n    \n        float elapsedTime = gameTime - activationGameTime;\n\n        if (elapsedTime < 0.0) {\n            gl_PointSize = 0.0;\n            gl_Position = vec4( 0.0, 0.0, 0.0, 1.0 );\n            vColor = vec4(0.0, 0.0, 0.0, 0.0);\n            textureN = textureNumber;\n            return;\n        }\n        \n\n        float currentOpacity = opacity;\n        if (sineFrequency > 0.0) {\n            currentOpacity = opacity + (sineAmplitude * 0.5 * sin(gameTime/sineFrequency) + sineAmplitude);\n        }\n\n        if ( currentOpacity > 0.0 && elapsedTime >= 0.0)\n        {\n            vColor = vec4( color, currentOpacity );\n        } else {\n            vColor = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n\n        vAngle = angle + angleChange * elapsedTime;\n        textureN = textureNumber;\n\n        vec3 modPos = vec3( position.x - (cameraPosition.x * parallaxFactor), position.y - (cameraPosition.y * parallaxFactor), position.z );\n\n\n        gl_PointSize = clamp(size + (sizeChange * elapsedTime), 0.0, 1024.0);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( modPos, 1.0 );\n        \n    }\n",fragmentShader:"\n    uniform sampler2D texture;\n    varying vec4 vColor;\n    varying float vAngle;\n    varying float textureN;\n    void main()\n    {\n        gl_FragColor = vColor;\n        if (gl_FragColor.a == 0.0) {\n            return;\n        }\n\n        float c = cos(vAngle);\n        float s = sin(vAngle);\n        float textureAmount = 8.0;\n        vec2 tPos = vec2((mod(textureN, textureAmount) * (1.0 / textureAmount)), (floor(textureN / textureAmount) * (1.0 / textureAmount)));\n\n        vec2 pos = vec2(gl_PointCoord.x, gl_PointCoord.y);\n        vec2 tCen = vec2(0.5, 0.5);\n\n        vec2 rPos = vec2(\n            tCen.x + c * (pos.x - tCen.x) - s * (pos.y - tCen.y),\n            tCen.y + s * (pos.x - tCen.x) + c * (pos.y - tCen.y)\n        );\n\n        rPos = clamp(rPos, 0.0, 1.0);\n\n        vec2 finalPos = vec2(\n            (rPos.x / textureAmount + tPos.x),\n            1.0 - (rPos.y / textureAmount + tPos.y)\n        );\n\n        vec4 rotatedTexture = texture2D(texture, finalPos);\n        gl_FragColor = gl_FragColor * rotatedTexture;\n    }\n",transparent:!0,blending:r,depthWrite:!1}),a.flyParticle=new ri(a.particleMaterial,a.particleGeometry);n--;)a.flyParticle.create(n).setInitialValues();return a.mesh=new Wt.Points(a.particleGeometry,a.particleMaterial),a.mesh.frustumCulled=!1,a.mesh.position.set(0,0,i.z||-10),a.needsUpdate=!1,a.scene.add(a.mesh),a}return Object(I.a)(t,e),Object(E.a)(t,[{key:"cleanUp",value:function(){this.mesh.material.dispose(),this.scene.remove(this.mesh)}},{key:"render",value:function(e){var t=e.total;this.particleMaterial.uniforms.gameTime.value=t,this.mesh.material.needsUpdate=!0}},{key:"hasFree",value:function(){return this.free.length>0}},{key:"getParticle",value:function(){if(0===this.free.length)return!1;var e=this.free.pop();return this.flyParticle.create(e)}},{key:"freeParticles",value:function(e){(e=[].concat(e)).forEach((function(e){this.flyParticle.create(e).setInitialValues()}),this),this.free=this.free.concat(e)}}]),t}(Fn),ui=function(){function e(t,n){Object(T.a)(this,e),this.starCount=5e3,this.emitterContainer=new ii(t,this.starCount),this.scene=t,this.lastAnimationTime=null,this.totalAnimationTime=0,this.zoomChanged=0,this.gameId=n,this.getRandom=null,this.create()}return Object(E.a)(e,[{key:"create",value:function(){var e;return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Zt.a.awrap(this.emitterContainer.ready());case 2:for(3e3,2e3,this.getRandom=kn(this.gameId),e=this.starCount;e--;)this.createStar(3e3,2e3),this.getRandom()>.98&&this.createShiningStar(3e3,2e3);return this.lastAnimationTime=(new Date).getTime(),this.totalAnimationTime=0,this.zoomChanged=1,t.abrupt("return",this);case 11:case"end":return t.stop()}}),null,this)}},{key:"resize",value:function(){}},{key:"cleanUp",value:function(){this.emitterContainer.release(this)}},{key:"render",value:function(){if(this.emitterContainer.isReady()){var e=(new Date).getTime()-this.lastAnimationTime;this.totalAnimationTime+=e,this.emitterContainer.render({delta:0,total:this.totalAnimationTime,last:0,zoom:this.zoomChanged}),1===this.zoomChanged&&(this.zoomChanged=0),this.lastAnimationTime=(new Date).getTime()}}},{key:"createStar",value:function(e,t){var n=this.emitterContainer.getStarParticle(this),i=(this.getRandom()-.5)*e*1.5,a=(this.getRandom()-.5)*t*1.5;n.setActivationTime(0).setSize(2+2*this.getRandom()).setOpacity(.2*this.getRandom()+.9).setPosition({x:i,y:a}).setColor(new Wt.Color(1,1,1)).setParallaxFactor(.1+.1*this.getRandom()),this.getRandom()>.9&&n.setSineFrequency(200*this.getRandom()+50).setSineAmplitude(this.getRandom())}},{key:"createShiningStar",value:function(e,t){var n=this.emitterContainer.getStarParticle(this),i=(this.getRandom()-.5)*e*1.5,a=(this.getRandom()-.5)*t*1.5,r=6+6*this.getRandom(),s=.1+.1*this.getRandom(),o=new Wt.Color(.4*this.getRandom()+.6,.2*this.getRandom()+.8,.4*this.getRandom()+.6);n.setActivationTime(0).setSize(.5*r).setOpacity(.2*this.getRandom()+.9).setPosition({x:i,y:a}).setColor(new Wt.Color(1,1,1)).setParallaxFactor(s),(n=this.emitterContainer.getStarParticle(this)).setActivationTime(0).setSize(r).setOpacity(.1*this.getRandom()+.1).setPosition({x:i,y:a}).setColor(o).setParallaxFactor(s).setSineFrequency(200*this.getRandom()+100).setSineAmplitude(.4*this.getRandom());var u=Math.round(8*this.getRandom())-3;if(!(u<=2))for(var c=360*this.getRandom(),l=.01*(this.getRandom()-.5);u--;)c+=60*this.getRandom()+40,(n=this.emitterContainer.getStarParticle(this)).setActivationTime(0).setSize(r*this.getRandom()*10+10).setOpacity(.1*this.getRandom()+.1).setPosition({x:i,y:a}).setColor(o).setParallaxFactor(s).setSineFrequency(200*this.getRandom()+100).setSineAmplitude(.1).setAngle(c).setAngleChange(l).setTexture(n.texture.starLine)}},{key:"createGasCloud",value:function(e,t){for(var n={x:(this.getRandom()-.5)*e,y:(this.getRandom()-.5)*t},i=this.getRandomBand(.5,1)*e/100,a=this.getRandomBand(.5,1)*e/100,r=Math.floor(3*this.getRandom())+5;r--;)this.createGasCloudPart({x:n.x,y:n.y},e),n.x+=50*this.getRandomBand(0,1)+i,n.y+=50*this.getRandomBand(0,1)+a}},{key:"getRandomBand",value:function(e,t){var n=this.getRandom()*(t-e)+e;return this.getRandom()>.5?-1*n:n}},{key:"createGasCloudPart",value:function(e,t){for(var n=Math.floor(5*this.getRandom()+5),i=.002*(this.getRandom()-.5);n--;)this.createGas(e,i,this.getRandom()*t*.4+.4*t)}},{key:"createGas",value:function(e,t,n){var i=this.emitterContainer.getStarParticle(this);e.x+=100*(this.getRandom()-.5),e.y+=100*(this.getRandom()-.5),i.setActivationTime(0).setSize(this.getRandom()*n*.5+.5*n).setOpacity(.005*this.getRandom()+.005).setPosition({x:e.x,y:e.y}).setColor(new Wt.Color(104/255,.8,249/255)).setTexture(i.texture.gas).setAngle(360*this.getRandom()).setAngleChange(t+.001*(this.getRandom()-.5)).setParallaxFactor(.1+.1*this.getRandom()),this.getRandom()>.9&&i.setActivationTime(0).setSize(this.getRandom()*n*.25+.25*n).setOpacity(0).setPosition({x:e.x,y:e.y}).setColor(new Wt.Color(1,1,1)).setTexture(i.texture.gas).setAngle(360*this.getRandom()).setAngleChange(t+.01*(this.getRandom()-.5)).setParallaxFactor(.1+.1*this.getRandom()).setSineFrequency(200*this.getRandom()+200).setSineAmplitude(.02*this.getRandom())}}]),e}();window.THREE=Wt;var ci=function(){function e(){Object(T.a)(this,e),this.starFieldScene=null,this.starFieldCamera=null,this.starField=null,this.width=null,this.height=null,this.element=null,this.initialized=!1,this.zoom=1}return Object(E.a)(e,[{key:"init",value:function(e,t){var n=t.width,i=t.height;this.element=e,this.scene=new Wt.Scene,this.width=n,this.height=i,this.starFieldScene=new Wt.Scene,this.starFieldCamera=new Wt.OrthographicCamera(this.zoom*this.width/-2,this.zoom*this.width/2,this.zoom*this.height/2,this.zoom*this.height/-2,-4e3,3e4),this.starFieldCamera.position.set(0,0,500),this.starFieldCamera.lookAt(0,0,100),this.renderer=new Wt.WebGLRenderer({alpha:!0,antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.autoClear=!1,this.renderer.context.getExtension("OES_standard_derivatives"),this.renderer.gammaOutput=!0,this.renderer.gammaFactor=2.2,e.appendChild(this.renderer.domElement),this.initialized=!0,this.starField=new ui(this.starFieldScene,"home"),this.render()}},{key:"render",value:function(){this.renderer.clear(),this.renderer.render(this.starFieldScene,this.starFieldCamera),this.starField.render(),requestAnimationFrame(this.render.bind(this))}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this.width=t,this.height=n,this.renderer.setSize(window.innerWidth,window.innerHeight),this.starField.resize()}}]),e}();function li(){var e=Object(R.a)(["\n  position: fixed;\n  top: 0px;\n  bottom: 0px;\n  left: 0px;\n  right: 0px;\n  display: flex;\n  background-size: cover;\n  background-color: #0b121a;\n  box-shadow: inset 0px 0px 200px rgba(0, 0, 0, 1);\n  z-index: -2;\n"]);return li=function(){return e},e}var hi=F.b.div(li()),di=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).canvasRef=j.createRef(),n.scene=new ci,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onResize.bind(this));var e=this.canvasRef.current;this.scene.init(e,this.getDimensions())}},{key:"getDimensions",value:function(){return{width:this.canvasRef.current.offsetWidth,height:this.canvasRef.current.offsetHeight}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResize.bind(this))}},{key:"onResize",value:function(){if(this.canvasRef.current){var e=this.getDimensions();this.scene.onResize(e)}}},{key:"shouldComponentUpdate",value:function(e,t){return!1}},{key:"render",value:function(){return j.createElement(hi,{ref:this.canvasRef})}}]),t}(j.Component),mi=n(67),fi=n(26),pi=n(12),vi=n(38),gi=n.n(vi),yi="http://localhost:4000",bi={withCredentials:!0,headers:{"Content-Type":"application/json"}},Oi=function(e,t){return Zt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Zt.a.awrap(gi.a.post("".concat(yi,"/login"),{username:e,password:t},bi));case 3:return n.abrupt("return",n.sent);case 6:throw n.prev=6,n.t0=n.catch(0),n.t0.response;case 9:case"end":return n.stop()}}),null,null,[[0,6]])},wi=function(e,t){return Zt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Zt.a.awrap(gi.a.post("".concat(yi,"/register"),{username:e,password:t},bi));case 3:return n.abrupt("return",n.sent);case 6:throw n.prev=6,n.t0=n.catch(0),n.t0.response;case 9:case"end":return n.stop()}}),null,null,[[0,6]])},ki=function(){return Zt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Zt.a.awrap(gi.a.get("".concat(yi,"/user"),bi));case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),e.t0.response;case 9:case"end":return e.stop()}}),null,null,[[0,6]])},ji=function(){return Zt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Zt.a.awrap(gi.a.get("".concat(yi,"/logout"),bi));case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),e.t0.response;case 9:case"end":return e.stop()}}),null,null,[[0,6]])},Si={withCredentials:!0,headers:{"Content-Type":"application/json"}},xi=function(e){return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.abrupt("return",gi.a.post("".concat(yi,"/game"),e.serialize(),Si));case 4:throw t.prev=4,t.t0=t.catch(0),t.t0.response;case 7:case"end":return t.stop()}}),null,null,[[0,4]])},Ci=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Object(T.a)(this,e),this.id=t,this.username=n,this.accessLevel=i}return Object(E.a)(e,[{key:"serialize",value:function(){return{id:this.id,username:this.username,accessLevel:this.accessLevel}}},{key:"deserialize",value:function(e){return this.id=e.id,this.username=e.username,this.accessLevel=e.accessLevel,this}}]),e}(),Ti="GET_CURRENT_USER",Ei=function(e){var t;return Zt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Zt.a.awrap(r.getCurrentUser());case 2:t=n.sent,e({type:Ti,payload:t});case 4:case"end":return n.stop()}}))},Ai=function(e,t){switch(t.type){case"GET_CURRENT_USER":var n=t.payload.data?(new Ci).deserialize(t.payload.data):null;return Object(pi.a)({},e,{currentUser:n});default:return e}},Pi=n(28),Ii=S.a.createContext({}),Di=S.a.createContext({}),Mi={currentUser:void 0},zi=function(e){var t=e.children,n=Object(j.useReducer)(Ai,Mi),i=Object(Pi.a)(n,2),a=i[0],r=i[1];return Object(j.useEffect)((function(){Ei(r)}),[]),S.a.createElement(Di.Provider,{value:r},S.a.createElement(Ii.Provider,{value:a},t))},Ri=function(e){var t=e.className,n=Object(j.useContext)(Di);return Object(j.useContext)(Ii).currentUser?null:S.a.createElement(mi.a,{initialValues:{username:"",password:""},onSubmit:function(e,t){var i;return Zt.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return i=t.setSubmitting,a.next=3,Zt.a.awrap(Oi(e.username,e.password));case 3:return console.log("user logged in!"),a.next=6,Zt.a.awrap(Ei(n));case 6:i(!1);case 7:case"end":return a.stop()}}))},validationSchema:fi.object().shape({username:fi.string().required("Required"),password:fi.string().required("Required")})},(function(e){var n=e.values,i=e.touched,a=e.errors,r=e.isSubmitting,s=e.handleChange,o=e.handleBlur,u=e.handleSubmit;return S.a.createElement(mt,{className:t,as:"form",onSubmit:u},S.a.createElement(yt,null,"Login"),S.a.createElement(Se,null,S.a.createElement(Ce,null,S.a.createElement(Ge,{label:"Username",id:"username",placeholder:"Username",value:n.username,onChange:s,onBlur:o,error:i.username&&a.username})),S.a.createElement(Ce,null,S.a.createElement(Ge,{label:"Password",id:"password",placeholder:"Password",value:n.password,onChange:s,onBlur:o,error:i.password&&a.password,type:"password"}))),S.a.createElement(Se,null,S.a.createElement(Ce,null,S.a.createElement(Nt,{buttonStyle:"button-grey",type:"submit",disabled:r||0!==Object.entries(a).length},"Login")),S.a.createElement(Ce,null,S.a.createElement(Nt,{buttonStyle:"button-grey",onClick:function(e){e.preventDefault(),e.stopPropagation(),alert("not implemented")}},"Register"))))}))};function Fi(){var e=Object(R.a)(["\n  position: absolute;\n  width: 20%;\n  min-width: 200px;\n  right: 10px;\n  top: 10px;\n  z-index: 3;\n"]);return Fi=function(){return e},e}var Hi=Object(F.b)(Ri)(Fi()),Li=function(){return Object(j.useContext)(Ii).currentUser?null:S.a.createElement(Hi,null)};function Bi(){var e=Object(R.a)(["\n  width: 21%;\n  min-width: 200px;\n  margin: 5px;\n"]);return Bi=function(){return e},e}function _i(){var e=Object(R.a)(["\n  width: 40%;\n  min-width: 800px;\n  margin: 5px;\n"]);return _i=function(){return e},e}function Ui(){var e=Object(R.a)(["\n  display: flex;\n  justify-content: flex-end;\n  flex-wrap: wrap-reverse;\n  margin: 5px;\n"]);return Ui=function(){return e},e}function Ni(){var e=Object(R.a)(["\n  height: 58px;\n  width: 412px;\n  background-image: url(img/coldvoid.png);\n  position: absolute;\n  top: 45px;\n  left: 30px;\n  opacity: 0.8;\n  z-index: -1;\n"]);return Ni=function(){return e},e}var Vi=F.b.div(Ni()),Gi=F.b.div(Ui()),Wi=F.b.div(_i()),qi=F.b.div(Bi()),Zi=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){return S.a.createElement(S.a.Fragment,null,S.a.createElement(Vi,null),S.a.createElement(di,null),S.a.createElement(Gi,null,S.a.createElement(Wi,null,S.a.createElement(mt,null,S.a.createElement(yt,null,"Home"),S.a.createElement(Gt,{to:"/createGame"},S.a.createElement(Nt,{type:"button",buttonStyle:"button-grey"},"Create game")),S.a.createElement(Gt,{to:"/logout"},S.a.createElement(Nt,{type:"button",buttonStyle:"button-grey"},"Log out")))),S.a.createElement(qi,null,S.a.createElement(Ri,null))))}}]),t}(j.Component);function Ki(){var e=Object(R.a)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  z-index: 2;\n  width: 100%;\n  height: 100%;\n  background-color: transparent;\n"]);return Ki=function(){return e},e}function Xi(){var e=Object(R.a)(["\n  display: flex;\n  width: 100%;\n  height: 100%;\n  background-size: cover;\n  background-color: #0b121a;\n  box-shadow: inset 0px 0px 200px rgba(0, 0, 0, 1);\n"]);return Xi=function(){return e},e}var Yi=F.b.div(Xi()),Qi=F.b.div(Ki()),Ji=function(e,t){return e.touches?{x:e.originalEvent.touches[0].pageX-t.offset().left,y:e.originalEvent.touches[0].pageY-t.offset().top,xR:(e.originalEvent.touches[0].pageX-t.offset().left)/window.innerWidth*2-1,yR:-(e.originalEvent.touches[0].pageY-t.offset().top)/window.innerHeight*2+1}:{x:e.clientX,y:e.clientY,xR:e.clientX/t.offsetWidth*2-1,yR:-e.clientY/t.offsetHeight*2+1}},$i=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).onTouchStart=function(e){e.stopPropagation(),e.preventDefault()},n.onWheel=function(e){e.stopImmediatePropagation(),e.preventDefault();var t=n.props.game,i=Math.sign(e.deltaY);t.onMouseWheel(i)},n.onResize=function(){n.props.game.onResize()},n.canvasRef=j.createRef(),n.clickCatcherRef=j.createRef(),n.mouseDownPosition=null,n.lastDraggingPosition=null,n.draggingThreshold=5,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){console.log("Game scene component mounted");var e=this.props.game;window.addEventListener("resize",this.onResize),this.clickCatcherRef.current.addEventListener("wheel",this.onWheel),window.addEventListener("touchstart",this.onTouchStart),document.addEventListener("keydown",this.onKeyDown.bind(this),!1),document.addEventListener("keyup",this.onKeyUp.bind(this),!1),e.initRender(this.canvasRef.current)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onKeyDown.bind(this),!1),document.removeEventListener("keyup",this.onKeyUp.bind(this),!1),window.removeEventListener("resize",this.onResize),this.clickCatcherRef.current.removeEventListener("wheel",this.onWheel),window.removeEventListener("touchstart",this.onTouchStart)}},{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this.mouseDownPosition=Ji(e,this.clickCatcherRef.current)}},{key:"onMouseUp",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.props.game;this.lastDraggingPosition||t.onMouseUp(Ji(e,this.clickCatcherRef.current),e.button),this.mouseDownPosition=null,this.lastDraggingPosition=null}},{key:"onMouseMove",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.props.game;if(null!==this.mouseDownPosition){var n=Ji(e,this.clickCatcherRef.current);if(!this.lastDraggingPosition&&wn(this.mouseDownPosition,n)>this.draggingThreshold&&(this.lastDraggingPosition=this.mouseDownPosition),this.lastDraggingPosition){var i={x:n.x-this.lastDraggingPosition.x,y:n.y-this.lastDraggingPosition.y};this.lastDraggingPosition=n,t.onDrag(n,i)}}else t.onMouseMove(Ji(e,this.canvasRef.current))}},{key:"onMouseOut",value:function(e){var t=this.props.game;this.mouseDownPosition=null,this.lastDraggingPosition=null,t.onMouseOut(e)}},{key:"onKeyDown",value:function(e){this.props.game.onKeyDown(e)}},{key:"onKeyUp",value:function(e){this.props.game.onKeyUp(e)}},{key:"componentDidUpdate",value:function(){console.log("updated init"),this.props.game.initRender(this.canvasRef.current)}},{key:"shouldComponentUpdate",value:function(e,t){return!1}},{key:"render",value:function(){return console.log("rerender game scene component"),j.createElement(j.Fragment,null,j.createElement(Qi,{ref:this.clickCatcherRef,onMouseOut:this.onMouseOut.bind(this),onMouseDown:this.onMouseDown.bind(this),onMouseUp:this.onMouseUp.bind(this),onMouseMove:this.onMouseMove.bind(this),onKeyUp:this.onKeyUp.bind(this),onContextMenu:function(e){e.preventDefault(),e.stopPropagation()}}),j.createElement(Yi,{ref:this.canvasRef}))}}]),t}(j.Component),ea=$i,ta=n(11),na=function(){function e(t,n){if(Object(T.a)(this,e),this.requirements={},this.fullfilments={0:[],1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[]},n)switch(n.type){case sa.SPEED:this.requireSpeed(t,n);break;case sa.PIVOT:this.requirePivot(t,n);break;case sa.ROLL:this.requireRoll(t);break;case sa.EVADE:this.requireEvade(t,n)}}return Object(E.a)(e,[{key:"serialize",value:function(){return{requirements:this.requirements,fullfilments:this.fullfilments}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.requirements=e.requirements||{},this.fullfilments=e.fullfilments||{0:[],1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[]},this}},{key:"getTotalAmountRequired",value:function(){var e=this;return Object.keys(this.requirements).reduce((function(t,n){return t+(e.requirements[n]||0)}),0)}},{key:"getRequirement",value:function(e){return this.requirements[e]?this.requirements[e]-this.getFulfilledAmount(e):0}},{key:"isFulfilled",value:function(){var e=this;return Object.keys(this.requirements).every((function(t){return 0===e.getRequirement(t)}))}},{key:"fulfill",value:function(e,t,n){if(this.fullfilments[e].push({amount:t,thrusterId:n.id}),this.requirements[e]<this.getFulfilledAmount(e))throw new Error("Fulfilled too much!")}},{key:"getFulfilledAmount",value:function(e){return this.fullfilments[e].reduce((function(e,t){return e+t.amount}),0)}},{key:"getFulfilments",value:function(){var e=this;return Object.keys(this.fullfilments).map((function(t){return e.fullfilments[t]})).filter((function(e){return e.length>0}))}},{key:"requireRoll",value:function(e){this.requirements[8]=e.rollcost}},{key:"requireEvade",value:function(e,t){this.requirements[8]=e.evasioncost*t.value}},{key:"requirePivot",value:function(e,t){e.movement.isRolled()?1===t.value?this.requirements[7]=e.pivotcost:this.requirements[6]=e.pivotcost:1===t.value?this.requirements[6]=e.pivotcost:this.requirements[7]=e.pivotcost}},{key:"requireSpeed",value:function(e,t){var n=t.facing,i=t.value,a=Sn(Sn(i,-n),3);e.movement.isRolled()&&[1,2,4,5].includes(a)?this.requirements[Sn(a,3)]=e.accelcost:this.requirements[a]=e.accelcost}},{key:"accumulate",value:function(e){var t=this;return Object.keys(this.requirements).forEach((function(n){e[n]=e[n]?e[n]+t.requirements[n]:t.requirements[n]})),e}}]),e}(),ia=na,aa=function(){function e(t,n,i,a,r,s,o){var u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;Object(T.a)(this,e),this.id=t,this.type=n,this.facing=r,this.rolled=s,this.turn=o,this.value=u,this.requiredThrust=c||new ia,this.index=l,this.setPosition(i),this.setVelocity(a)}return Object(E.a)(e,[{key:"round",value:function(){var e=this.position.round(),t=this.velocity.round(),n=this.clone();return n.setPosition(e),n.setVelocity(t),n}},{key:"setPosition",value:function(e){e instanceof un.Offset&&(e=Dn.fromHexToGame(e)),this.position=e}},{key:"setVelocity",value:function(e){e instanceof un.Offset&&(e=Dn.fromHexToGame(e)),this.velocity=e}},{key:"getFacing",value:function(){return this.facing}},{key:"getPosition",value:function(){return this.position}},{key:"getVelocity",value:function(){return this.velocity}},{key:"getHexPosition",value:function(){return Dn.fromGameToHex(this.position)}},{key:"getHexVelocity",value:function(){return Dn.fromGameToHex(this.velocity)}},{key:"setRequiredThrust",value:function(e){return this.requiredThrust=e,this}},{key:"setId",value:function(e){return this.id=e,this}},{key:"setIndex",value:function(e){return this.index=e,this}},{key:"serialize",value:function(){return{id:this.id,type:this.type,position:this.position.serialize(),velocity:this.velocity.serialize(),facing:this.facing,rolled:this.rolled,turn:this.turn,value:this.value,requiredThrust:this.requiredThrust.serialize(),index:this.index}}},{key:"deserialize",value:function(e){return this.id=e.id,this.type=e.type,this.position=new Rn(e.position),this.velocity=new Rn(e.velocity),this.facing=e.facing,this.rolled=e.rolled,this.turn=e.turn,this.value=e.value,this.index=e.index,this.requiredThrust=(new ia).deserialize(e.requiredThrust),this}},{key:"equals",value:function(e){return this.type===e.type&&this.position.roundToHexCenter().equals(e.position.roundToHexCenter())&&this.velocity.roundToHexCenter().equals(e.velocity.roundToHexCenter())&&this.facing===e.facing&&this.rolled===e.rolled&&this.turn===e.turn&&this.value===e.value}},{key:"isSpeed",value:function(){return this.type===sa.SPEED}},{key:"isDeploy",value:function(){return this.type===sa.DEPLOY}},{key:"isStart",value:function(){return this.type===sa.START}},{key:"isEvade",value:function(){return this.type===sa.EVADE}},{key:"isRoll",value:function(){return this.type===sa.ROLL}},{key:"isEnd",value:function(){return this.type===sa.END}},{key:"isPivot",value:function(){return this.type===sa.PIVOT}},{key:"isCancellable",value:function(){return this.isSpeed()||this.isPivot()||this.isEvade()||this.isRoll()}},{key:"isPlayerAdded",value:function(){return this.isSpeed()||this.isPivot()||this.isEvade()||this.isRoll()}},{key:"clone",value:function(){return new e(this.id,this.type,this.position,this.velocity,this.facing,this.rolled,this.turn,this.value,this.requiredThrust,this.index)}},{key:"isOpposite",value:function(e){switch(e.type){case sa.SPEED:return this.isSpeed()&&this.value===Sn(e.value,3);default:return!1}}}]),e}(),ra=aa,sa={START:"start",END:"end",DEPLOY:"deploy",SPEED:"speed",PIVOT:"pivot",EVADE:"evade",ROLL:"roll"},oa=function(){function e(t,n,i){Object(T.a)(this,e),this.ship=t,this.movementService=n,this.turn=i}return Object(E.a)(e,[{key:"billAndPay",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.pay()){var n=e.getMoves();return t&&(this.ship.movement.replaceMovement(n),this.movementService.shipStateChanged(this.ship)),!0}if(t)throw new Error("Tried to commit move that was not legal. Check legality first!");return!1}},{key:"canRoll",value:function(){return this.roll(!1)}},{key:"roll",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.ship.movement.getRollMove(),n=this.ship.movement.getLastEndMoveOrSurrogate(),i=this.ship.movement.getMovement();if(t)i=i.filter((function(e){return!e.isRoll()}));else{t=new ra(null,sa.ROLL,n.position,n.velocity,n.facing,n.rolled,this.turn,!n.rolled);var a=i.filter((function(e){return e.isPlayerAdded()})),r=i.filter((function(e){return!e.isPlayerAdded()}));i=[].concat(Object(ta.a)(r),[t],Object(ta.a)(a))}var s=new la(this.ship,this.ship.movement.getThrustOutput(),i);return this.billAndPay(s,e)}},{key:"canEvade",value:function(e){return this.evade(e,!1)}},{key:"evade",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.ship.movement.getEvadeMove(),i=this.ship.movement.getLastEndMoveOrSurrogate();if(n){if(n.value+e>this.ship.movement.getMaxEvasion())return!1;if(n.value+e<0)return!1;n.value+=e}else{if(e<0)return!1;n=new ra(null,sa.EVADE,i.position,i.velocity,i.facing,i.rolled,this.turn,1)}var a=this.ship.movement.getMovement().filter((function(e){return e.isPlayerAdded()&&!e.isRoll()&&!e.isEvade()})),r=this.ship.movement.getMovement().filter((function(e){return!e.isPlayerAdded()||e.isRoll()})),s=0===n.value?[].concat(Object(ta.a)(r),Object(ta.a)(a)):[].concat(Object(ta.a)(r),[n],Object(ta.a)(a)),o=new la(this.ship,this.ship.movement.getThrustOutput(),s);return this.billAndPay(o,t)}},{key:"canPivot",value:function(e){return this.pivot(e,!1)}},{key:"pivot",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.ship.movement.getLastMove(),i=new ra(null,sa.PIVOT,n.position,n.velocity,Sn(n.facing,e),n.rolled,this.turn,e),a=this.ship.movement.getMovement();if(n.isPivot()&&n.value!==e)a.pop();else{if(null!==this.ship.maxPivots&&this.ship.movement.getMovement().filter((function(e){return e.isPivot()})).length>=this.ship.maxPivots)return!1;a.push(i)}var r=new la(this.ship,this.ship.movement.getThrustOutput(),a);return this.billAndPay(r,t)}},{key:"canThrust",value:function(e){return this.thrust(e,!1)}},{key:"thrust",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.ship.movement.getLastMove(),i=new ra(null,sa.SPEED,n.position,n.getHexVelocity().moveToDirection(e),n.facing,n.rolled,this.turn,e),a=this.ship.movement.getMovement();n.isSpeed()&&n.value===Sn(e,3)?a.pop():a.push(i);var r=new la(this.ship,this.ship.movement.getThrustOutput(),a);return this.billAndPay(r,t)}},{key:"canCancel",value:function(){return this.ship.movement.getMovement().some((function(e){return e.isCancellable()}))}},{key:"cancel",value:function(){var e=this.ship.movement.getLastMove();if(e&&e.isCancellable()){this.ship.movement.removeMovement(e);var t=new la(this.ship,this.ship.movement.getThrustOutput(),this.ship.movement.getMovement());return this.billAndPay(t,!0)}}},{key:"canRevert",value:function(){return this.ship.movement.getMovement().some((function(e){return e.isPlayerAdded()}))}},{key:"revert",value:function(){var e=this;this.ship.movement.getMovement().filter((function(e){return e.isCancellable()})).forEach((function(t){return e.ship.movement.removeMovement(t)})),this.movementService.shipStateChanged(this.ship)}}]),e}(),ua=oa,ca=function(){function e(t,n,i){Object(T.a)(this,e),this.ship=t,this.movement=i.map((function(e){return e.clone()})),this.thrusters=t.systems.getSystems().filter((function(e){return e.callHandler("isThruster",null,!1)})).filter((function(e){return!e.isDisabled()})).map((function(e){return new da(e)})),this.buildRequiredThrust(this.movement),this.paid=null,this.cost=0,this.thrustAvailable=n,this.directionsRequired=this.getRequiredThrustDirections()}return Object(E.a)(e,[{key:"getRequiredThrustDirections",value:function(){var e=this.movement.reduce((function(e,t){return t.requiredThrust.accumulate(e)}),{});return e[0]=e[0]||0,e[1]=e[1]||0,e[2]=e[2]||0,e[3]=e[3]||0,e[4]=e[4]||0,e[5]=e[5]||0,e[6]=e[6]||0,e[7]=e[7]||0,e[8]=e[8]||0,e}},{key:"getTotalThrustRequired",value:function(){var e=this.getRequiredThrustDirections();return e[0]+e[1]+e[2]+e[3]+e[4]+e[5]+e[6]+e[7]+e[8]}},{key:"getCurrentThrustRequired",value:function(){return this.directionsRequired[0]+this.directionsRequired[1]+this.directionsRequired[2]+this.directionsRequired[3]+this.directionsRequired[4]+this.directionsRequired[5]+this.directionsRequired[6]+this.directionsRequired[7]+this.directionsRequired[8]}},{key:"isPaid",value:function(){return 0===this.getCurrentThrustRequired()}},{key:"getAllUsableThrusters",value:function(e){return this.thrusters.filter((function(t){var n=t.getThrustCapacity();return t.isDirection(e)&&n>0})).sort(this.sortThrusters)}},{key:"sortThrusters",value:function(e,t){var n=e.getOverheat(),i=t.getOverheat();return n>i?-1:n>i?1:e.channeled>t.channeled?-1:e.channeled<t.channeled?1:0}},{key:"errorIfOverBudget",value:function(){if(this.isOverBudget())throw new Error("over budget")}},{key:"isOverBudget",value:function(){return this.cost>this.thrustAvailable}},{key:"pay",value:function(){if(null!==this.paid)throw new Error("Thrust bill is already paid!");try{if(this.getTotalThrustRequired()>this.thrustAvailable)throw new Error("over budget");return this.process(),this.paid=this.isPaid(),this.paid}catch(e){if("over budget"===e.message)return this.paid=!1,this.paid;throw e}}},{key:"process",value:function(){var e=this;return Object.keys(this.directionsRequired).forEach((function(t){var n=e.directionsRequired[t];t=parseInt(t,10),0!==n&&e.useThrusters(t,n)})),this.isPaid()}},{key:"useThrusters",value:function(e,t){for(var n=0;;){var i=this.getAllUsableThrusters(e);if(0===i.length)return;if(n===t)return;i.pop().channel(1),this.directionsRequired[e]-=1,this.cost+=1,n+=1,this.errorIfOverBudget()}}},{key:"buildRequiredThrust",value:function(e){var t=this;e.forEach((function(e){return e.setRequiredThrust(new ia(t.ship,e))}))}},{key:"getMoves",value:function(){var e=this;if([0,1,2,3,4,5,6,7,8].forEach((function(t){e.thrusters.forEach((function(n){if(n.isDirection(t)){var i=n.channeled-n.assigned;0!==i&&e.movement.forEach((function(e){var a=e.requiredThrust.getRequirement(t);0!==a&&(a>i?(e.requiredThrust.fulfill(t,i,n.thruster),n.addAssigned(i),i=0):(e.requiredThrust.fulfill(t,a,n.thruster),n.addAssigned(a),i-=a))}))}}))})),!this.movement.every((function(e){return e.requiredThrust.isFulfilled()})))throw new Error("Not all moves are fulfilled");return this.movement}}]),e}(),la=ca,ha=function(){function e(t){Object(T.a)(this,e),this.thruster=t,this.directions=[].concat(t.callHandler("getThrustDirection")),this.paid=0,this.channeled=0,this.capacity=t.callHandler("getThrustChannel"),this.assigned=0}return Object(E.a)(e,[{key:"addAssigned",value:function(e){this.assigned+=e}},{key:"getOverheat",value:function(){return this.thruster.heat.getOverheat()+this.thruster.callHandler("getHeatForThrust",{amount:this.channeled},0)}},{key:"isDirection",value:function(e){return this.directions.includes(e)}},{key:"canChannel",value:function(){return this.channeled<this.capacity}},{key:"getThrustCapacity",value:function(){var e=this.capacity-this.channeled;return e<0?0:e}},{key:"channel",value:function(e){this.channeled+=e}},{key:"undoChannel",value:function(e){if(this.channeled-e<0)throw new Error("Can not undo channel more than channeled");this.channeled=this.channeled-e}}]),e}(),da=ha,ma=function(){function e(){Object(T.a)(this,e),this.gamedata=null}return Object(E.a)(e,[{key:"update",value:function(e,t){return this.gamedata=e,this.phaseDirector=t,this}},{key:"isMoved",value:function(e,t){var n=this.getLastEndMove(e);return!!n&&n.turn===t}},{key:"getShipsInSameHex",value:function(e,t){var n=this;return t=t&&this.getMostRecentMove(e).position,this.gamedata.ships.filter((function(i){return i.isDestroyed()&&e!==i&&n.getMostRecentMove(i).position.equals(t)}))}},{key:"getNewEndMove",value:function(e,t){var n=e.movement.getLastEndMoveOrSurrogate(),i=e.movement.getLastMove(),a=i.getVelocity(),r=t.getGravityVectorForTurn(n.position,a),s=r.position,o=r.velocity;return new ra(null,sa.END,s,o,i.facing,i.rolled,n.turn+1,0)}},{key:"deploy",value:function(e,t){var n=e.movement.getDeployMove();if(n)n.setPosition(t),e.movement.replaceDeployMove(n);else{var i=e.movement.getLastMove();n=new ra(-1,sa.DEPLOY,t,i.velocity,i.facing,i.rolled,this.gamedata.turn,0,null,1),e.movement.addMovement(n)}}},{key:"doDeploymentTurn",value:function(e,t){var n=e.movement.getDeployMove(),i=Sn(n.facing,t);n.facing=i,e.movement.replaceDeployMove(n),this.shipStateChanged(e)}},{key:"getPositionAtStartOfTurn",value:function(e,t){void 0===t&&(t=this.gamedata.turn);for(var n=null,i=e.movement.length-1;i>=0&&!((n=e.movement[i]).turn<t);i--);return new un.Offset(n.position)}},{key:"shipStateChanged",value:function(e){this.phaseDirector.relayEvent("shipStateChanged",e)}},{key:"canThrust",value:function(e,t){return new ua(e,this,this.gamedata.turn).canThrust(t)}},{key:"thrust",value:function(e,t){new ua(e,this,this.gamedata.turn).thrust(t)}},{key:"canCancel",value:function(e){return new ua(e,this,this.gamedata.turn).canCancel()}},{key:"canRevert",value:function(e){return new ua(e,this,this.gamedata.turn).canRevert()}},{key:"cancel",value:function(e){new ua(e,this,this.gamedata.turn).cancel()}},{key:"revert",value:function(e){new ua(e,this,this.gamedata.turn).revert()}},{key:"canPivot",value:function(e,t){if(1!==t&&-1!==t)throw new Error("While pivoting direction must be 1 or -1");return new ua(e,this,this.gamedata.turn).canPivot(t)}},{key:"pivot",value:function(e,t){if(1!==t&&-1!==t)throw new Error("While pivoting direction must be 1 or -1");return new ua(e,this,this.gamedata.turn).pivot(t)}},{key:"canRoll",value:function(e){return new ua(e,this,this.gamedata.turn).canRoll()}},{key:"roll",value:function(e){return new ua(e,this,this.gamedata.turn).roll()}},{key:"canEvade",value:function(e,t){if(1!==t&&-1!==t)throw new Error("While evading step must be 1 or -1");return!(e.movement.getEvasion()+t>e.movement.getMaxEvasion())&&new ua(e,this,this.gamedata.turn).canEvade(t)}},{key:"evade",value:function(e,t){if(1!==t&&-1!==t)throw new Error("While evading step must be 1 or -1");return new ua(e,this,this.gamedata.turn).evade(t)}}]),e}(),fa=ma,pa=function(){function e(t){Object(T.a)(this,e),this.shipSystems=t}return Object(E.a)(e,[{key:"getPowerOutput",value:function(){return this.shipSystems.getSystems().reduce((function(e,t){return e+t.power.getPowerOutput()}),0)}},{key:"getPowerRequired",value:function(){return this.shipSystems.getSystems().filter((function(e){return!e.power.isOffline()})).reduce((function(e,t){return e+t.power.getPowerRequirement()}),0)}},{key:"getRemainingPowerOutput",value:function(){return this.getPowerOutput()-this.getPowerRequired()}},{key:"isValidPower",value:function(){return this.getRemainingPowerOutput()>=0||0===this.getPowerRequired()}},{key:"canSetOffline",value:function(e){return e.power.canSetOffline()}},{key:"canSetOnline",value:function(e){return!!e.power.canSetOnline()&&this.getRemainingPowerOutput()>=e.power.getPowerRequirement()}},{key:"copyPower",value:function(e){var t=this;this.shipSystems.getSystems().forEach((function(n){var i=e.systems.getSystemById(n.id);i.power.isGoingOffline()&&t.canSetOffline(n)&&n.power.setOffline(),i.power.isGoingOnline()&&t.canSetOnline(n)&&n.power.setOnline()}))}},{key:"forceValidPower",value:function(){var e=this;(function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),i=[e[n],e[t]];e[t]=i[0],e[n]=i[1]}return e})(this.shipSystems.getSystems()).forEach((function(t){e.canSetOffline(t)&&!e.isValidPower()&&t.power.setOffline()}))}},{key:"advanceTurn",value:function(e){}}]),e}(),va=pa,ga=n(27),ya=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(T.a)(this,e),this.amount=t,this.amount<0&&(this.amount=0),this.armor=n,this.id=ga(),this.destroyedSystem=!1,this.system=null,this.new=!0}return Object(E.a)(e,[{key:"isNew",value:function(){return this.new}},{key:"setSystem",value:function(e){this.system=e}},{key:"setDestroyedSystem",value:function(){this.destroyedSystem=!0}},{key:"serialize",value:function(){return{amount:this.amount,armor:this.armor,id:this.id,destroyedSystem:this.destroyedSystem}}},{key:"deserialize",value:function(e){return this.id=e.id||ga(),this.amount=e.amount||0,this.armor=e.armor||0,this.destroyedSystem=e.destroyedSystem||!1,this.new=!1,this}},{key:"getDamage",value:function(){return this.amount}},{key:"advanceTurn",value:function(){return this}}]),e}(),ba=ya,Oa=n(10),wa=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(T.a)(this,e),this.id=ga(),this.duration=Number.isInteger(t)?t+1:null,this.turnsRemaining=this.duration}return Object(E.a)(e,[{key:"getMessage",value:function(){return""}},{key:"serialize",value:function(){return{className:this.getClassName(),id:this.id,duration:this.duration,turnsRemaining:this.turnsRemaining}}},{key:"deserialize",value:function(e){return this.id=e.id||null,this.turnsRemaining=e.turnsRemaining||null,this.duration=e.duration||null,this}},{key:"advanceTurn",value:function(){null!==this.turnsRemaining&&this.turnsRemaining>0&&this.turnsRemaining--}},{key:"excludes",value:function(e){return!1}},{key:"isReplacedBy",value:function(e){return!1}},{key:"isFixed",value:function(){return 0===this.turnsRemaining}},{key:"getDuration",value:function(){return this.duration}},{key:"getClassName",value:function(){return this.constructor.name}}]),e}(),ka=wa,ja=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this,n))).outputReduction=e,i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"serialize",value:function(){return Object(pi.a)({},Object(Oa.a)(Object(P.a)(t.prototype),"serialize",this).call(this),{outputReduction:this.outputReduction})}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(Oa.a)(Object(P.a)(t.prototype),"deserialize",this).call(this,e),this.outputReduction=e.outputReduction||1,this}},{key:"getMessage",value:function(){return this.duration?"Output decreased by ".concat(this.outputReduction," for ").concat(this.turnsRemaining," turns"):"Output decreased by ".concat(this.outputReduction)}},{key:"getOutputReduction",value:function(){return this.outputReduction}},{key:"excludes",value:function(e){return e instanceof t&&(e.outputReduction===this.outputReduction&&(null!==e.getDuration()&&null!==this.getDuration()&&e.getDuration()<=this.turnsRemaining))}},{key:"isReplacedBy",value:function(e){return e instanceof t&&(null!==e.getDuration()&&null!==this.getDuration()&&(e.outputReduction===this.outputReduction&&e.getDuration()>this.turnsRemaining))}}]),t}(ka),Sa=ja,xa=function(e){function t(e){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,2,e))}return Object(I.a)(t,e),t}(Sa),Ca=xa,Ta=function(e){function t(e){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,4,e))}return Object(I.a)(t,e),t}(Sa),Ea=Ta,Aa=function(e){function t(e){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,6,e))}return Object(I.a)(t,e),t}(Sa),Pa=Aa,Ia=function(e){function t(e){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,8,e))}return Object(I.a)(t,e),t}(Sa),Da=Ia,Ma=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this,e))).loadingTimeIncrease=n,i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"serialize",value:function(){return Object(pi.a)({},Object(Oa.a)(Object(P.a)(t.prototype),"serialize",this).call(this),{loadingTimeIncrease:this.loadingTimeIncrease})}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(Oa.a)(Object(P.a)(t.prototype),"deserialize",this).call(this,e),this.loadingTimeIncrease=e.loadingTimeIncrease||1,this}},{key:"getMessage",value:function(){return this.duration?"Charging time increased by ".concat(this.loadingTimeIncrease," for ").concat(this.turnsRemaining," turns"):"Charging time increased by ".concat(this.loadingTimeIncrease)}},{key:"getLoadingTimeIncrease",value:function(){return this.loadingTimeIncrease}},{key:"excludes",value:function(e){return e instanceof t&&(e.loadingTimeIncrease<this.loadingTimeIncrease||!(e.loadingTimeIncrease>this.loadingTimeIncrease)&&(null!==e.getDuration()&&null===this.getDuration()||e.getDuration()<=this.turnsRemaining))}},{key:"isReplacedBy",value:function(e){return e instanceof t&&(e.loadingTimeIncrease>this.loadingTimeIncrease||(null===e.getDuration()&&null!==this.getDuration()||e.getDuration()>this.turnsRemaining))}}]),t}(ka),za=Ma,Ra=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getMessage",value:function(){return"Forced offline for ".concat(this.turnsRemaining," turns")}},{key:"excludes",value:function(e){return e instanceof t&&e.getDuration()<=this.turnsRemaining}},{key:"isReplacedBy",value:function(e){return e instanceof t&&e.getDuration()>this.turnsRemaining}}]),t}(ka),Fa=Ra,Ha=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getMessage",value:function(){return"Forced offline until system heat lowers to 0.5 or below"}},{key:"excludes",value:function(e){return e instanceof t}},{key:"isFixed",value:function(e){return e.heat.getOverheatPercentage()<.5}}]),t}(ka),La=Ha,Ba=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,i=arguments.length>1?arguments[1]:void 0;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this,i))).heatMultiplier=n,e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"serialize",value:function(){return Object(pi.a)({},Object(Oa.a)(Object(P.a)(t.prototype),"serialize",this).call(this),{heatMultiplier:this.heatMultiplier})}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(Oa.a)(Object(P.a)(t.prototype),"deserialize",this).call(this,e),this.heatMultiplier=e.heatMultiplier||.5,this}},{key:"getMessage",value:function(){return this.duration?"Heat per thrust increased by ".concat(this.heatMultiplier," for ").concat(this.turnsRemaining," turns"):"Heat per thrust increased by ".concat(this.heatMultiplier)}},{key:"getHeatIncrease",value:function(){return this.heatMultiplier}},{key:"excludes",value:function(e){return e instanceof t&&(e.heatMultiplier===this.heatMultiplier&&(null!==e.getDuration()&&null!==this.getDuration()&&e.getDuration()<=this.turnsRemaining))}},{key:"isReplacedBy",value:function(e){return e instanceof t&&(null!==e.getDuration()&&null!==this.getDuration()&&(e.heatMultiplier===this.heatMultiplier&&e.getDuration()>this.turnsRemaining))}}]),t}(ka),_a=Ba,Ua=function(){function e(t){Object(T.a)(this,e),this.system=t,this.entries=[],this.criticals=[]}return Object(E.a)(e,[{key:"serialize",value:function(){return{entries:this.entries.map((function(e){return e.serialize()})),criticals:this.criticals.map((function(e){return e.serialize()}))}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.entries=e.entries?e.entries.map((function(e){return(new ba).deserialize(e)})):[],this.criticals=e.criticals?e.criticals.map((function(e){return(new s[e.className]).deserialize(e)})):[],this}},{key:"addDamage",value:function(e){this.entries.push(e)}},{key:"getDamageById",value:function(e){var t=this.entries.find((function(t){return t.id===e}));return t&&t.setSystem(this.system),t}},{key:"addCritical",value:function(e){this.criticals.push(e)}},{key:"filterReplaced",value:function(e){this.criticals=this.criticals.filter((function(t){return!t.isReplacedBy(e)}))}},{key:"hasCritical",value:function(e){switch(typeof e){case"object":return this.criticals.some((function(t){return t.constructor===e.constructor}));case"function":return this.criticals.some((function(t){return t instanceof e}));case"string":return this.criticals.some((function(t){return t.constructor.name===e}))}}},{key:"getCriticals",value:function(){return this.criticals}},{key:"hasAnyCritical",value:function(){return this.criticals.length>0}},{key:"getTotalDamage",value:function(){var e=this.entries.reduce((function(e,t){return e+t.getDamage()}),0);return e>this.system.hitpoints?this.system.hitpoints:e}},{key:"getPercentUnDamaged",value:function(){return 1-this.getTotalDamage()/this.system.hitpoints}},{key:"getNewDamage",value:function(){return this.entries.filter((function(e){return e.new})).reduce((function(e,t){return e+t.getDamage()}),0)}},{key:"isDestroyed",value:function(){return this.getTotalDamage()>=this.system.hitpoints}},{key:"advanceTurn",value:function(){var e=this;this.entries=this.entries.map((function(e){return e.advanceTurn()})).filter(Boolean),this.criticals.forEach((function(e){return e.advanceTurn()})),this.criticals=this.criticals.filter((function(t){return!t.isFixed(e.system)}))}}]),e}(),Na=Ua,Va=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(T.a)(this,e),this.type=t,this.amount=n}return Object(E.a)(e,[{key:"isOffline",value:function(){return"offline"===this.type}},{key:"isGoingOffline",value:function(){return"go-offline"===this.type}},{key:"isGoingOnline",value:function(){return"go-online"===this.type}},{key:"isBoost",value:function(){return"boost"===this.type}},{key:"getAmount",value:function(){return this.amount}},{key:"setAmount",value:function(e){this.amount=e}},{key:"serialize",value:function(){return{type:this.type,amount:this.amount}}},{key:"deserialize",value:function(e){return this.type=e.type,this.amount=e.amount||0,this}}]),e}(),Ga=Va,Wa=function(){function e(t){Object(T.a)(this,e),this.system=t,this.entries=[]}return Object(E.a)(e,[{key:"serialize",value:function(){return{entries:this.entries.map((function(e){return e.serialize()}))}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.entries=e.entries?e.entries.map((function(e){return(new Ga).deserialize(e)})):[],this}},{key:"isOffline",value:function(){return!this.system.isDestroyed()&&((this.entries.some((function(e){return e.isOffline()}))||this.isGoingOffline())&&!this.isGoingOnline())}},{key:"isOnline",value:function(){return!this.isOffline()}},{key:"isGoingOnline",value:function(){return this.entries.some((function(e){return e.isGoingOnline()}))}},{key:"isGoingOffline",value:function(){return this.entries.some((function(e){return e.isGoingOffline()}))}},{key:"forceOffline",value:function(){!this.isOffline()&&this.canSetOffline()&&(this.entries=this.entries.filter((function(e){return"go-online"!==e.type})),this.entries.push(new Ga("go-offline")))}},{key:"setOffline",value:function(){this.forceOffline(),this.system.callHandler("onSystemOffline")}},{key:"canSetOffline",value:function(){return!this.isOffline()&&this.system.callHandler("canSetOffline",null,!1)}},{key:"canSetOnline",value:function(){return!this.system.callHandler("shouldBeOffline",null,!1)&&(this.isOffline()&&this.system.callHandler("canSetOnline",null,!1))}},{key:"setOnline",value:function(){this.isOffline()&&(this.entries=this.entries.filter((function(e){return"go-offline"!==e.type})),this.entries.push(new Ga("go-online")))}},{key:"getPowerOutput",value:function(){return this.system.callHandler("getPowerOutput",null,0)}},{key:"getPowerRequirement",value:function(){return this.system.callHandler("getPowerRequirement",null,0)}},{key:"advanceTurn",value:function(){this.isOffline()?this.entries=[new Ga("offline")]:this.entries=[]}}]),e}(),qa=Wa,Za=function(){function e(t){Object(T.a)(this,e),this.system=t,this.heat=0,this.overheat=0,this.heatTransferPerStructure=.5,this.overheatLimitPerStructure=1,this.overheatTransferRatio=.5,this.heatTransferred=0}return Object(E.a)(e,[{key:"serialize",value:function(){return{heat:this.heat,overheat:this.overheat}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.heat=e.heat||0,this.overheat=e.overheat||0,this}},{key:"getHeat",value:function(){return this.heat}},{key:"getMaxTransferHeat",value:function(){return this.isHeatStorage()?0:this.system.hitpoints*this.heatTransferPerStructure}},{key:"getTransferOverHeat",value:function(){return this.overheat*this.overheatTransferRatio}},{key:"getTransferHeat",value:function(){var e=this.getMaxTransferHeat()-this.heatTransferred;if(e<=0)return 0;if(e>this.heat){var t=e-this.heat;return t>this.getTransferOverHeat()&&(t=this.getTransferOverHeat()),this.heat+t}return e}},{key:"getHeatGenerated",value:function(){return this.system.callHandler("getHeatGenerated",null,0)}},{key:"getHeatPerStructure",value:function(){return this.getHeat()/this.system.hitpoints}},{key:"shouldDisplayHeat",value:function(){return this.system.callHandler("generatesHeat",null,!1)||this.isHeatStorage()}},{key:"generateHeat",value:function(){var e=this.getHeatGenerated();return this.heat+=e,e}},{key:"isHeatStorage",value:function(){return this.system.callHandler("canStoreHeat",null,!1)}},{key:"getMaxHeatStoreCapacity",value:function(){return this.system.callHandler("getHeatStoreAmount",null,0)}},{key:"getHeatStoreCapacity",value:function(){var e=this.getMaxHeatStoreCapacity()-this.heat;return e<=0?0:e}},{key:"changeHeat",value:function(e){return e<0?(e>this.heat?(this.overheat+=e+this.heat,this.heat=0):this.heat+=e,this.heatTransferred+=Math.abs(e)):this.heat+=e,this}},{key:"markNewOverheat",value:function(){this.isHeatStorage()||(this.overheat+=this.heat,this.heat=0)}},{key:"getOverheat",value:function(){return this.isHeatStorage()?0:this.overheat}},{key:"getOverheatTreshold",value:function(){return this.system.hitpoints*this.overheatLimitPerStructure}},{key:"getOverheatPercentage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.isHeatStorage()?0:(this.overheat+e)/this.getOverheatTreshold()}},{key:"getRadiateHeatCapacity",value:function(){return this.system.callHandler("getHeatRadiationCapacity",null,0)}},{key:"radiateHeat",value:function(e){return this.system.callHandler("radiateHeat",e)}},{key:"advanceTurn",value:function(){this.heatTransferred=0}}]),e}(),Ka=Za,Xa=function(){function e(t){Object(T.a)(this,e),this.system=t,this.turn=null,this.messages=[]}return Object(E.a)(e,[{key:"setTurn",value:function(e){this.turn=e}},{key:"addMessage",value:function(e){this.messages.push(e)}},{key:"getMessage",value:function(){return this.messages}},{key:"isOpen",value:function(){return null===this.turn}},{key:"isTurn",value:function(e){return this.turn===e}},{key:"serialize",value:function(){return{className:this.constructor.name,messages:this.messages,turn:this.turn}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.turn=e.turn||null,this.messages=e.messages||[],this}}]),e}(),Ya=Xa,Qa=function(e){return 10*e%1>0?e.toFixed(2):e%1>0?e.toFixed(1):e},Ja=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).initialOverheat=0,n.initialOverheatPercentage=0,n.heatGenerated=0,n.heatCooled=0,n.heatRadiated=0,n.overheat=0,n.overheatPercentage=0,n.isForcedOffline=0,n.intialHeatStored=0,n.newHeatStored=0,n.heatGivenToRadiators=0,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"setIntialHeatStored",value:function(e){this.intialHeatStored=e}},{key:"addNewHeatStored",value:function(e){this.newHeatStored+=e}},{key:"addHeatGivenToRadiators",value:function(e){this.heatGivenToRadiators+=e}},{key:"setInitialOverheat",value:function(e,t){this.initialOverheat=e,this.initialOverheatPercentage=t}},{key:"setHeatGenerated",value:function(e){this.heatGenerated=e}},{key:"setNewOverheat",value:function(e,t){this.overheat=e,this.overheatPercentage=t,this.heatCooled=this.heatGenerated+this.initialOverheat-this.overheat}},{key:"setHeatRadiated",value:function(e){this.heatRadiated=e}},{key:"setForcedOffline",value:function(){this.isForcedOffline=!0}},{key:"serialize",value:function(){return Object(pi.a)({},Object(Oa.a)(Object(P.a)(t.prototype),"serialize",this).call(this),{initialOverheat:this.initialOverheat,initialOverheatPercentage:this.initialOverheatPercentage,heatGenerated:this.heatGenerated,heatCooled:this.heatCooled,heatRadiated:this.heatRadiated,overheat:this.overheat,overheatPercentage:this.overheatPercentage,isForcedOffline:this.isForcedOffline,intialHeatStored:this.intialHeatStored,newHeatStored:this.newHeatStored,heatGivenToRadiators:this.heatGivenToRadiators})}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(Oa.a)(Object(P.a)(t.prototype),"deserialize",this).call(this,e),this.initialOverheat=e.initialOverheat||0,this.initialOverheatPercentage=e.initialOverheatPercentage||0,this.heatGenerated=e.heatGenerated||0,this.heatCooled=e.heatCooled||0,this.heatRadiated=e.heatRadiated||0,this.overheat=e.overheat||0,this.overheatPercentage=e.overheatPercentage||0,this.isForcedOffline=e.isForcedOffline||0,this.intialHeatStored=e.intialHeatStored||0,this.newHeatStored=e.newHeatStored||0,this.heatGivenToRadiators=e.heatGivenToRadiators||0,this}},{key:"getMessage",value:function(){var e=[],t=this.system.callHandler("isRadiator",null,!1),n=this.system.heat.isHeatStorage();return n&&(e=[].concat(Object(ta.a)(e),Object(ta.a)(this.getHeatStorageMessage()))),t&&(e=[].concat(Object(ta.a)(e),Object(ta.a)(this.getRadiatorMessage()))),t||n||(e=[].concat(Object(ta.a)(e),Object(ta.a)(this.getRegularMessage()))),e}},{key:"getRadiatorMessage",value:function(){return this.heatRadiated?["Radiated ".concat(Qa(this.heatRadiated)," units of heat.")]:[]}},{key:"getHeatStorageMessage",value:function(){var e=[];return(this.heatGivenToRadiators||this.newHeatStored)&&e.push("Added ".concat(Qa(this.newHeatStored)," units of heat. Transfered ").concat(Qa(this.heatGivenToRadiators)," units of heat to radiators.")),e.push("Stored ".concat(Qa(this.intialHeatStored+this.newHeatStored-this.heatGivenToRadiators)," units of heat.")),e}},{key:"getRegularMessage",value:function(){var e=[];(this.heatGenerated||this.heatCooled)&&e.push("Added ".concat(Qa(this.heatGenerated)," and cooled ").concat(Qa(this.heatCooled)," units of heat."));var t="Current system heat was ".concat(Qa(this.overheat),".");return e.push(),this.overheat&&(t+=" Overheating ".concat(Math.round(100*this.overheatPercentage),"%.")),e.push(t),this.isForcedOffline&&e.push("System forced offline until overheat is less than 50%."),e}}]),t}(Ya),$a=Ja,er=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).newDamagePoints=0,n.overHeatPoints=0,n.oldDamagePoints=0,n.criticalMessage="",n.extraPoints=0,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"setExtraPoints",value:function(e){this.extraPoints=e}},{key:"setNewDamagePoints",value:function(e){this.newDamagePoints=e}},{key:"setOldDamagePoints",value:function(e){this.oldDamagePoints=e}},{key:"setOverHeatPoints",value:function(e){this.overHeatPoints+=e}},{key:"setCriticalMessage",value:function(e){this.criticalMessage=e}},{key:"serialize",value:function(){return Object(pi.a)({},Object(Oa.a)(Object(P.a)(t.prototype),"serialize",this).call(this),{newDamagePoints:this.newDamagePoints,overHeatPoints:this.overHeatPoints,oldDamagePoints:this.oldDamagePoints,criticalMessage:this.criticalMessage,extraPoints:this.extraPoints})}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(Oa.a)(Object(P.a)(t.prototype),"deserialize",this).call(this,e),this.newDamagePoints=e.newDamagePoints||0,this.overHeatPoints=e.overHeatPoints||0,this.oldDamagePoints=e.oldDamagePoints||0,this.criticalMessage=e.criticalMessage||"",this.extraPoints=e.extraPoints||0,this}},{key:"getMessage",value:function(){var e=["Tested for critical damage:","Existing damage: ".concat(this.oldDamagePoints,", new: ").concat(this.newDamagePoints,", overheat: ").concat(this.overHeatPoints,", random: ").concat(this.extraPoints,", total: ").concat(this.oldDamagePoints+this.newDamagePoints+this.overHeatPoints+this.extraPoints)];return this.criticalMessage&&(e.push("Resulted in critical:"),e.push('"'.concat(this.criticalMessage,'"'))),e}}]),t}(Ya),tr=er,nr=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).damage=0,n.blockedByArmor=0,n.wasDestroyed=!1,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"addDamage",value:function(e){this.damage+=e.amount,this.blockedByArmor+=e.armor,e.destroyedSystem&&(this.wasDestroyed=!0)}},{key:"serialize",value:function(){return Object(pi.a)({},Object(Oa.a)(Object(P.a)(t.prototype),"serialize",this).call(this),{blockedByArmor:this.blockedByArmor,damage:this.damage,wasDestroyed:this.wasDestroyed})}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(Oa.a)(Object(P.a)(t.prototype),"deserialize",this).call(this,e),this.blockedByArmor=e.blockedByArmor||0,this.damage=e.damage||0,this.wasDestroyed=e.wasDestroyed||!1,this}},{key:"getMessage",value:function(){var e=["Suffered ".concat(this.damage," points of damge. Armor blocked ").concat(this.addBlockedByArmor," points.")];return this.wasDestroyed&&e.push("System was destroyed"),e}}]),t}(Ya),ir=nr,ar={ShipSystemLogEntry:Ya,ShipSystemLogEntryHeat:$a,ShipSystemLogEntryCriticalHit:tr,ShipSystemLogEntryDamage:ir},rr=function(){function e(t){Object(T.a)(this,e),this.system=t,this.log=[]}return Object(E.a)(e,[{key:"getGenericLogEntry",value:function(){var e=new Ya;return this.log.push(e),e}},{key:"getOpenLogEntryByClass",value:function(e){var t=this.log.filter((function(e){return e.isOpen()})).find((function(t){return t instanceof e}));return t||(t=new e(this.system),this.log.push(t)),t}},{key:"serialize",value:function(){return{log:this.log.map((function(e){return e.serialize()}))}}},{key:"getMessagesForTurn",value:function(e){return this.log.filter((function(t){return t.isTurn(e)})).reduce((function(e,t){return[].concat(Object(ta.a)(e),Object(ta.a)(t.getMessage()))}),[])}},{key:"getWithTurns",value:function(){var e=[];return this.log.forEach((function(t){var n=e.find((function(e){return e.turn===t.turn}));n||(n={turn:t.turn,messages:[]},e.push(n)),n.messages=[].concat(Object(ta.a)(n.messages),Object(ta.a)(t.getMessage()))})),e}},{key:"deserialize",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.log=t.log||[],this.log=this.log.map((function(t){return new ar[t.className](e.system).deserialize(t)})),this}},{key:"endTurn",value:function(e){this.log.filter((function(e){return e.isOpen()})).forEach((function(t){return t.setTurn(e)}))}},{key:"advanceTurn",value:function(e){}}]),e}(),sr=rr,or=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(Object(T.a)(this,e),this.id=n.id,this.hitpoints=n.hitpoints,this.armor=n.armor||0,this.strategies=i,!this.hitpoints)throw new Error("System must have hitpoints");this.strategies.forEach((function(e){return e.init(t)})),this.damage=new Na(this),this.power=new qa(this),this.shipSystems=null,this.heat=new Ka(this),this.log=new sr(this)}return Object(E.a)(e,[{key:"getSystemDescription",value:function(){return""}},{key:"addStrategy",value:function(e){this.strategies.push(e),e.init(this)}},{key:"addShipSystemsReference",value:function(e){this.shipSystems=e}},{key:"getSystemInfo",value:function(e){var t=[];return this.heat.shouldDisplayHeat()&&(this.heat.isHeatStorage()||t.push({sort:"heat",value:[{header:"Overheat",value:"".concat(Qa(this.heat.getOverheat()),"/").concat(Qa(this.heat.getOverheatTreshold())," (").concat(Math.round(100*this.heat.getOverheatPercentage()),"%)")},{header:"Cooling",value:this.heat.getMaxTransferHeat()}]})),[{sort:"AAA",value:[{header:"Hitpoints",value:"".concat(this.getRemainingHitpoints(),"/").concat(this.hitpoints)},{header:"Armor",value:"".concat(this.getArmor())}]}].concat(t,Object(ta.a)(this.callHandler("getMessages",null,[])))}},{key:"getDisplayName",value:function(){return null}},{key:"getBackgroundImage",value:function(){return null}},{key:"getIconText",value:function(){return this.callHandler("getIconText",null,"")}},{key:"isDestroyed",value:function(){return this.damage.isDestroyed()}},{key:"isDisabled",value:function(){return this.power.isOffline()||this.isDestroyed()}},{key:"getArmor",value:function(){var e=this.callHandler("getArmorModifier",null,0);return this.armor+e}},{key:"getRemainingHitpoints",value:function(){return this.hitpoints-this.getTotalDamage()}},{key:"getTotalDamage",value:function(){return this.damage.getTotalDamage()}},{key:"addDamage",value:function(e){var t=this.shipSystems?this.shipSystems.isDestroyed():void 0,n=this.isDestroyed();this.damage.addDamage(e),!n&&this.isDestroyed()&&e.setDestroyedSystem(),this.log.getOpenLogEntryByClass(ir).addDamage(e),this.shipSystems&&!1===t&&this.shipSystems.isDestroyed()&&this.shipSystems.markDestroyedThisTurn()}},{key:"addCritical",value:function(e){this.damage.addCritical(e)}},{key:"hasAnyCritical",value:function(){return this.damage.hasAnyCritical()}},{key:"hasCritical",value:function(e){return this.damage.hasCritical(e)}},{key:"callHandler",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return this.strategies.forEach((function(i){n=i.callHandler(e,t,n)})),n}},{key:"getStrategiesByInstance",value:function(e){return this.strategies.filter((function(t){return t instanceof e}))}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.damage.deserialize(e.damage),this.power.deserialize(e.power),this.heat.deserialize(e.heat),this.log.deserialize(e.log),this.callHandler("deserialize",e),this}},{key:"serialize",value:function(){return Object(pi.a)({damage:this.damage.serialize(),power:this.power.serialize(),heat:this.heat.serialize(),log:this.log.serialize()},this.callHandler("serialize"))}},{key:"endTurn",value:function(e){this.log.endTurn(e)}},{key:"advanceTurn",value:function(e){this.damage.advanceTurn(e),this.power.advanceTurn(e),this.heat.advanceTurn(e),this.log.advanceTurn(e),this.callHandler("advanceTurn",e)}},{key:"isWeapon",value:function(){return!1}},{key:"showOnSystemList",value:function(){return!1}}]),e}(),ur=n(149),cr=function(){function e(){Object(T.a)(this,e),this.system=null,this.diceRoller=new ur.DiceRoller}return Object(E.a)(e,[{key:"init",value:function(e){this.system=e}},{key:"hasHandler",value:function(e){return Boolean(this[e])}},{key:"callHandler",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this.hasHandler(e)?this[e](t,n):n}}]),e}(),lr=function(){function e(){Object(T.a)(this,e)}return Object(E.a)(e,[{key:"getSpaceRequired",value:function(){return.1}},{key:"getCargoInfo",value:function(){return[]}},{key:"getDisplayName",value:function(){return""}},{key:"getShortDisplayName",value:function(){return""}},{key:"getBackgroundImage",value:function(){return""}}]),e}(),hr=function(e){function t(e){var n,i=e.deltaVelocityPerTurn,a=e.turnsToLive,r=e.maxInterceptVelocity,s=void 0===r?140:r,o=e.hitSize,u=void 0===o?0:o,c=e.evasion,l=void 0===c?30:c,h=e.armingTime,d=void 0===h?1:h;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).deltaVelocityPerTurn=i,n.turnsToLive=a,n.maxInterceptVelocity=s,n.hitSize=u,n.evasion=l,n.armingTime=d,n.damageStrategy=null,n.visuals={engineColor:[.2,163/255,1],explosionType:"HE",explosionSize:15},n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getStrikeDistance",value:function(e,t){return 1}},{key:"getHitSize",value:function(){return this.hitSize}},{key:"getEvasion",value:function(){return this.evasion}},{key:"getInterceptTries",value:function(e,t,n){var i=Math.round(5*(1-e));switch(i<1&&(i=1),i){case 1:return[1,2,3];case 2:return[1,2,3,4];default:return[1,2,3,4,5]}}},{key:"getCargoInfo",value:function(){var e=Object(Oa.a)(Object(P.a)(t.prototype),"getCargoInfo",this).call(this);return[].concat(Object(ta.a)(e),[{header:"Velocity per turn",value:this.deltaVelocityPerTurn},{header:"Turns active",value:this.turnsToLive},{header:"Arming time",value:this.armingTime},{header:"Evasion",value:this.evasion}],Object(ta.a)(this.damageStrategy.getMessages()))}}]),t}(lr),dr=function(e){function t(e){var n=e.deltaVelocityPerTurn,i=e.turnsToLive,a=e.maxInterceptVelocity,r=void 0===a?140:a,s=e.hitSize,o=void 0===s?0:s,u=e.evasion,c=void 0===u?30:u;return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,{deltaVelocityPerTurn:n,turnsToLive:i,maxInterceptVelocity:r,hitSize:o,evasion:c,armingTime:2}))}return Object(I.a)(t,e),t}(hr),mr=function(){function e(){Object(T.a)(this,e)}return Object(E.a)(e,[{key:"rollForSystem",value:function(e){return Math.ceil(Math.random()*e)}},{key:"randomizeHitSystem",value:function(e){var t=this;if(0===e.length)return null;var n=e.reduce((function(e,n){return e+t.getSystemHitSize(n)}),0),i=this.rollForSystem(n),a=0;return e.find((function(e){return i>a&&i<=t.getSystemHitSize(e)+a||(a+=t.getSystemHitSize(e),!1)}))}},{key:"getSystemHitSize",value:function(e){return e.hitpoints*e.callHandler("getHitSystemSizeMultiplier",null,1)}}]),e}(),fr=function(){function e(){Object(T.a)(this,e),this.entries=[],this.notes=[]}return Object(E.a)(e,[{key:"addNote",value:function(e){this.notes.push(e)}},{key:"serialize",value:function(){return{logEntryClass:this.constructor.name,entries:this.entries,notes:this.notes}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.entries=e.entries||[],this.notes=e.notes||[],this}},{key:"add",value:function(e,t){this.entries.push({systemId:e.id,damageIds:[].concat(t).map((function(e){return e.id}))})}},{key:"getDamages",value:function(e){return this.entries.reduce((function(t,n){var i=n.systemId,a=n.damageIds,r=e.systems.getSystemById(i);return t.concat(a.map((function(e){return r.damage.getDamageById(e)})))}),[])}}]),e}(),pr=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).damageFormula=n,e.armorPiercingFormula=i,e.hitSystemRandomizer=new mr,e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getTotalBurstSize",value:function(){return 1}},{key:"_getDamageMessage",value:function(){var e=[];this.damageFormula&&e.push(this.damageFormula);var t=this.system.callHandler("getSelectedAmmo",null,null);return t&&e.push(t.damageFormula),e.join(" + ammo: ")}},{key:"_getArmorPiercingMessage",value:function(){var e=[];this.armorPiercingFormula&&e.push(this.armorPiercingFormula);var t=this.system.callHandler("getSelectedAmmo",null,null);return t&&e.push(t.armorPiercingFormula),e.join(" + ammo: ")}},{key:"_getDamageTypeMessage",value:function(){return"Standard"}},{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({header:"Damage type",value:this._getDamageTypeMessage()}),t.push({header:"Damage",value:this._getDamageMessage()}),t.push({header:"Armor piercing",value:this._getArmorPiercingMessage()}),t}},{key:"applyDamageFromWeaponFire",value:function(e){e.fireOrder;var t=e.combatLogEntry,n=e.hitResolution.result,i=new fr;t.addDamage(i),n?(t.setShots(1,1),this._doDamage(Object(pi.a)({shooterPosition:e.shooter.getPosition()},e),i)):t.setShots(0,1)}},{key:"_doDamage",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,r=e.target,s=e.shooterPosition;void 0===i&&(i=this._getArmorPiercing(e)),void 0===a&&(a=this._getDamageForWeaponHit(e));var o=this._chooseHitSystem({target:r,shooterPosition:s,lastSection:n});if(o){var u=this._doDamageToSystem(e,t,o,i,a);if(i=u.armorPiercing,0===(a=u.damage))return t;var c=this._findOverkillStructure(o,r);if(!c)return this._doDamage(e,t,r.systems.sections.getSectionBySystem(o),i,a);if(i=(u=this._doDamageToSystem(e,t,c,i,a)).armorPiercing,0!==(a=u.damage))return this._doDamage(e,t,r.systems.sections.getSectionBySystem(c),i,a)}else t.addNote("Unable to find system to hit")}},{key:"_findOverkillStructure",value:function(e,t){var n=t.systems.sections.getSectionBySystem(e).getStructure();return n&&n.id!==e.id?n:null}},{key:"_doDamageToSystem",value:function(e,t,n,i,a){e.fireOrder;var r=n.getArmor(),s=r-i;s<0&&(s=0);var o=i-r;o<0&&(o=0),(a-=s)<0&&(a=0);var u=null;if(a>n.getRemainingHitpoints()){if(n.getRemainingHitpoints()<=0)throw new Error("Trying to damage destroyed system");u=new ba(n.getRemainingHitpoints(),s),a-=n.getRemainingHitpoints()}else u=new ba(a,s),a=0;return n.addDamage(u),t.add(n,u),{armorPiercing:o,damage:a}}},{key:"_chooseHitSystem",value:function(e){var t=e.target,n=e.shooterPosition,i=e.lastSection;return this.hitSystemRandomizer.randomizeHitSystem(t.systems.getSystemsForHit(n,i))}},{key:"_getDamageForWeaponHit",value:function(e){e.requiredToHit,e.rolledToHit;var t=0;if(Number.isInteger(this.damageFormula)?t=this.damageFormula:null!==this.damageFormula&&(t=this.diceRoller.roll(this.damageFormula).total),!this.system)return t;var n=this.system.callHandler("getSelectedAmmo",null,null);return n?t+n.getDamage(this.diceRoller):t}},{key:"_getArmorPiercing",value:function(){var e=0;if(Number.isInteger(this.armorPiercingFormula)?e=this.armorPiercingFormula:null!==this.armorPiercingFormula&&(e=this.diceRoller.roll(this.armorPiercingFormula).total),!this.system)return e;var t=this.system.callHandler("getSelectedAmmo",null,null);return t?e+t.getArmorPiercing(this.diceRoller):e}}]),t}(cr),vr=function(e){function t(e,n,i,a){var r,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return Object(T.a)(this,t),(r=Object(A.a)(this,Object(P.a)(t).call(this,e,n))).rangePenalty=i,r.numberOfShots=a,r.strikeHitChange=s,r.minStrikeDistance=o,r}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({header:"Number of SVs",value:this.numberOfShots}),t.push({header:"Damage per SV",value:this.damageFormula}),t.push({header:"Armor piercing per SV",value:this.armorPiercingFormula}),t.push({header:"SV range penalty",value:this.rangePenalty}),t}},{key:"_getDamageForWeaponHit",value:function(e){var t=e.torpedoFlight;return Number.isInteger(this.damageFormula)?Math.ceil(this.damageFormula*t.strikeEffectiveness):Math.ceil(this.diceRoller.roll(this.damageFormula).total*t.strikeEffectiveness)}},{key:"_getArmorPiercing",value:function(e){var t=e.torpedoFlight;return Number.isInteger(this.armorPiercingFormula)?Math.round(this.armorPiercingFormula*t.strikeEffectiveness):Math.round(this.diceRoller.roll(this.armorPiercingFormula).total*t.strikeEffectiveness)}},{key:"getHitChange",value:function(e){var t=e.target,n=e.torpedoFlight,i=e.distance;return t.getHitProfile(n.launchPosition)-this.rangePenalty*(1+t.movement.getEvasion()/10)*i}},{key:"getStrikeDistance",value:function(e){for(var t=11;t--;){if(t===this.minStrikeDistance)return t;if(this.getHitChange(Object(pi.a)({},e,{distance:t}))>=this.strikeHitChange)return t}return 1}},{key:"applyDamageFromWeaponFire",value:function(e){var t=e.torpedoFlight,n=e.combatLogEvent,i=t.launchPosition,a=this.numberOfShots,r=this.getStrikeDistance(e),s=this.getHitChange(Object(pi.a)({},e,{distance:r}));n.addNote("MSV with ".concat(this.numberOfShots," projectiles at distance ").concat(r," with hit chance of ").concat(s,"% each."));for(var o=0;a--;){if(Math.ceil(100*Math.random())<=s){o++;var u=new fr;n.addDamage(u),this._doDamage(Object(pi.a)({shooterPosition:i},e),u)}}n.addNote("".concat(o," MSVs hit target."))}}]),t}(pr),gr=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this,{deltaVelocityPerTurn:48,turnsToLive:6}))).damageStrategy=new vr("d3+3",0,15,32),e.visuals={engineColor:[1,222/255,120/255],explosionType:"MSV"},e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getInterceptTries",value:function(e,t,n){var i=this.getStrikeDistance(t,n);return i>5?[5]:[i]}},{key:"getStrikeDistance",value:function(e,t){return this.damageStrategy.getStrikeDistance({target:t,torpedoFlight:e})}},{key:"getCargoInfo",value:function(){var e=Object(Oa.a)(Object(P.a)(t.prototype),"getCargoInfo",this).call(this);return[{value:"A long range torpedo with Multiple Strike Vehicles."}].concat(Object(ta.a)(e))}},{key:"getDisplayName",value:function(){return"Shrike 1.53m MSV torpedo"}},{key:"getBackgroundImage",value:function(){return"/img/system/torpedoMSV.png"}}]),t}(dr),yr=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this,{deltaVelocityPerTurn:48,turnsToLive:6,evasion:35}))).damageStrategy=new vr("d3",0,5,84,10),e.visuals={engineColor:[1,222/255,120/255],explosionType:"MSV"},e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getInterceptTries",value:function(e,t,n){var i=this.getStrikeDistance(t,n);return i>5?[5]:[i]}},{key:"getStrikeDistance",value:function(e,t){return this.damageStrategy.getStrikeDistance({target:t,torpedoFlight:e})}},{key:"getCargoInfo",value:function(){var e=Object(Oa.a)(Object(P.a)(t.prototype),"getCargoInfo",this).call(this);return[{value:"A long range torpedo with Multiple Strike Vehicles. Designed to supress smaller targets."}].concat(Object(ta.a)(e))}},{key:"getDisplayName",value:function(){return"Shrike B 1.53m saturation MSV torpedo"}},{key:"getBackgroundImage",value:function(){return"/img/system/torpedoMSV2.png"}}]),t}(dr),br=function(e){function t(e,n,i){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,n,i))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"_getDamageMessage",value:function(){return this.damageFormula}},{key:"_getArmorPiercingMessage",value:function(){return this.armorPiercingFormula}},{key:"getStrikeDistance",value:function(){return 1}},{key:"applyDamageFromWeaponFire",value:function(e){var t=e.torpedoFlight,n=e.combatLogEvent,i=t.launchPosition,a=new fr;n.addDamage(a),this._doDamage(Object(pi.a)({shooterPosition:i},e),a)}}]),t}(function(e){function t(e,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this,e,n))).numberOfDamagesFormula=a,i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"_getDamageTypeMessage",value:function(){return"Explosive"}},{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({header:"Damage type",value:this._getDamageTypeMessage()}),t.push({header:"Number of hits",value:this.numberOfDamagesFormula}),t.push({header:"Damage per hit",value:this._getDamageMessage()}),t.push({header:"Armor piercing per hit",value:this._getArmorPiercingMessage()}),t}},{key:"_getNumberOfDamagesForWeaponHit",value:function(){return Number.isInteger(this.numberOfDamagesFormula)?this.numberOfDamagesFormula:this.diceRoller.roll(this.numberOfDamagesFormula).total}},{key:"_doDamage",value:function(e,t){for(var n=e.target,i=e.shooterPosition,a=this._getNumberOfDamagesForWeaponHit();a--;){var r=this._chooseHitSystem({target:n,shooterPosition:i});if(!r)return;this._doDamageToSystem(e,t,r,this._getArmorPiercing(),this._getDamageForWeaponHit(e))}}}]),t}(pr)),Or=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,{deltaVelocityPerTurn:40,turnsToLive:6,maxInterceptVelocity:200,evasion:25}))).damageStrategy=new br("d10+4",0,"d20+60"),n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getCargoInfo",value:function(){var e=Object(Oa.a)(Object(P.a)(t.prototype),"getCargoInfo",this).call(this);return[{value:"A long range torpedo with 8 megaton nuclear payload."}].concat(Object(ta.a)(e))}},{key:"getDisplayName",value:function(){return"Bodkin 1.53m nuclear torpedo"}},{key:"getBackgroundImage",value:function(){return"/img/system/torpedoNuclear.png"}}]),t}(dr),wr=function(e){function t(e){var n=e.deltaVelocityPerTurn,i=e.turnsToLive,a=void 0===i?4:i,r=e.maxInterceptVelocity,s=void 0===r?110:r,o=e.hitSize,u=void 0===o?0:o,c=e.evasion,l=void 0===c?50:c;return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,{deltaVelocityPerTurn:n,turnsToLive:a,maxInterceptVelocity:s,hitSize:u,evasion:l}))}return Object(I.a)(t,e),t}(hr),kr=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this,{deltaVelocityPerTurn:42,turnsToLive:4}))).damageStrategy=new vr("d3+3",0,15,25),e.visuals={engineColor:[1,222/255,120/255],explosionType:"MSV"},e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getInterceptTries",value:function(e,t,n){var i=this.getStrikeDistance(t,n);return i>5?[5]:[i]}},{key:"getStrikeDistance",value:function(e,t){return this.damageStrategy.getStrikeDistance({target:t,torpedoFlight:e})}},{key:"getCargoInfo",value:function(){var e=Object(Oa.a)(Object(P.a)(t.prototype),"getCargoInfo",this).call(this);return[{value:"A medium range torpedo with Multiple Strike Vehicles."}].concat(Object(ta.a)(e))}},{key:"getDisplayName",value:function(){return"Avalanche 0.72m MSV torpedo"}},{key:"getBackgroundImage",value:function(){return"/img/system/torpedoMSVsmall.png"}}]),t}(wr),jr=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this,{deltaVelocityPerTurn:42,turnsToLive:4}))).damageStrategy=new br("d8+4",0,"d3+3"),e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getStrikeDistance",value:function(e,t){return this.damageStrategy.getStrikeDistance({target:t,torpedoFlight:e})}},{key:"getCargoInfo",value:function(){var e=Object(Oa.a)(Object(P.a)(t.prototype),"getCargoInfo",this).call(this);return[{value:"A medium range torpedo with high explosive warhead."}].concat(Object(ta.a)(e))}},{key:"getDisplayName",value:function(){return"Pike 0.72m HE torpedo"}},{key:"getBackgroundImage",value:function(){return"/img/system/torpedoHEsmall.png"}}]),t}(wr),Sr=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this,{deltaVelocityPerTurn:52,turnsToLive:6}))).damageStrategy=new br("d10+4",0,"d8+6"),e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getStrikeDistance",value:function(e,t){return this.damageStrategy.getStrikeDistance({target:t,torpedoFlight:e})}},{key:"getCargoInfo",value:function(){var e=Object(Oa.a)(Object(P.a)(t.prototype),"getCargoInfo",this).call(this);return[{value:"A long range torpedo with high explosive warhead."}].concat(Object(ta.a)(e))}},{key:"getDisplayName",value:function(){return"Meteor 1.53m HE torpedo"}},{key:"getBackgroundImage",value:function(){return"/img/system/torpedoHE.png"}}]),t}(dr),xr=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this))).damageFormula=e,i.armorPiercingFormula=n,i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDamage",value:function(e){return Number.isInteger(this.damageFormula)?this.armorPiercingFormula:e.roll(this.damageFormula).total}},{key:"getArmorPiercing",value:function(e){return Number.isInteger(this.armorPiercingFormula)?this.armorPiercingFormula:e.roll(this.armorPiercingFormula).total}},{key:"getCargoInfo",value:function(){var e=Object(Oa.a)(Object(P.a)(t.prototype),"getCargoInfo",this).call(this);return[{header:"Damage",value:this.damageFormula},{header:"Armor piercing",value:this.armorPiercingFormula}].concat(Object(ta.a)(e))}},{key:"getIconText",value:function(){return""}}]),t}(lr),Cr=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,"d2","d3+2"))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getSpaceRequired",value:function(){return.01}},{key:"getDisplayName",value:function(){return"30mm PDC shell"}},{key:"getShortDisplayName",value:function(){return"30mm"}},{key:"getBackgroundImage",value:function(){return"/img/ammo/30mm.png"}}]),t}(xr),Tr=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,"2d4+2",0))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getSpaceRequired",value:function(){return.02}},{key:"getDisplayName",value:function(){return"85mm high explosive shell"}},{key:"getShortDisplayName",value:function(){return"85mm HE"}},{key:"getBackgroundImage",value:function(){return"/img/ammo/85mmHE.png"}},{key:"getIconText",value:function(){return"HE"}}]),t}(xr),Er=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,"d3","2d3+2"))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getSpaceRequired",value:function(){return.02}},{key:"getDisplayName",value:function(){return"85mm armor piercing shell"}},{key:"getShortDisplayName",value:function(){return"85mm AP"}},{key:"getBackgroundImage",value:function(){return"/img/ammo/85mmAP.png"}},{key:"getIconText",value:function(){return"AP"}}]),t}(xr),Ar=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,"2d3+6",12))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"140mm armor piercing railgun projectile"}},{key:"getShortDisplayName",value:function(){return"140mm AP"}},{key:"getBackgroundImage",value:function(){return"/img/ammo/140mmAP.png"}},{key:"getIconText",value:function(){return"AP"}}]),t}(xr),Pr=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,"2d5 + 10",0))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"140mm high explosive railgun projectile"}},{key:"getShortDisplayName",value:function(){return"140mm HE"}},{key:"getBackgroundImage",value:function(){return"/img/ammo/140mmHE.png"}},{key:"getIconText",value:function(){return"HE"}}]),t}(xr),Ir=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,"2d3+5",10))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"120mm armor piercing railgun projectile"}},{key:"getShortDisplayName",value:function(){return"120mm AP"}},{key:"getBackgroundImage",value:function(){return"/img/ammo/120mmAP.png"}},{key:"getIconText",value:function(){return"AP"}}]),t}(xr),Dr=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,"2d4 + 10",0))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"120mm high explosive railgun projectile"}},{key:"getShortDisplayName",value:function(){return"120mm HE"}},{key:"getBackgroundImage",value:function(){return"/img/ammo/120mmHE.png"}},{key:"getIconText",value:function(){return"HE"}}]),t}(xr),Mr=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"NO AMMUNITION LOADED"}},{key:"getBackgroundImage",value:function(){return"/img/system/noAmmo.png"}}]),t}(lr),zr=Object(pi.a)({},o,{},u,{NoAmmunitionLoaded:Mr}),Rr=Object(pi.a)({},zr),Fr=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).space=e,n.cargo=[],n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getUiComponents",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(Object(ta.a)(t),[{name:"CargoList",props:{list:this.cargo.map((function(e){return{object:e.object,amount:e.amount}}))}}])}},{key:"serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(pi.a)({},t,{cargoBaySystemStrategy:this.cargo.map((function(e){return{className:e.object.constructor.name,amount:e.amount}}))})}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.cargo=e.cargoBaySystemStrategy?e.cargoBaySystemStrategy.map((function(e){return{object:new Rr[e.className],amount:e.amount}})):[],this}},{key:"getTotalCargoSpace",value:function(){return this.space}},{key:"getAvailableCargoSpace",value:function(){return this.space-this.getCargoSpaceUsed()}},{key:"getCargoSpaceUsed",value:function(){return this.cargo.reduce((function(e,t){var n=t.object,i=t.amount;return e+n.getSpaceRequired()*i}),0)}},{key:"hasSpaceFor",value:function(e){var t=e.object,n=e.amount;return this.getAvailableCargoSpace()>=t.getSpaceRequired()*n}},{key:"getCargoEntry",value:function(e){return this.cargo.find((function(t){return t.object.constructor===e.constructor}))}},{key:"getCargoByParentClass",value:function(e){return this.cargo.filter((function(t){return t.object instanceof e}))}},{key:"hasCargo",value:function(e){var t=e.object,n=e.amount,i=void 0===n?1:n,a=this.getCargoEntry(t);return!!a&&a.amount>=i}},{key:"removeCargo",value:function(e){var t=e.object,n=e.amount,i=void 0===n?1:n,a=this.getCargoEntry(t);if(!a||a.amount<i)throw new Error("Check hasCargo first!");a.amount-=i,this.cargo=this.cargo.filter((function(e){return e.amount>0}))}},{key:"addCargo",value:function(e){var t=e.object,n=e.amount,i=void 0===n?1:n;if(!this.hasSpaceFor({object:t,amount:i}))throw new Error("No space in cargo bay");var a=this.getCargoEntry(t);a?a.amount+=i:(a={object:new Rr[t.constructor.name],amount:i},this.cargo.push(a))}}]),t}(cr),Hr=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).heatCapacity=e,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({header:"Stores heat without overheating",value:"".concat(this.heatCapacity)}),t}},{key:"canStoreHeat",value:function(){return!this.system.isDisabled()}},{key:"getHeatStoreAmount",value:function(e,t){return this.system.isDisabled()?t:t+this.heatCapacity}}]),t}(cr),Lr=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).radiationCapacity=e,n.heatRadiated=0,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"isRadiator",value:function(){return!0}},{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({header:"Radiates heat",value:"".concat(this.radiationCapacity)}),t}},{key:"getRadiatedHeat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.heatRadiated+t}},{key:"getHeatRadiationCapacity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.system.isDisabled())return t;var n=this.system.damage.getPercentUnDamaged(),i=Math.floor(this.radiationCapacity*n)-this.heatRadiated;return i<0&&(i=0),t+i}},{key:"radiateHeat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e-t;if(n<=0)return t;var i=this.getHeatRadiationCapacity();return i<n&&(n=i),this.heatRadiated+=n,t+n}}]),t}(cr),Br=function(e){function t(e){var n,i=e.cargoSpace,a=void 0===i?0:i,r=e.heatStorage,s=void 0===r?0:r,o=e.radiator,u=void 0===o?0:o,c=Object(D.a)(e,["cargoSpace","heatStorage","radiator"]);return Object(T.a)(this,t),n=Object(A.a)(this,Object(P.a)(t).call(this,c)),a&&n.addStrategy(new Fr(a)),s&&n.addStrategy(new Hr(s)),u&&n.addStrategy(new Lr(u)),n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"Structure"}}]),t}(or),_r=function(){function e(t){Object(T.a)(this,e),this.location=t,this.systems=[]}return Object(E.a)(e,[{key:"getOffsetHex",value:function(){switch(this.location){case 0:return new un.Offset(0,0);case 1:return new un.Offset(1,0);case 2:return new un.Offset(-1,0);case 31:return new un.Offset(1,1);case 32:return new un.Offset(0,1);case 41:return new un.Offset(1,-1);case 42:return new un.Offset(0,-1)}}},{key:"hasUndestroyedStructure",value:function(){return this.systems.some((function(e){return e instanceof Br&&!e.isDisabled()}))}},{key:"addSystem",value:function(e){return this.systems.push(e),this}},{key:"getSystems",value:function(){return this.systems}},{key:"isLocation",value:function(e){return this.location===e}},{key:"hasSystems",value:function(){return this.systems.length>0}},{key:"getStructure",value:function(){return this.systems.find((function(e){return e instanceof Br}))}},{key:"getNonStructureSystems",value:function(){return this.systems.filter((function(e){return!(e instanceof Br)}))}}]),e}(),Ur=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,0))}return Object(I.a)(t,e),t}(_r),Nr=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,2))}return Object(I.a)(t,e),t}(_r),Vr=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,1))}return Object(I.a)(t,e),t}(_r),Gr=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,32))}return Object(I.a)(t,e),t}(_r),Wr=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,31))}return Object(I.a)(t,e),t}(_r),qr=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,41))}return Object(I.a)(t,e),t}(_r),Zr=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,42))}return Object(I.a)(t,e),t}(_r),Kr=function(){function e(t){Object(T.a)(this,e),this.ship=t,this.sections=[new Ur,new Vr,new Nr,new Wr,new Gr,new qr,new Zr]}return Object(E.a)(e,[{key:"getHitSectionHeading",value:function(e,t,n){var i=jn(En(t,e),-n);return this.ship.movement.isRolled()?jn(0,-i):i}},{key:"getNextSectionForHit",value:function(e,t){return this.sections.find((function(n){var i=n.getOffsetHex().getNeighbourAtHeading(e);return t.getOffsetHex().equals(i)}))}},{key:"getSectionsThatCanBeHit",value:function(e){var t=this;return this.sections.filter((function(n){var i=n.getOffsetHex().getNeighbourAtHeading(e);return t.sections.every((function(e){return!e.getOffsetHex().equals(i)||(!e.hasUndestroyedStructure()||e===n)}))}))}},{key:"getHitSections",value:function(e,t,n,i){var a=this.getHitSectionHeading(e,t,n);if(!i)return this.getSectionsThatCanBeHit(a);for(var r=[];;){var s=this.getNextSectionForHit(a,i);if(!s)return r;if(r=r.concat(s),s.hasUndestroyedStructure())return r;i=s}}},{key:"getPrimarySection",value:function(){return this.getSection(Ur)}},{key:"getFrontSection",value:function(){return this.getSection(Vr)}},{key:"getAftSection",value:function(){return this.getSection(Nr)}},{key:"getStarboardFrontSection",value:function(){return this.getSection(qr)}},{key:"getStarboardAftSection",value:function(){return this.getSection(Zr)}},{key:"getPortFrontSection",value:function(){return this.getSection(Wr)}},{key:"getPortAftSection",value:function(){return this.getSection(Gr)}},{key:"getSection",value:function(e){return this.sections.find((function(t){return t instanceof e}))}},{key:"getSectionBySystem",value:function(e){return this.sections.find((function(t){return t.systems.find((function(t){return e.id===t.id}))}))}}]),e}(),Xr=function(){function e(t){Object(T.a)(this,e),this.ship=t,this.systems={},this.systemsAsArray=[],this.sections=new Kr(t),this.power=new va(this)}return Object(E.a)(e,[{key:"markDestroyedThisTurn",value:function(){this.ship.markDestroyedThisTurn()}},{key:"isDestroyed",value:function(){var e=this.sections.sections.reduce((function(e,t){var n=t.getStructure();return n&&n.isDestroyed()?e+1:e}),0),t=this.sections.sections.reduce((function(e,t){return t.getStructure()?e+1:e}),0),n=this.sections.getPrimarySection().getStructure();return(!n||n.isDestroyed())&&e>t/2}},{key:"getSectionsForHit",value:function(e,t){return this.sections.getHitSections(e,this.ship.getPosition(),An(this.ship.getFacing()),t)}},{key:"getSystemsForHit",value:function(e,t){var n=this.getSectionsForHit(e,t).reduce((function(e,t){return[].concat(Object(ta.a)(e),Object(ta.a)(t.getSystems().filter((function(e){return!e.isDestroyed()}))))}),[]);return[].concat(Object(ta.a)(n),Object(ta.a)(this.getSystems().filter((function(e){return e.callHandler("canBeTargeted",null,!1)}))))}},{key:"addSystem",value:function(e,t){if(this.getSystemById(e.id))throw new Error("System with duplicate id! "+e.id);if(!e.id)throw new Error("System with falsy id!");return this.systems[e.id]=e,this.systemsAsArray.push(e),t.addSystem(e),e.addShipSystemsReference(this),this}},{key:"addPrimarySystem",value:function(e){var t=this;return(e=[].concat(e)).forEach((function(e){return t.addSystem(e,t.sections.getPrimarySection())})),this}},{key:"addFrontSystem",value:function(e){var t=this;return(e=[].concat(e)).forEach((function(e){return t.addSystem(e,t.sections.getFrontSection())})),this}},{key:"addAftSystem",value:function(e){var t=this;return(e=[].concat(e)).forEach((function(e){return t.addSystem(e,t.sections.getAftSection())})),this}},{key:"addStarboardFrontSystem",value:function(e){var t=this;return(e=[].concat(e)).forEach((function(e){return t.addSystem(e,t.sections.getStarboardFrontSection())})),this}},{key:"addStarboardAftSystem",value:function(e){var t=this;return(e=[].concat(e)).forEach((function(e){return t.addSystem(e,t.sections.getStarboardAftSection())})),this}},{key:"addPortFrontSystem",value:function(e){var t=this;return(e=[].concat(e)).forEach((function(e){return t.addSystem(e,t.sections.getPortFrontSection())})),this}},{key:"addPortAftSystem",value:function(e){var t=this;return(e=[].concat(e)).forEach((function(e){return t.addSystem(e,t.sections.getPortAftSection())})),this}},{key:"getSystemById",value:function(e){return this.systems[e]}},{key:"getSystems",value:function(){return this.systemsAsArray}},{key:"deserialize",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.forEach((function(t){var n=e.getSystemById(t.systemId);n&&n.deserialize(t.data)})),this}},{key:"serialize",value:function(){return this.systemsAsArray.map((function(e){return{systemId:e.id,data:e.serialize()}}))}},{key:"endTurn",value:function(e){this.getSystems().forEach((function(t){t.endTurn(e)}))}},{key:"advanceTurn",value:function(e){return this.getSystems().forEach((function(t){t.advanceTurn(e)})),this.power.advanceTurn(e),this}},{key:"receivePlayerData",value:function(e){this.getSystems().forEach((function(t){return t.callHandler("receivePlayerData",{clientShip:e,clientSystem:e.systems.getSystemById(t.id)})}))}},{key:"censorForUser",value:function(e,t){this.getSystems().forEach((function(n){n.callHandler("censorForUser",{user:e,mine:t})}))}},{key:"callAllSystemHandlers",value:function(e,t){return this.getSystems().reduce((function(n,i){return[].concat(Object(ta.a)(n),Object(ta.a)([].concat(i.callHandler(e,t))))}),[]).filter(Boolean)}},{key:"getTotalHeat",value:function(){return this.getSystems().reduce((function(e,t){return e+t.heat.getHeat()}),0)}},{key:"getTotalHeatStorage",value:function(){return this.getSystems().reduce((function(e,t){return e+t.heat.getMaxHeatStoreCapacity()}),0)}},{key:"getTotalHeatStored",value:function(){return this.getSystems().filter((function(e){return e.heat.isHeatStorage()})).reduce((function(e,t){return e+t.heat.getHeat()}),0)}},{key:"getPassiveHeatChange",value:function(){return this.getSystems().reduce((function(e,t){var n=t.heat.getHeatGenerated(),i=t.heat.getMaxTransferHeat();return n>i?e+i:e+n}),0)-this.getSystems().reduce((function(e,t){return e+t.heat.getRadiateHeatCapacity()}),0)}}]),e}(),Yr=n(150),Qr=function(){function e(t,n,i){Object(T.a)(this,e),this.deserialize({type:t,targetShipId:n,amount:i})}return Object(E.a)(e,[{key:"clone",value:function(){return new e(this.type,this.targetShipId,this.amount)}},{key:"addAmount",value:function(e){this.amount+=e}},{key:"getAmount",value:function(){return this.amount}},{key:"getType",value:function(){return this.type}},{key:"getActualPower",value:function(){switch(this.type){case"oew":case"dew":case"ccew":case"soew":case"sdew":return this.amount;case"disew":return this.amount/3;case"adew":return this.amount/2.5}}},{key:"getEfficiency",value:function(){switch(this.type){case"oew":case"dew":case"ccew":case"soew":case"sdew":return 1;case"disew":return 3;case"adew":return 2.5}}},{key:"serialize",value:function(){return{type:this.type,targetShipId:this.targetShipId,amount:this.amount}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.type=e.type,this.targetShipId=e.targetShipId,this.amount=e.amount,this}}]),e}(),Jr=function(){function e(t,n,i){Object(T.a)(this,e),this.dew=t,this.ccew=n,this.entries=i?i.map((function(e){return e.clone()})):[]}return Object(E.a)(e,[{key:"serialize",value:function(){return{dew:this.dew,ccew:this.ccew,entries:this.entries.map((function(e){return e.serialize()}))}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.dew=e.dew||0,this.ccew=e.ccew||0,this.entries=e.entries?e.entries.map((function(e){return(new Qr).deserialize(e)})):[],this}},{key:"getDefensiveEw",value:function(){return this.dew}},{key:"getCcEw",value:function(){return this.ccew}},{key:"getOffensiveEw",value:function(e){return this.getFromEntries("oew",e)}},{key:"getAllOew",value:function(){var e=[];return this.entries.filter((function(e){return"oew"===e.getType()})).forEach((function(t){var n=e.find((function(e){return e.targetShipId===t.targetShipId}));n?n.amount+=t.amount:e.push(t.clone())})),e}},{key:"getFromEntries",value:function(e,t){return t instanceof is&&(t=t.id),this.entries.filter((function(n){return n.type===e&&n.targetShipId===t})).reduce((function(e,t){return e+t.getAmount()}),0)}}]),e}(),$r=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),t}(Object(Yr.a)(Error)),es=function(){function e(t){Object(T.a)(this,e),this.ship=t,this.inEffect=new Jr}return Object(E.a)(e,[{key:"serialize",value:function(){return this.inEffect.serialize()}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.inEffect.deserialize(e),this}},{key:"activatePlannedElectronicWarfare",value:function(){this.inEffect=new Jr(this.getDefensiveEw(),this.getCcEw(),this.getAllEntries())}},{key:"canAssignCcEw",value:function(e){return this.canAssignEw("ccew",this.ship.id,e)}},{key:"assignCcEw",value:function(e){this.assingEw("ccew",this.ship.id,e)}},{key:"assignOffensiveEw",value:function(e,t){this.assingEw("oew",e,t)}},{key:"canAssignOffensiveEw",value:function(e,t){return this.canAssignEw("oew",e,t)}},{key:"getCcEw",value:function(){return this.getEw("ccew",this.ship.id)}},{key:"getDefensiveEw",value:function(){return this.getEw("dew")}},{key:"getOffensiveEw",value:function(e){return this.getEw("oew",e)}},{key:"getEw",value:function(e,t){return t&&t instanceof is&&(t=t.id),"dew"===e?this.getEwArrays().reduce((function(t,n){return t+n.callHandler("getTotalEwUsedByType",e)}),0):this.getAllEntries().filter((function(n){return n.type===e&&n.targetShipId===t})).reduce((function(e,t){return e+t.getAmount()}),0)}},{key:"assingEw",value:function(e,t,n){t&&t instanceof is&&(t=t.id);var i=this.getAllEntries();i.push(new Qr(e,t,n)),this.assignEntries(i)}},{key:"canAssignEw",value:function(e,t,n){var i=this.getAllEntries();try{return this.assingEw(e,t,n),this.assignEntries(i),!0}catch(a){if(a instanceof $r)return this.assignEntries(i),!1;throw a}}},{key:"getAllOew",value:function(){var e=[];return this.getEwArrays().reduce((function(e,t){return[].concat(Object(ta.a)(e),Object(ta.a)(t.callHandler("getEwEntries")))}),[]).filter((function(e){return"oew"===e.getType()})).forEach((function(t){var n=e.find((function(e){return e.targetShipId===t.targetShipId}));n?n.amount+=t.amount:e.push(t.clone())})),e}},{key:"getAllEntries",value:function(){return this.getEwArrays().reduce((function(e,t){return[].concat(Object(ta.a)(e),Object(ta.a)(t.callHandler("getEwEntries")))}),[])}},{key:"getEwArrays",value:function(){return this.ship.systems.getSystems().filter((function(e){return e.callHandler("isEwArray")}))}},{key:"repeatElectonicWarfare",value:function(){this.assignEntries(this.getAllEntries(),!0)}},{key:"removeAll",value:function(){this.getEwArrays().forEach((function(e){return e.callHandler("resetEw")}))}},{key:"assignEntries",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.removeAll();var i=e.filter((function(e){return e.getAmount()<0}));if(e.filter((function(e){return e.getAmount()>0})).sort((function(e,t){return"oew"===e.type&&"oew"!==t.type?1:"oew"!==e.type&&"oew"===t.type?-1:0})).map((function(e){return i.filter((function(t){return t.type===e.type&&t.targetShipId===e.targetShipId})).forEach((function(t){e.getAmount()>=Math.abs(t.getAmount())?(e.amount+=t.getAmount(),t.amount=0):Math.abs(t.getAmount())>e.getAmount()&&(t.amount+=e.getAmount(),e.amount=0)})),e})).filter((function(e){return 0!==e.getAmount()})).forEach((function(e){return t.assignPositiveEW(e,n)})),i.some((function(e){return 0!==e.getAmount()})))throw new $r("Invalid EW, negative entries left")}},{key:"assignPositiveEW",value:function(e,t){for(var n=e.getAmount();n>0;){var i=this.getAvailableSystemsForEntry(e);if(0===i.length){if(t)return;throw new $r("Invalid EW")}i.shift().callHandler("assignEw",{type:e.type,target:e.targetShipId,amount:1}),n--}}},{key:"getAvailableSystemsForEntry",value:function(e){return this.getEwArrays().filter((function(t){return t.callHandler("canUseEw",{type:e.type,amount:1})})).sort((function(e,t){var n=e.callHandler("getValidEwTypes"),i=t.callHandler("getValidEwTypes");return n.length>i.length?-1:n.length<i.length?1:0}))}}]),e}(),ts=function(){function e(){Object(T.a)(this,e),this.user=null}return Object(E.a)(e,[{key:"is",value:function(e){return e&&this.user.id===e.id}},{key:"setUser",value:function(e){this.user=e}},{key:"isUsers",value:function(e){return e&&this.user&&this.user.id===e.id}},{key:"deserialize",value:function(e){return this.user=e?(new Ci).deserialize(e):void 0,this}},{key:"serialize",value:function(){return this.user?this.user.serialize():void 0}}]),e}(),ns=function(){function e(t){Object(T.a)(this,e),this.ship=t,this.moves=[]}return Object(E.a)(e,[{key:"addMovement",value:function(e){this.moves.push(e.clone()),this.buildIndex()}},{key:"removeMovement",value:function(e){var t=this.moves.find((function(t){return t.equals(e)}));this.moves=this.moves.filter((function(e){return e!==t})),this.buildIndex()}},{key:"replaceLastMove",value:function(e){this.moves[this.moves.length-1]=e,this.buildIndex()}},{key:"removeMovementExceptEnd",value:function(e){this.moves=this.moves.filter((function(t){return t.turn<e||t.isEnd()||t.isDeploy()||t.isStart()})),this.buildIndex()}},{key:"removeMovementForTurn",value:function(e){this.moves=this.moves.filter((function(t){return t.turn<e||t.isStart()})),this.buildIndex()}},{key:"removeMovementForOtherTurns",value:function(e){this.moves=this.moves.filter((function(t){return t.turn===e})),this.buildIndex()}},{key:"getMovement",value:function(){return this.moves.map((function(e){return e.clone()}))}},{key:"getPlayerAddedMovement",value:function(){return this.moves.filter((function(e){return e.isPlayerAdded()})).map((function(e){return e.clone()}))}},{key:"getLastMove",value:function(){return 0===this.moves.length?null:this.moves[this.moves.length-1].clone()}},{key:"getStartMove",value:function(){var e=this.moves.find((function(e){return e.isStart()}));return e?e.clone():null}},{key:"getDeployMove",value:function(){var e=this.moves.find((function(e){return e.isDeploy()}));return e?e.clone():null}},{key:"replaceDeployMove",value:function(e){this.moves=this.moves.map((function(t){return t.isDeploy()?e:t.clone()}))}},{key:"replaceMovement",value:function(e){this.moves=[].concat(Object(ta.a)(this.moves.filter((function(e){return!e.isPlayerAdded()}))),Object(ta.a)(e.filter((function(e){return e.isPlayerAdded()})))),this.moves=this.moves.map((function(e){return e.clone()})),this.buildIndex()}},{key:"buildIndex",value:function(){var e=this,t=null;this.moves.forEach((function(e){null===t&&(e.isEnd()||e.isStart()||e.isDeploy())&&0!==e.index?t=e.index:null!==t&&(t++,e.index=t)})),this.ship.systems.callAllSystemHandlers("resetChanneledThrust"),this.moves.forEach((function(t){t.requiredThrust.getFulfilments().forEach((function(t){t.forEach((function(t){var n=t.amount,i=t.thrusterId;e.ship.systems.getSystemById(i).callHandler("addChanneledThrust",n)}))}))}))}},{key:"getLastEndMove",value:function(){var e=this.moves.slice().reverse().find((function(e){return e.isEnd()}));return e?e.clone():null}},{key:"getLastEndMoveOrSurrogate",value:function(){var e=this.getLastEndMove();if(!e){var t=this.getDeployMove();return t||this.getStartMove()}return e}},{key:"getEvadeMove",value:function(){var e=this.moves.find((function(e){return e.isEvade()}));return e?e.clone():null}},{key:"isRolled",value:function(){return this.getLastEndMoveOrSurrogate().rolled}},{key:"isRolling",value:function(){return this.getRollMove()}},{key:"getRollMove",value:function(){var e=this.moves.find((function(e){return e.isRoll()}));return e?e.clone():null}},{key:"getEvasion",value:function(){var e=this.getEvadeMove();return e?e.value:0}},{key:"getThrustOutput",value:function(){return this.ship.systems.getSystems().reduce((function(e,t){return t.callHandler("getThrustOutput",null,e)}),0)}},{key:"getThrustRequired",value:function(){return this.moves.filter((function(e){return e.requiredThrust})).reduce((function(e,t){return e+t.requiredThrust.getTotalAmountRequired()}),0)}},{key:"getRemainingThrustOutput",value:function(){return this.getThrustOutput()-this.getThrustRequired()}},{key:"getThrusters",value:function(){return this.ship.systems.getSystems().filter((function(e){return e.callHandler("isThruster")})).filter((function(e){return!e.isDisabled()}))}},{key:"getMaxEvasion",value:function(){return this.ship.systems.getSystems().reduce((function(e,t){return t.callHandler("getMaxEvasion",null,e)}),0)}},{key:"isOverlapping",value:function(e){var t=this.ship.getHexPosition(),n=this.ship.getFacing(),i=e.getHexPosition(),a=e.getFacing();return this.ship.hexSizes.some((function(r){return e.hexSizes.some((function(e){return t.add(r.rotate(n)).equals(i.add(e.rotate(a)))}))}))}},{key:"hasValidMovement",value:function(){return new la(this.ship,this.getThrustOutput(),this.getMovement()).pay()}},{key:"revertMovementsUntilValidMovement",value:function(){for(var e=this;;){if(this.hasValidMovement())return;if(!e.getMovement().some((function(e){return e.isPlayerAdded()})))throw new Error("Ship does not have valid movement, but can not revert either");this.removeMovement(this.getMovement().filter((function(e){return e.isCancellable()})).pop())}}},{key:"applyRoll",value:function(){var e=this.getLastEndMove();this.getRollMove()&&(e.rolled=!e.rolled),this.replaceLastMove(e)}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.moves=e.map((function(e){return(new ra).deserialize(e)})),this}},{key:"serialize",value:function(){return this.moves.map((function(e){return e.serialize()}))}}]),e}(),is=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(T.a)(this,e),this.systems=new Xr(this),this.pointCost=0,this.accelcost=1,this.rollcost=1,this.pivotcost=1,this.maxPivots=null,this.evasioncost=1,this.frontHitProfile=30,this.sideHitProfile=50,this.hexSizes=[],this.shipModel=null,this.shipTypeName="",this.setShipProperties(),this.deserialize(t)}return Object(E.a)(e,[{key:"setShipProperties",value:function(){}},{key:"getFrontHitProfile",value:function(){return this.frontHitProfile+this.systems.callAllSystemHandlers("getHitProfile",{front:!0}).reduce((function(e,t){return e+t}),0)}},{key:"getSideHitProfile",value:function(){return this.sideHitProfile+this.systems.callAllSystemHandlers("getHitProfile",{front:!1}).reduce((function(e,t){return e+t}),0)}},{key:"getHitProfile",value:function(e){var t=jn(En(this.getPosition(),e),-An(this.getFacing()));return t>=330||t<=30||t>=150&&t<=210?this.getFrontHitProfile():this.getSideHitProfile()}},{key:"getPointCost",value:function(){return this.pointCost}},{key:"getFacing",value:function(){var e=this.movement.getLastMove();return e?e.getFacing():null}},{key:"getFinalPosition",value:function(){var e=this.movement.getLastMove();return e?e.getPosition().add(e.velocity):null}},{key:"getFinalHexPosition",value:function(){return Dn.fromGameToHex(this.getFinalPosition())}},{key:"getPosition",value:function(){var e=this.movement.getLastMove();return e?e.getPosition():null}},{key:"getHexPosition",value:function(){return Dn.fromGameToHex(this.getPosition())}},{key:"distanceTo",value:function(e){return vn()*this.hexDistanceTo(e)}},{key:"_calculateHexDistanceTo",value:function(e,t,n,i,a){var r=null;return(this.hexSizes.length>0?this.hexSizes:[new nn(0,0)]).forEach((function(s){(a.hexSizes.length>0?a.hexSizes:[new nn(0,0)]).forEach((function(a){var o=e.add(s.rotate(t)).distanceTo(n.add(a.rotate(i)));(null===r||o<r)&&(r=o)}))})),r}},{key:"finalHexDistanceTo",value:function(e){var t=this.getFinalHexPosition(),n=this.getFacing(),i=e.getFinalHexPosition(),a=e.getFacing();return this._calculateHexDistanceTo(t,n,i,a,e)}},{key:"hexDistanceTo",value:function(e){var t=this.getHexPosition(),n=this.getFacing(),i=e.getHexPosition(),a=e.getFacing();return this._calculateHexDistanceTo(t,n,i,a,e)}},{key:"getVelocity",value:function(){var e=this.movement.getLastMove();return e?e.getVelocity():null}},{key:"getIconHexas",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.hexSizes.map((function(t){return t.rotate(e)}))}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.shipData||{};return this.id=e.id||null,this.name=e.name||"Unnamed ship ",this.shipClass=this.constructor.name,this.slotId=e.slotId||null,this.systems.deserialize(t.systems),this.player=new ts(this).deserialize(t.player),this.movement=new ns(this).deserialize(e.movement),this.electronicWarfare=new es(this).deserialize(t.electronicWarfare),this.destroyedThisTurn=e.destroyedThisTurn||!1,this}},{key:"serialize",value:function(){return{id:this.id,gameId:this.gameId,name:this.name,shipClass:this.shipClass,slotId:this.slotId,movement:this.movement.serialize(),shipData:{systems:this.systems.serialize(),player:this.player.serialize(),electronicWarfare:this.electronicWarfare.serialize()},destroyedThisTurn:this.destroyedThisTurn}}},{key:"isDestroyed",value:function(){return this.systems.isDestroyed()}},{key:"isDestroyedThisTurn",value:function(){return this.destroyedThisTurn}},{key:"markDestroyedThisTurn",value:function(){this.destroyedThisTurn=!0}},{key:"censorForUser",value:function(e,t){t||this.movement.removeMovementExceptEnd(this.turn),this.systems.censorForUser(e,t)}},{key:"endTurn",value:function(e){this.systems.endTurn(e)}},{key:"advanceTurn",value:function(e){return this.movement.removeMovementForOtherTurns(e),this.systems.advanceTurn(e),this.electronicWarfare.activatePlannedElectronicWarfare(),this.electronicWarfare.removeAll(),this.destroyedThisTurn=!1,this}},{key:"receivePlayerData",value:function(e){this.systems.receivePlayerData(e)}},{key:"setShipLoadout",value:function(){this.systems.callAllSystemHandlers("loadTargetInstant")}}]),e}(),as=function(){function e(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(T.a)(this,e),this.id=null,this.shooterId=t instanceof is?t.id:t,this.targetId=t instanceof is?n.id:n,this.weaponId=i instanceof or?i.id:i,this.weaponSettigs=a,this.resolved=!1}return Object(E.a)(e,[{key:"setId",value:function(e){return this.id=e,this}},{key:"setResolved",value:function(){return this.resolved=!0,this}},{key:"serialize",value:function(){return{id:this.id,shooterId:this.shooterId,targetId:this.targetId,weaponId:this.weaponId,weaponSettigs:this.weaponSettigs,resolved:this.resolved}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.id=e.id||null,this.shooterId=e.shooterId,this.targetId=e.targetId,this.weaponId=e.weaponId,this.weaponSettigs=e.weaponSettigs||{},this.resolved=e.resolved,this}}]),e}(),rs=function(){function e(){Object(T.a)(this,e),this.gamedata=null}return Object(E.a)(e,[{key:"update",value:function(e){return this.gamedata=e,this}},{key:"getAllFireOrders",value:function(){var e=this;return this.gamedata.ships.getShips().reduce((function(t,n){return[].concat(Object(ta.a)(t),Object(ta.a)(e.getAllFireOrdersForShip(n)))}),[])}},{key:"getFireOrderById",value:function(e){return this.getAllFireOrders().find((function(t){return t.id===e}))}},{key:"getAllFireOrdersForShip",value:function(e){return e.systems.getSystems().reduce((function(e,t){return[].concat(Object(ta.a)(e),Object(ta.a)(t.callHandler("getFireOrders",{},[])))}),[])}},{key:"systemHasFireOrder",value:function(e){var t=e.callHandler("getFireOrders");return t&&t.length>0}},{key:"systemHasFireOrderAgainstShip",value:function(e,t){return e.callHandler("getFireOrders",null,[]).some((function(e){return e.targetId===t.id}))}},{key:"addFireOrder",value:function(e,t,n){if(!this.canFire(e,t,n))throw new Error("Check validity first");return n.callHandler("addFireOrder",{shooter:e,target:t})}},{key:"removeFireOrders",value:function(e,t){t.callHandler("removeFireOrders")}},{key:"canFire",value:function(e,t,n){return!(e.isDestroyed()||t.isDestroyed()||n.isDisabled()||!n.callHandler("usesFireOrders",null,!1))&&!!n.callHandler("canFire",null,!0)}}]),e}(),ss=function(){function e(){Object(T.a)(this,e),this.state={}}return Object(E.a)(e,[{key:"set",value:function(e,t){this.state[e]=t}},{key:"get",value:function(e){return this.state[e]}}]),e}(),os=$n("/img/3d/line3/scene.gltf"),us=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";switch(e){case"dashed":return(new Wt.TextureLoader).load("/img/line/dash.png");case"dashed-arrow":return(new Wt.TextureLoader).load("/img/line/dashArrow.png");case"dashed-circle":return(new Wt.TextureLoader).load("/img/line/dashCircle.png");default:return(new Wt.TextureLoader).load("/img/line/full.png")}},cs=function(){function e(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(T.a)(this,e),this.args=a,this.mesh=null,this.color=a.color||new Wt.Color(1,1,1),this.opacity=a.opacity||1,this.material=new Wt.RawShaderMaterial({uniforms:{map:{value:us(a.type)},time:{type:"f",value:0},zoom:{type:"f",value:0},color:{type:"v3",value:this.color},opacity:{type:"f",value:this.opacity},textureRepeat:{type:"f",value:1},pulse:{type:"v2",value:[a.pulseAmount||0,a.pulseSpeed||1]}},transparent:!0,depthWrite:!1,depthTest:!0,side:Wt.DoubleSide,blending:a.blending||Wt.NormalBlending,vertexShader:Vn,fragmentShader:Gn}),this.start=t,this.end=n,this.lineWidth=i,this.create(),this.update(t,n,i,!0),this.animate()}return Object(E.a)(e,[{key:"animate",value:function(){var e=Date.now();this.material.uniforms.time.value=e%1e3*.001,this.material.needsUpdate=!0,requestAnimationFrame(this.animate.bind(this))}},{key:"addTo",value:function(e){return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return this.scene=e,t.next=3,Zt.a.awrap(os);case 3:e.add(this.mesh);case 4:case"end":return t.stop()}}),null,this)}},{key:"create",value:function(){var e;return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return this.material.uniforms.map.value.wrapT=Wt.RepeatWrapping,this.material.uniforms.map.value.minFilter=this.args.minFilter||Wt.LinearMipmapNearestFilter,this.material.needsUpdate=!0,t.next=5,Zt.a.awrap(os);case 5:e=t.sent,this.mesh=new Wt.Mesh(e.scene.children[0].geometry.clone(),this.material);case 7:case"end":return t.stop()}}),null,this)}},{key:"updateTextureSize",value:function(e){var t,n;return Zt.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:this.args.textureSize=e,t=this.start.distanceTo(this.end),n=this.args.textureSize?t/this.args.textureSize:1,this.args.roundTestureRepeate&&(n=Math.round(n)),this.material.uniforms.textureRepeat.value=n;case 5:case"end":return i.stop()}}),null,this)}},{key:"update",value:function(e,t){var n,i,a,r,s,o,u=arguments;return Zt.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return n=u.length>2&&void 0!==u[2]?u[2]:1,i=u.length>3?u[3]:void 0,c.next=4,Zt.a.awrap(os);case 4:return(n!==this.lineWidth||i)&&this.mesh.scale.setY(this.lineWidth),e.equals(this.start)&&t.equals(this.end)&&!i||(a=t.sub(e),this.mesh.quaternion.setFromUnitVectors(new Wt.Vector3(1,0,0).normalize(),a.normalize()),r=e.distanceTo(t),this.mesh.scale.setX(r),s=e.add(a.multiplyScalar(.5)),this.mesh.position.set(s.x,s.y,s.z),o=this.args.textureSize?r/this.args.textureSize:1,this.args.roundTestureRepeate&&(o=Math.round(o)),this.material.uniforms.textureRepeat.value=o,this.material.needsUpdate=!0),this.start=e,this.end=t,this.lineWidth=n,c.abrupt("return",this);case 10:case"end":return c.stop()}}),null,this)}},{key:"render",value:function(e){}},{key:"hide",value:function(){return Zt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zt.a.awrap(os);case 2:return this.mesh.visible=!1,e.abrupt("return",this);case 4:case"end":return e.stop()}}),null,this)}},{key:"show",value:function(){return Zt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zt.a.awrap(os);case 2:return this.mesh.visible=!0,e.abrupt("return",this);case 4:case"end":return e.stop()}}),null,this)}},{key:"destroy",value:function(){return Zt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zt.a.awrap(os);case 2:this.scene.remove(this.mesh),this.mesh.material.dispose();case 4:case"end":return e.stop()}}),null,this)}}]),e}(),ls=new Wt.TextureLoader,hs={},ds=new Wt.ShaderMaterial({vertexShader:Nn,fragmentShader:Un,transparent:!0,depthWrite:!1}),ms=function(){function e(t,n,i){Object(T.a)(this,e),this.z=i||0,this.mesh=null,this.size=n,this.opacity=1,this.uniforms={texture:{type:"t",value:new Wt.DataTexture(null,0,0)},overlayAlpha:{type:"f",value:0},overlayColor:{type:"v3",value:new Wt.Color(0,0,0)},opacity:{type:"f",value:1}},this.color=null,this.mesh=this.create(n,t)}return Object(E.a)(e,[{key:"getMaterial",value:function(){return ds}},{key:"hide",value:function(){return this.mesh.visible=!1,this}},{key:"show",value:function(){return this.mesh.visible=!0,this}},{key:"replaceColor",value:function(e){return this.uniforms.overlayColor.value=e,this}},{key:"revertColor",value:function(){this.color&&(this.uniforms.overlayColor.value=this.color)}},{key:"setPosition",value:function(e){return this.mesh.position.x=e.x,this.mesh.position.y=e.y,this}},{key:"setOpacity",value:function(e){return this.opacity=e,this.uniforms.opacity.value=e,this}},{key:"multiplyOpacity",value:function(e){return this.uniforms.opacity.value=this.opacity*e,this}},{key:"setOverlayColorAlpha",value:function(e){return this.uniforms.overlayAlpha.value=e,this}},{key:"setOverlayColor",value:function(e){return this.color=e,this.uniforms.overlayColor.value=e,this}},{key:"setScale",value:function(e,t){return this.mesh.scale.set(e,t,1),this}},{key:"destroy",value:function(){this.mesh.material.dispose()}},{key:"setFacing",value:function(e){return this.mesh.rotation.z=Tn(e),this}},{key:"getFacing",value:function(){return Cn(this.mesh.rotation.z)}},{key:"create",value:function(e,t){var n=this.getMaterial(),i=hs[e.width+"-"+e.height]||function(){var t=new Wt.PlaneGeometry(e.width,e.height,1,1);return hs[e.width+"-"+e.height]=t,t}();"string"==typeof t&&(t=ls.load("img/spritesheet.png")),this.uniforms.texture.value=t,this.material=n.clone(),this.material.uniforms=this.uniforms,this.material.depthTest=!0;var a=new Wt.Mesh(i,this.material);return a.position.z=this.z,a}}]),e}(),fs=function(e,t,n,i,a,r,s){e.beginPath(),e.arc(t,n,a,r,s,!1);var o=xn(i,-Cn(s),t,n);e.lineTo(o.x,o.y),e.arc(t,n,i,s,r,!0);var u=xn(a,-Cn(r),t,n);e.lineTo(u.x,u.y),e.closePath(),e.stroke(),e.fill()},ps=function(e,t,n,i,a,r,s){var o=i*Math.sin(30/180*Math.PI),u=i*Math.cos(30/180*Math.PI);vs(e,t-=u,n-=2*o,i,a,r,s)},vs=function(e,t,n,i,a,r,s){var o,u,c,l,h,d,m=i*Math.sin(30/180*Math.PI),f=i*Math.cos(30/180*Math.PI);o={x:t,y:n+m+i},u={x:t,y:n+m},c={x:t+f,y:n},l={x:t+2*f,y:n+m},h={x:t+2*f,y:n+m+i},d={x:t+f,y:n+2*i},e.beginPath(),a?(e.moveTo(o.x,o.y),e.lineTo(u.x,u.y)):e.moveTo(u.x,u.y),r?e.lineTo(c.x,c.y):e.moveTo(c.x,c.y),s?e.lineTo(l.x,l.y):e.moveTo(l.x,l.y),e.lineTo(h.x,h.y),e.lineTo(d.x,d.y),e.lineTo(o.x,o.y),e.closePath(),e.stroke(),e.fill()},gs=function(e,t,n){var i=document.createElement("canvas");return i.width=e,i.height=t,i.style.zIndex=1e3,i.style.position="absolute",i.style.top="3px",i.style.left="3px",i.style.border="1px solid red",n&&document.body.appendChild(i),i},ys=function(e,t,n){return gs(e,t,n)},bs=function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=1);var i=new Wt.Texture(e);return i.needsUpdate=!0,i.wrapS=Wt.RepeatWrapping,i.wrapT=Wt.RepeatWrapping,i.repeat.set(Os(t),ws(n)),i.offset.set(0,.16666),i},Os=function(e){return.75+2*(e-1)/4},ws=function(e){return 4/6+3*(e-1)/6},ks=function(e,t,n,i,a){var r=1,s=1,o=e,u=o/4/Math.cos(30/180*Math.PI),c=mn(u),l=fn(u),h=gn(u),d=ys(o,h,!1),m=d.getContext("2d",{antialias:!0});m.fillStyle=t,m.strokeStyle=t,m.fillStyle=n,m.lineWidth=i,m.scale(r,s),a&&(ps(m,l,0,u,!0,!0,!0),ps(m,3*l,0,u,!0,!0,!0)),ps(m,2*l,u+c,u,!0,!0,!0),a&&(ps(m,l,3*u,u,!0,!0,!0),ps(m,3*l,3*u,u,!0,!0,!0));var f=ys(o,o,!1);return f.getContext("2d",{antialias:!0}).drawImage(d,0,0,o,h,0,0,o,o),f},js=ks,Ss=function(e,t,n,i,a,r){return bs(ks(e,i,a,r,!0),t,n)},xs=null,Cs=function(){var e=js(512,Ts(),Es(),10),t=new Wt.Texture(e);t.needsUpdate=!0,xs=t},Ts=function(){return"rgba(255,255,255,0.50)"},Es=function(){return"rgba(255,255,255,0.15)"},As=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Object(T.a)(this,t),n=Object(A.a)(this,Object(P.a)(t).call(this,null,{width:yn()*a,height:gn()*a},i)),xs||Cs(),n.uniforms.texture.value=xs,n.setPosition(e),n}return Object(I.a)(t,e),t}(ms),Ps=null,Is=function(){if(!Ps){var e=gs(512,512),t=e.getContext("2d");t.strokeStyle="rgba(78,220,25,1.0)",t.fillStyle="rgba(78,220,25,0.5)",function(e,t,n,i,a,r,s){for(var o=360/r,u=o*s,c=0;c<360;c+=o)fs(e,t,n,i,a,Tn(c),Tn(c+o-u))}(t,256,256,204.8,256,12,.3),(Ps=new Wt.Texture(e)).needsUpdate=!0}},Ds=function(e){function t(e,n,i){var a;return Object(T.a)(this,t),(a=Object(A.a)(this,Object(P.a)(t).call(this,null,e,n))).setOpacity(i),Is(),a.uniforms.texture.value=Ps,a}return Object(I.a)(t,e),t}(ms),Ms=function(){function e(t,n,i,a){Object(T.a)(this,e),a||(a={}),this.z=i||0;var r=a.size||256;this.color=n||"rgba(255,255,255,1)",this.fontSize=a.fontSize||"32px",this.font=a.font||"Arial Black";var s=gs(r,r),o=s.getContext("2d");o.save(),o.fillStyle=this.color,o.font=this.fontSize+" "+this.font,o.textAlign="center",o.textBaseline="middle",o.shadowOffsetX=0,o.shadowOffsetY=0,o.shadowColor="rgba(0,0,0,1)",o.shadowBlur=8,o.fillText(t,Math.round(r/2),Math.round(r/2)),o.restore();var u=new Wt.PlaneGeometry(r,r,1,1),c=new Wt.Texture(s);c.needsUpdate=!0,this.material=new Wt.MeshBasicMaterial({map:c,transparent:!0,depthTest:!1,depthWrite:!1}),this.mesh=new Wt.Mesh(u,this.material)}return Object(E.a)(e,[{key:"setScale",value:function(e,t){this.mesh.scale.set(e,t,1)}},{key:"hide",value:function(){return this.mesh.visible=!1,this}},{key:"show",value:function(){return this.mesh.visible=!0,this}},{key:"setOpacity",value:function(e){this.material.opacity=e}},{key:"setPosition",value:function(e){return this.mesh.position.x=e.x,this.mesh.position.y=e.y,this.mesh.position.z=this.z,this}},{key:"destroy",value:function(){this.mesh.material.dispose()}}]),e}(),zs=new Wt.ShaderMaterial({vertexShader:Nn,fragmentShader:Un,transparent:!0,depthWrite:!1}),Rs=(new Wt.TextureLoader).load("/img/shipMapIcon.png"),Fs=(new Wt.TextureLoader).load("/img/shipMapIconMovementTarget.png"),Hs=function(e){function t(e,n,i,a){var r,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return Object(T.a)(this,t),(r=Object(A.a)(this,Object(P.a)(t).call(this,null,n,i))).setOpacity(a),r.uniforms.texture.value=s?Fs:Rs,r.setPosition(e),r}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getMaterial",value:function(){return zs}}]),t}(ms),Ls=null,Bs=new Wt.ShaderMaterial({vertexShader:"\n\n    attribute vec3 color;\n    attribute float opacity;\n    attribute float dashRatio;\n    attribute vec2 pulse;\n    varying float vOpacity;\n    varying vec3 vColor;\n    varying vec2 vUv;\n    varying float vDashRatio;\n    varying vec2 vPulse;\n\n    void main() {\n        vUv = uv;\n        vColor = color;\n        vPulse = pulse;\n        vOpacity = opacity;\n        vDashRatio = dashRatio;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);\n    }\n",fragmentShader:"\n\n    uniform float time;\n    varying vec3 vColor;\n    varying vec2 vUv;\n    varying float vOpacity;\n    varying float vDashRatio;\n    varying vec2 vPulse;\n\n    vec4 getPulse(vec4 color) {\n        float pulseAmount = vPulse.x;\n        float pulseSpeed = vPulse.y;\n\n        if (pulseAmount == 0.0 || pulseSpeed == 0.0) {\n            return color;\n        }\n\n        float pulseTime = mod(time * pulseSpeed, 1.0);\n        float y = mod(vUv.y * pulseAmount, 1.0);\n   \n        float diff = y - pulseTime;\n        if (diff < 0.0) {\n            diff = 1.0 + diff;\n        }\n\n        if (diff > 0.9) {\n            diff = 1.0 - ((diff - 0.9) * 10.0);\n        }\n    \n        color += diff * 0.1;\n\n        return color;\n    }\n\n    vec4 blendSides(vec4 color) {\n        float treshold = 0.4;\n        if (vUv.x < treshold) {\n            color.a *= vUv.x * 1.0 / treshold;\n        } else if (vUv.x > 1.0 - treshold) {\n            color.a *= (1.0 - vUv.x) * 1.0 / treshold;;\n        }\n\n        return color;\n    }\n\n    vec4 getDashedColor(vec4 color) {\n\n        if (vDashRatio == 0.0) {\n            return color;\n        }\n\n        float y = vUv.y;\n\n        if ( mod(floor(y * 10.0 / (vDashRatio * 10.0)), 2.0) == 0.0 ) {\n            discard;\n        }\n\n        float modulus = mod(y, vDashRatio) / vDashRatio;\n        if (modulus < 0.2) {\n            color.a *= modulus * 5.0;\n        } else if (modulus > 0.8) {\n            color.a *= (1.0 - modulus) * 5.0;\n        }\n\n        return color;\n    }\n\n    void main() {\n        vec4 finalColor = vec4(vColor, 1.0);\n\n        if (finalColor.a > 0.0) {\n            finalColor.a *= vOpacity;\n        }\n\n        finalColor = getDashedColor(finalColor);\n        finalColor = blendSides(finalColor);\n        finalColor = getPulse(finalColor);\n       \n        gl_FragColor = finalColor; \n    }\n",transparent:!0,depthWrite:!1,side:Wt.DoubleSide,blending:Wt.AdditiveBlending});Bs.uniforms={time:{type:"f",value:0}};!function e(){var t=Date.now();Bs.uniforms.time.value=t%1e3*.001,Bs.needsUpdate=!0,requestAnimationFrame(e)}();var _s=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(T.a)(this,e),i||(i={}),this.scene=t,this.mesh=null,this.start=i.start,this.end=i.end,this.width=i.width||10,this.pulseAmount=i.pulseAmount||0,this.pulseSpeed=i.pulseSpeed||1,this.dashSize=i.dashSize||0,this.length=(new Wt.Vector3).subVectors(this.start,this.end).length(),this.type=i.type||"laser",this.ready=new Promise((function(e){n.resolveReady=e})),this.color=i.color,this.opacity=i.opacity,this.currentRotationMatrix=null,this.create(this.start,this.end,this.width)}return Object(E.a)(e,[{key:"getGeometry",value:function(){var e;return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(Ls){t.next=7;break}return t.next=3,Zt.a.awrap($n("/img/3d/line2/scene.gltf"));case 3:e=t.sent,(Ls=e.scene.children[0]).rotation.set(Ls.rotation.x+Tn(90),Ls.rotation.y,Ls.rotation.z),Ls.material=Bs;case 7:return t.abrupt("return",Ls);case 8:case"end":return t.stop()}}))}},{key:"createMesh",value:function(e,t){var n;return Zt.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Zt.a.awrap(this.getGeometry());case 2:return(n=(n=i.sent).clone()).geometry=n.geometry.clone(),n.scale.set(e,e,t),i.abrupt("return",n);case 7:case"end":return i.stop()}}),null,this)}},{key:"getVertexAmount",value:function(){switch(this.type){case"cylinder":return 14;case"laser":return 16}}},{key:"setPulse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.pulseAmount=e,this.pulseSpeed=t,this.pulseAttribute)for(var n=0;n<this.getVertexAmount();n++)this.pulseAttribute.setXY(n,this.pulseAmount,this.pulseSpeed);else{for(var i=[],a=0;a<this.getVertexAmount();a++)i.push(this.pulseAmount,this.pulseSpeed);this.pulseAttribute=new Wt.BufferAttribute(new Float32Array(i),2).setDynamic(!0),this.mesh.geometry.addAttribute("pulse",this.pulseAttribute)}this.dashAttribute.needsUpdate=!0}},{key:"setDashed",value:function(e){if(this.dashRatio=e/this.length,this.dashAttribute)for(var t=0;t<this.getVertexAmount();t++)this.dashAttribute.setX(t,this.dashAttribute);else{for(var n=[],i=0;i<this.getVertexAmount();i++)n.push(this.dashRatio);this.dashAttribute=new Wt.BufferAttribute(new Float32Array(n),1).setDynamic(!0),this.mesh.geometry.addAttribute("dashRatio",this.dashAttribute)}this.dashAttribute.needsUpdate=!0}},{key:"setColorAttribute",value:function(e){for(var t=[],n=0;n<this.getVertexAmount();n++)t.push(e.r,e.g,e.b);this.colorAttribute=new Wt.BufferAttribute(new Float32Array(t),3).setDynamic(!0),this.mesh.geometry.addAttribute("color",this.colorAttribute),this.colorAttribute.needsUpdate=!0}},{key:"setColor",value:function(e){var t;return Zt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Zt.a.awrap(this.ready);case 2:for(this.color=e,t=0;t<this.getVertexAmount();t++)this.colorAttribute.setXYZ(t,this.color.r,this.color.g,this.color.b);this.colorAttribute.needsUpdate=!0;case 5:case"end":return n.stop()}}),null,this)}},{key:"setOpacity",value:function(e){if(this.opacity=e,this.opacityAttribute)for(var t=0;t<this.getVertexAmount();t++)this.opacityAttribute.setX(t,this.opacity);else{for(var n=[],i=0;i<this.getVertexAmount();i++)n.push(e);this.opacityAttribute=new Wt.BufferAttribute(new Float32Array(n),1).setDynamic(!0),this.mesh.geometry.addAttribute("opacity",this.opacityAttribute)}this.opacityAttribute.needsUpdate=!0}},{key:"getOrientation",value:function(e,t){var n=new Wt.Matrix4;return n.lookAt(e,t,(new Wt.Object3D).up),n.multiply((new Wt.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1)),n}},{key:"create",value:function(e,t,n){var i,a;return Zt.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Zt.a.awrap(this.createMesh(n,this.length));case 2:i=r.sent,a=this.getOrientation(e,t),i.applyMatrix(a),this.currentRotationMatrix=a,i.position.x=(t.x+e.x)/2,i.position.y=(t.y+e.y)/2,i.position.z=(t.z+e.z)/2,this.scene.add(i),this.mesh=i,this.resolveReady(!0),this.setColorAttribute(this.color),this.setOpacity(this.opacity),this.setDashed(this.dashSize),this.setPulse(this.pulseAmount,this.pulseSpeed);case 16:case"end":return r.stop()}}),null,this)}},{key:"updateMesh",value:function(){var e=this.getOrientation(this.start,this.end);this.mesh.applyMatrix((new Wt.Matrix4).getInverse(this.currentRotationMatrix)),this.mesh.scale.set(this.width,this.width,this.length),this.mesh.applyMatrix(e),this.currentRotationMatrix=e,this.mesh.position.x=(this.end.x+this.start.x)/2,this.mesh.position.y=(this.end.y+this.start.y)/2,this.mesh.position.z=(this.end.z+this.start.z)/2}},{key:"update",value:function(e,t,n){return Zt.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Zt.a.awrap(this.ready);case 2:this.width=n,this.start=e,this.end=t,this.length=(new Wt.Vector3).subVectors(this.start,this.end).length(),this.updateMesh();case 7:case"end":return i.stop()}}),null,this)}},{key:"setEnd",value:function(e){this.update(this.start,e,this.width)}},{key:"setLineWidth",value:function(e){this.width=e,this.mesh.scale.set(this.width,this.width,this.length)}},{key:"multiplyOpacity",value:function(e){this.setOpacity(this.opacity*e)}},{key:"hide",value:function(){return Zt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zt.a.awrap(this.ready);case 2:return this.mesh.visible=!1,e.abrupt("return",this);case 4:case"end":return e.stop()}}),null,this)}},{key:"show",value:function(){return Zt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zt.a.awrap(this.ready);case 2:return this.mesh.visible=!0,e.abrupt("return",this);case 4:case"end":return e.stop()}}),null,this)}},{key:"destroy",value:function(){return Zt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zt.a.awrap(this.ready);case 2:this.scene.remove(this.mesh);case 3:case"end":return e.stop()}}),null,this)}}]),e}(),Us=function(e){var t;return Zt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Zt.a.awrap($n(e));case 2:return t=n.sent,n.abrupt("return",new Ns(t.scene,t.animations));case 4:case"end":return n.stop()}}))},Ns=function(){function e(t,n){Object(T.a)(this,e),this.id=null,this.object=new Wt.Object3D,this.scene=t,this.animations=n,this.actions=[],this.object.add(this.scene),this.animationMixer=new Wt.AnimationMixer(this.scene),this.loopAnimation("ambient")}return Object(E.a)(e,[{key:"traverse",value:function(t){this.object.traverse((function(n){n.isMesh&&t(n),n instanceof e&&n.traverse(t)}))}},{key:"disableAnimation",value:function(e){var t=Wt.AnimationClip.findByName(this.animations,e);if(t){var n=this.animationMixer.clipAction(t);n.reset(),n.weight=0,n.paused=!0}}},{key:"playAnimation",value:function(e){var t=Wt.AnimationClip.findByName(this.animations,e);if(t){var n=this.animationMixer.clipAction(t);n.reset(),n.weight=1,n.clampWhenFinished=!0,n.loop=Wt.LoopOnce,n.time=0,n.paused=!1,n.play()}}},{key:"loopAnimation",value:function(e){var t=Wt.AnimationClip.findByName(this.animations,e);if(t){var n=this.animationMixer.clipAction(t);n.reset(),n.weight=1,n.clampWhenFinished=!0,n.loop=Wt.LoopRepeat,n.time=0,n.paused=!1,n.play()}}},{key:"setAnimation",value:function(e,t){var n=Wt.AnimationClip.findByName(this.animations,e);if(n){var i=this.animationMixer.clipAction(n);i.reset(),i.weight=1,i.clampWhenFinished=!0,i.loop=Wt.LoopOnce,i.time=t,i.paused=!0,i.play()}}},{key:"addTo",value:function(e){e.add(this.object)}},{key:"removeFrom",value:function(e){e.remove(this.object)}},{key:"clone",value:function(){var t=Qn(this),n=new e(t.scene,t.animations);return n.setId(this.id),n}},{key:"setId",value:function(e){return this.id=e,this}},{key:"render",value:function(e){var t=e.delta;this.animationMixer.update(.001*t)}}]),e}(),Vs=function(){function e(t){Object(T.a)(this,e),this.icon=t,this.size={width:25,height:25},this.normalSprite=new Hs({x:0,y:0,z:0},this.size,0,1),this.movementTargetSprite=new Hs({x:0,y:0,z:0},{width:30,height:30},0,1,!0),this.sprite=this.normalSprite,this.sprite.mesh.userData={icon:t},this.sprite.hide(),this.normalSprite.hide(),this.movementTargetSprite.hide(),this.scene=null}return Object(E.a)(e,[{key:"setMovementTarget",value:function(){return this.scene.remove(this.sprite.mesh),this.sprite=this.movementTargetSprite,this.scene.add(this.sprite.mesh),this}},{key:"replaceColor",value:function(e){return this.sprite.replaceColor(e),this}},{key:"revertColor",value:function(){return this.sprite.revertColor(this.color),this}},{key:"addTo",value:function(e){this.scene=e,e.add(this.sprite.mesh)}},{key:"setScale",value:function(e){return this.sprite.setScale(e,e),this}},{key:"setRotation",value:function(e){return this.normalSprite.setFacing(e),this.movementTargetSprite.setFacing(e),this}},{key:"setOverlayColor",value:function(e){return this.sprite.setOverlayColor(e),this}},{key:"setOverlayColorAlpha",value:function(e){return this.sprite.setOverlayColorAlpha(e),this}},{key:"show",value:function(){return this.sprite.show(),this}},{key:"hide",value:function(){return this.sprite.hide(),this}}]),e}(),Gs=(new Wt.Color(39/255,196/255,39/255),new Wt.Color(1,40/255,40/255),function(){function e(t,n){var i=this;Object(T.a)(this,e),this.shipId=t.id,this.ship=t,this.systemLocations={},this.bumpMap=null,this.scene=n,this.mesh=new Wt.Object3D,this.shipObject=null,this.systemObjects=[],this.resolveShipObjectLoaded=null,this.isShipObjectLoaded=new Promise((function(e,t){i.resolveShipObjectLoaded=e})),this.mapIcon=null,this.hexSprites=[],this.hexSpriteContainer=new Wt.Object3D,this.ghostShipObject=null,this.shipSideSprite=null,this.shipSelectedSprite=null,this.line=null,this.defaultHeight=50,this.sideSpriteSize=100,this.position={x:0,y:0,z:0},this.shipZ=null,this.hidden=!1,this.emissiveReplaced=[],this.ghost=!1,this.forcedEmissiveColor=null,this.opacity=1,this.rotation=0,this.roll=0,this.consumeShipdata(this.ship)}return Object(E.a)(e,[{key:"setShipObject",value:function(e){var t=this;this.shipObject=e,this.bumpMap&&e.scene.children.forEach((function(e){e.material.bumpMap=t.bumpMap,e.material.bumpScale=.5,e.material.bumpMap.flipY=!1,e.material.needsUpdate=!0})),this.shipObject.traverse((function(e){e.userData={icon:t}})),e.addTo(this.mesh),this.resolveShipObjectLoaded(!0)}},{key:"clone",value:function(){return new c[this.ship.shipModel](this.ship,this.scene)}},{key:"consumeShipdata",value:function(e){this.ship=e}},{key:"createMesh",value:function(){var e=this;null===this.shipZ&&(this.shipZ=this.defaultHeight);this.line=new _s(this.mesh,{start:{x:0,y:0,z:0},end:{x:0,y:0,z:this.defaultHeight},width:5,color:new Wt.Color(1,1,1),opacity:.1}),this.line.hide(),this.shipSelectedSprite=new Ds({width:this.overlaySpriteSize,height:this.overlaySpriteSize},this.defaultHeight,.5),this.ship.hexSizes.forEach((function(t){var n=new As(Dn.fromHexToGame(t)).setOpacity(.5).setOverlayColorAlpha(1);e.hexSprites.push(n),e.hexSpriteContainer.add(n.mesh)})),this.hexSpriteContainer.visible=!1,this.mapIcon=new Vs(this),this.mapIcon.addTo(this.mesh),this.mesh.add(this.hexSpriteContainer),this.scene.add(this.mesh),this.hide()}},{key:"create",value:function(){this.createMesh()}},{key:"setPosition",value:function(e,t){return Zt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return"object"===typeof e&&(t=e.y,e=e.x),this.position={x:e,y:t,z:0},this.mesh&&this.mesh.position.set(e,t,0),n.next=5,Zt.a.awrap(this.isShipObjectLoaded);case 5:this.shipObject.object.position.set(0,0,this.shipZ);case 6:case"end":return n.stop()}}),null,this)}},{key:"setShipZ",value:function(e){this.shipZ=e,this.setPosition(this.position)}},{key:"getPosition",value:function(){return new Rn(this.position)}},{key:"setRotation",value:function(){var e;return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Zt.a.awrap(this.isShipObjectLoaded);case 2:this.shipObject.object.quaternion.setFromAxisAngle(new Wt.Vector3(0,0,1),Tn(this.rotation)),(e=new Wt.Quaternion).setFromAxisAngle(new Wt.Vector3(1,0,0).normalize(),Tn(this.roll)).normalize(),this.shipObject.object.quaternion.multiply(e),this.hexSpriteContainer.rotation.z=Tn(this.rotation),this.mapIcon.setRotation(this.rotation);case 8:case"end":return t.stop()}}),null,this)}},{key:"setFacing",value:function(e){return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.rotation!==e){t.next=2;break}return t.abrupt("return");case 2:this.rotation=e,this.setRotation();case 4:case"end":return t.stop()}}),null,this)}},{key:"getFacing",value:function(){return-this.rotation}},{key:"setRoll",value:function(e){return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.roll!==e){t.next=2;break}return t.abrupt("return");case 2:this.roll=e,this.setRotation();case 4:case"end":return t.stop()}}),null,this)}},{key:"getRoll",value:function(){return this.roll}},{key:"setOpacity",value:function(e){return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Zt.a.awrap(this.isShipObjectLoaded);case 2:this.opacity=e,this.replaceOpacity(e);case 4:case"end":return t.stop()}}),null,this)}},{key:"hideShip",value:function(){this.shipObject&&(this.shipObject.object.visible=!1)}},{key:"showShip",value:function(){this.shipObject&&(this.shipObject.object.visible=!0)}},{key:"hide",value:function(){this.hidden||(this.scene.remove(this.mesh),this.hidden=!0)}},{key:"show",value:function(){this.hidden&&(this.scene.add(this.mesh),this.hidden=!1)}},{key:"setOverlayColorAlpha",value:function(e){}},{key:"setScale",value:function(e,t){}},{key:"showSideSprite",value:function(e){}},{key:"setHighlighted",value:function(e){}},{key:"setSideSpriteOpacity",value:function(e){}},{key:"replaceSocketByName",value:function(e,t){var n=this;return Zt.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return e=[].concat(e),i.next=3,Zt.a.awrap(this.isShipObjectLoaded);case 3:e.forEach((function(e){var i=e.name,a=e.id,r=n.shipObject.scene.children.find((function(e){return!!e.name&&(e.name===i||void 0)}));if(r)if(t){var s=t.clone().setId(a);s.object.position.copy(r.position),s.object.rotation.copy(r.rotation),s.object.quaternion.copy(r.quaternion),n.shipObject.scene.remove(r),s.addTo(n.shipObject.object),n.systemObjects.push(s),n.systemLocations[a]=r.position}else n.shipObject.scene.remove(r)}));case 4:case"end":return i.stop()}}),null,this)}},{key:"replaceOpacity",value:function(e){return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Zt.a.awrap(this.isShipObjectLoaded);case 2:this.shipObject.traverse((function(t){t.material.transparent=!0,t.material.opacity=e,t.material.needsUpdate=!0}));case 3:case"end":return t.stop()}}),null,this)}},{key:"revertOpacity",value:function(){var e=this;return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Zt.a.awrap(this.isShipObjectLoaded);case 2:this.shipObject.traverse((function(t){t.material.opacity=e.opacity,t.material.needsUpdate=!0}));case 3:case"end":return t.stop()}}),null,this)}},{key:"forceEmissive",value:function(e){this.forcedEmissiveColor=e,this.replaceEmissive(e),this.emissiveReplaced=[]}},{key:"replaceEmissive",value:function(e){var t=this;return Zt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Zt.a.awrap(this.isShipObjectLoaded);case 2:this.shipObject.traverse((function(n){t.emissiveReplaced.find((function(e){return e.object===n}))||t.emissiveReplaced.push({object:n,color:n.material.emissive,map:n.material.emissiveMap}),n.material.emissiveMap=null,n.material.emissive=e,n.material.needsUpdate=!0}));case 3:case"end":return n.stop()}}),null,this)}},{key:"revertEmissive",value:function(){var e=this;return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Zt.a.awrap(this.isShipObjectLoaded);case 2:this.shipObject.traverse((function(t){var n=e.emissiveReplaced.find((function(e){return e.object===t}));e.forcedEmissiveColor?(t.material.emissiveMap=null,t.material.emissive=e.forcedEmissiveColor,t.material.needsUpdate=!0):n&&(t.material.emissiveMap=n.map,t.material.emissive=n.color,t.material.needsUpdate=!0)}));case 3:case"end":return t.stop()}}),null,this)}},{key:"setGhostShip",value:function(e){this.ghost=!0}},{key:"setGhostShipEmissive",value:function(e){return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Zt.a.awrap(this.isShipObjectLoaded);case 2:this.forceEmissive(e),this.hexSprites.forEach((function(t){return t.setOverlayColor(new Wt.Color(e))}));case 4:case"end":return t.stop()}}),null,this)}},{key:"showMapIcon",value:function(e){this.mapIcon.setOverlayColor(e).setOverlayColorAlpha(1).show(),this.hideShip()}},{key:"hideMapIcon",value:function(){this.mapIcon.hide(),this.showShip()}},{key:"isGhostShip",value:function(){return this.ghost}},{key:"render",value:function(e){this.systemObjects.forEach((function(t){return t.render(e)}))}},{key:"playSystemAnimation",value:function(e,t){var n=this.systemObjects.find((function(t){return t.id===e.id}));n&&n.playAnimation(t)}},{key:"setSystemAnimation",value:function(e,t,n){var i=this.systemObjects.find((function(t){return t.id===e.id}));i&&i.setAnimation(t,n)}},{key:"disableSystemAnimation",value:function(e,t){var n=this.systemObjects.find((function(t){return t.id===e.id}));n&&n.disableAnimation(t)}},{key:"getShipHexas",value:function(){var e=this.getPosition(),t=this.getFacing(),n=Pn(t);return this.ship.getIconHexas(n).map((function(t){return Dn.fromHexToGame(t).add(e)}))}},{key:"getCenter",value:function(){var e=this.getShipHexas(),t=new Rn,n=new Rn;return e.forEach((function(e){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.x>n.x&&(n.x=e.x),e.y<n.y&&(n.y=e.y)})),t.add(n).multiplyScalar(.5)}}]),e}()),Ws=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this,e,n))).defaultHeight=30,i.sideSpriteSize=50,i.create(),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"create",value:function(){var e=this;Object(Oa.a)(Object(P.a)(t.prototype),"create",this).call(this),window.Loader.loadObject("img/3d/gunship/gunship.obj",(function(t){window.Loader.loadTexturesAndAssign(t.children[0],{},null,"img/3d/gunship/normal.png"),window.Loader.loadTexturesAndAssign(t.children[1],{},null,"img/3d/turretNormal.png"),window.Loader.loadTexturesAndAssign(t.children[2],{},null,"img/3d/turretNormal.png"),window.Loader.loadTexturesAndAssign(t.children[3],{},null,"img/3d/turretNormal.png"),window.Loader.loadTexturesAndAssign(t.children[6],{},null,"img/3d/turretNormal.png"),window.Loader.loadTexturesAndAssign(t.children[7],{},null,"img/3d/turretNormal.png"),window.Loader.loadTexturesAndAssign(t.children[4],{},"img/3d/diffuseThruster.png","img/3d/normalThruster.png"),window.Loader.loadTexturesAndAssign(t.children[5],{},"img/3d/diffuseThruster.png","img/3d/normalThruster.png"),t.scale.set(5,5,5),e.startRotation={x:90,y:90,z:0},e.shipObject=t,e.setRotation(e.rotation.x,e.rotation.y,e.rotation.z),e.mesh.add(e.shipObject),t.position.set(0,0,e.shipZ)}))}}]),t}(Gs),qs=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this,e,n))).defaultHeight=50,i.sideSpriteSize=30,i.overlaySpriteSize=80,i.create(),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"create",value:function(){var e,n,i,a;return Zt.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return Object(Oa.a)(Object(P.a)(t.prototype),"create",this).call(this),r.next=3,Zt.a.awrap($n("/img/3d/caliope/scene.gltf"));case 3:return e=r.sent,this.startRotation={x:90,y:90,z:0},this.shipObject=e,this.setRotation(this.rotation.x,this.rotation.y,this.rotation.z),this.mesh.add(this.shipObject),e.position.set(0,0,this.shipZ),r.next=11,Zt.a.awrap($n("/img/3d/radiator/scene.gltf"));case 11:return n=r.sent,r.next=14,Zt.a.awrap($n("/img/3d/systems/weapons/conventional/85mmAutoCannon/scene.gltf"));case 14:return i=r.sent,Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this).call(this,["engine_pylon_top_front","engine_pylon_left_front","engine_pylon_right_front"],n),Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this).call(this,["engine_pylon_top","engine_pylon_left","engine_pylon_right","main_hull_front_left_bottom","main_hull_front_left_top","main_hull_front_right_bottom","main_hull_front_right_top"],i),r.t0=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),r.t1=this,r.t2=["font_hull_bottom","font_hull_top","main_hull_front_left_side","main_hull_front_right_side"],r.next=22,Zt.a.awrap($n("/img/3d/systems/weapons/conventional/30mmPDC/scene.gltf"));case 22:return r.t3=r.sent,r.t0.call.call(r.t0,r.t1,r.t2,r.t3),r.t4=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),r.t5=this,r.t6=["thruster_top","thruster_right","thruster_left"],r.next=29,Zt.a.awrap($n("/img/3d/systems/thrusters/5mThruster/scene.gltf"));case 29:r.t7=r.sent,r.t4.call.call(r.t4,r.t5,r.t6,r.t7),(a=this.shipObject.children[0].material).emissive=new Wt.Color(1,1,1),a.emissiveMap=(new Wt.TextureLoader).load("/img/3d/caliope/emissiveMap.png"),a.emissiveMap.flipY=!1,console.log(e);case 36:case"end":return r.stop()}}),null,this)}},{key:"render",value:function(){Object(Oa.a)(Object(P.a)(t.prototype),"render",this).call(this),this.shipObject&&(this.shipObject.rotation.y+=.006)}}]),t}(Gs),Zs=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this,e,n))).defaultHeight=50,i.sideSpriteSize=50,i.create(),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"create",value:function(){var e=this;Object(Oa.a)(Object(P.a)(t.prototype),"create",this).call(this),window.Loader.loadObject("img/3d/capital/capital.obj",(function(t){window.Loader.loadTexturesAndAssign(t.children[0],{normalScale:new Wt.Vector2(.5,.5),shininess:10,color:new Wt.Color(1,1,1)},"img/3d/capital/diffuse.png","img/3d/capital/normalEdit.png"),t.scale.set(3,3,3),e.startRotation={x:90,y:90,z:0},e.shipObject=t,e.setRotation(e.rotation.x,e.rotation.y,e.rotation.z),e.mesh.add(e.shipObject),t.position.set(0,0,e.shipZ)}))}}]),t}(Gs),Ks=new Wt.TextureLoader,Xs=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this,e,n))).defaultHeight=80,i.sideSpriteSize=30,i.overlaySpriteSize=80,i.create(),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"create",value:function(){var e;return Zt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return Object(Oa.a)(Object(P.a)(t.prototype),"create",this).call(this),n.next=3,Zt.a.awrap(Us("/img/3d/ships/uc/haka/scene.gltf"));case 3:return e=n.sent,n.next=6,Zt.a.awrap(Ks.load("/img/3d/ships/uc/haka/heightMap.png"));case 6:return this.bumpMap=n.sent,n.t0=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t1=this,n.t2=[{name:"socket_middle_pylon_top",id:602},{name:"socket_front_top_1",id:606}],n.next=12,Zt.a.awrap(Us("/img/3d/systems/weapons/coilgun/turreted32GwRailgun/scene.gltf"));case 12:return n.t3=n.sent,n.t0.call.call(n.t0,n.t1,n.t2,n.t3),n.t4=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t5=this,n.t6=[{name:"socket_middle_pylon_bottom",id:202}],n.next=19,Zt.a.awrap(Us("/img/3d/systems/weapons/railgun/2x140mmRailgunTurret/scene.gltf"));case 19:return n.t7=n.sent,n.t4.call.call(n.t4,n.t5,n.t6,n.t7),n.t8=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t9=this,n.t10=[{name:"socket_main_pylon_left",id:118},{name:"socket_main_pylon_right",id:119},{name:"socket_front_top_2",id:603},{name:"socket_front_top_3",id:604}],n.next=26,Zt.a.awrap(Us("/img/3d/systems/weapons/railgun/140mmRailgunTurret/scene.gltf"));case 26:return n.t11=n.sent,n.t8.call.call(n.t8,n.t9,n.t10,n.t11),n.t12=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t13=this,n.t14=[{name:"socket_engine_1",id:123},{name:"socket_engine_2",id:123},{name:"socket_engine_3",id:123},{name:"socket_engine_4",id:123}],n.next=33,Zt.a.awrap(Us("/img/3d/systems/thrusters/10mThruster/scene.gltf"));case 33:return n.t15=n.sent,n.t12.call.call(n.t12,n.t13,n.t14,n.t15),n.t16=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t17=this,n.t18=[{name:"socket_engine_pylon_1",id:550},{name:"socket_engine_pylon_2",id:551},{name:"socket_engine_pylon_3",id:554},{name:"socket_engine_pylon_4",id:555},{name:"socket_engine_pylon_5",id:352},{name:"socket_engine_pylon_6",id:353},{name:"socket_engine_pylon_7",id:356},{name:"socket_engine_pylon_8",id:357},{name:"socket_engine_pylon_9",id:451},{name:"socket_engine_pylon_10",id:456},{name:"socket_engine_pylon_11",id:450},{name:"socket_engine_pylon_12",id:452},{name:"socket_engine_pylon_13",id:457},{name:"socket_engine_pylon_14",id:455},{name:"socket_engine_pylon_15",id:453},{name:"socket_engine_pylon_16",id:454},{name:"socket_main_right_1",id:114},{name:"socket_main_right_2",id:115},{name:"socket_main_left_1",id:116},{name:"socket_main_left_2",id:117}],n.next=40,Zt.a.awrap(Us("/img/3d/systems/weapons/conventional/30mmPDC/scene.gltf"));case 40:return n.t19=n.sent,n.t16.call.call(n.t16,n.t17,n.t18,n.t19),n.t20=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t21=this,n.t22=[{name:"socket_radiator_5",id:301},{name:"socket_radiator_6",id:302},{name:"socket_radiator_7",id:502},{name:"socket_radiator_8",id:503}],n.next=47,Zt.a.awrap(Us("/img/3d/systems/radiators/10x40/scene.gltf"));case 47:n.t23=n.sent,n.t20.call.call(n.t20,n.t21,n.t22,n.t23),Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this).call(this,[{name:"socket_radiator_1",id:416},{name:"socket_radiator_2",id:216},{name:"socket_radiator_3",id:416},{name:"socket_radiator_4",id:216}],null),this.setShipObject(e);case 51:case"end":return n.stop()}}),null,this)}}]),t}(Gs),Ys=new Wt.TextureLoader,Qs=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this,e,n))).defaultHeight=80,i.sideSpriteSize=30,i.overlaySpriteSize=80,i.create(),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"create",value:function(){var e,n,i;return Zt.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return Object(Oa.a)(Object(P.a)(t.prototype),"create",this).call(this),a.next=3,Zt.a.awrap(Us("/img/3d/caliope/scene.gltf"));case 3:return e=a.sent,a.next=6,Zt.a.awrap(Ys.load("/img/3d/caliope/heightMap.png"));case 6:return this.bumpMap=a.sent,e.object.position.set(0,0,this.defaultHeight),a.next=10,Zt.a.awrap(Us("/img/3d/radiator/scene.gltf"));case 10:return n=a.sent,a.next=13,Zt.a.awrap(Us("/img/3d/systems/weapons/conventional/85mmAutoCannon/scene.gltf"));case 13:return i=a.sent,Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this).call(this,[{name:"engine_pylon_top_front",id:412},{name:"engine_pylon_left_front",id:501},{name:"engine_pylon_right_front",id:301}],n),Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this).call(this,[{name:"engine_pylon_top",id:421},{name:"engine_pylon_left",id:521},{name:"engine_pylon_right",id:321}],i),Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this).call(this,[{name:"main_hull_front_left_bottom",id:603},{name:"main_hull_front_left_top",id:604},{name:"main_hull_front_right_bottom",id:203},{name:"main_hull_front_right_top",id:204}],i),a.t0=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),a.t1=this,a.t2=[{name:"front_hull_right_side",id:213},{name:"front_hull_left_side",id:612}],a.next=22,Zt.a.awrap(Us("/img/3d/systems/weapons/railgun/2x140mmRailgunTurret/scene.gltf"));case 22:return a.t3=a.sent,a.t0.call.call(a.t0,a.t1,a.t2,a.t3),a.t4=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),a.t5=this,a.t6=[{name:"font_hull_bottom",id:115},{name:"font_hull_top",id:114},{name:"main_hull_front_left_side",id:602},{name:"main_hull_front_right_side",id:202}],a.next=29,Zt.a.awrap(Us("/img/3d/systems/weapons/conventional/30mmPDC/scene.gltf"));case 29:return a.t7=a.sent,a.t4.call.call(a.t4,a.t5,a.t6,a.t7),a.t8=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),a.t9=this,a.t10=[{name:"thruster_top",id:123},{name:"thruster_right",id:123},{name:"thruster_left",id:123}],a.next=36,Zt.a.awrap(Us("/img/3d/systems/thrusters/5mThruster/scene.gltf"));case 36:a.t11=a.sent,a.t8.call.call(a.t8,a.t9,a.t10,a.t11),this.setShipObject(e);case 39:case"end":return a.stop()}}),null,this)}}]),t}(Gs),Js=new Wt.TextureLoader,$s=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this,e,n))).defaultHeight=100,i.sideSpriteSize=30,i.overlaySpriteSize=80,i.create(),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"create",value:function(){var e;return Zt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return Object(Oa.a)(Object(P.a)(t.prototype),"create",this).call(this),n.next=3,Zt.a.awrap(Us("/img/3d/ships/protectorate/Fulcrum/scene.gltf"));case 3:return e=n.sent,n.next=6,Zt.a.awrap(Js.load("/img/3d/ships/protectorate/Fulcrum/heightMap.png"));case 6:return this.bumpMap=n.sent,e.object.position.set(0,0,this.defaultHeight),n.t0=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t1=this,n.t2=[{name:"rear_hull_radiator_left",id:416},{name:"rear_hull_radiator_right",id:216},{name:"rear_hull_radiator_bottom",id:316}],n.next=13,Zt.a.awrap(Us("/img/3d/systems/radiators/5x40mSail/scene.gltf"));case 13:return n.t3=n.sent,n.t0.call.call(n.t0,n.t1,n.t2,n.t3),n.t4=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t5=this,n.t6=[{name:"front_plate_center",id:102}],n.next=20,Zt.a.awrap(Us("/img/3d/systems/weapons/coilgun/fixed22GwCoilgun/scene.gltf"));case 20:return n.t7=n.sent,n.t4.call.call(n.t4,n.t5,n.t6,n.t7),n.t8=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t9=this,n.t10=[{name:"front_hull_pdc_bottom",id:14},{name:"front_hull_pdc_left",id:13},{name:"front_hull_pdc_right",id:15},{name:"rear_hull_pdc_top",id:214},{name:"rear_hull_pdc_right",id:215},{name:"rear_hull_pdc_left",id:213}],n.next=27,Zt.a.awrap(Us("/img/3d/systems/weapons/conventional/30mmPDC/scene.gltf"));case 27:return n.t11=n.sent,n.t8.call.call(n.t8,n.t9,n.t10,n.t11),n.t12=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t13=this,n.t14=[{name:"thruster",id:123}],n.next=34,Zt.a.awrap(Us("/img/3d/systems/thrusters/5mThruster/scene.gltf"));case 34:n.t15=n.sent,n.t12.call.call(n.t12,n.t13,n.t14,n.t15),this.setShipObject(e);case 37:case"end":return n.stop()}}),null,this)}}]),t}(Gs),eo=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this,e,n))).defaultHeight=10,i.sideSpriteSize=30,i.overlaySpriteSize=80,i.create(),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"create",value:function(){var e;return Zt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return Object(Oa.a)(Object(P.a)(t.prototype),"create",this).call(this),n.next=3,Zt.a.awrap(Us("/img/3d/ships/protectorate/Mouros/scene.gltf"));case 3:return e=n.sent,this.setRotation(this.rotation.x,this.rotation.y,this.rotation.z),e.object.position.set(0,0,this.defaultHeight),n.t0=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t1=this,n.t2=[{name:"Middle_hull_depress_top",id:123},{name:"Middle_hull_depress_left",id:123},{name:"Middle_hull_depress_right",id:123}],n.next=11,Zt.a.awrap(Us("/img/3d/systems/weapons/conventional/85mmAutoCannon/scene.gltf"));case 11:return n.t3=n.sent,n.t0.call.call(n.t0,n.t1,n.t2,n.t3),n.t4=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t5=this,n.t6=[{name:"Middle_hull_frame_top",id:123},{name:"Middle_hull_frame_left",id:123},{name:"Middle_hull_frame_right",id:123}],n.next=18,Zt.a.awrap(Us("/img/3d/systems/weapons/conventional/140mmCannonTurret/scene.gltf"));case 18:return n.t7=n.sent,n.t4.call.call(n.t4,n.t5,n.t6,n.t7),n.t8=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t9=this,n.t10=[{name:"railgun_turret_mount_right",id:123},,{name:"railgun_turret_mount_left",id:123}],n.next=25,Zt.a.awrap(Us("/img/3d/systems/weapons/coilgun/turreted32GwRailgun/scene.gltf"));case 25:return n.t11=n.sent,n.t8.call.call(n.t8,n.t9,n.t10,n.t11),n.t12=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t13=this,n.t14=[{name:"thruster_1",id:123},{name:"thruster_6",id:123},{name:"thruster_2",id:123},{name:"thruster_4",id:123},{name:"thruster_3",id:123},{name:"thruster_5",id:123}],n.next=32,Zt.a.awrap(Us("/img/3d/systems/thrusters/8mThruster/scene.gltf"));case 32:n.t15=n.sent,n.t12.call.call(n.t12,n.t13,n.t14,n.t15),this.setShipObject(e);case 35:case"end":return n.stop()}}),null,this)}}]),t}(Gs),to=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this,e,n))).defaultHeight=15,i.sideSpriteSize=30,i.overlaySpriteSize=80,i.create(),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"create",value:function(){var e;return Zt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return Object(Oa.a)(Object(P.a)(t.prototype),"create",this).call(this),n.next=3,Zt.a.awrap(Us("/img/3d/ships/federation/Impetous/scene.gltf"));case 3:return e=n.sent,this.startRotation={x:90,y:90,z:0},this.setRotation(this.rotation.x,this.rotation.y,this.rotation.z),e.object.position.set(0,0,this.defaultHeight),n.t0=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t1=this,n.t2=[{name:"engine_mount_2",id:123},{name:"engine_mount_3",id:123},{name:"engine_mount_4",id:123},{name:"engine_mount_5",id:123}],n.next=12,Zt.a.awrap(Us("/img/3d/systems/thrusters/10mThruster/scene.gltf"));case 12:return n.t3=n.sent,n.t0.call.call(n.t0,n.t1,n.t2,n.t3),n.t4=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t5=this,n.t6=[{name:"front-wing-left-mount1",id:501},{name:"front-wing-left-mount2",id:502},{name:"front-wing-left-mount3",id:503},{name:"front-wing-right-mount1",id:101},{name:"front-wing-right-mount2",id:102},{name:"front-wing-right-mount3",id:103}],n.next=19,Zt.a.awrap(Us("/img/3d/systems/weapons/conventional/2x30mmPDC/scene.gltf"));case 19:return n.t7=n.sent,n.t4.call.call(n.t4,n.t5,n.t6,n.t7),n.t8=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t9=this,n.t10=[{name:"middle-top-mount1",id:623}],n.next=26,Zt.a.awrap(Us("/img/3d/systems/weapons/coilgun/turreted64GwRailgun/scene.gltf"));case 26:return n.t11=n.sent,n.t8.call.call(n.t8,n.t9,n.t10,n.t11),n.t12=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t13=this,n.t14=[{name:"front-wing-left-top-mount1",id:623},{name:"front-wing-left-bottom-mount1",id:623},{name:"aft-wing-left-top-mount1",id:623},{name:"aft-wing-left-bottom-mount1",id:623}],n.next=33,Zt.a.awrap(Us("/img/3d/systems/weapons/conventional/2x140mmCannonTurret/scene.gltf"));case 33:return n.t15=n.sent,n.t12.call.call(n.t12,n.t13,n.t14,n.t15),n.t16=Object(Oa.a)(Object(P.a)(t.prototype),"replaceSocketByName",this),n.t17=this,n.t18=[{name:"front-wing-left-top-mount2",id:623},{name:"front-wing-left-bottom-mount2",id:623}],n.next=40,Zt.a.awrap(Us("/img/3d/systems/weapons/conventional/85mmAutoCannon/scene.gltf"));case 40:n.t19=n.sent,n.t16.call.call(n.t16,n.t17,n.t18,n.t19),this.setShipObject(e);case 43:case"end":return n.stop()}}),null,this)}}]),t}(Gs),no=function(){function e(t,n){Object(T.a)(this,e),this.iconsAsObject={},this.iconsAsArray=[],this.scene=t,this.currentUser=n,this.ghostShipIcons=[]}return Object(E.a)(e,[{key:"shipsLoaded",value:function(){return Promise.all(this.iconsAsArray.map((function(e){return e.isShipObjectLoaded})))}},{key:"getGhostShipIconByShip",value:function(e){var t=this.ghostShipIcons.find((function(t){return t.ship===e}));return t||(t=function(e,t,n){var i=new c[e.shipModel](e,t);return i.setGhostShip(e.player.is(n)),i.hide(),i}(e,this.scene,this.currentUser),this.ghostShipIcons.push(t)),t}},{key:"update",value:function(e){var t,n=this;e.ships.getShips().forEach((function(e){n.hasIcon(e.id)?n.iconsAsObject[e.id].consumeShipdata(e):n.iconsAsObject[e.id]=function(e,t){return new c[e.shipModel](e,t)}(e,n.scene);var t=n.ghostShipIcons.find((function(t){return t.ship.id===e.id}));t&&t.consumeShipdata(e)})),this.iconsAsArray=(t=this.iconsAsObject,Object.keys(t).map((function(e){return t[e]})))}},{key:"getByShip",value:function(e){return this.iconsAsObject[e.id]}},{key:"getById",value:function(e){return this.iconsAsObject[e]}},{key:"onEvent",value:function(e,t){var n=this["on"+e];n&&"function"===typeof n&&n.call(this,t)}},{key:"onZoomEvent",value:function(e){var t=e.zoom,n=t>2?t-2:0;n>1&&(n=1),this.iconsAsArray.forEach((function(e){e.setOverlayColorAlpha(n)}))}},{key:"getArray",value:function(){return this.iconsAsArray}},{key:"hasIcon",value:function(e){return Boolean(this.iconsAsObject[e])}},{key:"getIconById",value:function(e){return this.iconsAsObject[e]}},{key:"getIconsInProximity",value:function(e){var t=[];if(this.coordinateConverter.getHexHeightViewport()/10<30)t=this.getIconsInSameHex(e.hex);else{var n=null,i=null;this.iconsAsArray.forEach((function(t){var a=wn(t.getPosition(),e.game);a<10&&(!n||a<i)&&(n=t,i=a)}),this),n&&t.push(n)}return t}},{key:"getIconsInSameHex",value:function(e){return this.iconsAsArray.filter((function(t){return this.coordinateConverter.fromGameToHex(t.getPosition()).equals(e)}),this)}},{key:"getFinalMovementInSameHex",value:function(e){return this.iconsAsArray.filter((function(t){return!t.ship.isDestroyed()&&t.getLastMovement().position.equals(e)}),this)}},{key:"render",value:function(e){this.iconsAsArray.forEach((function(t){return t.render(e)}))}}]),e}(),io=function(){function e(t,n,i,a,r,s){Object(T.a)(this,e),this.scene=s,this.shipIcon=t,this.targetIcon=n,this.targetGhost=i,this.amount=a,this.mine=r,this.visible=!1,this.targetPosition=this.targetGhost.hidden?n.getPosition():i.getPosition(),this.shipPosition=this.shipIcon.getPosition(),this.line=this.createLine()}return Object(E.a)(e,[{key:"createLine",value:function(){var e=new cs(this.shipIcon.getPosition().setZ(this.getZ()),this.targetPosition.setZ(this.getZ()),1*this.amount+5,{color:this.mine?$t:en,opacity:.5,type:"dashed-circle",textureSize:1*this.amount+5,pulseAmount:1});return e.addTo(this.scene),e}},{key:"getZ",value:function(){return 0}},{key:"remove",value:function(){this.line.destroy()}},{key:"render",value:function(e){if(this.visible){var t=this.targetGhost.hidden?this.targetIcon.getPosition():this.targetGhost.getPosition(),n=this.shipIcon.getPosition();this.shipPosition.equals(n)&&this.targetPosition.equals(t)||(this.shipPosition=n,this.targetPosition=t,this.line.update(this.shipPosition.setZ(this.getZ()),this.targetPosition.setZ(this.getZ()),1*this.amount+5),this.line&&this.line.updateTextureSize&&this.line.updateTextureSize(1*this.amount+5))}}},{key:"update",value:function(e,t){return this.ship=e,this.amount!==t&&(this.amount=t,this.line.update(this.shipPosition.setZ(this.getZ()),this.targetPosition.setZ(this.getZ()),1*this.amount+5),this.line&&this.line.updateTextureSize&&this.line.updateTextureSize(1*this.amount+5)),this}},{key:"show",value:function(){this.visible=!0,this.line.show()}},{key:"hide",value:function(){this.visible=!1,this.line.hide()}}]),e}(),ao=function(){function e(t,n,i,a){Object(T.a)(this,e),this.ship=t,this.icon=n.getByShip(t),this.shipIconContainer=n,this.currentUser=i,this.scene=a,this.oew=[],this.update(this.ship)}return Object(E.a)(e,[{key:"update",value:function(e,t){return this.ship=e,this.oew=this.createOEW(t),this}},{key:"show",value:function(){return this.oew.forEach((function(e){return e.show()})),this}},{key:"hide",value:function(){return this.oew.forEach((function(e){return e.hide()})),this}},{key:"isShip",value:function(e){return this.ship.id===e.id}},{key:"render",value:function(e){this.oew.forEach((function(t){return t.render(e)}))}},{key:"createOEW",value:function(){var e=this,t=this.oew,n=this.ship.electronicWarfare.getAllOew().map((function(t){var n=e.shipIconContainer.getById(t.targetShipId),i=e.shipIconContainer.getGhostShipIconByShip(n.ship),a=e.oew.find((function(e){return e.targetIcon===n}));return a||(a=new io(e.icon,n,i,t.amount,e.ship.player.is(e.currentUser),e.scene)),a.update(e.ship,t.amount)}));return t.filter((function(e){return n.every((function(t){return t!==e}))})).forEach((function(e){return e.remove()})),n}}]),e}(),ro=new Wt.Color(100/255,90/255,250/255),so=new Wt.Color(1,40/255,40/255),oo=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"createLine",value:function(){return new _s(this.scene,{start:Object(pi.a)({},this.shipIcon.getPosition(),{z:this.getZ()}),end:Object(pi.a)({},this.targetPosition,{z:this.getZ()}),width:1*this.amount+5,color:this.mine?ro:so,opacity:.1,pulseAmount:1,dashSize:0})}},{key:"getZ",value:function(){return 0}}]),t}(io),uo=function(){function e(t,n,i,a){Object(T.a)(this,e),this.ship=t,this.icon=n.getByShip(t),this.shipIconContainer=n,this.currentUser=i,this.scene=a,this.oew=[],this.update(this.ship)}return Object(E.a)(e,[{key:"update",value:function(e,t){return this.ship=e,this.oew=this.createOEW(t),this}},{key:"show",value:function(){return this.oew.forEach((function(e){return e.show()})),this}},{key:"hide",value:function(){return this.oew.forEach((function(e){return e.hide()})),this}},{key:"isShip",value:function(e){return this.ship.id===e.id}},{key:"render",value:function(e){this.oew.forEach((function(t){return t.render(e)}))}},{key:"createOEW",value:function(){var e=this,t=this.oew,n=this.ship.electronicWarfare.inEffect.getAllOew().map((function(t){var n=e.shipIconContainer.getById(t.targetShipId),i=e.shipIconContainer.getGhostShipIconByShip(n.ship),a=e.oew.find((function(e){return e.targetIcon===n}));return a||(a=new oo(e.icon,n,i,t.amount,e.ship.player.is(e.currentUser),e.scene)),a.update(e.ship,t.amount)}));return t.filter((function(e){return n.every((function(t){return t!==e}))})).forEach((function(e){return e.remove()})),n}}]),e}(),co=(new Wt.Color(1,157/255,0),new Wt.Color(109/255,189/255,1),new Wt.Color(1,1,1),function(){function e(t,n,i){Object(T.a)(this,e),this.scene=t,this.shipIconContainer=n,this.currentUser=i,this.indicators=[],this.currentIndicators=[]}return Object(E.a)(e,[{key:"getCurrentIndicators",value:function(e){var t=this.currentIndicators.find((function(t){return t.isShip(e)}));return t||(t=new uo(e,this.shipIconContainer,this.currentUser,this.scene),this.currentIndicators.push(t)),t}},{key:"getIndicators",value:function(e){var t=this.indicators.find((function(t){return t.isShip(e)}));return t||(t=new ao(e,this.shipIconContainer,this.currentUser,this.scene),this.indicators.push(t)),t}},{key:"render",value:function(e){this.indicators.forEach((function(t){return t.render(e)})),this.currentIndicators.forEach((function(t){return t.render(e)}))}},{key:"showCurrentForShip",value:function(e){this.getCurrentIndicators(e).update(e).show()}},{key:"hideCurrentForShip",value:function(e){this.getCurrentIndicators(e).update(e).hide()}},{key:"showForShip",value:function(e){this.getIndicators(e).update(e).show()}},{key:"hideForShip",value:function(e){this.getIndicators(e).update(e).hide()}},{key:"hideAll",value:function(){this.indicators.forEach((function(e){return e.hide()}))}},{key:"hideAllCurrent",value:function(){this.currentIndicators.forEach((function(e){return e.hide()}))}}]),e}()),lo=function(){function e(t){Object(T.a)(this,e),this.scene=t,this.terrain=null,this.terrainObjects=[]}return Object(E.a)(e,[{key:"init",value:function(){}},{key:"update",value:function(e){}},{key:"createObject",value:function(e){var t,n;return Zt.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Zt.a.awrap($n("/img/3d/sphere/scene.gltf"));case 2:t=i.sent,t.children[0].material.emissive=new Wt.Color(1,1,1),t.position.set(0,0,0),n=vn()*e.diameter,t.scale.set(n,n,n),this.scene.add(t);case 9:case"end":return i.stop()}}),null,this)}},{key:"render",value:function(){}}]),e}(),ho=function(){function e(t,n){Object(T.a)(this,e),this.uiState=t,this.movementService=n,this.ships=[]}return Object(E.a)(e,[{key:"open",value:function(e){this.ships=this.ships.filter((function(t){return t.player.user!==e.player.user})),this.ships.includes(e)||this.ships.push(e),this.uiState.setShipWindows({ships:this.ships,movementService:this.movementService})}},{key:"close",value:function(e){this.ships=this.ships.filter((function(t){return t!==e})),this.uiState.setShipWindows({ships:this.ships,movementService:this.movementService})}},{key:"closeAll",value:function(){this.ships=[],this.uiState.setShipWindows({ships:this.ships,movementService:this.movementService})}},{key:"update",value:function(){this.uiState.setShipWindows({ships:this.ships,movementService:this.movementService})}}]),e}(),mo=function(){function e(t,n,i,a,r){Object(T.a)(this,e),this.ship=t,this.scene=n,this.terrain=i,this.ghost=a,this.color=r?Xt:Yt,this.objects=[],this.movementService=new fa,this.create()}return Object(E.a)(e,[{key:"remove",value:function(){var e=this;this.objects.forEach((function(t){e.scene.remove(t.mesh),t.destroy()})),this.ghost.hide()}},{key:"create",value:function(){var e=this.movementService.getNewEndMove(this.ship,this.terrain),t=e.position,n=e.position.add(e.velocity),i=fo(this.scene,t,n,this.color,.5,this.ghost.shipZ);this.objects.push(i),po(this.ghost,e.facing,n,this.color)}}]),e}(),fo=function(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.8,r=arguments.length>5?arguments[5]:void 0,s=new cs(new Rn({x:t.x,y:t.y,z:r}),new Rn({x:n.x,y:n.y,z:r}),30,{color:i,opacity:a,type:"dashed-arrow",textureSize:30,pulseAmount:1,roundTestureRepeate:!0});return s.addTo(e),s},po=function(e,t,n,i){e.show(),e.setPosition(n),e.setFacing(-An(t)),e.setGhostShipEmissive(i),e.setOpacity(.2),e.mapIcon.setMovementTarget().replaceColor(i).setOverlayColorAlpha(1).show()},vo=mo,go=function(){function e(t,n,i){Object(T.a)(this,e),this.scene=t,this.shipIconContainer=n,this.terrain=null,this.currentUser=i,this.paths=[]}return Object(E.a)(e,[{key:"getPath",value:function(e){return this.paths.find((function(t){return t.ship.id===e.id}))}},{key:"update",value:function(e){this.terrain=e.terrain}},{key:"hideAllMovementPaths",value:function(){var e=this;this.paths.forEach((function(t){return t.movementPath.remove(e.scene)})),this.paths=[]}},{key:"hideMovementPath",value:function(e){var t=this.getPath(e);t&&(t.movementPath.remove(this.scene),this.paths=this.paths.filter((function(t){return t.ship!==e})))}},{key:"showMovementPath",value:function(e){var t=this.getPath(e);t||(t={ship:e,ghost:this.shipIconContainer.getGhostShipIconByShip(e),movementPath:null},this.paths.push(t)),t.movementPath&&t.movementPath.remove(this.scene),t.ship=e,t.movementPath=new vo(e,this.scene,this.terrain,t.ghost,e.player.is(this.currentUser))}}]),e}(),yo=function(){function e(t){Object(T.a)(this,e),this.services=t,this.strategies=[],this.inactive=!0,this.gameData=null,this.animationPaused=!0,this.animationReversed=!1,this.currentDeltaTime=0,this.animationStartTime=0,this.totalAnimationTime=0,this.lastAnimationTime=0,this.animationEndtime=0,this.animationTurnLength=null}return Object(E.a)(e,[{key:"onEvent",value:function(e,t){this.callStrategies(e,t)}},{key:"updateStrategies",value:function(e){this.strategies.forEach((function(t){return t.update(e)}))}},{key:"activateStrategies",value:function(){var e=this;this.strategies.forEach((function(t){return t.activate(e.services)}))}},{key:"callStrategies",value:function(e,t){this.strategies.forEach((function(n){!n[e]||t&&t.stopped||n[e](t)}))}},{key:"render",value:function(e,t,n){this.updateDeltaTime(this.animationPaused),this.updateTotalAnimationTime(this.animationPaused);var i=this.services,a=i.shipIconContainer,r=i.torpedoIconContainer,s={delta:this.currentDeltaTime,total:this.totalAnimationTime,last:this.lastAnimationTime,zoom:n};return this.callStrategies("render",s),a&&a.render(s),r&&r.render(s),s}},{key:"animateFromTo",value:function(e,t){this.animationStartTime=e,this.totalAnimationTime=e,this.animationReversed=!1,this.lastAnimationTime=null,this.currentDeltaTime=0,this.animationEndtime=t,this.animationPaused=!1}},{key:"pauseAnimation",value:function(){this.animationPaused=!0}},{key:"unpauseAnimation",value:function(){this.animationReversed=!1,this.animationPaused=!1}},{key:"unpauseAndRewindAnimation",value:function(){this.animationReversed=!0,this.animationPaused=!1}},{key:"setAnimationTime",value:function(e){this.totalAnimationTime=e,this.lastAnimationTime=null,this.currentDeltaTime=0}},{key:"updateTotalAnimationTime",value:function(){this.animationPaused||(this.animationReversed?(this.totalAnimationTime-=this.currentDeltaTime,this.totalAnimationTime<this.animationStartTime&&(this.totalAnimationTime=this.animationStartTime,this.animationPaused=!0)):(this.totalAnimationTime+=this.currentDeltaTime,this.animationEndtime&&this.totalAnimationTime>=this.animationEndtime&&(this.totalAnimationTime=this.animationEndtime,this.animationPaused=!0)))}},{key:"updateDeltaTime",value:function(){var e=Date.now();this.lastAnimationTime||(this.lastAnimationTime=e,this.currentDeltaTime=0),this.currentDeltaTime=e-this.lastAnimationTime,this.lastAnimationTime=e}},{key:"update",value:function(e){var t=this.services.uiState;return this.gameData=e,t.setGameData(e),this.updateStrategies(e),this}},{key:"activate",value:function(){return this.inactive=!1,this.activateStrategies(),this}},{key:"deactivate",value:function(){return this.inactive=!0,this.callStrategies("deactivate"),this}},{key:"triggerEvent",value:function(e,t){this.callStrategies(e,t)}},{key:"onScrollEvent",value:function(e){this.callStrategies("onScroll",e)}},{key:"onZoomEvent",value:function(e){this.callStrategies("onZoom",e)}},{key:"canDisturb",value:function(){return!0}},{key:"commitTurn",value:function(e){}}]),e}(),bo=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"update",value:function(e){return Object(Oa.a)(Object(P.a)(t.prototype),"update",this).call(this,e),this.services.uiState.setLobby(!0),this}},{key:"onEvent",value:function(e,n){switch(e){case"takeSlot":return this.services.gameConnector.takeSlot(n.id);case"leaveSlot":return this.services.gameConnector.leaveSlot(n.id);case"buyShips":return this.services.gameConnector.buyShips(n.slot.id,n.ships);default:return Object(Oa.a)(Object(P.a)(t.prototype),"onEvent",this).call(this,e,n)}}},{key:"deactivate",value:function(){return Object(Oa.a)(Object(P.a)(t.prototype),"deactivate",this).call(this),this.services.uiState.setLobby(!1),this}}]),t}(yo),Oo=function(){function e(){Object(T.a)(this,e),this.services=null,this.gameData=null}return Object(E.a)(e,[{key:"deactivate",value:function(){}},{key:"activate",value:function(e){this.services=e}},{key:"update",value:function(e){this.gameData=e}},{key:"stopEvent",value:function(e){e.stopped=!0}}]),e}(),wo=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){this.services.movementPathService.hideAllMovementPaths()}},{key:"mouseOverShip",value:function(e){var t=this.services.movementPathService;t.hideAllMovementPaths(),t.showMovementPath(e.entity.ship)}},{key:"mouseOutShip",value:function(){this.services.movementPathService.hideAllMovementPaths()}}]),t}(Oo),ko=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).active=!1,e.activeTime=0,e.icon=null,e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"hide",value:function(){var e=this.services.shipIconContainer;if(this.icon){this.icon.revertEmissive(),this.icon.mapIcon.revertColor(),this.icon.hexSprites.forEach((function(e){return e.revertColor()}));var t=e.getGhostShipIconByShip(this.icon.ship);t.revertOpacity(),t.mapIcon.setMovementTarget(),t.mapIcon.revertColor()}this.icon=null}},{key:"deactivate",value:function(){this.hide()}},{key:"shipSelected",value:function(e){var t=this.services.shipIconContainer;this.active=!0,this.activeTime=0,this.icon=t.getByShip(e)}},{key:"shipDeselected",value:function(e){this.services.shipIconContainer;this.active=!0,this.activeTime=0,this.hide()}},{key:"render",value:function(e){var t=e.delta,n=this.services.shipIconContainer;if(this.active){var i=.5*Math.sin(this.activeTime/200)+.5;i=.2+.6*i;var a=n.getGhostShipIconByShip(this.icon.ship),r=Qt.clone().multiplyScalar(i);a.setGhostShipEmissive(r),a.replaceOpacity(i),a.mapIcon.setMovementTarget().replaceColor(r).setOverlayColorAlpha(1),this.icon.hexSprites.forEach((function(e){return e.replaceColor(r.clone())})),this.icon.mapIcon.replaceColor(r),this.activeTime+=t}}}]),t}(Oo),jo=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){this.services.uiState.hideShipMovement()}},{key:"update",value:function(e){Object(Oa.a)(Object(P.a)(t.prototype),"update",this).call(this,e),this.shipStateChanged()}},{key:"shipStateChanged",value:function(){var e=this.services.uiState,t=e.getSelectedShip();t&&e.showShipMovement(t,!0)}},{key:"shipSelected",value:function(e){this.services.uiState.showShipMovement(e,!0)}},{key:"shipDeselected",value:function(){this.services.uiState.hideShipMovement()}}]),t}(Oo),So=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).areas=[],e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){var e=this.services.scene;this.areas.forEach((function(t){t.sprites.forEach((function(t){e.remove(t.mesh),t.destroy()}))}))}},{key:"update",value:function(e){Object(Oa.a)(Object(P.a)(t.prototype),"update",this).call(this,e);var n=this.services,i=n.scene,a=n.coordinateConverter,r=n.currentUser;this.areas=e.slots.getSlots().map((function(t){var n=t.deploymentLocation.spiral(t.deploymentRadius),s=new Wt.Color(1,1,1);return t.isUsers(r)?s=new Wt.Color(39/255,196/255,39/255):e.slots.isUsersTeamSlot(t,r)||(s=new Wt.Color(196/255,39/255,39/255)),{slot:t,sprites:n.map((function(e){var t=new As(a.fromHexToGame(e));return t.setOpacity(.5),t.setOverlayColor(s),t.setOverlayColorAlpha(.5),i.add(t.mesh),t}))}}))}},{key:"selectShip",value:function(e){}}]),t}(Oo),xo=n(14),Co=function(e,t,n,i,a){if(n[i-1]){var r=n[i-1];return!r.isPivot()||r.value!==a.value}if(e[t-1]){var s=e[t-1].between,o=s[s.length-1];return!o.isPivot()||o.value!==a.value}return!0},To=function(e,t,n,i,a){if(n[i+1]){var r=n[i+1];return!r.isPivot()||r.value!==a.value}if(e[t+1]){var s=e[t+1].between[0];return!s.isPivot()||s.value!==a.value}return!0},Eo=function(e){return e.map((function(t,n){var i=t.start,a=t.end,r=t.between;return{startFacing:An(i.facing),endFacing:An(a.facing),steps:r.map((function(t,i){return function(e,t,n,i,a){return a.isPivot()?{pivot:1===a.value?60:-60,easeIn:Co(e,t,n,i,a),easeOut:To(e,t,n,i,a)}:null}(e,n,r,i,t)}))}}))},Ao=function(e){var t=[],n=[],i=null;return e.forEach((function(e){e.isDeploy()?i=e:e.isEnd()&&!i?i=e:e.isEnd()?(t.push({start:i,between:Object(ta.a)(n),end:e}),i=e,n=[]):i&&e.isPivot()?n.push(e):i&&e.isSpeed()&&n.push(e)})),Eo(t).map((function(e){var t=e.startFacing,n=e.endFacing,i=e.steps;return{startFacing:t,endFacing:n,steps:i.map((function(e){if(null===e)return{facing:t};var n=Object(pi.a)({},e,{startFacing:t});return t=jn(t,e.pivot),n}))}}))},Po=function(){function e(t){Object(T.a)(this,e),this.moves=t,this.path=Ao(t)}return Object(E.a)(e,[{key:"getFacing",value:function(e,t){var n=this.path[e]||this.path[this.path.length-1],i=n.steps.length;if(0===i)return n.endFacing;var a=this.path[e]?Math.floor(i*t):i-1,r=this.path[e]?i*t%1:1,s=n.steps[a];return void 0!==s.facing?s.facing:jn(s.startFacing,s.pivot*r)}}]),e}(),Io=function(e){function t(e,n,i,a){var r;return Object(T.a)(this,t),(r=Object(A.a)(this,Object(P.a)(t).call(this))).shipIcon=e,r.moves=n,r.doneCallback=null,r.start=i,r.end=a,r.duration=a-i,r.positionCurves=r.movesToCurves(n),r.pivotSteps=new Po(n),r.startRoll=n[0].rolled?180:0,r.endRoll=n[0].rolled===n[n.length-1].rolled?r.startRoll:r.startRoll+180,r.easeInOut=new Wt.CubicBezierCurve(new Wt.Vector2(0,0),new Wt.Vector2(.75,0),new Wt.Vector2(.25,1),new Wt.Vector2(1,1)),Fn.call(Object(xo.a)(r)),r}return Object(I.a)(t,e),Object(E.a)(t,[{key:"doesMove",value:function(){return!new Rn(this.positionCurves[0].getPoint(0)).equals(new Rn(this.positionCurves[0].getPoint(1)))}},{key:"deactivate",value:function(){}},{key:"update",value:function(e){}},{key:"cleanUp",value:function(){}},{key:"getEndPosition",value:function(){return this.getPositionAndFacing(1,1)}},{key:"getPositionAt",value:function(e){var t=this.getMovementTurnDone({total:e}),n=Math.floor(t),i=t<1?t%1:1;return this.getPositionAndFacing(n,i)}},{key:"getMovementTurnDone",value:function(e){var t=e.total;return t<this.start?0:t>this.end?1:(t-this.start)/this.duration}},{key:"getCurrentRoll",value:function(e){var t,n,i,a=(t=this.startRoll,n=this.endRoll,-(i?t>n?360-t+n:n-t:t<n?-1*(t+(360-n)):n-t));return 0===a?this.endRoll:jn(this.startRoll,a*this.easeInOut.getPoint(e).y)}},{key:"render",value:function(e){var t=this.getMovementTurnDone(e);if(1!==t){var n=Math.floor(t),i=t<1?t%1:1,a=this.getPositionAndFacing(n,i),r=a.position,s=a.facing,o=this.getCurrentRoll(t);this.shipIcon.setPosition(r),this.shipIcon.setFacing(-s),this.shipIcon.setRoll(o)}}},{key:"getPositionAndFacing",value:function(e,t){return{position:this.positionCurves[e]?this.positionCurves[e].getPoint(t):this.positionCurves[this.positionCurves.length-1].getPoint(1),facing:this.pivotSteps.getFacing(e,t)}}},{key:"movesToCurves",value:function(e){var t=this,n=[],i=null;return e.forEach((function(e){e.isDeploy()?i=e:e.isEnd()&&!i?i=e:e.isEnd()&&(n.push({start:i,end:e}),i=e)})),n.map((function(e){var n=e.start,i=e.end;return t.buildPositionCurve(n,i)}))}},{key:"buildPositionCurve",value:function(e,t){var n=e.position.add(e.velocity),i=n.roundToHexCenter(),a=n.roundToHexCenter(),r=t.position.roundToHexCenter(),s=t.position.roundToHexCenter();return new Wt.CubicBezierCurve3(new Wt.Vector3(i.x,i.y,i.z),new Wt.Vector3(a.x,a.y,a.z),new Wt.Vector3(r.x,r.y,r.z),new Wt.Vector3(s.x,s.y,s.z))}}]),t}(Fn),Do=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this))).gameTerrain=n,i.shipIcon=e,i.ship=e.ship,i.duration=0,i.movementService=new fa,i.position=i.getPosition(),i.facing=i.getFacing(),i.roll=i.getRoll(),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"update",value:function(){this.position=this.getPosition(),this.facing=this.getFacing(),this.roll=this.getRoll()}},{key:"deactivate",value:function(){}},{key:"render",value:function(e,t,n,i,a,r,s){this.shipIcon.setPosition(this.position),this.shipIcon.setFacing(-this.facing),this.shipIcon.setRoll(this.roll)}},{key:"getRoll",value:function(){var e=this.shipIcon.ship.movement.isRolled()?180:0;return this.shipIcon.ship.movement.isRolling()?e+90:e}},{key:"getPosition",value:function(){return this.movementService.getNewEndMove(this.ship,this.gameTerrain).position}},{key:"getFacing",value:function(){return An(this.ship.movement.getLastMove().facing)}}]),t}(Fn),Mo=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this))).icon=e,i.ship=n||e.ship,i.updateAll(),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"updateAll",value:function(){var e=this;this.ship.systems.getSystems().forEach((function(t){return e.updateSystem(t)}))}},{key:"updateSystem",value:function(e){return e.power.isGoingOffline()?(this.icon.disableSystemAnimation(e,"online"),this.icon.playSystemAnimation(e,"offline")):e.power.isGoingOnline()?(this.icon.disableSystemAnimation(e,"offline"),this.icon.playSystemAnimation(e,"online")):e.isDisabled()?(this.icon.disableSystemAnimation(e,"online"),this.icon.setSystemAnimation(e,"offline",100)):e.power.isOffline()?(this.icon.disableSystemAnimation(e,"online"),this.icon.setSystemAnimation(e,"offline",100)):e.power.isOnline()&&(this.icon.disableSystemAnimation(e,"offline"),this.icon.setSystemAnimation(e,"online",100)),this}}]),t}(Fn),zo=function(){function e(){Object(T.a)(this,e)}return Object(E.a)(e,[{key:"create",value:function(e,t,n,i,a,r,s,o,u,c){this.particleEmitterContainer=u;var l=new Rn(n).sub(t).normalize().multiplyScalar(i);this.duration=this.createBolt(e,t,n,r,l,i,a,s,u,o,c)}},{key:"createBolt",value:function(e,t,n,i,a,r,s,o,u,c,l){var h=n.sub(t).normalize(),d=o.color?new Wt.Color(o.color[0],o.color[1],o.color[2]):new Wt.Color(1,0,0),m=o.length?o.length:2*o.size;u.getBoltParticle(l).setScale(m,o.size).setOpacity(.5).setPosition(t).setBoltTexture().setRotation(h).setColor(d).setVelocity(a).setActivationTime(e).setDeactivationTime(e+i,s);var f=.5*(o.length?o.length:2*o.size),p=.2*f/r,v=o.coreOpacity||.5;return u.getBoltParticle(l).setScale(f,.5*o.size).setOpacity(v).setPosition(t).setBoltTexture().setRotation(h).setColor(new Wt.Color(1,1,1)).setVelocity(a).setActivationTime(e+p).setDeactivationTime(e+i+p,s),i+p}}]),e}(),Ro=new zo,Fo=function(e){function t(e,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this,n))).getRandomColor=function(){return this.color?this.color:(new Wt.Color).setRGB(1,(155-Math.floor(75*Math.random()))/255,Math.floor(155*Math.random())/255)},i.getSmokeColor=function(){var e=(50*Math.random()+20)/255;return(new Wt.Color).setRGB(e,e,e+.05)},i.emitterContainer=e,i.position=a.position||{x:0,y:0},i.time=a.time||0,i.type=a.type||"gas",i.size=a.size||16,i.speed=a.speed||1,i.ring=a.ring||!1,i.duration=a.duration,i.color=a.color,i.opacity=a.opacity||1,i.movement=a.velocity||{x:0,y:0,z:0},i.context=r,i.create(),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"create",value:function(){switch(this.type){case"gas":this.createGas();break;case"glow":this.createGlow();break;case"emp":this.createEMP();break;case"pillar":this.createPillar();break;default:this.createGas()}}},{key:"createGlow",value:function(){this.createMainGlow(3,this.size),this.createCore(this.size,2),this.createWhiteCenter(2*this.size,.8)}},{key:"createGas",value:function(){var e=Math.ceil(this.size/4);e>6&&(e=6);var t=Math.ceil(20*Math.random()+10);this.createShootOffs(t,this.size),this.createMainGlow(1,this.size),this.createCore(this.size,2),this.createMain(e,this.size),this.createWhiteCenter(2*this.size,.5)}},{key:"createPillar",value:function(){var e=Math.ceil(this.size/4);e>6&&(e=6);var t=Math.ceil(20*Math.random()+10);this.createPillars(t,this.size),this.createMainGlow(Math.ceil(e/2),this.size)}},{key:"createEMP",value:function(){var e=Math.ceil(this.size/4);e>6&&(e=6),this.createEmpGlow(Math.ceil(e/2),this.size),this.createWhiteCenter(4*this.size,.5),this.createEmpCore(this.size,0)}},{key:"createWhiteCenter",value:function(e,t){t||(t=1);var n=this.time,i=n+100;this.emitterContainer.getParticle(this.context).setSize(e/4).setOpacity(t*this.opacity).setFadeIn(n,100).setFadeOut(i,500).setColor({r:1,g:1,b:1}).setPosition({x:this.position.x,y:this.position.y,z:this.position.z}).setTexture(2).setActivationTime(n)}},{key:"createShootOffs",value:function(e,t,n){for(;e--;)this.createShootOff(t,n)}},{key:"createShootOff",value:function(e,t){t||(t={}),console.log("hi",this.size);var n=(.2*Math.random()+.1)*this.speed*this.size*.01,i=t.position||this.position,a=t.target||new Rn(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize().multiplyScalar((10*Math.random()+3)*this.size).add(i),r=this.getRandomColor();Ro.create(this.time+Math.floor(30*Math.random()/this.speed),new Rn(i),new Rn(a),1.5*n,t.fadeOutSpeed||500*Math.random()+250,Math.floor(500*Math.random()+250)/this.speed,{size:e/3,color:[r.r,r.g,r.b],coreOpacity:.1},this.getRandom,this.emitterContainer,this.context)}},{key:"createPillars",value:function(e,t){for(var n=t;e--;){var i=this.emitterContainer.getParticle(this.context),a=this.time+Math.floor(30*Math.random()/this.speed),r=a+Math.floor(50*Math.random()/this.speed),s=Math.floor(360*Math.random()),o=xn(.1,-s,0,0);i.setSize(Math.floor(Math.random()*n)+n/2).setOpacity(.1*Math.random()+.9).setFadeIn(a,50*Math.random()+25).setFadeOut(r,500*Math.random()/this.speed+250/this.speed).setColor(Lo()).setPosition({x:this.position.x,y:this.position.y,z:this.position.z}).setVelocity(o).setAngle(s).setTexture(1).setActivationTime(a),this.createShootOff(t,{angle:s,activationTime:a})}}},{key:"createCore",value:function(e,t){var n=e,i=this.emitterContainer.getParticle(this.context),a=this.time+.005*Math.random()/this.speed,r=a+.02*Math.random()/this.speed+.03/this.speed;i.setSize(Math.floor(Math.random()*n/2)+n).setOpacity(.2*Math.random()+.6).setFadeIn(a,.005*Math.random()+.0025).setFadeOut(r,.05*Math.random()/this.speed+.025/this.speed).setOpacity(.5*this.opacity).setColor(Ho()).setPosition({x:this.position.x,y:this.position.y,z:this.position.z}).setAngle(45).setTexture(t).setVelocity(this.movement).setAngle(Math.floor(360*Math.random())).setAngleChange(Math.floor(20*Math.random()*this.speed)-10*this.speed).setActivationTime(a)}},{key:"createEmpGlow",value:function(e,t){for(var n=2*t;e--;){var i=this.emitterContainer.getParticle(this.context),a=this.time,r=a;i.setSize(n).setSizeChange(.004*this.size).setOpacity(.1*Math.random()+.2).setFadeIn(a,.005*Math.random()+.0025).setFadeOut(r,(200*Math.random()+800)/this.speed).setColor({r:122/255,g:221/255,b:1}).setVelocity(this.movement).setPosition({x:this.position.x,y:this.position.y,z:this.position.z}).setTexture(2).setActivationTime(a)}}},{key:"createEmpCore",value:function(e,t){var n=e,i=this.emitterContainer.getParticle(this.context),a=this.time,r=a;i.setSize(.9*n).setSizeChange(.0039*this.size).setOpacity(.2*Math.random()+.6).setFadeIn(a,.1).setFadeOut(r,(200*Math.random()+800)/this.speed).setColor(Ho()).setPosition({x:this.position.x,y:this.position.y,z:this.position.z}).setAngle(45).setTexture(t).setVelocity(this.movement).setAngle(Math.floor(360*Math.random())).setAngleChange(5*this.speed).setActivationTime(a)}},{key:"createMain",value:function(e,t){for(var n=t;e--;){var i=this.emitterContainer.getParticle(this.context),a=this.time+Math.floor(300*Math.random()/this.speed),r=a+Math.floor(500*Math.random()/this.speed);i.setSize(Math.floor(Math.random()*n)+n/2).setSizeChange(.003*this.size).setOpacity(.1*Math.random()+.05).setFadeIn(a,50*Math.random()+25).setFadeOut(r,500*Math.random()/this.speed+500/this.speed).setColor(this.getRandomColor()).setPosition({x:this.position.x+(Math.floor(Math.random()*t)-t)/8,y:this.position.y+(Math.floor(Math.random()*t)-t)/8,z:this.position.z+(Math.floor(Math.random()*t)-t)/8}).setVelocity(this.movement).setAngle(Math.floor(360*Math.random())).setActivationTime(a).setTexture(0)}}},{key:"createMainGlow",value:function(e,t){for(var n=2*t;e--;){var i=this.emitterContainer.getParticle(this.context),a=this.time+Math.floor(.03*Math.random()/this.speed),r=this.duration?a+this.duration:a+Math.floor(.05*Math.random()/this.speed);i.setSize(Math.floor(Math.random()*n/2)+n).setOpacity(.1*Math.random()+.4).setFadeIn(a,.005*Math.random()+.0025).setFadeOut(r,(200*Math.random()+800)/this.speed).setColor(this.getRandomColor()).setVelocity(this.movement).setOpacity(this.opacity).setPosition({x:this.position.x,y:this.position.y,z:this.position.z}).setTexture(2).setActivationTime(a)}}},{key:"deactivate",value:function(){this.emitterContainer.release(this)}}]),t}(Fn),Ho=function(){return(new Wt.Color).setRGB(255,255,255)},Lo=function(){return(new Wt.Color).setRGB(1,(Math.floor(20*Math.random())+235)/255,(Math.floor(10*Math.random())+130)/255)},Bo=Fo,_o=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e.getRandom))).particleEmitterContainer=e.particleEmitterContainer,n.props=e,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getLocationForSystem",value:function(e,t,n){var i=t.systemLocations[e.id];if(!i)return new Rn;var a=new Wt.Object3D;a.rotation.z=Tn(-n);var r=i.clone();return r.applyQuaternion(a.quaternion),r.z+=t.shipZ,r}}]),t}(Fn),Uo={ShipWeaponBoltAnimation:function(e){function t(e,n,i,a,r,s,o,u,c,l,h){var d;Object(T.a)(this,t),d=Object(A.a)(this,Object(P.a)(t).call(this,u));var m=Boolean(n.shotsHit);d.particleEmitterContainer=c,d.extraWait=2e3*u();var f=e+d.extraWait,p=l.speed||1,v=o(r,f).position.add(d.getLocationForSystem(a,r,o(r,f).facing));v.z+=r.shipZ;var g=o(s,f).position.add(d.getRandomPosition(20));g.z+=s.shipZ;var y=v.distanceTo(g);d.duration=y/p;var b=0;if(!m){var O=300*u()+300;d.duration+=O,b=.8*O}return d.animations=[],d.animations.push(h.getBoltEffect(f,v,g.clone(),p,b,d.duration,l,Object(xo.a)(d))),d.explosion=null,n.causedDamage()?(m&&(h.getDamageExplosion(l.explosionSize,g,f+d.duration,Object(xo.a)(d)),d.duration+=1e3),d):Object(A.a)(d)}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDuration",value:function(){return this.duration+this.extraWait}},{key:"deactivate",value:function(){this.particleEmitterContainer.release(this)}}]),t}(_o),ShipWeaponBoltBurstAnimation:function(e){function t(e,n,i,a,r,s,o,u,c,l,h){var d;Object(T.a)(this,t),(d=Object(A.a)(this,Object(P.a)(t).call(this,u))).animations=[],d.particleEmitterContainer=c;var m=d.getRandom()>.5,f=l.speed||1;d.extraWait=2e3*u();var p=e+d.extraWait,v=o(r,p).position.add(d.getLocationForSystem(a,r,o(r,p).facing));v.z+=r.shipZ;var g=o(s,p).position.add(d.getRandomPosition(20));g.z+=s.shipZ;var y=v.distanceTo(g);d.duration=y/f;var b=d.getRandomPosition(5),O=300*u()+300,w=.8*O,k=n.totalShots,j=n.shotsHit;d.startExtra=0;for(var S=1;S<=k;S++)d.startExtra=30/f*S,m&&S<=k-j||!m&&S>j?d.animations.push(h.getBoltEffect(d.startExtra+p,v,g.clone(),f,w,d.duration+O,l,Object(xo.a)(d))):(d.animations.push(h.getBoltEffect(d.startExtra+p,v,g.clone(),f,0,d.duration,l,Object(xo.a)(d))),h.getDamageExplosion(l.explosionSize,g,d.startExtra+p+d.duration,Object(xo.a)(d))),g=g.add(b);return d}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDuration",value:function(){return this.duration+this.extraWait+this.startExtra+1e3}},{key:"deactivate",value:function(){this.particleEmitterContainer.release(this)}}]),t}(_o),ShipWeaponUniversalBoltAnimation:function(e){function t(e){var n;Object(T.a)(this,t),n=Object(A.a)(this,Object(P.a)(t).call(this,e));var i=e.args,a=e.weaponAnimationService,r=e.omitHitExplosion;n.animations=[],n.speed=i.speed||1,n.duration=0,n.setShots(),n.setStartPosition(),n.setEndPosition(),n.setStartTime();var s=300*n.getRandom()+300,o=.8*s;return n.shots.forEach((function(t){var i=n.startPosition.distanceTo(n.endPosition.add(t.offset))/n.speed;n.animations.push(a.getBoltEffect(n.startTime+t.startExtra,n.startPosition.clone(),n.endPosition.clone(),n.speed,t.hit?0:o,t.hit?i:i+s,e.args,Object(xo.a)(n))),t.hit&&!r&&n.animations.push(a.getDamageExplosion(e.args.explosionSize,e.args.explosionType,n.endPosition.add(t.offset),n.startTime+t.startExtra+i,Object(xo.a)(n)))})),n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"setShots",value:function(){var e=this.props,t=e.totalShots,n=e.shotsHit,i=0;this.shots=[];for(var a=Math.floor(this.getRandom()*(t-n)),r=this.getRandomPosition(5),s=0;s<t;s++){var o=s>=a&&s<a+n;i=30/this.speed*s;var u=s-a,c=new Rn;u<0?c=c.sub(r.multiplyScalar(Math.abs(u))):u>0&&(c=c.add(r.multiplyScalar(Math.abs(u)))),this.shots.push({startExtra:i,hit:o,offset:c})}}},{key:"getFirstHit",value:function(){return this.shots.find((function(e){return e.hit}))}},{key:"setEndPosition",value:function(){var e=this.props,t=e.targetIcon,n=e.animationStartTime,i=e.impactPosition,a=e.getPosition,r=e.shotsHit;i?this.endPosition=0===r?i.add(this.getRandomPosition(20)):i:(this.endPosition=a(t,n).position.add(this.getRandomPosition(20)),this.endPosition.z+=t.shipZ)}},{key:"setStartTime",value:function(){var e=this.props,t=e.animationStartTime,n=e.impactTime;if(n){this.startWait=0;var i=this.getFirstHit(),a=i?i.startExtra:0,r=this.startPosition.distanceTo(this.endPosition);this.duration=r/this.speed,this.startTime=n-(a+this.duration)}else{this.startWait=2e3*this.getRandom(),this.startTime=t+this.startWait;var s=this.startPosition.distanceTo(this.endPosition);this.duration=s/this.speed}}},{key:"setStartPosition",value:function(){var e=this.props,t=e.shooterIcon,n=e.weapon,i=e.animationStartTime,a=e.getPosition;this.startPosition=a(t,i).position.add(this.getLocationForSystem(n,t,a(t,i).facing))}},{key:"getDuration",value:function(){return this.duration+this.startWait+1e3}},{key:"deactivate",value:function(){this.particleEmitterContainer.release(this)}}]),t}(_o)},No=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).animations=[],e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){this.removeAllAnimations(),Object(Oa.a)(Object(P.a)(t.prototype),"deactivate",this).call(this)}},{key:"render",value:function(e){this.animations.forEach((function(t){return t.render(e)}))}},{key:"removeAllAnimations",value:function(){this.animations.forEach((function(e){return e.deactivate()})),this.animations=[]}},{key:"removeAnimation",value:function(e){this.animations=this.animations.filter((function(e){return e!==e})),e.deactivate()}}]),t}(Oo),Vo=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"update",value:function(e){var n=this;Object(Oa.a)(Object(P.a)(t.prototype),"update",this).call(this,e),this.services.shipIconContainer.getArray().forEach((function(t){return t.ship.isDestroyed()?t.hide():(t.show(),n.animations.push(new Do(t,e.terrain)),n.animations.push(new Mo(t))),n}))}},{key:"shipStateChanged",value:function(e){this.animations.filter((function(t){return t.ship===e})).forEach((function(e){e.update()}))}},{key:"shipSystemStateChanged",value:function(e){var t=e.ship,n=e.system;this.animations.filter((function(e){return e.ship===t})).forEach((function(e){e.updateSystem&&e.updateSystem(n)}))}},{key:"deactivate",value:function(){return this.services.shipIconContainer.getArray().forEach((function(e){e.hide()}),this),Object(Oa.a)(Object(P.a)(t.prototype),"deactivate",this).call(this)}}]),t}(No),Go=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"shipRightClicked",value:function(e){this.services.uiState}}]),t}(Oo),Wo=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).clickedShip=null,e.mouseOveredShip=null,e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"shipStateChanged",value:function(e){var t=this.services,n=t.uiState,i=t.shipIconContainer;this.clickedShip===e&&n.showShipTooltip(i.getByShip(e),!0)}},{key:"deactivate",value:function(){var e=this.services.uiState;this.clickedShip&&e.hideShipTooltip(this.clickedShip)}},{key:"shipClicked",value:function(e){var t=this.services.uiState;this.clickedShip&&t.hideShipTooltip(this.clickedShip),t.showShipTooltip(e.entity,!0),this.clickedShip=e.entity.ship}},{key:"hexClicked",value:function(){if(this.clickedShip){var e=this.services.uiState;e.state.systemMenu.activeSystem||(e.hideShipTooltip(this.clickedShip),this.clickedShip=null)}}},{key:"mouseOverShip",value:function(e){if(this.clickedShip!==e.entity.ship){var t=this.services.uiState;this.mouseOveredShip&&t.hideShipTooltip(this.mouseOveredShip),this.clickedShip&&t.hideShipTooltip(this.clickedShip),t.showShipTooltip(e.entity),this.mouseOveredShip=e.entity.ship}}},{key:"mouseOutShip",value:function(e){var t=this.services.shipIconContainer;if(this.clickedShip!==e.entity.ship){var n=this.services.uiState;n.hideShipTooltip(e.entity.ship),this.mouseOveredShip=null,this.clickedShip&&n.showShipTooltip(t.getByShip(this.clickedShip),!0)}}}]),t}(Oo),qo=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(e){this.hide()}},{key:"show",value:function(e){var t=this.services.currentUser;e.entity.ship.player.isUsers(t)?e.entity.replaceEmissive(Xt):e.entity.replaceEmissive(Yt)}},{key:"hide",value:function(){this.services.shipIconContainer.getArray().forEach((function(e){e.revertEmissive()}))}},{key:"mouseOverShip",value:function(e){this.show(e)}},{key:"mouseOutShip",value:function(e){this.hide()}},{key:"mouseOut",value:function(){this.hide()}}]),t}(Oo),Zo=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"update",value:function(e){var t=this.services,n=t.uiState,i=t.currentUser;if(!n.getSelectedShip()){var a=e.getShipsForUser(i),r=a.find((function(e){return e.movement.getDeployMove()}));r||(r=a[0]),r&&n.selectShip(r)}}}]),t}(Oo),Ko=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"hexClicked",value:function(e){var t=e.hex,n=this.services,i=n.uiState,a=n.movementService,r=i.getSelectedShip();r&&this.gameData&&(this.gameData.slots.getSlotByShip(r).isValidShipDeployment(r,t)&&(this.gameData.ships.getShips().find((function(e){return e!==r&&e.getHexPosition().equals(t)}))||(a.deploy(r,t),i.shipStateChanged(r))))}}]),t}(Oo),Xo=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){this.services.uiState.setTurnReady(!1)}},{key:"update",value:function(e){Object(Oa.a)(Object(P.a)(t.prototype),"update",this).call(this,e),this.checkDeployment()}},{key:"shipStateChanged",value:function(){this.checkDeployment()}},{key:"checkDeployment",value:function(){var e=this,t=this.services,n=t.currentUser,i=t.uiState,a=this.gameData.ships.getShips().every((function(t){return!t.player.isUsers(n)||!!e.gameData.slots.getSlotByShip(t).isValidShipDeployment(t,t.getHexPosition())}));i.setTurnReady(a)}}]),t}(Oo),Yo=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){this.services.uiState.hideShipMovement()}},{key:"shipStateChanged",value:function(){var e=this.services.uiState,t=e.getSelectedShip();t&&e.showShipDeploymentMovement(t,!0)}},{key:"shipSelected",value:function(e){this.services.uiState.showShipDeploymentMovement(e,!0)}},{key:"shipDeselected",value:function(){this.services.uiState.hideShipMovement()}}]),t}(Oo),Qo=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"activate",value:function(e){Object(Oa.a)(Object(P.a)(t.prototype),"activate",this).call(this,e),this.services.uiState.setWaiting(!0)}},{key:"deactivate",value:function(){this.services.uiState.setWaiting(!1)}}]),t}(Oo),Jo=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"update",value:function(e){var t=this.services,n=t.uiState,i=t.currentUser;if(n.getSelectedShip()&&e.activeShips.isActive(n.getSelectedShip())){var a=n.getSelectedShip(),r=e.ships.getShipById(a.id);a!==r&&n.selectShip(r)}else{var s=e.getActiveShipsForUser(i).pop();s&&n.selectShip(s)}}}]),t}(Oo),$o=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){this.services.movementPathService.hideAllMovementPaths()}},{key:"update",value:function(e){Object(Oa.a)(Object(P.a)(t.prototype),"update",this).call(this,e),this.show()}},{key:"uiStateChanged",value:function(){this.gameData&&this.show()}},{key:"shipStateChanged",value:function(e){var t=this.services,n=t.movementPathService,i=t.uiState;this.gameData&&i.hasGameUiMode("movement")&&i.getSelectedShip()===e&&n.showMovementPath(e)}},{key:"mouseOutShip",value:function(){this.show()}},{key:"show",value:function(){var e=this.services,t=e.movementPathService;e.uiState.hasGameUiMode("movement")?this.gameData.ships.getAliveShips().forEach((function(e){return t.showMovementPath(e)})):t.hideAllMovementPaths()}}]),t}(Oo),eu=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){this.services.uiState.setTurnReady(!1)}},{key:"update",value:function(e){Object(Oa.a)(Object(P.a)(t.prototype),"update",this).call(this,e),this.services.uiState.setTurnReady(!0)}}]),t}(Oo),tu=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this))).phaseStrategy=e,i.replayContext=n,i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"newTurn",value:function(e){var t,n=this;return Zt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.services.shipIconContainer,e.next=3,Zt.a.awrap(t.shipsLoaded());case 3:setTimeout((function(){n.phaseStrategy.animateFromTo(0)}),500);case 4:case"end":return e.stop()}}),null,this)}},{key:"render",value:function(e){e.delta;e.total>=this.replayContext.getTurnLength()+2e3&&this.services.uiState.closeReplay()}}]),t}(Oo),nu=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).replayContext=e,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"activate",value:function(e){Object(Oa.a)(Object(P.a)(t.prototype),"activate",this).call(this,e),this.services.uiState.showReplayUi(this.replayContext)}},{key:"deactivate",value:function(){this.services.uiState.showReplayUi(!1)}}]),t}(Oo);function iu(){var e=Object(R.a)(["\n  ","\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 25px;\n  height: 25px;\n"]);return iu=function(){return e},e}function au(){var e=Object(R.a)(["\n  ","\n  padding: 0 5px 0 30px;\n  width: 200px;\n  overflow: hidden;\n"]);return au=function(){return e},e}function ru(){var e=Object(R.a)(["\n  color: white;\n  font-size: 18px;\n  font-weight: bold;\n  font-family: arial;\n  font-size: 16px;\n  text-transform: uppercase;\n"]);return ru=function(){return e},e}function su(){var e=Object(R.a)(["\n  display: flex;\n  align-items: center;\n"]);return su=function(){return e},e}var ou=F.b.div(su()),uu=Object(F.a)(ru()),cu=F.b.div(au(),uu),lu=F.b.div(iu(),uu),hu=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.ship,i=e.target,a=e.uiState,r=e.oew;return j.createElement(ou,null,t&&j.createElement(cu,null,t),j.createElement(Et,{img:"/img/removeOEW.png",onClick:function(){n.electronicWarfare.canAssignOffensiveEw(i,-1)&&(n.electronicWarfare.assignOffensiveEw(i,-1),a.shipStateChanged(n))}}),j.createElement(lu,null,r),j.createElement(Et,{img:"/img/addOEW.png",onClick:function(){n.electronicWarfare.canAssignOffensiveEw(i,1)&&(n.electronicWarfare.assignOffensiveEw(i,1),a.shipStateChanged(n))}}))}}]),t}(j.PureComponent);function du(){var e=Object(R.a)(["\n  position: absolute;\n  top: 0px;\n  left: 0px;\n"]);return du=function(){return e},e}var mu=F.b.div(du()),fu=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).containerRef=j.createRef(),n.renderCallback=n.onGameRender.bind(Object(xo.a)(n)),n.position=null,n.state={position:null},n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"onGameRender",value:function(){var e=this.props,t=e.getPosition,n=e.marginTop,i=void 0===n?0:n,a=e.marginLeft,r=void 0===a?0:a;if(this.containerRef.current){var s=t();this.position&&this.position.x===s.x&&this.position.y===s.y||(this.position=s,this.containerRef.current.style.left="".concat(s.x+r,"px"),this.containerRef.current.style.top="".concat(s.y+i,"px"))}}},{key:"componentDidMount",value:function(){this.props.uiState.subscribeToRender(this.renderCallback)}},{key:"componentWillUnmount",value:function(){this.props.uiState.unsubscribeFromRender(this.renderCallback)}},{key:"render",value:function(){var e=this.props.children;return j.createElement(mu,{ref:this.containerRef},e)}}]),t}(j.Component);function pu(){var e=Object(R.a)(["\n  color: ",";\n"]);return pu=function(){return e},e}function vu(){var e=Object(R.a)(["\n  color: white;\n"]);return vu=function(){return e},e}function gu(){var e=Object(R.a)(["\n  text-align: left;\n  color: #5e85bc;\n  font-family: arial;\n  font-size: 11px;\n"]);return gu=function(){return e},e}function yu(){var e=Object(R.a)(["\n  position: absolute;\n  z-index: 20000;\n  ","\n  width: ",";\n  text-align: left;\n  filter: brightness(1);\n"]);return yu=function(){return e},e}function bu(){var e=Object(R.a)(["\n  font-size: 12px;\n"]);return bu=function(){return e},e}var Ou=Object(F.b)(yt)(bu()),wu=(Object(F.b)(ft)(yu(),(function(e){return Object.keys(e.position).reduce((function(t,n){return t+"\n"+n+":"+e.position[n]+"px;"}),"")}),(function(e){return e.ship?"300px":"200px"})),Object(F.b)(wt)(gu())),ku=F.b.span(vu()),ju=F.b.span(pu(),i.lightBlue),Su=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=(e.ship,e.system,e.uiState,e.target),n=e.hitChange;return j.createElement(j.Fragment,null,j.createElement(Ou,null,"TARGET: ",t.name),j.createElement(wu,null,j.createElement(ku,null,"Base hit change: "),j.createElement(ju,null,n.baseToHit,"%")),j.createElement(wu,null,j.createElement(ku,null,"Fire control: "),j.createElement(ju,null,"+",n.fireControl," to hit")),j.createElement(wu,null,j.createElement(ku,null,"Distance: "),j.createElement(ju,null,n.distance," hexas,"," ",n.outOfRange?"out of range":"".concat(n.rangeModifier," to hit"))),j.createElement(wu,null,j.createElement(ku,null,"OEW: "),j.createElement(ju,null,"+",5*n.oew," to hit")),j.createElement(wu,null,j.createElement(ku,null,"DEW: "),j.createElement(ju,null,"-",5*n.dew," to hit")),j.createElement(wu,null,j.createElement(ku,null,"FINAL HIT CHANGE: "),j.createElement(ju,null,n.result,"%")))}}]),t}(j.Component);function xu(){var e=Object(R.a)(["\n  width: 200px;\n"]);return xu=function(){return e},e}var Cu=Object(F.b)(gt)(xu()),Tu=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.element,n=e.cargo,i=e.additionalContent;return S.a.createElement(Cu,{element:t},S.a.createElement(yt,null,n.getDisplayName()),n.getCargoInfo().map(Eu),i)}}]),t}(S.a.Component),Eu=function(e,t){var n=e.header,i=e.value;return i.replace&&(i=i.replace(/<br>/gm,"\n")),S.a.createElement(wt,{key:"cargoTooltipEntry-".concat(n,"-").concat(t)},n&&S.a.createElement(Ot,null,n,": "),i&&S.a.createElement(vt,null,i))},Au=Tu;function Pu(){var e=Object(R.a)(["\n  position: relative;\n  margin: 0;\n  padding: 0;\n  ","\n"]);return Pu=function(){return e},e}var Iu=F.b.div(Pu(),(function(e){return e.onClick&&"cursor: pointer;"})),Du=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).element=S.a.createRef(),n.state={mouseOveredCargo:null},n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"onCargoMouseOver",value:function(e){e.stopPropagation(),e.preventDefault(),this.setState({mouseOveredCargo:this.element})}},{key:"onCargoMouseOut",value:function(e){e.stopPropagation(),e.preventDefault(),this.setState({mouseOveredCargo:null})}},{key:"render",value:function(){var e=this,t=this.props,n=t.cargo,i=t.amount,a=t.handleOnClick,r=void 0===a?function(){}:a,s=t.tooltipAdditionalContent,o=t.text,u=Object(D.a)(t,["cargo","amount","handleOnClick","tooltipAdditionalContent","text"]),c=this.state.mouseOveredCargo;return S.a.createElement(Iu,Object.assign({onClick:r,onMouseOver:this.onCargoMouseOver.bind(this),onMouseOut:this.onCargoMouseOut.bind(this)},u),c&&S.a.createElement(Au,{element:c,cargo:n,additionalContent:s}),S.a.createElement(se,{ref:function(t){return e.element=t},background:n.getBackgroundImage()},o||i))}}]),t}(S.a.Component);function Mu(){var e=Object(R.a)(["\n  display: flex;\n  flex-wrap: wrap;\n"]);return Mu=function(){return e},e}var zu=F.b.div(Mu()),Ru=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"onSystemMouseOver",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.props,n=t.uiState,i=t.system,a=t.ship;n.customEvent("systemMouseOver",{ship:a,system:i,element:this.element}),this.setState({mouseOveredSystem:this.element})}},{key:"onSystemMouseOut",value:function(e){e.stopPropagation(),e.preventDefault(),this.props.uiState.customEvent("systemMouseOut"),this.setState({mouseOveredSystem:null})}},{key:"render",value:function(){var e=this.props.list;return S.a.createElement(S.a.Fragment,null,S.a.createElement(bt,null,"Current cargo"),S.a.createElement(zu,null,e.map((function(e,t){var n=e.object,i=e.amount;return S.a.createElement(Du,{key:"cargo-item-".concat(t),cargo:n,amount:i})}))))}}]),t}(S.a.Component);function Fu(){var e=Object(R.a)(["\n  display: flex;\n  flex-wrap: wrap;\n"]);return Fu=function(){return e},e}var Hu=F.b.div(Fu()),Lu=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"systemChangedCallback",value:function(e,t){e.id===this.props.ship.id&&t.id===this.props.launcher.system.id&&this.forceUpdate()}},{key:"componentDidMount",value:function(){var e=this.props.uiState;this.systemChangedCallbackInstance=this.systemChangedCallback.bind(this),e.subscribeToSystemChange(this.systemChangedCallbackInstance)}},{key:"componentWillUnmount",value:function(){this.props.uiState.unsubscribeFromSystemChange(this.systemChangedCallbackInstance)}},{key:"unloadAmmo",value:function(){var e=this;return function(t){t.preventDefault(),t.stopPropagation();var n=e.props,i=n.ship,a=n.launcher,r=n.uiState,s=n.launcherIndex;a.unloadAmmo({launcherIndex:s}),r.shipSystemStateChanged(i,a.system)}}},{key:"loadTorpedo",value:function(e){var t=this;return function(n){n.preventDefault(),n.stopPropagation();var i=t.props,a=i.ship,r=i.launcher,s=i.uiState,o=i.launcherIndex;r.loadAmmo({ammo:e,launcherIndex:o}),s.shipSystemStateChanged(a,r.system)}}},{key:"render",value:function(){var e=this,t=this.props,n=t.launcherIndex,i=t.loadedTorpedo,a=t.loadingTime,r=t.turnsLoaded,s=(t.torpedoClass,t.launcher);return S.a.createElement(S.a.Fragment,null,S.a.createElement(yt,null,"Torpedo tube ",n),S.a.createElement(jt,null,S.a.createElement(wt,null,S.a.createElement(Ot,null,"Loading: "),S.a.createElement(vt,null,"".concat(r,"/").concat(a))),S.a.createElement(jt,null,S.a.createElement(Ot,null,"Loaded torpedo:"),S.a.createElement(Du,{cargo:i||new Mr,amount:null}))),S.a.createElement(wt,null,S.a.createElement(Ot,null,"Select torpedo to load: ")),S.a.createElement(Hu,null,s.getPossibleTorpedosToLoad().map((function(t,n){var i=t.object,a=t.amount;return S.a.createElement(Du,{handleOnClick:e.loadTorpedo(i).bind(e),key:"torpedo-launcer-".concat(n,"-possible-torpedo-").concat(i.constructor.name),cargo:i,amount:a})})),i&&S.a.createElement(Du,{handleOnClick:this.unloadAmmo().bind(this),key:"torpedo-launcer-unload",cargo:new Mr,amount:null})))}}]),t}(S.a.PureComponent);function Bu(){var e=Object(R.a)(["\n  width: 20px;\n  height: 20px;\n"]);return Bu=function(){return e},e}function _u(){var e=Object(R.a)(["\n  justify-content: flex-start;\n"]);return _u=function(){return e},e}function Uu(){var e=Object(R.a)(["\n  display: flex;\n  align-items: center;\n"]);return Uu=function(){return e},e}function Nu(){var e=Object(R.a)(["\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-around;\n"]);return Nu=function(){return e},e}var Vu=F.b.div(Nu()),Gu=F.b.div(Uu()),Wu=Object(F.b)(jt)(_u()),qu=Object(F.b)(Et)(Bu()),Zu=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).state={loadingOpen:!1},n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"systemChangedCallback",value:function(e,t){e.id===this.props.ship.id&&t.id===this.props.ammoStrategy.system.id&&this.forceUpdate()}},{key:"componentDidMount",value:function(){var e=this.props.uiState;this.systemChangedCallbackInstance=this.systemChangedCallback.bind(this),e.subscribeToSystemChange(this.systemChangedCallbackInstance)}},{key:"componentWillUnmount",value:function(){this.props.uiState.unsubscribeFromSystemChange(this.systemChangedCallbackInstance)}},{key:"getNewLoadOutButtons",value:function(){var e=this,t=this.props,n=t.ammoStrategy,i=(t.uiState,t.ship,n.getLoadingTarget());return n.ammunitionClasses.filter((function(e){return!i.find((function(t){return t.object instanceof e}))})).forEach((function(e){i.push({object:new e,amount:0})})),i.sort((function(e,t){return e.object.constructor.name>t.object.constructor.name?1:e.object.constructor.name<t.object.constructor.name?-1:0})),S.a.createElement(Vu,null,i.map((function(t,i){var a=t.object,r=t.amount;return S.a.createElement(Gu,{key:"new-loading-".concat(i)},S.a.createElement(qu,{img:"/img/minus.png",onClick:function(t){t.preventDefault(),t.stopPropagation(),n.addToLoading({object:a,amount:-1}),e.forceUpdate()}}),S.a.createElement(Du,{key:"torpedo-launcer-".concat(i,"-possible-torpedo-").concat(a.constructor.name),cargo:a,amount:r}),S.a.createElement(qu,{img:"/img/plus.png",onClick:function(t){t.preventDefault(),t.stopPropagation(),n.addToLoading({object:a,amount:1}),e.forceUpdate()}}))})))}},{key:"render",value:function(){var e=this,t=this.props,n=t.ammoStrategy,i=t.uiState,a=t.ship,r=this.state.loadingOpen;return a.player.isUsers(i.services.currentUser)?S.a.createElement(S.a.Fragment,null,!r&&S.a.createElement(S.a.Fragment,null,S.a.createElement(yt,null,"AMMO MAGAZINE"),S.a.createElement(wt,null,S.a.createElement(Ot,null,"Ammo needed to fire"),S.a.createElement(vt,null,n.ammoPerFireOrder)),S.a.createElement(Wu,null,S.a.createElement(wt,null,S.a.createElement(Ot,null,"Current ammo: "),S.a.createElement(vt,null,n.getSelectedAmmo().getShortDisplayName()))),S.a.createElement(Wu,null,S.a.createElement(wt,null,S.a.createElement(Ot,null,"Ammo in magazine: ")),n.getAmmoInMagazine().map((function(e,t){var n=e.object,i=e.amount;return S.a.createElement(Du,{key:"torpedo-launcer-".concat(t,"-possible-torpedo-").concat(n.constructor.name),cargo:n,amount:i})}))),S.a.createElement(wt,null,S.a.createElement(vt,null,"NOTE: Magazine reloaded only offline")),S.a.createElement(kt,{clickable:!0,onClick:function(t){t.preventDefault(),t.stopPropagation(),e.setState({loadingOpen:!0})}},S.a.createElement(Ot,null,"CLICK TO LOAD NEW AMMO"))),r&&S.a.createElement(S.a.Fragment,null,S.a.createElement(yt,null,"New loadout"),S.a.createElement(wt,null,S.a.createElement(vt,null,"NOTE: Magazine reloaded only offline")),S.a.createElement(wt,null,S.a.createElement(Ot,null,"Cooldown before loading:"),S.a.createElement(vt,null,n.startLoadingAfter," turn(s)")),S.a.createElement(wt,null,S.a.createElement(Ot,null,"Turns offline:"),S.a.createElement(vt,null,n.turnsOffline," turn(s)")),S.a.createElement(wt,null,S.a.createElement(Ot,null,"Ammo transfer per turn:"),S.a.createElement(vt,null,n.intakeInTurn)),S.a.createElement(wt,null,S.a.createElement(Ot,null,"Magazine capacity:"),S.a.createElement(vt,null,"".concat(n.getLoadingTargetAmount(),"/").concat(n.capacity))),this.getNewLoadOutButtons(),S.a.createElement(kt,{clickable:!0,onClick:function(t){t.preventDefault(),t.stopPropagation(),e.setState({loadingOpen:!1})}},S.a.createElement(Ot,null,"CLOSE")),S.a.createElement(kt,{clickable:!0,onClick:function(t){t.preventDefault(),t.stopPropagation(),a.systems.getSystems().filter((function(e){return e.constructor===n.system.constructor})).forEach((function(e){return e.callHandler("setNewLoadingTarget",n.getLoadingTarget())})),e.setState({loadingOpen:!1})}},S.a.createElement(Ot,null,"COPY FOR ALL WEAPONS")))):null}}]),t}(S.a.Component);function Ku(){var e=Object(R.a)(['\n  width: 1%;\n  height: 100%;\n  background-image: url("/img/lightBluePixel.png");\n  background-size: 100% ',";\n  background-repeat: no-repeat;\n  background-position: bottom 0 left 0;\n  opacity: 0.25;\n  filter: blur(1px);\n\n  &:hover {\n    opacity: 0.5;\n  }\n"]);return Ku=function(){return e},e}function Xu(){var e=Object(R.a)(["\n  width: calc(100% - 16px);\n  margin: 0 8px;\n  display: flex;\n  justify-content: space-between;\n"]);return Xu=function(){return e},e}function Yu(){var e=Object(R.a)(["\n  display: flex;\n  width: calc(100% - 16px);\n  height: 32px;\n  align-items: flex-end;\n  margin: 0 8px;\n"]);return Yu=function(){return e},e}var Qu=F.b.div(Yu()),Ju=F.b.div(Xu()),$u=F.b.div(Ku(),(function(e){return"".concat(e.height,"%")})),ec=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){for(var e=this.props.rangeStrategy,t=tc(e)/100,n=[],i=0;i<100;i++){var a=e.getRangeModifier({distance:i*t});n.push({range:i,rangePenalty:a,height:100*Math.abs(a/200)})}return S.a.createElement(S.a.Fragment,null,S.a.createElement(wt,null,S.a.createElement(Ot,null,"Range penalty:")),S.a.createElement(Qu,null,n.map((function(e,t){return S.a.createElement($u,{key:"rangestep-".concat(t),height:e.height})}))),S.a.createElement(Ju,null,S.a.createElement(vt,null,"0"),S.a.createElement(vt,null,"distance"),S.a.createElement(vt,null,tc(e))))}}]),t}(S.a.Component),tc=function(e){var t=e.rangesAndPenalties;return t[t.length-1].range},nc=ec,ic=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.ship,n=e.uiState,i=e.system,a=n.services.currentUser,r=t.player.is(a);return S.a.createElement(S.a.Fragment,null,i.callHandler("getUiComponents",{myShip:r},[]).map((function(e,i){var a=e.name,r=e.props;switch(a){case"RangePenalty":return S.a.createElement(nc,Object.assign({key:"rangePenalty-".concat(a,"-index-").concat(i),uiState:n,ship:t},r));case"Ammo":return S.a.createElement(Zu,Object.assign({key:"ammo-".concat(a,"-index-").concat(i),uiState:n,ship:t},r));case"CargoList":return S.a.createElement(Ru,Object.assign({key:"cargo-item-".concat(a,"-index-").concat(i),uiState:n,ship:t},r));case"TorpedoLauncher":return S.a.createElement(Lu,Object.assign({key:"torpedo-launcher-".concat(a,"-index-").concat(i),uiState:n,ship:t},r))}})))}}]),t}(S.a.Component);function ac(){var e=Object(R.a)(["\n  cursor: pointer;\n  font-weight: bolder;\n  margin-right: 4px;\n\n  ","\n  &:last-child {\n    margin: 0;\n  }\n  :hover {\n    color: white;\n  }\n"]);return ac=function(){return e},e}function rc(){var e=Object(R.a)(["\n  line-height: 14px;\n  display: flex;\n  flex-direction: row;\n  color: #5e85bc;\n"]);return rc=function(){return e},e}function sc(){var e=Object(R.a)(["\n  color: ",";\n  font-weight: bold;\n\n  animation: blinker 2s linear infinite;\n\n  @keyframes blinker {\n    50% {\n      opacity: 0.5;\n    }\n  }\n"]);return sc=function(){return e},e}function oc(){var e=Object(R.a)(["\n  top: 0px;\n  right: 340px;\n  width: 202px;\n\n  ","\n  transition: width 0.25s;\n  transition-timing-function: ease-in-out;\n"]);return oc=function(){return e},e}var uc=Object(F.b)(ft)(oc(),(function(e){return e.tab&&"width: 302px;"})),cc=F.b.div(sc(),i.textDanger),lc=F.b.div(rc()),hc=F.b.div(ac(),(function(e){return e.active&&"color: white;"})),dc=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).state={tab:null},n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"systemChangedCallback",value:function(e,t){e.id===this.props.ship.id&&t.id===this.props.system.id&&this.forceUpdate()}},{key:"componentDidMount",value:function(){var e=this.props.uiState;this.systemChangedCallbackInstance=this.systemChangedCallback.bind(this),e.subscribeToSystemChange(this.systemChangedCallbackInstance)}},{key:"componentWillUnmount",value:function(){this.props.uiState.unsubscribeFromSystemChange(this.systemChangedCallbackInstance)}},{key:"getContainer",value:function(e){var t=this.props,n=t.element,i=t.scs,a=this.state.tab;return i?j.createElement(uc,{tab:a},e):j.createElement(gt,{tab:a,element:n},e)}},{key:"getWarnings",value:function(){var e=this.props.system,t=[];e.isDestroyed()&&t.push("DESTROYED"),e.power.isOffline()&&t.push("OFFLINE");var n=e.damage.getCriticals().map((function(e){return e.getMessage()}));return[].concat(t,Object(ta.a)(n)).join(", ")}},{key:"getInfoTab",value:function(){var e=this.props.system;return At([{value:e.getSystemDescription()}])}},{key:"getLogTab",value:function(){return this.props.system.log.getWithTurns().map((function(e,t){var n=e.turn,i=e.messages;return j.createElement("div",{key:"systemlog-turn-".concat(n,"-").concat(t)},j.createElement(bt,null,"Log, turn ".concat(n)),i.map((function(e,i){return j.createElement(wt,{key:"logmessage-".concat(n,"-").concat(t,"-").concat(i)},j.createElement(vt,null,e))})))}))}},{key:"getDefaultTab",value:function(){var e=this.props,t=e.ship,n=e.system,i=e.systemInfoMenuProvider,a=e.uiState,r=e.weaponTargeting,s=i?i():null,o=this.getWarnings();return j.createElement(j.Fragment,null,s&&j.createElement(s,{uiState:a,ship:t,system:n}),o&&j.createElement(wt,null,j.createElement(cc,null,o)),At(n.getSystemInfo(t)),j.createElement(ic,{ship:t,system:n,uiState:a}),r&&j.createElement(Su,{uiState:a,ship:t,system:n,target:r.target,hitChange:r.hitChange}))}},{key:"render",value:function(){var e=this,t=this.props.system,n=this.state.tab;return this.getContainer(j.createElement(j.Fragment,null,j.createElement(yt,null,t.getDisplayName(),j.createElement(lc,null,j.createElement(hc,{active:"log"===n,onClick:function(t){t.preventDefault(),t.stopPropagation(),e.setState({tab:"log"})}},"L"),j.createElement(hc,{active:"info"===n,onClick:function(t){t.preventDefault(),t.stopPropagation(),e.setState({tab:"info"})}},"?"),j.createElement(hc,{active:!n,onClick:function(t){t.preventDefault(),t.stopPropagation(),e.setState({tab:null})}},"D"))),!n&&this.getDefaultTab(),"log"===n&&this.getLogTab(),"info"===n&&this.getInfoTab()))}}]),t}(j.Component);function mc(){var e=Object(R.a)(["\n  cursor: pointer;\n  position: relative;\n  margin: 3px 1px;\n"]);return mc=function(){return e},e}function fc(){var e=Object(R.a)(['\n  position: relative;\n  box-sizing: border-box;\n  width: 30px;\n  height: 30px;\n\n  background-color: "transparent";\n  background-image: ',";\n  background-size: cover;\n  filter: ",";\n  cursor: pointer;\n\n  "," {\n    display: ",';\n  }\n\n  :before {\n    content: "";\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    opacity: ',";\n\n    background-color: transparent;\n\n    background-image: ",";\n  }\n"]);return fc=function(){return e},e}function pc(){var e=Object(R.a)(["\n  position: absolute;\n  top: 0px;\n  width: 100%;\n  height: calc(100% - 5px);\n  font-family: arial;\n  font-size: 10px;\n  color: white;\n  display: flex;\n  ","\n  align-items: flex-end;\n  justify-content: center;\n  text-shadow: black 0 0 6px, black 0 0 6px, black 0 0 6px, black 0 0 6px;\n"]);return pc=function(){return e},e}function vc(){var e=Object(R.a)(["\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  height: 7px;\n  border: 2px solid black;\n  box-sizing: border-box;\n\n  ",'\n  background-color: #7a2020;\n\n  :before {\n    content: "";\n    position: absolute;\n    width: ',";\n    height: 100%;\n    left: 0;\n    bottom: 0;\n    background-color: ",";\n  }\n"]);return vc=function(){return e},e}var gc=F.b.div(vc(),(function(e){return e.destroyed&&"display: none;"}),(function(e){return"".concat(e.health,"%")}),(function(e){return e.criticals?"#ed6738":"#427231"})),yc=F.b.div(pc(),(function(e){return e.destroyed&&"display: none;"})),bc=F.b.div(fc(),(function(e){return"url(".concat(e.background,")")}),(function(e){return e.targeting?"hue-rotate(0deg) brightness(4) grayscale(0)":e.reserved?"hue-rotate(0deg) brightness(1) grayscale(0.7)":e.firing?"hue-rotate(0deg) brightness(4) grayscale(0)":e.destroyed?"blur(1px) brightness(0.5)":"none"}),yc,(function(e){return e.offline?"none":"flex"}),(function(e){return e.destroyed||e.offline||e.loading?"0.8":"0"}),(function(e){return e.offline?"url(/img/offline.png)":"none"})),Oc=F.b.div(mc()),wc=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).element=j.createRef(),n.state={mouseOveredSystem:null,clickedSystem:null},n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"clickSystem",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.props,n=t.uiState,i=t.system,a=t.ship,r=t.scs;n.customEvent("systemClicked",{ship:a,system:i,element:this.element,scs:r})}},{key:"onSystemMouseOver",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.props,n=t.uiState,i=t.system,a=t.ship;n.customEvent("systemMouseOver",{ship:a,system:i,element:this.element}),this.setState({mouseOveredSystem:this.element})}},{key:"onSystemMouseOut",value:function(e){e.stopPropagation(),e.preventDefault(),this.props.uiState.customEvent("systemMouseOut"),this.setState({mouseOveredSystem:null})}},{key:"onContextMenu",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.props,n=t.uiState,i=t.system,a=t.ship;n.customEvent("systemRightClicked",{system:i,ship:a})}},{key:"render",value:function(){var e=this,t=this.props,n=t.uiState,i=t.system,a=t.ship,r=t.scs,s=(t.destroyed,t.systemMenu),o=(s=void 0===s?{systemInfoMenuProvider:null,activeSystem:null,activeSystemElement:null}:s).systemInfoMenuProvider,u=s.activeSystem,c=s.activeSystemElement,l=t.onSystemClicked,h=void 0===l?this.clickSystem:l,d=t.selected,m=void 0!==d&&d,f=t.text,p=void 0===f?null:f,v=t.target,g=void 0===v?null:v,y=Object(D.a)(t,["uiState","system","ship","scs","destroyed","systemMenu","onSystemClicked","selected","text","target"]),b=this.state.mouseOveredSystem,O=n.services.weaponFireService;p||(p=i.getIconText());var w=u?o:null,k=Boolean(!u&&b||u&&u===i&&c===this.element),S=O.systemHasFireOrder(i),x=g&&O.systemHasFireOrder(i)&&!O.systemHasFireOrderAgainstShip(i,g),C=g&&O.systemHasFireOrderAgainstShip(i,g);return j.createElement(j.Fragment,null,k&&r&&j.createElement(dc,Object.assign({scs:!0,uiState:n,ship:a,system:i,systemInfoMenuProvider:w,element:b||c,target:g},y)),j.createElement(Oc,{onClick:h.bind(this),onMouseOver:this.onSystemMouseOver.bind(this),onMouseOut:this.onSystemMouseOut.bind(this),onContextMenu:this.onContextMenu.bind(this),scs:!0},k&&!r&&j.createElement(dc,Object.assign({scs:!0,uiState:n,ship:a,system:i,systemInfoMenuProvider:w,element:b||c,target:g},y)),j.createElement(bc,{ref:function(t){return e.element=t},scs:r,background:i.getBackgroundImage(),offline:jc(a,i),loading:kc(i),selected:m,firing:S,targeting:C,reserved:x,destroyed:i.isDestroyed()}),j.createElement(yc,{destroyed:i.isDestroyed(),selected:m},p),j.createElement(gc,{destroyed:i.isDestroyed(),criticals:i.hasAnyCritical(),health:Sc(i)})))}}]),t}(j.Component),kc=function(e){},jc=function(e,t){return t.power.isOffline()},Sc=function(e){return(e.hitpoints-e.getTotalDamage())/e.hitpoints*100},xc=wc;function Cc(){var e=Object(R.a)(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-sizing: border-box;\n  width: calc(100% - 4px);\n  height: 16px;\n  background-color: #081313;\n  color: ",";\n  font-family: arial;\n  font-size: 11px;\n  text-shadow: black 0 0 6px, black 0 0 6px;\n  margin: 1px;\n  filter: ",';\n  border: 1px solid black;\n\n  :before {\n    box-sizing: border-box;\n    content: "";\n    position: absolute;\n    width: ',";\n    height: 100%;\n    left: 0;\n    bottom: 0;\n    z-index: 0;\n    background-color: ",";\n  }\n"]);return Cc=function(){return e},e}function Tc(){var e=Object(R.a)(["\n  z-index: 1;\n"]);return Tc=function(){return e},e}function Ec(){var e=Object(R.a)(["\n  cursor: pointer;\n  position: relative;\n  margin: 3px 1px;\n"]);return Ec=function(){return e},e}function Ac(){var e=Object(R.a)(['\n  position: relative;\n  box-sizing: border-box;\n  width: 30px;\n  height: 30px;\n\n  background-color: "transparent";\n  background-image: ',";\n  background-size: cover;\n  filter: ",";\n  cursor: pointer;\n\n  "," {\n    display: ",';\n  }\n\n  :before {\n    content: "";\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    opacity: ',";\n\n    background-color: ",";\n\n    background-image: ",";\n  }\n"]);return Ac=function(){return e},e}function Pc(){var e=Object(R.a)(["\n  position: absolute;\n  top: 0px;\n  width: 100%;\n  height: calc(100% - 5px);\n  font-family: arial;\n  font-size: 10px;\n  color: white;\n  display: flex;\n  align-items: flex-end;\n  justify-content: center;\n  text-shadow: black 0 0 6px, black 0 0 6px, black 0 0 6px, black 0 0 6px;\n"]);return Pc=function(){return e},e}function Ic(){var e=Object(R.a)(['\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  height: 7px;\n  border: 2px solid black;\n  box-sizing: border-box;\n\n  background-color: #7a2020;\n\n  :before {\n    content: "";\n    position: absolute;\n    width: ',";\n    height: 100%;\n    left: 0;\n    bottom: 0;\n    background-color: ",";\n  }\n"]);return Ic=function(){return e},e}F.b.div(Ic(),(function(e){return"".concat(e.health,"%")}),(function(e){return e.criticals?"#ed6738":"#427231"}));var Dc=F.b.div(Pc()),Mc=(F.b.div(Ac(),(function(e){return"url(".concat(e.background,")")}),(function(e){return e.targeting?"hue-rotate(0deg) brightness(4) grayscale(0)":e.reserved?"hue-rotate(0deg) brightness(1) grayscale(0.7)":e.firing?"hue-rotate(0deg) brightness(4) grayscale(0)":e.destroyed?"blur(1px)":"none"}),Dc,(function(e){return e.offline?"none":"flex"}),(function(e){return e.destroyed||e.offline||e.loading?"0.5":"0"}),(function(e){return e.destroyed||e.offline?"black":e.loading?"orange":"transparent"}),(function(e){return e.offline?"url(/img/offline.png)":"none"})),F.b.div(Ec()),F.b.div(Tc())),zc=F.b.div(Cc(),(function(e){return 0===e.health?"transparent":"white"}),(function(e){return 0===e.health?"blur(1px)":"none"}),(function(e){return"".concat(e.health,"%")}),(function(e){return e.criticals?"#ed6738":"#427231"})),Rc=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).element=j.createRef(),n.state={mouseOveredSystem:null,clickedSystem:null},n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"clickSystem",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.props,n=t.uiState,i=t.system,a=t.ship;n.customEvent("systemClicked",{ship:a,system:i,element:this.element,scs:!0})}},{key:"onSystemMouseOver",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.props,n=t.uiState,i=t.system,a=t.ship;n.customEvent("systemMouseOver",{ship:a,system:i,element:this.element}),this.setState({mouseOveredSystem:this.element})}},{key:"onSystemMouseOut",value:function(e){e.stopPropagation(),e.preventDefault(),this.props.uiState.customEvent("systemMouseOut"),this.setState({mouseOveredSystem:null})}},{key:"onContextMenu",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.props,n=t.uiState,i=t.system,a=t.ship;n.customEvent("systemRightClicked",{system:i,ship:a})}},{key:"render",value:function(){var e=this,t=this.props,n=t.uiState,i=t.system,a=t.ship,r=(t.scs,t.destroyed,t.systemMenu),s=(r=void 0===r?{systemInfoMenuProvider:null,activeSystem:null,activeSystemElement:null}:r).systemInfoMenuProvider,o=r.activeSystem,u=r.activeSystemElement,c=t.onSystemClicked,l=void 0===c?this.clickSystem:c,h=(t.selected,t.text,t.target),d=void 0===h?null:h,m=Object(D.a)(t,["uiState","system","ship","scs","destroyed","systemMenu","onSystemClicked","selected","text","target"]),f=this.state.mouseOveredSystem,p=o?s:null,v=Boolean(!o&&f||o&&o===i&&u===this.element);return j.createElement(j.Fragment,null,v&&j.createElement(dc,Object.assign({scs:!0,uiState:n,ship:a,system:i,systemInfoMenuProvider:p,element:f||u,target:d},m)),j.createElement(zc,{ref:function(t){return e.element=t},onClick:l.bind(this),onMouseOver:this.onSystemMouseOver.bind(this),onMouseOut:this.onSystemMouseOut.bind(this),onContextMenu:this.onContextMenu.bind(this),health:Fc(i),criticals:i.hasAnyCritical()},j.createElement(Mc,null,i.getRemainingHitpoints()," / ",i.hitpoints," A"," ",i.getArmor())))}}]),t}(j.Component),Fc=function(e){return(e.hitpoints-e.getTotalDamage())/e.hitpoints*100},Hc=Rc;function Lc(){var e=Object(R.a)(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-sizing: border-box;\n  width: calc(100% - 4px);\n  height: 16px;\n  background-color: #081313;\n  color: ",";\n  font-family: arial;\n  font-size: 11px;\n  text-shadow: black 0 0 6px, black 0 0 6px;\n  margin: 1px;\n  filter: ",';\n  border: 1px solid black;\n\n  :before {\n    box-sizing: border-box;\n    content: "";\n    position: absolute;\n    width: ',";\n    height: 100%;\n    left: 0;\n    bottom: 0;\n    z-index: 0;\n    background-color: ",";\n  }\n"]);return Lc=function(){return e},e}function Bc(){var e=Object(R.a)(["\n  z-index: 1;\n"]);return Bc=function(){return e},e}function _c(){var e=Object(R.a)(["\n  display: flex;\n  flex-wrap: wrap-reverse;\n  width: calc(100% - 2px);\n  align-items: end;\n  justify-content: space-around;\n  align-content: center;\n  box-sizing: border-box;\n  margin: 1px;\n  flex-grow: 1;\n\n  border: ",";\n"]);return _c=function(){return e},e}var Uc=F.b.div(_c(),(function(e){switch(e.location){case 0:return"1px solid ".concat(i.systemWindowPrimaryBorder);default:return"1px dashed ".concat(i.systemWindowBorder)}})),Nc=(F.b.div(Bc()),F.b.div(Lc(),(function(e){return 0===e.health?"transparent":"white"}),(function(e){return 0===e.health?"blur(1px)":"none"}),(function(e){return"".concat(e.health,"%")}),(function(e){return e.criticals?"#ed6738":"#427231"})),function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.ship,n=e.section,i=e.uiState,a=Object(D.a)(e,["ship","section","uiState"]),r=n.location,s=n.getStructure();return j.createElement(Uc,{location:r},n.getNonStructureSystems().map((function(e){return j.createElement(xc,Object.assign({scs:!0,uiState:i,key:"system-scs-".concat(r,"-").concat(t.id,"-").concat(e.id),system:e,ship:t,selected:i.isSelectedSystem(e)},a))})),s&&j.createElement(Hc,Object.assign({uiState:i,system:s,ship:t,selected:i.isSelectedSystem(s)},a)))}}]),t}(j.Component));function Vc(){var e=Object(R.a)(["\n  width: 50%;\n"]);return Vc=function(){return e},e}function Gc(){var e=Object(R.a)(["\n  width: 25%;\n  max-height: calc(33.3333333% - 11px);\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n"]);return Gc=function(){return e},e}function Wc(){var e=Object(R.a)(["\n  display: flex;\n  flex-wrap: wrap;\n  max-width: 400px;\n  height: auto;\n  opacity: 0.95;\n  z-index: 10001;\n  font-size: 10px;\n  color: white;\n  font-family: arial;\n  max-height: 100vh;\n  overflow-y: scroll;\n  margin: 0 8px;\n  scrollbar-width: 0;\n\n  &::-webkit-scrollbar {\n    width: 0;\n  }\n"]);return Wc=function(){return e},e}var qc=F.b.div(Wc()),Zc=F.b.div(Gc()),Kc=Object(F.b)(Zc)(Vc()),Xc=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"close",value:function(){this.props.uiState.closeShipWindow(this.props.ship)}},{key:"render",value:function(){var e=this.props,t=e.ship,n=e.uiState,i=Object(D.a)(e,["ship","uiState"]);return j.createElement(qc,{onClick:Yc.bind(this,n),onContextMenu:function(e){e.preventDefault(),e.stopPropagation()},team:t.team},j.createElement(Zc,null,j.createElement(Nc,Object.assign({uiState:n,ship:t,section:t.systems.sections.getPortFrontSection()},i)),j.createElement(Nc,Object.assign({uiState:n,ship:t,section:t.systems.sections.getPortAftSection()},i))),j.createElement(Kc,null,j.createElement(Nc,Object.assign({uiState:n,section:t.systems.sections.getFrontSection(),ship:t},i)),j.createElement(Nc,Object.assign({uiState:n,ship:t,section:t.systems.sections.getPrimarySection()},i)),j.createElement(Nc,Object.assign({uiState:n,ship:t,section:t.systems.sections.getAftSection()},i))),j.createElement(Zc,null,j.createElement(Nc,Object.assign({uiState:n,ship:t,section:t.systems.sections.getStarboardFrontSection()},i)),j.createElement(Nc,Object.assign({uiState:n,ship:t,section:t.systems.sections.getStarboardAftSection()},i))))}}]),t}(j.Component),Yc=function(e){return e.customEvent("closeSystemInfo")},Qc=Xc;function Jc(){var e=Object(R.a)(["\n  display: flex;\n"]);return Jc=function(){return e},e}var $c=F.b.div(Jc()),el=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.uiState,n=e.ship,i=e.target,a=e.system,r=Object(D.a)(e,["uiState","ship","target","system"]);if(!t.services.weaponFireService.canFire(n,i,a))return null;var s=a.callHandler("getHitChange",{shooter:n,target:i,prediction:!0});return j.createElement($c,null,j.createElement(xc,Object.assign({scs:!0,targeting:!0,uiState:t,key:"system-weaponTargeting-".concat(n.id,"-").concat(a.id),system:a,ship:n,selected:!1,target:i,weaponTargeting:{target:i,hitChange:s},text:s.result+"%"},r)))}}]),t}(j.Component);function tl(){var e=Object(R.a)(["\n  display: flex;\n  flex-wrap: wrap;\n  margin: 0 8px;\n"]);return tl=function(){return e},e}function nl(){var e=Object(R.a)(["\n  border: none;\n  margin-bottom: 0;\n  font-size: 12px;\n"]);return nl=function(){return e},e}Object(F.b)(yt)(nl());var il=F.b.div(tl()),al=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getSystemIcons",value:function(e,t,n,i,a,r){var s=this;return e.map((function(e){return j.createElement(el,Object.assign({key:"weaponTargeting-".concat(e.id),uiState:n,system:e,target:a,ship:i,onSystemClicked:t.systemHasFireOrderAgainstShip(e,a)?s.unTargetShip(e,i,a,n):s.targetShip(e,i,a,n)},r))}))}},{key:"targetShip",value:function(e,t,n,i){var a=i.services.weaponFireService;return function(){a.removeFireOrders(t,e),a.addFireOrder(t,n,e),i.shipSystemStateChanged(t,e),i.shipStateChanged(t)}}},{key:"unTargetShip",value:function(e,t,n,i){var a=i.services.weaponFireService;return function(){a.removeFireOrders(t,e),i.shipSystemStateChanged(t,e),i.shipStateChanged(t)}}},{key:"render",value:function(){var e=this.props,t=e.ship,n=e.uiState,i=Object(D.a)(e,["ship","uiState"]),a=n.services.weaponFireService,r=n.getSelectedShip();if(!r||n.gameData.ships.isSameTeam(t,r))return null;var s=r.systems.getSystems().filter((function(e){return a.canFire(r,t,e)})),o=this.getSystemIcons(s,a,n,r,t,i);return j.createElement(j.Fragment,null,j.createElement(il,null,o))}}]),t}(j.Component),rl=function(){function e(t,n,i){Object(T.a)(this,e),this.services=t,this.target=i,this.gameData=n}return Object(E.a)(e,[{key:"getPossibleTorpedos",value:function(e,t){var n=this,i=[];return t.player.isUsers(e)?[]:(this.gameData.ships.getShips().filter((function(t){return t.player.isUsers(e)})).forEach((function(e){e.systems.getSystems().forEach((function(t){var a=t.callHandler("getLoadedLaunchers",null,[]);if(0!==a.length){var r=i.find((function(t){return t.ship===e}));r?r.launchers=[].concat(Object(ta.a)(r.launchers),Object(ta.a)(a)):i.push({ship:e,launchers:a,distance:n.target.getHexPosition().distanceTo(e.getHexPosition()),deltaDistance:sl(n.target,e)})}}))})),i.sort((function(e,t){return e.distance>t.distance?1:e.distance<t.distance?-1:0})),i)}}]),e}(),sl=function(e,t){var n=e.getHexPosition().distanceTo(t.getHexPosition()),i=e.movement.getLastMove(),a=t.movement.getLastMove();if(!i||!a)return 0;var r=e.getHexPosition().add(i.getHexVelocity()),s=t.getHexPosition().add(a.getHexVelocity());return r.distanceTo(s)-n},ol=rl,ul=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=(e.shooter,e.target,e.torpedo,e.strikePrediction);return S.a.createElement(S.a.Fragment,null,S.a.createElement(yt,null,"Torpedo attack"),function(e,t,n,i){if(i){var a=[{value:"Following prediction depends on relative velocity, position of target, launched torpedo and is subject to change"},{header:"Impact in",value:"+".concat(Math.floor(i.impactTurn)," turns")},{header:"Relative velocity",value:"".concat(i.impactVelocity," h/t")}];return i.note&&a.push({value:i.note}),a}return[]}(0,0,0,t).map(cl))}}]),t}(S.a.Component),cl=function(e,t){var n=e.header,i=e.value;return i.replace&&(i=i.replace(/<br>/gm,"\n")),S.a.createElement(wt,{key:"cargoTooltipEntry-".concat(n,"-").concat(t)},n&&S.a.createElement(Ot,null,n,": "),i&&S.a.createElement(vt,null,i))},ll=ul,hl=function(){function e(){Object(T.a)(this,e)}return Object(E.a)(e,[{key:"reachesTargetThisTurn",value:function(e,t){return this.torpedoMath(e.position,e.velocity,t.getPosition(),t.getVelocity(),e.getTorpedoGameDeltaVelocity()).impactTurn<1}},{key:"moveTorpedo",value:function(e,t){var n=this.torpedoMath(e.position,e.velocity,t.getPosition().sub(t.getVelocity()),t.getVelocity(),e.getTorpedoGameDeltaVelocity()),i=n.accelerationVector;Object(D.a)(n,["accelerationVector"]);e.position=e.position.add(e.velocity).add(i.multiplyScalar(.5*e.getTorpedoGameDeltaVelocity())),e.velocity=e.velocity.add(i.multiplyScalar(e.getTorpedoGameDeltaVelocity()))}},{key:"buildPredictions",value:function(e,t){var n=e.torpedo.maxInterceptVelocity,i=t.impactVelocity/vn();i>n&&(i=n);var a=i/n,r="";return Math.floor(t.impactTurn)+e.turnsActive<e.torpedo.armingTime&&(a=0,r="Insufficient time to arm torpedo"),Math.floor(t.impactTurn)+e.turnsActive>e.torpedo.turnsToLive&&(a=0,r="Out of range"),Object(pi.a)({},t,{notes:r,impactVelocity:Math.round(t.impactVelocity/vn()),effectiveness:a})}},{key:"predictTorpedoHitPositionAndTurnAfterMovement",value:function(e,t){var n=this.torpedoMath(e.position,e.velocity,t.getPosition().sub(t.getVelocity()),t.getVelocity(),e.getTorpedoGameDeltaVelocity());return this.buildPredictions(e,n)}},{key:"predictTorpedoHitPositionAndTurn",value:function(e,t){var n=this.torpedoMath(e.position,e.velocity,t.getPosition(),t.getVelocity(),e.getTorpedoGameDeltaVelocity());return this.buildPredictions(e,n)}},{key:"standardize",value:function(e,t,n,i){var a=n.sub(e),r=Math.atan2(a.y,a.x),s=(new Kt.Matrix4).makeRotationZ(-r);return{newTargetPosition:a.applyMatrix4(s),newShooterVelocity:t.sub(i).applyMatrix4(s),"\u03c6":r}}},{key:"torpedoMath",value:function(e,t,n,i,a){if(a<=0)throw new Error("Torpedoacceleration is <= 0");if(e.equals(n))throw new Error("Shooter and target positions can not be same");var r=this.standardize(e,t,n,i),s=r.newTargetPosition,o=r.newShooterVelocity,u=r.\u03c6,c=s.x,l=null;if(Math.pow(o.y,2)/(a*c)<Math.pow(10,-7))l={accelerationAngle:u,impactTurn:(-o.x+Math.sqrt(Math.pow(o.x,2)+2*a*c))/a};else if(o.y>0){var h=this.findRoot(s.x,o.x,o.y,a);l={accelerationAngle:h+u,impactTurn:-2*o.y/(a*Math.sin(h))}}else{var d=this.findRoot(s.x,o.x,-o.y,a),m=2*o.y/(a*Math.sin(d));l={accelerationAngle:2*Math.PI-d+u,impactTurn:m}}var f=Math.sqrt(Math.pow(-o.x+i.x-a*l.impactTurn*Math.cos(l.accelerationAngle),2)+Math.pow(-o.y+i.y-a*l.impactTurn*Math.sin(l.accelerationAngle),2)),p=new Rn(Math.cos(l.accelerationAngle),Math.sin(l.accelerationAngle)).normalize();if(Number.isNaN(l.accelerationAngle)||Number.isNaN(l.impactTurn)||Number.isNaN(p)||Number.isNaN(f))throw new Error("Torpedo math encountered NaN with values '".concat(e.toString(),", '").concat(t.toString(),", '").concat(n.toString(),", '").concat(i.toString(),",'").concat(a,"'"));var v=e.add(t.multiplyScalar(l.impactTurn)).add(p.multiplyScalar(.5*a*Math.pow(l.impactTurn,2)));return Object(pi.a)({},l,{accelerationVector:p,impactVelocity:f,impactPosition:v})}},{key:"findRoot",value:function(e,t,n,i){return t/n-i*e/(2*Math.pow(n,2)<0)?this.findRoot2(e,t,n,i,3*Math.PI/2,this.findUpperLimit(e,t,n,i)):this.findRoot2(e,t,n,i,this.findLowerLimit(e,t,n,i),3*Math.PI/2)}},{key:"f",value:function(e,t,n,i,a){return Math.cos(a)/Math.pow(Math.sin(a),2)-t/(n*Math.sin(a))-i*e/(2*Math.pow(n,2))}},{key:"findRoot2",value:function(e,t,n,i,a,r){for(var s=a,o=r,u=0;o-s>Math.pow(10,-8);)u=(s+o)/2,this.f(e,t,n,i,u)>0?o=u:s=u;return(s+o)/2}},{key:"findUpperLimit",value:function(e,t,n,i){for(var a=1;;){var r=2*Math.PI-Math.PI/Math.pow(2,a);if(this.f(e,t,n,i,r)>0)return r;a++}}},{key:"findLowerLimit",value:function(e,t,n,i){for(var a=1;;){var r=Math.PI+Math.PI/Math.pow(2,a);if(this.f(e,t,n,i,r)<0)return r;a++}}}]),e}(),dl=function(){function e(t,n,i,a,r){Object(T.a)(this,e),this.id=ga(),this.torpedo=t,this.targetId=n,this.shooterId=i,this.weaponId=a,this.launcherIndex=r,this.position=new Rn,this.launchPosition=new Rn,this.velocity=new Rn,this.reachedTarget=!1,this.strikeEffectiveness=0,this.intercepted=!1,this.turnsActive=0}return Object(E.a)(e,[{key:"hasArmed",value:function(){return this.turnsActive>this.torpedo.armingTime}},{key:"noLongerActive",value:function(){return this.torpedo.turnsToLive<this.turnsActive}},{key:"getTorpedoGameDeltaVelocity",value:function(){return this.torpedo.deltaVelocityPerTurn*vn()}},{key:"getRelativeVelocityRatio",value:function(e){return e>this.torpedo.maxInterceptVelocity&&(e=this.torpedo.maxInterceptVelocity),e/this.torpedo.maxInterceptVelocity}},{key:"setIntercepted",value:function(){this.intercepted=!0}},{key:"setReachedTarget",value:function(e){this.reachedTarget=!0,this.strikeEffectiveness=e}},{key:"getInterceptTries",value:function(e){return this.torpedo.getInterceptTries(this.strikeEffectiveness,this,e)}},{key:"getStrikeDistance",value:function(e){return this.torpedo.getStrikeDistance(this,e)}},{key:"setImpactAngle",value:function(e){this.impactAngle=e}},{key:"setPosition",value:function(e){return this.position=e,this}},{key:"setLaunchPosition",value:function(e){return this.launchPosition=e,this}},{key:"setVelocity",value:function(e){return this.velocity=e,this}},{key:"serialize",value:function(){return{id:this.id,torpedo:this.torpedo.constructor.name,targetId:this.targetId,position:this.position,velocity:this.velocity,shooterId:this.shooterId,weaponId:this.weaponId,launcherIndex:this.launcherIndex,intercepted:this.intercepted,launchPosition:this.launchPosition,turnsActive:this.turnsActive}}},{key:"deserialize",value:function(e){return this.id=e.id,this.torpedo=new Rr[e.torpedo],this.targetId=e.targetId,this.position=new Rn(e.position),this.launchPosition=new Rn(e.launchPosition),this.velocity=new Rn(e.velocity),this.shooterId=e.shooterId,this.weaponId=e.weaponId,this.launcherIndex=e.launcherIndex,this.intercepted=e.intercepted||!1,this.turnsActive=e.turnsActive||0,this}},{key:"clone",value:function(){return(new e).deserialize(this.serialize())}}]),e}();function ml(){var e=Object(R.a)(["\n  "," {\n    ","\n  }\n"]);return ml=function(){return e},e}function fl(){var e=Object(R.a)(["\n  display: flex;\n  flex-wrap: wrap;\n"]);return fl=function(){return e},e}function pl(){var e=Object(R.a)(["\n  width: 25%;\n  display: flex;\n\n  justify-content: center;\n\n  :first-child {\n    width: 50%;\n    justify-content: flex-start;\n  }\n\n  :last-child {\n    justify-content: flex-end;\n  }\n"]);return pl=function(){return e},e}function vl(){var e=Object(R.a)(["\n  z-index: 3;\n"]);return vl=function(){return e},e}var gl=F.b.div(vl()),yl=F.b.div(pl()),bl=F.b.div(fl()),Ol=Object(F.b)(Du)(ml(),se,(function(e){var t=e.launcher,n=e.ship;return t.launchTarget===n.id?"filter: hue-rotate(0deg) brightness(4) grayscale(0);":null!==t.launchTarget&&t.launchTarget!==n.id?"filter: hue-rotate(0deg) brightness(1) grayscale(0.7);":void 0})),wl=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"launcherClick",value:function(e){var t=this;return function(){var n=t.props.ship;null===e.launchTarget||e.launchTarget!==n.id?e.setLaunchTarget(n.id):e.launchTarget&&e.launchTarget===n.id&&e.setLaunchTarget(null),t.forceUpdate()}}},{key:"render",value:function(){var e=this,t=this.props,n=t.uiState,i=t.ship,a=new ol(n.services,n.gameData,i).getPossibleTorpedos(n.services.currentUser,i),r=new hl;return S.a.createElement(S.a.Fragment,null,S.a.createElement(bt,null,S.a.createElement(yl,null,"Name"),S.a.createElement(yl,null,"Distance"),S.a.createElement(yl,null,"\u0394 Distance")),a.map((function(t,n){return S.a.createElement(gl,{key:"torpedo-launching-ship-".concat(n)},S.a.createElement(yt,null,S.a.createElement(yl,null,t.ship.name),S.a.createElement(yl,null,t.distance),S.a.createElement(yl,null,t.deltaDistance)),S.a.createElement(bl,null,t.launchers.map((function(n,a){var s=r.predictTorpedoHitPositionAndTurn(new dl(n.loadedTorpedo).setPosition(t.ship.getPosition()).setVelocity(t.ship.getVelocity()),i);return s?S.a.createElement(Ol,{launcher:n,ship:t.ship,handleOnClick:e.launcherClick(n).bind(e),key:"torpedo-attack--torpedo-".concat(t.ship.id,"-").concat(a),cargo:n.loadedTorpedo,amount:null,text:"".concat(Math.round(100*s.effectiveness),"%"),tooltipAdditionalContent:S.a.createElement(ll,{shooter:t.ship,target:i,torpedo:n.loadedTorpedo,strikePrediction:s})}):null}))))})))}}]),t}(S.a.Component);function kl(){var e=Object(R.a)(["\n  margin: 2px 0;\n"]);return kl=function(){return e},e}function jl(){var e=Object(R.a)(["\n  margin: 0 8px 5px 8px;\n"]);return jl=function(){return e},e}function Sl(){var e=Object(R.a)(["\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n"]);return Sl=function(){return e},e}var xl=F.b.div(Sl()),Cl=F.b.div(jl()),Tl=Object(F.b)(wt)(kl()),El=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getEntry",value:function(e,t){return j.createElement(Tl,null,e&&j.createElement(Ot,null,e,": "),t&&j.createElement(vt,null,t))}},{key:"render",value:function(){var e=this.props,t=e.ship,n=e.uiState.services.currentUser;return j.createElement(Cl,null,j.createElement(xl,null,this.getEntry("Hit profile","Front: ".concat(t.getFrontHitProfile(),", Side: ").concat(t.getSideHitProfile())),this.getEntry("DEW",t.electronicWarfare.inEffect.getDefensiveEw()),this.getEntry("CCEW",t.electronicWarfare.inEffect.getCcEw())),j.createElement(xl,null,this.getEntry("Movement costs","Acc: ".concat(t.accelcost,", Pivot: ").concat(t.pivotcost,", Evasion: ").concat(t.evasioncost,", Roll: ").concat(t.rollcost))),j.createElement(xl,null,t.player.isUsers(n)&&this.getEntry("Power available",t.systems.power.getRemainingPowerOutput()),t.player.isUsers(n)&&this.getEntry("Planned DEW",t.electronicWarfare.getDefensiveEw()),t.player.isUsers(n)&&this.getEntry("Planned CCEW",t.electronicWarfare.getCcEw())),j.createElement(xl,null,this.getEntry("Heat stored","".concat(Math.round(t.systems.getTotalHeatStored()),"/").concat(t.systems.getTotalHeatStorage())),this.getEntry("Passive heat change",t.systems.getPassiveHeatChange())))}}]),t}(j.Component);function Al(){var e=Object(R.a)(["\n  color: white;\n"]);return Al=function(){return e},e}function Pl(){var e=Object(R.a)(["\n  text-align: left;\n  color: #5e85bc;\n  font-family: arial;\n  font-size: 11px;\n"]);return Pl=function(){return e},e}function Il(){var e=Object(R.a)(["\n  width: 315px;\n  text-align: left;\n  opacity: 0.95;\n  position: absolute;\n  top: 10px;\n  right: 10px;\n  ","\n"]);return Il=function(){return e},e}function Dl(){var e=Object(R.a)(["\n  display: flex;\n  justify-content: space-between;\n"]);return Dl=function(){return e},e}var Ml=Object(F.b)(yt)(Dl()),zl=Object(F.b)(ft)(Il(),(function(e){return e.interactable?"z-index: 4;":"z-index: 1;"})),Rl=(Object(F.b)(wt)(Pl()),F.b.span(Al()),function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).state={tooltipTab:null},n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"selectTooltipTab",value:function(e){this.setState({tooltipTab:e})}},{key:"getMenu",value:function(){var e=this.props,t=e.ui,n=e.shipTooltipMenuProvider;return this.getTooltipTab()?null:t&&n?n():null}},{key:"getTabHeader",value:function(){switch(this.state.tooltipTab){case"toolti_tab_torpedo_attack":return"Torpedo attack";default:return"Ship details"}}},{key:"getTooltipTab",value:function(){var e=this.props,t=e.ship,n=e.uiState,i=this.state.tooltipTab,a=n.services.currentUser,r=t.player.isUsers(a);return"toolti_tab_torpedo_attack"===i&&r?null:i}},{key:"render",value:function(){var e=this.props,t=e.ship,n=(e.getPosition,e.uiState),i=(e.ui,e.shipTooltipMenuProvider,e.className),a=Object(D.a)(e,["ship","getPosition","uiState","ui","shipTooltipMenuProvider","className"]),r=this.getTooltipTab(),s=this.getMenu(),o=Boolean(s)||r;return j.createElement(zl,{className:i,interactable:o},j.createElement(Ml,null,j.createElement("div",null,t.name)," ",j.createElement("div",null,this.getTabHeader())),s&&j.createElement(s,Object.assign({uiState:n,ship:t,selectTooltipTab:this.selectTooltipTab.bind(this)},a)),!r&&j.createElement(j.Fragment,null,s&&j.createElement(al,Object.assign({uiState:n,ship:t},a)),j.createElement(El,{ship:t,uiState:n}),j.createElement(Qc,Object.assign({ship:t,uiState:n},a))),"toolti_tab_torpedo_attack"===r&&j.createElement(wl,Object.assign({ship:t,uiState:n},a)))}}]),t}(j.Component));function Fl(){var e=Object(R.a)(["\n  ","\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 25px;\n  height: 25px;\n"]);return Fl=function(){return e},e}function Hl(){var e=Object(R.a)(["\n  ","\n  padding: 0 5px 0 30px;\n  width: 200px;\n  overflow: hidden;\n"]);return Hl=function(){return e},e}function Ll(){var e=Object(R.a)(["\n  color: white;\n  font-size: 18px;\n  font-weight: bold;\n  font-family: arial;\n  font-size: 16px;\n  text-transform: uppercase;\n"]);return Ll=function(){return e},e}function Bl(){var e=Object(R.a)(["\n  display: flex;\n  align-items: center;\n"]);return Bl=function(){return e},e}var _l=F.b.div(Bl()),Ul=Object(F.a)(Ll()),Nl=F.b.div(Hl(),Ul),Vl=F.b.div(Fl(),Ul),Gl=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.ship,i=e.uiState,a=e.ccew;return j.createElement(_l,null,t&&j.createElement(Nl,null,t),j.createElement(Et,{img:"/img/removeCCEW.png",onClick:function(){n.electronicWarfare.canAssignCcEw(-1)&&(n.electronicWarfare.assignCcEw(-1),i.shipStateChanged(n))}}),j.createElement(Vl,null,a),j.createElement(Et,{img:"/img/addCCEW.png",onClick:function(){n.electronicWarfare.canAssignCcEw(1)&&(n.electronicWarfare.assignCcEw(1),i.shipStateChanged(n))}}))}}]),t}(j.PureComponent),Wl=Gl,ql=function(e){return e.systems.getSystems().filter((function(e){return!e.isDestroyed()})).filter((function(e){return e.callHandler("isRadiator",null,!1)})).filter((function(e){return e.power.canSetOffline()})).filter((function(e){return e.power.isOnline()})).length>0},Zl=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.ship,i=t.uiState,a=t.selectTooltipTab,r=i.services.currentUser,s=i.getSelectedShip();return j.createElement(St,null,n.player.isUsers(r)&&!i.isSelected(n)&&j.createElement(Et,{img:"/img/selectShip.png",onClick:function(){return i.selectShip(n)}}),n.player.isUsers(r)&&j.createElement(Wl,{ship:n,uiState:i,ccew:s.electronicWarfare.getCcEw()}),!n.player.isUsers(r)&&s&&j.createElement(hu,{ship:s,target:n,uiState:i,oew:s.electronicWarfare.getOffensiveEw(n)}),n.player.isUsers(r)&&function(e){return e.systems.getSystems().filter((function(e){return!e.isDestroyed()})).filter((function(e){return e.callHandler("isRadiator",null,!1)})).length>0}(n)&&j.createElement(Et,{img:"/img/system/radiator.png",onClick:function(t){t.preventDefault(),t.stopPropagation(),console.log("hasOnlineradiators",ql(n)),function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.systems.getSystems().filter((function(e){return!e.isDestroyed()})).filter((function(e){return e.callHandler("isRadiator",null,!1)})).filter((function(e){return n?e.power.canSetOnline():e.power.canSetOffline()})).forEach((function(i){n?i.power.setOnline():i.power.setOffline(),t.shipSystemStateChanged(e,i)}))}(n,i,!ql(n)),i.shipStateChanged(n),e.forceUpdate()}}),n.player.isUsers(r)&&function(e){return e.systems.getSystems().filter((function(e){return!e.isDestroyed()})).filter((function(e){return e.callHandler("canIntercept",null,!1)})).length>0}(n)&&j.createElement(Et,{img:"/img/system/gatlingPulseCannon.png",onClick:function(t){t.preventDefault(),t.stopPropagation(),function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.systems.getSystems().filter((function(e){return!e.isDestroyed()})).filter((function(e){return e.callHandler("canIntercept",null,!1)})).filter((function(e){return n?e.power.canSetOnline():e.power.canSetOffline()})).forEach((function(i){n?i.power.setOnline():i.power.setOffline(),t.shipSystemStateChanged(e,i)}))}(n,i,!function(e){return e.systems.getSystems().filter((function(e){return!e.isDestroyed()})).filter((function(e){return e.callHandler("canIntercept",null,!1)})).filter((function(e){return e.power.canSetOffline()})).filter((function(e){return e.power.isOnline()})).length>0}(n)),i.shipStateChanged(n),e.forceUpdate()}}),!n.player.isUsers(r)&&j.createElement(Et,{img:"/img/system/missile1.png",onClick:function(){return a("toolti_tab_torpedo_attack")}}))}}]),t}(j.PureComponent),Kl=Zl,Xl=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"activate",value:function(e){Object(Oa.a)(Object(P.a)(t.prototype),"activate",this).call(this,e),this.services.uiState.setTooltipMenuProvider(this.getTooltipComponent)}},{key:"deactivate",value:function(){Object(Oa.a)(Object(P.a)(t.prototype),"deactivate",this).call(this),this.services.uiState.setTooltipMenuProvider(null)}},{key:"getTooltipComponent",value:function(){return Kl}}]),t}(Oo),Yl=Xl,Ql=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"activate",value:function(e){Object(Oa.a)(Object(P.a)(t.prototype),"activate",this).call(this,e),this.services.uiState.showUiModeButtons(!0)}},{key:"deactivate",value:function(){this.services.uiState.showUiModeButtons(!1)}}]),t}(Oo),Jl=Ql,$l=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){this.services.electronicWarfareIndicatorService.hideAll()}},{key:"update",value:function(e){Object(Oa.a)(Object(P.a)(t.prototype),"update",this).call(this,e),this.show()}},{key:"uiStateChanged",value:function(){this.gameData&&this.show()}},{key:"shipStateChanged",value:function(e){var t=this.services,n=t.electronicWarfareIndicatorService,i=t.uiState;this.gameData&&(i.hasGameUiMode("ew")||i.getSelectedShip()===e)&&n.showForShip(e)}},{key:"mouseOutShip",value:function(){this.show()}},{key:"show",value:function(){var e=this.services,t=e.electronicWarfareIndicatorService,n=e.uiState,i=e.currentUser;if(t.hideAll(),n.hasGameUiMode("ew")&&this.gameData.ships.getUsersShips(i).forEach((function(e){return t.showForShip(e)})),!n.hasGameUiMode(["enemy_weapons","weapons"])){var a=n.getSelectedShip();a&&t.showForShip(a)}}}]),t}(Oo),eh=$l,th=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"shipClicked",value:function(e){var t=this.services,n=t.uiState,i=t.currentUser,a=e.entity.ship;a.player.isUsers(i)&&!n.isSelected(a)&&n.selectShip(a)}}]),t}(Oo),nh=th,ih=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){this.services.electronicWarfareIndicatorService.hideAllCurrent()}},{key:"update",value:function(e){Object(Oa.a)(Object(P.a)(t.prototype),"update",this).call(this,e),this.show()}},{key:"uiStateChanged",value:function(){this.gameData&&this.show()}},{key:"mouseOutShip",value:function(){this.show()}},{key:"show",value:function(){var e=this.services,t=e.electronicWarfareIndicatorService,n=e.uiState,i=e.currentUser;t.hideAllCurrent(),n.hasGameUiMode("enemy_weapons")&&this.gameData.ships.getShipsEnemyTeams(i).forEach((function(e){return t.showCurrentForShip(e)})),n.hasGameUiMode("weapons")&&this.gameData.ships.getShipsInSameTeam(i).forEach((function(e){return t.showCurrentForShip(e)}))}}]),t}(Oo),ah=ih,rh=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).weaponArcs=[],e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){this.hide()}},{key:"systemMouseOver",value:function(e){var t=e.ship,n=e.system;n.callHandler("hasArcs")&&this.show(t,n)}},{key:"systemMouseOut",value:function(){this.hide()}},{key:"hide",value:function(){this.services.scene;this.weaponArcs=this.weaponArcs.filter((function(e){var t=e.mesh,n=e.circle;t.remove(n)}))}},{key:"show",value:function(e,t){for(var n=this,i=this.services,a=i.coordinateConverter,r=i.shipIconContainer.getByShip(e),s=t.callHandler("getMaxRange"),o=s*a.getHexDistance(),u=t.callHandler("getArcs",{facing:r.getFacing()}),c=gs(s+1,1),l=c.getContext("2d"),h=0;h<=s;h++){var d=(100+t.callHandler("getRangeModifier",{distance:h}))/100;d<0&&(d=0),l.fillStyle="rgba(2,80,128,"+d+")",l.fillRect(h,0,1,1)}var m=new Wt.CanvasTexture(c),f=new Wt.MeshBasicMaterial({color:new Wt.Color("rgb(20,80,128)"),opacity:1,transparent:!0,map:m});u.forEach((function(e){var t,i,a=e.start===e.end?360:(t=e.start,i=e.end,t>i?360-t+i:i-t),s=new Wt.CircleGeometry(o,32,Tn(jn(360,-e.end)),Tn(a));s.faceVertexUvs=[s.faceVertexUvs[0].map((function(e){return[new Wt.Vector2(1,0),new Wt.Vector2(1,0),new Wt.Vector2(0,0)]}))],s.uvsNeedUpdate=!0;var u=new Wt.Mesh(s,f);u.position.z=-1,r.mesh.add(u),n.weaponArcs.push({mesh:r.mesh,circle:u})}))}}]),t}(Oo),sh=rh,oh=(new Wt.MeshBasicMaterial({color:new Wt.Color("rgb(20,80,128)"),opacity:.5,transparent:!0}),function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).weaponArcs=[],e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){this.services.uiState.deselectAllSystems()}},{key:"systemClicked",value:function(e){var t=e.ship,n=e.system,i=e.scs,a=this.services,r=a.uiState,s=a.currentUser;!i&&n.isWeapon()&&t.player.is(s)&&(r.isSelectedSystem(n)?r.deselectSystem(n):r.selectSystem(t,n),r.updateState())}}]),t}(Oo)),uh=oh,ch=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){this.services.uiState.setSystemList([])}},{key:"update",value:function(e){var n=this.services.uiState;Object(Oa.a)(Object(P.a)(t.prototype),"update",this).call(this,e);var i=n.getSelectedShip();i&&n.setSystemList(i.systems.getSystems().filter((function(e){return e.showOnSystemList()})))}},{key:"shipSelected",value:function(e){var t=this.services.uiState;this.gameData&&t.setSystemList(e.systems.getSystems().filter((function(e){return e.showOnSystemList()})))}}]),t}(Oo),lh=ch,hh=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.ship,i=t.system,a=t.uiState,r=a.services.currentUser,s=n.player.is(r);a.getSelectedShip();return i.isDestroyed()?null:j.createElement(St,null,s&&n.systems.power.canSetOnline(i)&&j.createElement(Et,{img:"/img/goOnline.png",onClick:function(t){t.preventDefault(),t.stopPropagation(),i.power.setOnline(),a.shipSystemStateChanged(n,i),a.shipStateChanged(n),e.forceUpdate()}}),s&&n.systems.power.canSetOffline(i)&&j.createElement(Et,{img:"/img/goOffline.png",onClick:function(t){t.preventDefault(),t.stopPropagation(),i.power.setOffline(),a.shipSystemStateChanged(n,i),a.shipStateChanged(n),e.forceUpdate()}}),s&&!i.isDisabled()&&i.callHandler("isBoostable",null,!1)&&j.createElement(Et,{img:"/img/plus.png",disabled:!i.callHandler("canBoost",null,!1),onClick:function(t){t.preventDefault(),t.stopPropagation(),i.callHandler("canBoost"),i.callHandler("boost"),a.shipSystemStateChanged(n,i),a.shipStateChanged(n),e.forceUpdate()}}),s&&!i.isDisabled()&&i.callHandler("isBoostable",null,!1)&&j.createElement(Et,{img:"/img/minus.png",disabled:!i.callHandler("canDeBoost",null,!1),onClick:function(t){t.preventDefault(),t.stopPropagation(),i.callHandler("canDeBoost",null,!1)&&(i.callHandler("deBoost"),a.shipSystemStateChanged(n,i),a.shipStateChanged(n),e.forceUpdate())}}),i.callHandler("getTooltipMenuButton",{uiState:a,myShip:s},[]).map((function(t,r){var s=t.img,o=t.disabledHandler,u=t.onClickHandler;return j.createElement(Et,{key:"custom-system-tooltip-button-".concat(r),img:s,disabled:o,onClick:function(t){t.preventDefault(),t.stopPropagation(),u(),a.shipSystemStateChanged(n,i),a.shipStateChanged(n),e.forceUpdate()}})})))}}]),t}(j.PureComponent),dh=hh,mh=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"activate",value:function(e){Object(Oa.a)(Object(P.a)(t.prototype),"activate",this).call(this,e),this.services.uiState.setSystemInfoMenuProvider(this.getTooltipComponent)}},{key:"deactivate",value:function(){Object(Oa.a)(Object(P.a)(t.prototype),"deactivate",this).call(this),this.services.uiState.setSystemInfoMenuProvider(null)}},{key:"getTooltipComponent",value:function(){return dh}}]),t}(Oo),fh=mh,ph=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).clickedSystem=null,e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"shipStateChanged",value:function(){var e=this.services.uiState;this.clickedSystem&&e.setSystemMenuActiveSystem(this.clickedSystem,this.element)}},{key:"closeSystemInfo",value:function(){this.hide()}},{key:"deactivate",value:function(){var e=this.services.uiState;this.clickedShip&&e.setSystemMenuActiveSystem(null,null)}},{key:"systemClicked",value:function(e){var t=e.system,n=e.element,i=e.scs,a=this.services.uiState;i&&(this.clickedSystem=t,this.element=n,a.setSystemMenuActiveSystem(this.clickedSystem,this.element))}},{key:"hexClicked",value:function(){this.hide()}},{key:"mouseOverShip",value:function(e){this.hide()}},{key:"mouseOutShip",value:function(){this.hide()}},{key:"hide",value:function(){this.clickedSystem&&(this.services.uiState.setSystemMenuActiveSystem(null,null),this.clickedSystem=null,this.element=null)}}]),t}(Oo),vh=ph,gh=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){this.services.uiState.setEwList([])}},{key:"shipStateChanged",value:function(){var e=this.services.uiState,t=e.getSelectedShip();e.setEwList(t.electronicWarfare.getAllOew())}},{key:"shipSelected",value:function(e){var t=this.services.uiState;this.gameData&&t.setEwList(e.electronicWarfare.getAllOew())}}]),t}(Oo),yh=gh,bh=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).showing=!1,e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"show",value:function(){var e=this.services,t=e.shipIconContainer,n=e.currentUser;t.getArray().forEach((function(e){e.hexSpriteContainer.visible=!0;var t=e.ship.player.isUsers(n)?Xt:Yt;e.hexSprites.forEach((function(e){return e.setOverlayColor(t)})),e.line.setColor(t),e.line.show()})),this.showing=!0}},{key:"hide",value:function(){this.services.shipIconContainer.getArray().forEach((function(e){e.hexSpriteContainer.visible=!1,e.line.hide()})),this.showing=!1}},{key:"update",value:function(e){Object(Oa.a)(Object(P.a)(t.prototype),"update",this).call(this,e),this.show()}},{key:"render",value:function(e){var t=e.zoom;t>4&&this.showing&&this.hide(),t<=4&&!this.showing&&this.show()}},{key:"deactivate",value:function(){this.hide()}}]),t}(Oo),Oh=bh,wh=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).zoom=1,e.showingIcons=!1,e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"showHighligh",value:function(e){var t=this.services.currentUser,n=e.ship.player.isUsers(t)?Qt:Jt;e.mapIcon.replaceColor(n)}},{key:"hideHighligh",value:function(){var e=this.services,t=e.shipIconContainer;e.currentUser;t.getArray().forEach((function(e){t.getGhostShipIconByShip(e.ship).mapIcon.revertColor(),e.mapIcon.revertColor()}))}},{key:"mouseOverShip",value:function(e){var t=e.entity;this.showHighligh(t)}},{key:"uiStateChanged",value:function(){this.shouldShow(this.zoom,!0)}},{key:"shipStateChanged",value:function(){this.shouldShow(this.zoom,!0)}},{key:"mouseOutShip",value:function(){this.hideHighligh(),this.shouldShow(this.zoom,!0)}},{key:"mouseOut",value:function(){this.hideHighligh()}},{key:"showIcons",value:function(){this.changeScale(1);var e=this.services,t=e.shipIconContainer,n=e.currentUser,i=e.gameCamera;t.getArray().forEach((function(e){var i=e.ship.player.isUsers(n)?Xt:Yt;t.getGhostShipIconByShip(e.ship).showMapIcon(i),e.showMapIcon(i)})),this.showingIcons=!0,i.changeToMapView()}},{key:"hideIcons",value:function(){this.changeScale(1);var e=this.services,t=e.shipIconContainer,n=e.gameCamera;t.getArray().forEach((function(e){e.hideMapIcon(),t.getGhostShipIconByShip(e.ship).hideMapIcon()})),this.showingIcons=!1,n.changeToCloseView()}},{key:"changeScale",value:function(e){var t=this.services.shipIconContainer;t.getArray().forEach((function(n){n.mapIcon.setScale(e),t.getGhostShipIconByShip(n.ship).mapIcon.setScale(e)}))}},{key:"shouldShow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.services&&(e>4&&(t||!this.showingIcons)&&this.showIcons(),e<=4&&(t||this.showingIcons)&&this.hideIcons(),e>4)){var n=e;this.changeScale(n)}}},{key:"render",value:function(e){var t=e.zoom;t!==this.zoom&&(this.zoom=t,this.shouldShow(t))}},{key:"deactivate",value:function(){Object(Oa.a)(Object(P.a)(t.prototype),"deactivate",this).call(this),this.hideIcons()}}]),t}(No),kh=wh,jh=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).zoom=1,e.showing=!1,e.showingName=!1,e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"shipStateChanged",value:function(e){this.show(e)}},{key:"updateShip",value:function(e){var t=this.services,n=t.shipIconContainer,i=t.uiState,a=n.getByShip(e);i.showShipBadge(a)}},{key:"show",value:function(e){var t=this.services,n=t.shipIconContainer,i=t.uiState;n.getArray().forEach((function(t){i.showShipBadge(t,e)})),this.showing=!0,this.showingName=e}},{key:"hide",value:function(){var e=this.services,t=e.shipIconContainer,n=e.uiState;t.getArray().forEach((function(e){n.hideShipBadge(e)})),this.showing=!1}},{key:"shouldShow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.services&&(e>2&&(t||this.showing)&&this.hide(),e<=2&&(!t&&this.showing||this.show()))}},{key:"render",value:function(e){var t=e.zoom;this.zoom=t,this.shouldShow(t)}},{key:"deactivate",value:function(){this.hide()}}]),t}(No),Sh=jh,xh=function(e){function t(){var e;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).torpedoMovementService=new hl,e.movementService=new fa,e.lines=[],e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"update",value:function(e){var n=this;Object(Oa.a)(Object(P.a)(t.prototype),"update",this).call(this,e),e.torpedos.getTorpedoFlights().forEach((function(t){var i=e.ships.getShipById(t.targetId);n.torpedoMovementService.reachesTargetThisTurn(t,i)?n.handleImpactingTorpedo(t,i):n.handleTorpedo(t)}))}},{key:"shipStateChanged",value:function(e){var t=this;this.gameData&&this.gameData.torpedos.getTorpedoFlights().filter((function(t){return t.targetId===e.id})).forEach((function(n){t.torpedoMovementService.reachesTargetThisTurn(n,e)&&t.handleImpactingTorpedo(n,e)}))}},{key:"handleImpactingTorpedo",value:function(e,t){var n=this.services,i=n.torpedoIconContainer,a=n.scene,r=n.shipIconContainer,s=i.getIconByTorpedoFlight(e),o=kn(s.torpedoFlight.id),u=new Rn(100*o()-50,100*o()-50),c=e.launchPosition,l=this.movementService.getNewEndMove(t,this.gameData.terrain).position,h=c.sub(l).normalize().multiplyScalar(500).add(l).setZ(30).add(u);s.setPosition(h),s.setFacing(-En(e.position,e.position.add(e.velocity)));var d=this.lines.find((function(n){var i=n.flightId,a=n.targetId;return i===e.id&&a===t.id}));d?d.line.update(h,l.setZ(r.getByShip(t).shipZ),2):((d=new _s(a,{start:h,end:l.setZ(r.getByShip(t).shipZ),width:2,color:new Wt.Color(1,40/255,40/255),opacity:.01,pulseAmount:1})).show(),this.lines.push({targetId:t.id,flightId:e.id,line:d})),s.show()}},{key:"handleTorpedo",value:function(e){var t=this.services.torpedoIconContainer.getIconByTorpedoFlight(e),n=kn(t.torpedoFlight.id),i=new Rn(30*n()-15,30*n()-15);t.setPosition(e.position.setZ(30).add(i)),t.setFacing(-En(e.position,e.position.add(e.velocity))),t.show()}},{key:"deactivate",value:function(){return this.services.torpedoIconContainer.getArray().forEach((function(e){e.hide()}),this),this.lines.forEach((function(e){return e.line.destroy()})),Object(Oa.a)(Object(P.a)(t.prototype),"deactivate",this).call(this)}}]),t}(No),Ch=xh,Th=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).strategies=[new nh,new Go,new So,new qo,new wo,new Vo,new Wo,new Zo,new ko,new Ko,new Xo,new Yo],n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"commitTurn",value:function(e){e.commitDeployment(this.gameData)}}]),t}(yo),Eh=Th,Ah=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),t}(yo),Ph=Ah,Ih=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).strategies=[new Qo,new Go,new qo,new wo,new Vo,new Wo],n}return Object(I.a)(t,e),t}(yo),Dh=Ih,Mh=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).strategies=[new nh,new qo,new Vo,new Wo,new Jo,new ko,new jo,new $o,new eu,new Yl,new Jl,new eh,new ah,new sh,new uh,new lh,new fh,new vh,new yh,new Oh,new kh,new Sh,new Ch],n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"commitTurn",value:function(e){e.commitTurn(this.gameData)}}]),t}(yo),zh=Mh,Rh=function(e){function t(e,n,i,a){var r;return Object(T.a)(this,t),(r=Object(A.a)(this,Object(P.a)(t).call(this))).shipIcon=e,r.endMove=n,r.start=i,r.end=a,r.duration=a-i,r.positionCurve=r.buildPositionCurve(n.position,n.position.add(n.velocity)),Fn.call(Object(xo.a)(r)),r}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){}},{key:"update",value:function(e){}},{key:"cleanUp",value:function(){}},{key:"getPositionAt",value:function(e){var t=this.getMovementTurnDone({total:e});if(-1===t)throw new Error("Don't ask ShipVelocityAnimation");var n=t<1?t%1:1;return{facing:this.endMove.facing,position:this.positionCurve.getPoint(n)}}},{key:"getMovementTurnDone",value:function(e){var t=e.total;return t<this.start?-1:t>this.end?1:(t-this.start)/this.duration}},{key:"render",value:function(e){var t=this.getMovementTurnDone(e);if(-1!==t){var n=t<1?t%1:1;this.shipIcon.setPosition(this.positionCurve.getPoint(n)),this.shipIcon.setFacing(-An(this.endMove.facing))}}},{key:"buildPositionCurve",value:function(e,t){var n=e.roundToHexCenter(),i=e.roundToHexCenter(),a=t.roundToHexCenter(),r=t.roundToHexCenter();return new Wt.CubicBezierCurve3(new Wt.Vector3(n.x,n.y,n.z),new Wt.Vector3(i.x,i.y,i.z),new Wt.Vector3(a.x,a.y,a.z),new Wt.Vector3(r.x,r.y,r.z))}}]),t}(Fn),Fh=Rh,Hh=function(){function e(t){Object(T.a)(this,e),this.firingDuration=0,this.movementDuration=0,this.torpedoMovementDuration=0,this.velocityDuration=0,this.torpedoAttackDuration=0,this.phaseStrategy=t}return Object(E.a)(e,[{key:"getTorpedoMovementStart",value:function(){return this.movementDuration}},{key:"setTorpedoMovementDuration",value:function(e){this.torpedoMovementDuration=e}},{key:"setMovementDuration",value:function(e){this.movementDuration=e}},{key:"setVelocityDuration",value:function(e){this.velocityDuration=e}},{key:"getVelocityStart",value:function(){return this.movementDuration+this.torpedoMovementDuration+this.firingDuration+this.torpedoAttackDuration}},{key:"getNextFireStart",value:function(){return this.movementDuration+this.torpedoMovementDuration+this.firingDuration}},{key:"addFireAnimationDuration",value:function(e){this.firingDuration+=e}},{key:"getNextTorpedoAttackStart",value:function(){return this.movementDuration+this.torpedoMovementDuration+this.firingDuration+this.torpedoAttackDuration}},{key:"addTorpedoAttackAnimationDuration",value:function(e){this.torpedoAttackDuration+=e}},{key:"resumeReplayRewind",value:function(){this.phaseStrategy.unpauseAndRewindAnimation()}},{key:"pauseReplay",value:function(){this.phaseStrategy.pauseAnimation()}},{key:"resumeReplay",value:function(){this.phaseStrategy.unpauseAnimation()}},{key:"rewindToFiring",value:function(){this.phaseStrategy.setAnimationTime(this.movementDuration+this.torpedoMovementDuration-1)}},{key:"rewindToMovement",value:function(){}},{key:"getTurnLength",value:function(){return this.firingDuration+this.movementDuration+this.velocityDuration+this.torpedoAttackDuration}},{key:"wrapGetShootingPosition",value:function(e){var t=this;return function(n){return t.getShootingPosition(n,e)}}},{key:"getShootingPosition",value:function(e,t){var n=t.find((function(t){return t instanceof Io&&t.shipIcon===e}));if(!n)throw new Error("Animation not found");return n.getEndPosition()}}]),e}(),Lh=Hh,Bh=new zo,_h=function(){function e(t,n){Object(T.a)(this,e),this.getRandom=t,this.particleEmitterContainer=n}return Object(E.a)(e,[{key:"getBoltEffect",value:function(e,t,n,i,a,r,s,o){return Bh.create(e,t,n,i,a,r,s,this.getRandom,this.particleEmitterContainer,o)}},{key:"getDamageExplosion",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"glow",n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return new Bo(this.particleEmitterContainer,this.getRandom,{position:n.clone(),time:i,duration:250+250*this.getRandom(),type:t,size:e||10},a)}}]),e}(),Uh=_h,Nh=function(){function e(t){Object(T.a)(this,e),this.shipId=t,this.replayOrder=1}return Object(E.a)(e,[{key:"serialize",value:function(){return{logEntryClass:this.constructor.name,shipId:this.shipId}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.shipId=e.shipId,this}}]),e}(),Vh=Nh,Gh=function(){function e(t){Object(T.a)(this,e),this.shipId=t,this.replayOrder=10}return Object(E.a)(e,[{key:"serialize",value:function(){return{logEntryClass:this.constructor.name,shipId:this.shipId}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.shipId=e.shipId,this}}]),e}(),Wh=Gh,qh=function(e){function t(e,n,i,a){var r;return Object(T.a)(this,t),r=Object(A.a)(this,Object(P.a)(t).call(this)),Fn.call(Object(xo.a)(r)),r.time=n,r.position=e,r.lastTime=null,r.endTime=0,r.gameCamera=a,r.duration=1e3,void 0===i&&(r.endTime=300),r.startPosition=null,r.curve=new Wt.CubicBezierCurve(new Wt.Vector2(0,0),new Wt.Vector2(.5,0),new Wt.Vector2(.5,1),new Wt.Vector2(1,1)),r}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(e){var t=e.now,n=e.total,i=e.last,a=e.delta,r=e.zoom,s=e.back;e.paused;this.smoothMove(t,n,i,a,r,s)}},{key:"smoothMove",value:function(e,t,n,i,a,r,s){if(!r)if(t>this.time&&t<this.time+this.duration&&!s){null===this.startPosition&&(this.startPosition=this.gameCamera.getLookAtPosition());var o=1-(this.time+this.duration-t)/this.duration,u=this.curve.getPoint(o).y,c=function(e,t,n,i){var a=e.x+n*(t.x-e.x),r=e.y+n*(t.y-e.y);return i?{x:a,y:r}:{x:Math.floor(a),y:Math.floor(r)}}(this.startPosition,this.position,u,!0);this.doMove(c)}else this.startPosition=null}},{key:"instantMove",value:function(e,t,n,i,a,r){r||(null!==this.lastTime&&this.lastTime<this.time&&t>this.time&&this.doMove(this.position),this.lastTime=t)}},{key:"doMove",value:function(e){this.gameCamera.setByLookAtPosition(e)}}]),t}(Fn),Zh=qh,Kh=function(){function e(t){Object(T.a)(this,e),this.deserialize(t)}return Object(E.a)(e,[{key:"serialize",value:function(){return{baseToHit:this.baseToHit,fireControl:this.fireControl,dew:this.dew,oew:this.oew,distance:this.distance,evasion:this.evasion,rangeModifier:this.rangeModifier,result:this.result,absoluteResult:this.absoluteResult,outOfRange:this.outOfRange,rollingPenalty:this.rollingPenalty}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.baseToHit=e.baseToHit||0,this.fireControl=e.fireControl||0,this.dew=e.dew||0,this.oew=e.oew||0,this.distance=e.distance||0,this.rangeModifier=e.rangeModifier||0,this.result=e.result||0,this.absoluteResult=e.absoluteResult||0,this.outOfRange=e.outOfRange||!1,this.evasion=e.evasion||0,this.rollingPenalty=e.rollingPenalty||0,this}}]),e}(),Xh=Kh,Yh=function(){function e(t,n,i){Object(T.a)(this,e),this.result=t,this.hitChange=n,this.hitRoll=i}return Object(E.a)(e,[{key:"serialize",value:function(){return{result:this.result,hitChange:this.hitChange.serialize(),hitRoll:this.hitRoll}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.result=e.result||!1,this.hitChange=(new Xh).deserialize(e.hitChange),this.hitRoll=e.hitRoll||1,this}}]),e}(),Qh=Yh,Jh=function(){function e(t,n,i,a){Object(T.a)(this,e),this.fireOrderId=t,this.targetId=n,this.shooterId=i,this.damages=[],this.notes=[],this.hitResult=null,this.ammoName=a?a.getShortDisplayName():null}return Object(E.a)(e,[{key:"addNote",value:function(e){this.notes.push(e)}},{key:"addDamage",value:function(e){this.damages.push(e)}},{key:"addHitResult",value:function(e){this.hitResult=e}},{key:"setShots",value:function(e,t){this.shotsHit=e,this.totalShots=t}},{key:"causedDamage",value:function(){return this.damages.length>0}},{key:"getDamages",value:function(e){return this.damages.reduce((function(t,n){return[].concat(Object(ta.a)(t),Object(ta.a)(n.entries.reduce((function(t,n){var i=e.systems.getSystemById(n.systemId);return[].concat(Object(ta.a)(t),Object(ta.a)(n.damageIds.map((function(e){return i.damage.getDamageById(e)}))))}),[])))}),[])}},{key:"getDestroyedSystems",value:function(e){return this.getDamages(e).filter((function(e){return e.destroyedSystem})).map((function(e){return e.system}))}},{key:"serialize",value:function(){return{logEntryClass:this.constructor.name,fireOrderId:this.fireOrderId,targetId:this.targetId,shooterId:this.shooterId,damages:this.damages.map((function(e){return e.serialize()})),notes:this.notes,hitResult:this.hitResult?this.hitResult.serialize():null,shotsHit:this.shotsHit,totalShots:this.totalShots,ammoName:this.ammoName}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.fireOrderId=e.fireOrderId,this.targetId=e.targetId,this.shooterId=e.shooterId,this.damages=e.damages.map((function(e){return(new fr).deserialize(e)})),this.notes=e.notes||[],this.hitResult=e.hitResult?(new Qh).deserialize(e.hitResult):null,this.shotsHit=e.shotsHit||0,this.totalShots=e.totalShots||0,this.ammoName=e.ammoName||null,this}}]),e}(),$h=Jh,ed=function(){function e(t){Object(T.a)(this,e),this.targetId=t,this.entries=[],this.replayOrder=5}return Object(E.a)(e,[{key:"addEntry",value:function(e){this.entries.push(e)}},{key:"serialize",value:function(){return{logEntryClass:this.constructor.name,entries:this.entries.map((function(e){return e.serialize()}))}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.targetId=e.targetId,this.entries=e.entries?e.entries.map((function(e){return(new $h).deserialize(e)})):[],this}}]),e}(),td=ed,nd=function(e,t,n){var i=null;return(i=e.structure?new Ms(e.toUpperCase(),"rgba(255, 100, 45, 0.7)",t.z+30,{fontSize:"24px",size:512}):new Ms(e.toUpperCase(),"rgba(255, 255, 255, 0.7)",t.z+30,{fontSize:"18px",size:512})).setPosition(t),i.setOpacity(0),n.add(i.mesh),i},id=function(e,t,n){var i=ad(e,n);if(0===i.length)return t;for(;rd(t,i);)t+=200;return t},ad=function(e,t){var n=Dn.fromGameToHex(e);return t.filter((function(e){return Dn.fromGameToHex(e.position).equals(n)}))},rd=function(e,t){return t.some((function(t){return t.time-e<200&&t.time-e>-200}))},sd=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).scene=e,n.duration=1e3,n.fadeOutSpeed=2e3,n.velocity=.1,n.destroyedTexts=[],n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){var e=this;this.destroyedTexts.forEach((function(t){e.scene.remove(t.sprite.mesh),t.sprite.destroy()}),this),this.destroyedTexts=[]}},{key:"add",value:function(e,t,n){var i=this;(t=[].concat(t)).filter(Boolean).forEach((function(t){i.destroyedTexts.push({time:id(e,n,i.destroyedTexts),position:e,sprite:nd(t,e,i.scene)})}),this)}},{key:"render",value:function(e){var t=this,n=(e.now,e.total),i=(e.last,e.delta,e.zoom);this.destroyedTexts.forEach((function(e){var a=e.time,r=e.sprite;if(n<a||n>a+t.duration+t.fadeOutSpeed)r.setOpacity(0);else{r.setScale(i,i);var s=n-a,o=Object(pi.a)({},e.position,{y:e.position.y+t.velocity*i*s});r.setPosition(o);var u=n-(a+t.duration);if(u<0)r.setOpacity(1);else{var c=1-u/t.fadeOutSpeed;r.setOpacity(c)}}}),this)}},{key:"getDuration",value:function(){return 0}}]),t}(Fn),od=sd,ud=function(e){function t(e,n,i,a,r){var s,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Object(T.a)(this,t),(s=Object(A.a)(this,Object(P.a)(t).call(this))).icon=e,s.start=a,s.end=r,s.duration=r-a,s.startPosition=n,s.endPosition=i,s.interceptTime=u,s.launch=o,s.impact=c,s.positionCurve=s.buildPositionCurve(n,i);var l=kn(e.torpedoFlight.id);return s.variance=new Rn(30*l()-15,30*l()-15),Fn.call(Object(xo.a)(s)),s}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){this.icon.hide()}},{key:"update",value:function(e){}},{key:"cleanUp",value:function(){}},{key:"getPositionAt",value:function(e){var t=this.getMovementTurnDone({total:e});if(-1===t)throw new Error("Don't ask ShipVelocityAnimation");var n=t<1?t%1:1;return{facing:this.endMove.facing,position:this.positionCurve.getPoint(n)}}},{key:"getInterceptPosition",value:function(){var e=this.getMovementTurnDone({total:this.interceptTime}),t=e<1?e%1:1,n=this.positionCurve.getPoint(t);return new Rn(n)}},{key:"getMovementTurnDone",value:function(e){var t=e.total;return t<this.start?0:t>this.end?1:(t-this.start)/this.duration}},{key:"render",value:function(e){var t=e.total,n=this.getMovementTurnDone({total:t});if(null!==this.interceptTime&&t>this.interceptTime)this.icon.hide();else if(0===n&&this.launch)this.icon.hide();else{var i=n<1?n%1:1;if(1===n&&this.impact)this.icon.hide();else{this.icon.show();var a=this.positionCurve.getPoint(i);this.icon.setPosition({x:a.x+this.variance.x,y:a.y+this.variance.y,z:a.z}),this.icon.setFacing(-En(this.startPosition,this.endPosition))}}}},{key:"buildPositionCurve",value:function(e,t){var n=e,i=e,a=t,r=t;return this.impact?new Wt.LineCurve3(new Wt.Vector3(n.x,n.y,n.z),new Wt.Vector3(r.x,r.y,r.z)):new Wt.CubicBezierCurve3(new Wt.Vector3(n.x,n.y,n.z),new Wt.Vector3(i.x,i.y,i.z),new Wt.Vector3(a.x,a.y,a.z),new Wt.Vector3(r.x,r.y,r.z))}}]),t}(Fn),cd=ud,ld=function(){function e(t,n,i,a){Object(T.a)(this,e),this.torpedoFlightId=t,this.startPosition=n,this.endPosition=i,this.velocity=a,this.replayOrder=4}return Object(E.a)(e,[{key:"serialize",value:function(){return{logEntryClass:this.constructor.name,torpedoFlightId:this.torpedoFlightId,startPosition:this.startPosition,endPosition:this.endPosition,velocity:this.velocity}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.torpedoFlightId=e.torpedoFlightId,this.startPosition=new Rn(e.startPosition),this.endPosition=new Rn(e.endPosition),this.velocity=new Rn(e.velocity),this}}]),e}(),hd=ld,dd=function(){function e(t,n){Object(T.a)(this,e),this.torpedoFlightId=t,this.targetId=n,this.damages=[],this.notes=[]}return Object(E.a)(e,[{key:"addNote",value:function(e){this.notes.push(e)}},{key:"addDamage",value:function(e){this.damages.push(e)}},{key:"getDamages",value:function(e){return this.damages.reduce((function(t,n){return[].concat(Object(ta.a)(t),Object(ta.a)(n.entries.reduce((function(t,n){var i=e.systems.getSystemById(n.systemId);return[].concat(Object(ta.a)(t),Object(ta.a)(n.damageIds.map((function(e){return i.damage.getDamageById(e)}))))}),[])))}),[])}},{key:"getDestroyedSystems",value:function(e){return this.getDamages(e).filter((function(e){return e.destroyedSystem})).map((function(e){return e.system}))}},{key:"serialize",value:function(){return{logEntryClass:this.constructor.name,torpedoFlightId:this.torpedoFlightId,damages:this.damages.map((function(e){return e.serialize()})),notes:this.notes,targetId:this.targetId}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.torpedoFlightId=e.torpedoFlightId,this.targetId=e.targetId,this.damages=e.damages.map((function(e){return(new fr).deserialize(e)})),this.notes=e.notes||[],this}}]),e}(),md=dd,fd=function(){function e(t){Object(T.a)(this,e),this.targetId=t,this.entries=[],this.replayOrder=6}return Object(E.a)(e,[{key:"addEntry",value:function(e){this.entries.push(e)}},{key:"serialize",value:function(){return{logEntryClass:this.constructor.name,entries:this.entries.map((function(e){return e.serialize()}))}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.targetId=e.targetId,this.entries=e.entries?e.entries.map((function(e){return(new md).deserialize(e)})):[],this}}]),e}(),pd=fd,vd=function(e){function t(e,n,i,a,r){var s;Object(T.a)(this,t),(s=Object(A.a)(this,Object(P.a)(t).call(this))).particleEmitterContainer=i,s.animations=[];var o=r.visuals.explosionSize;return s.animations.push(new Bo(i,a,{position:e,time:n,duration:250+250*a(),type:"gas",size:a()*(.3*o)+o,color:new Wt.Color(.2,163/255,1)},Object(xo.a)(s))),s.animations.push(new Bo(i,a,{position:e,time:n,duration:250+250*a(),type:"glow",size:a()*(.2*o)+.4*o},Object(xo.a)(s))),s}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){return this.particleEmitterContainer.release(this),Object(Oa.a)(Object(P.a)(t.prototype),"deactivate",this).call(this)}}]),t}(Fn),gd=vd,yd=function(e){function t(e,n,i,a,r,s){var o;Object(T.a)(this,t),(o=Object(A.a)(this,Object(P.a)(t).call(this))).particleEmitterContainer=i,o.animations=[];for(var u=new Wt.Color(1.5*r.visuals.engineColor[0],1.5*r.visuals.engineColor[1],1.5*r.visuals.engineColor[2]),c=0;c<s;c++){var l=360*a(),h=(new Rn).setFromAngle(l).multiplyScalar(10*a()).add(e);o.animations.push(new Bo(i,a,{position:h,time:n+500*a(),duration:100+250*a(),type:"glow",size:2,color:u,opacity:.25},Object(xo.a)(o)))}return o}return Object(I.a)(t,e),Object(E.a)(t,[{key:"deactivate",value:function(){return this.particleEmitterContainer.release(this),Object(Oa.a)(Object(P.a)(t.prototype),"deactivate",this).call(this)}}]),t}(Fn),bd=yd,Od=function(e,t){return e.reduce((function(e,n){return[].concat(Object(ta.a)(e),Object(ta.a)(n.ships.getShipById(t.id).movement.getMovement()))}),[])},wd=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).replayContext=e,n.systemDestroyedTextAnimation=null,n.ready=!1,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"newTurn",value:function(e){var t,n,i,a,r,s,o=this;return Zt.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:return t=this.services,n=t.shipIconContainer,i=t.particleEmitterContainer,a=t.uiState,r=t.scene,u.next=3,Zt.a.awrap(n.shipsLoaded());case 3:return u.next=5,Zt.a.awrap(i.ready());case 5:s=e[0],this.getRandom=kn("id"+s.id+"turn"+s.turn),a.startCombatLog(this.replayContext,s),this.systemDestroyedTextAnimation=new od(r),this.animations.push(this.systemDestroyedTextAnimation),s.combatLog.getForReplay().forEach((function(t){t instanceof Vh?o.buildMovementAnimation(t,e):t instanceof Wh?o.buildVelocityAnimation(t,e):t instanceof td?o.buildWeaponFireAnimation(t,e):t instanceof hd?o.buildTorpedoMoveAnimation(t,e):t instanceof pd&&o.buildTorpedoAttackAnimation(t,e)}));case 11:case"end":return u.stop()}}),null,this)}},{key:"buildInterceptAnimation",value:function(e,t,n,i,a){var r=this,s=this.services,o=s.particleEmitterContainer,u=s.shipIconContainer,c=new Uh(this.getRandom,o);n.forEach((function(n){var s=e.ships.getShipById(n.shipId),l=s.systems.getSystemById(n.weaponId);if(n.isSucessfull()){var h=l.callHandler("getWeaponFireAnimationName");if(h){var d=new(Uo["ShipWeapon".concat(h.charAt(0).toUpperCase()+h.slice(1),"Animation")])({getRandom:r.getRandom,particleEmitterContainer:o,weapon:l,getPosition:r.replayContext.wrapGetShootingPosition(r.animations),args:l.callHandler("getWeaponFireAnimationArguments"),weaponAnimationService:c,targetIcon:t,shooterIcon:u.getByShip(s),animationStartTime:r.replayContext.getVelocityStart(),impactPosition:a,impactTime:i,totalShots:l.callHandler("getTotalBurstSize",null,1),shotsHit:n.isSucessfull()?1:0,omitHitExplosion:!0});r.animations.push(d)}}}))}},{key:"buildTorpedoAttackAnimation",value:function(e,t){var n=this,i=this.services,a=i.shipIconContainer,r=i.gameCamera,s=i.particleEmitterContainer,o=i.torpedoIconContainer,u=i.uiState,c=t[0],l=this.replayContext.getNextTorpedoAttackStart(),h=l+2e3,d=c.ships.getShipById(e.targetId),m=a.getByShip(d),f=this.replayContext.getShootingPosition(m,this.animations).position;this.animations.push(new Zh(f,l,h,r)),e.entries.forEach((function(e){var t=c.torpedos.getTorpedoFlightById(e.torpedoFlightId);u.addToCombatLog(e);var i=c.combatLog.getInterceptsFor(e),a=i.some((function(e){return e.isSucessfull()})),r=a?h+2e3+1e3*n.getRandom():null,l=new Rn(f).setZ(m.shipZ).add(new Rn(30*n.getRandom()-15,30*n.getRandom()-15,0)),p=t.launchPosition,v=p.sub(l).normalize().multiplyScalar(1e3).add(l).setZ(30),g=h+3e3+500*n.getRandom(),y=new cd(o.getIconByTorpedoFlight(t),v,l,h,g,1===t.turnsActive,r,!0),b=e.getDestroyedSystems(d);b.length>0&&n.systemDestroyedTextAnimation.add(new Rn(l.x,l.y,l.z),b.map((function(e){return e.getDisplayName()})),g);var O=l.sub(p).normalize().multiplyScalar(1e3/3e3).multiplyScalar(.5),w=y.getInterceptPosition();if(n.animations.push(y),n.buildInterceptAnimation(c,m,i,r,w),a)n.animations.push(new Bo(s,n.getRandom,{position:w,time:r,duration:250+250*n.getRandom(),type:"glow",size:5*n.getRandom()+5,color:new Wt.Color(1,.9,.8),velocity:O},n));else switch(t.torpedo.visuals.explosionType){case"HE":n.animations.push(new gd(l,g,s,n.getRandom,t.torpedo));break;case"MSV":n.animations.push(new bd(l,g,s,n.getRandom,t.torpedo,e.damages.length));break;default:n.animations.push(new gd(l,g,s,n.getRandom))}})),this.replayContext.addTorpedoAttackAnimationDuration(6e3)}},{key:"buildTorpedoMoveAnimation",value:function(e,t){var n=this.services.torpedoIconContainer,i=this.replayContext.getTorpedoMovementStart();this.replayContext.setTorpedoMovementDuration(3e3);var a=t[0].torpedos.getTorpedoFlightById(e.torpedoFlightId),r=i+2e3*this.getRandom(),s=i+3e3+1e3*this.getRandom(),o=new cd(n.getIconByTorpedoFlight(a),e.startPosition.setZ(30),e.endPosition.setZ(30),r,s,1===a.turnsActive);this.animations.push(o)}},{key:"buildWeaponFireAnimation",value:function(e,t){var n=this,i=this.services,a=i.shipIconContainer,r=i.gameCamera,s=i.particleEmitterContainer,o=i.uiState,u=t[0],c=(new rs).update(u),l=new Uh(this.getRandom,s),h=this.replayContext.getNextFireStart(),d=h+2e3,m=0,f=u.ships.getShipById(e.targetId),p=a.getByShip(f),v=this.replayContext.getShootingPosition(p,this.animations),g=(v.facing,v.position);this.animations.push(new Zh(g,h,d,r)),e.entries.forEach((function(e){var t=c.getFireOrderById(e.fireOrderId);o.addToCombatLog(e);var i=u.ships.getShipById(t.shooterId),r=i.systems.getSystemById(t.weaponId),h=r.callHandler("getWeaponFireAnimationName");if(h){var v=new(Uo["ShipWeapon".concat(h.charAt(0).toUpperCase()+h.slice(1),"Animation")])({getRandom:n.getRandom,particleEmitterContainer:s,weapon:r,getPosition:n.replayContext.wrapGetShootingPosition(n.animations),args:r.callHandler("getWeaponFireAnimationArguments"),weaponAnimationService:l,targetIcon:p,shooterIcon:a.getByShip(i),animationStartTime:d,totalShots:e.totalShots,shotsHit:e.shotsHit});n.animations.push(v);var y=v.getDuration();y>m&&(m=y);var b=e.getDestroyedSystems(f);b.length>0&&n.systemDestroyedTextAnimation.add(new Rn(g.x,g.y,g.z+p.shipZ),b.map((function(e){return e.getDisplayName()})),d+y-1e3)}})),this.replayContext.addFireAnimationDuration(2e3+m)}},{key:"buildVelocityAnimation",value:function(e,t){var n=this.services.shipIconContainer,i=this.replayContext.getVelocityStart();this.replayContext.setVelocityDuration(5e3);var a=n.getById(e.shipId),r=a.ship;a.show(),this.animations.push(new Fh(a,function(e,t){return Od(e,t).pop()}(t,r),i,i+5e3))}},{key:"buildMovementAnimation",value:function(e,t){var n=this.services.shipIconContainer.getById(e.shipId),i=n.ship;n.show();var a=new Io(n,Od(t,i),0,5e3);a.doesMove()&&(console.log("animation moves"),this.replayContext.setMovementDuration(5e3)),this.animations.push(a),this.animations.push(new Mo(n,t[0].ships.getShipById(n.ship.id)))}},{key:"deactivate",value:function(){var e=this.services,n=e.shipIconContainer,i=e.uiState,a=e.particleEmitterContainer;return n.getArray().forEach((function(e){e.hide()}),this),i.hideCombatLog(),a.release(this),this.animations.forEach((function(e){return e.deactivate()})),Object(Oa.a)(Object(P.a)(t.prototype),"deactivate",this).call(this)}}]),t}(No),kd=wd,jd=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).emitterContainer=e.particleEmitterContainer,n.replayContext=new Lh(Object(xo.a)(n)),n.replayTurnActions=new kd(n.replayContext),n.strategies=[n.replayTurnActions,new tu(Object(xo.a)(n),n.replayContext),new nu(n.replayContext),new Wo,new Oh,new kh],n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(e,n,i){var a=Object(Oa.a)(Object(P.a)(t.prototype),"render",this).call(this,e,n,i);this.emitterContainer.render(a)}},{key:"canDisturb",value:function(){return!1}},{key:"update",value:function(e){return this.updateStrategies(e),this}},{key:"deactivate",value:function(){Object(Oa.a)(Object(P.a)(t.prototype),"deactivate",this).call(this)}}]),t}(yo),Sd=jd,xd=Sd,Cd=function(){function e(){Object(T.a)(this,e),this.replays=[],this.currentGameData=null}return Object(E.a)(e,[{key:"getGameDatasForAutomaticReplay",value:function(){var e=this;if(!this.currentGameData)return null;var t=this.replays.find((function(t){return t.turn===e.currentGameData.turn-1}));return t?[t,this.currentGameData]:null}},{key:"setCurrent",value:function(e){this.currentGameData=e}},{key:"getCurrent",value:function(){return this.currentGameData}},{key:"setReplays",value:function(e){this.replays=this.replays.filter((function(t){return!e.find((function(e){return e.turn===t.turn}))})),this.replays=[].concat(Object(ta.a)(this.replays),Object(ta.a)(e))}}]),e}(),Td=Cd,Ed=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;Object(T.a)(this,e),this.id=ga(),this.gameData=n,this.deserialize(t)}return Object(E.a)(e,[{key:"getShips",value:function(){var e=this;return this.gameData?this.gameData.ships.getShips().filter((function(t){return e.shipIds.includes(t.id)})):[]}},{key:"includesShip",value:function(e){return this.shipIds.includes(e.id)}},{key:"isUsers",value:function(e){return this.userId===e.id}},{key:"addShip",value:function(e){this.shipIds.push(e.id)}},{key:"isTaken",value:function(){return Boolean(this.userId)}},{key:"takeSlot",value:function(e){this.userId=e.id}},{key:"leaveSlot",value:function(e){if(this.userId!==e.id)throw Error("Trying to leave slot that is not occupied by player");this.userId=null}},{key:"isOccupiedBy",value:function(e){return e&&this.userId===e.id}},{key:"setBought",value:function(){this.bought=!0}},{key:"isBought",value:function(){return this.bought}},{key:"validate",value:function(){return this.name?this.deploymentLocation instanceof un.Offset?this.deploymentRadius!==parseInt(this.deploymentRadius,10)||this.deploymentRadius<0?"Slot needs to have greater than zero deploymentRadius":this.team!==parseInt(this.team,10)||this.team<0?"Slot needs to have greater than zero numeric team":this.deploymentVector instanceof un.Offset?this.points!==parseInt(this.points,10)||this.points<=0?"Slot needs to have points more than 0":void 0:"Slot needs to have deploymentVector of type hexagon.Offset":"Slot needs to have deploymentlocation of type hexagon.Offset":"Slot needs to have a name"}},{key:"isValidShipDeployment",value:function(e,t){return this.includesShip(e)&&t.distanceTo(this.deploymentLocation)<=this.deploymentRadius}},{key:"serialize",value:function(){return{id:this.id,name:this.name,userId:this.userId,deploymentLocation:this.deploymentLocation,deploymentRadius:this.deploymentRadius,deploymentVector:this.deploymentVector,points:this.points,shipIds:this.shipIds,team:this.team,bought:this.bought,facing:this.facing}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.id=e.id||this.id,this.name=e.name,this.userId=e.userId||null,this.deploymentLocation=e.deploymentLocation?new un.Offset(e.deploymentLocation):new un.Offset(0,0),this.deploymentVector=e.deploymentVector?new un.Offset(e.deploymentVector):new un.Offset(0,0),this.deploymentRadius=e.deploymentRadius||10,this.shipIds=e.shipIds||[],this.points=e.points||0,this.bought=e.bought||!1,this.team=e.team||1,this.facing=e.facing||0,this}}]),e}(),Ad=Ed,Pd=function(){function e(t){Object(T.a)(this,e),this.gameData=t,this.slots=[]}return Object(E.a)(e,[{key:"getTeamForShip",value:function(e){return this.slots.find((function(t){return t.includesShip(e)})).team}},{key:"getSlotsByTeams",value:function(){var e=[];return this.slots.forEach((function(t){var n=e.find((function(e){return e.team===t.team}));n?n.slots.push(t):(n={team:t.team,slots:[t]},e.push(n))})),e}},{key:"isUsersTeamSlot",value:function(e,t){var n=this.slots.find((function(e){return e.userId===t}));return!!n&&e.team===n.team}},{key:"getUsersSlots",value:function(e){return this.slots.filter((function(t){return t.isUsers(e)}))}},{key:"getSlotByShip",value:function(e){return this.slots.find((function(t){return t.includesShip(e)}))}},{key:"getSlotById",value:function(e){return this.slots.find((function(t){return t.id===e}))}},{key:"setSlots",value:function(e){e.forEach(this.addSlot.bind(this))}},{key:"getSlots",value:function(){return this.slots}},{key:"addSlot",value:function(e){return this.slots.push(e),e}},{key:"serialize",value:function(){return{slots:this.slots.map((function(e){return e.serialize()}))}}},{key:"deserialize",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.slots=t.slots?t.slots.map((function(t){return new Ad(t,e.gameData)})):[],this}}]),e}(),Id=Pd,Dd=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).power=n,e.maxLevel=i,e.boostLevel=0,e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"isBoostable",value:function(){return!0}},{key:"canBoost",value:function(e,t){var n=this.system.shipSystems.power.getRemainingPowerOutput();return!this.system.isDisabled()&&(!(null!==this.maxLevel&&this.boostLevel>=this.maxLevel)&&n>=this.getPowerRequiredForBoost())}},{key:"canDeBoost",value:function(e,t){return this.boostLevel>0}},{key:"getPowerRequiredForBoost",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.power+t}},{key:"getBoost",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.system.isDisabled()?t:t+this.boostLevel}},{key:"getPowerRequirement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.system.isDisabled())return t;var n=this.boostLevel*this.power;return n+t}},{key:"boost",value:function(e,t){if(!this.canBoost(e))return!1;this.boostLevel++}},{key:"deBoost",value:function(e,t){if(0===this.boostLevel)return!1;this.boostLevel--,this.system.callHandler("onSystemPowerLevelDecrease")}},{key:"receivePlayerData",value:function(e){e.clientShip;var n=e.clientSystem;if(n&&!this.system.isDisabled()){var i=n.getStrategiesByInstance(t)[0].boostLevel;if(this.boostLevel>i)for(;;){if(this.boostLevel===i)return;if(!this.canDeBoost())return;this.deBoost()}else if(this.boostLevel<i)for(;;){if(this.boostLevel===i)return;if(!this.canBoost())return;this.boost()}}}},{key:"serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(pi.a)({},t,{boostableSystemStrategy:{boostLevel:this.boostLevel}})}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.boostLevel=e.boostableSystemStrategy?e.boostableSystemStrategy.boostLevel:0,this}}]),t}(cr),Md=Dd,zd=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).output=e||0,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getOutputForBoost",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t>this.output?t:this.output}},{key:"getThrustOutput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.system.isDisabled())return t;var n=this.output;return(n-=this.system.damage.getCriticals().filter((function(e){return e instanceof Sa})).reduce((function(e,t){return e+t.getOutputReduction()}),0))<0&&(n=0),t+this.system.callHandler("getBoost")+n}},{key:"getPossibleCriticals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(Object(ta.a)(t),[{severity:20,critical:new Sa(2,2)},{severity:30,critical:new Sa(Math.ceil(this.output/4),2)},{severity:60,critical:new Sa(Math.ceil(this.output/3),2)},{severity:70,critical:new Sa(Math.ceil(this.output/2),2)},{severity:30,critical:new Sa(2)},{severity:70,critical:new Sa(Math.ceil(this.output/4))},{severity:80,critical:new Sa(Math.ceil(this.output/3))},{severity:90,critical:new Sa(Math.ceil(this.output/2))}])}},{key:"onSystemOffline",value:function(){this.onSystemPowerLevelDecrease()}},{key:"onSystemPowerLevelDecrease",value:function(){this.system&&this.system.shipSystems&&this.system.shipSystems.ship&&this.system.shipSystems.ship.movement.revertMovementsUntilValidMovement()}}]),t}(cr),Rd=zd,Fd=function(e){function t(e){var n,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).power=e||0,n.power<=0)throw new Error("Power must be more than zero");return n.getsCriticals=i,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({sort:"AAAA",header:"Power requirement",value:this.power}),t}},{key:"getPowerRequirement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.power+t}},{key:"canSetOffline",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!0}},{key:"canSetOnline",value:function(){return!0}},{key:"shouldBeOffline",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!0===t||this.system.hasCritical(Fa)}},{key:"getPossibleCriticals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.getsCriticals?[].concat(Object(ta.a)(t),[{severity:20,critical:new Fa(1)},{severity:40,critical:new Fa(2)},{severity:60,critical:new Fa(3)},{severity:80,critical:new Fa(4)}]):t}}]),t}(cr),Hd=Fd,Ld=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).output=e||0,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({header:"Power output",value:this.getPowerOutput()}),t}},{key:"getPowerOutput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.system.isDisabled())return t;var n=this.output;return this.system.hasCritical(Ca)&&(n-=2),this.system.hasCritical(Ea)&&(n-=4),this.system.hasCritical(Pa)&&(n-=6),this.system.hasCritical(Da)&&(n-=8),n<0&&(n=0),t+n}},{key:"getPossibleCriticals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(Object(ta.a)(t),[{weight:10,className:Ca},{weight:7,className:Ea},{weight:3,className:Pa},{weight:1,className:Da}])}}]),t}(cr),Bd=Ld,_d={0:"Thrust forward",3:"Thrust aft",1:"Thrust starboard",2:"Thrust starboard",4:"Thrust port",5:"Thrust port",6:"Pivot right",7:"Pivot left",8:"Roll, Evade"},Ud=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this))).output=e||0,i.direction=n||0,i.channeled=0,i.heatPerThrustChanneled=.75,i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"resetChanneledThrust",value:function(){this.channeled=0}},{key:"addChanneledThrust",value:function(e){this.channeled+=e}},{key:"serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(pi.a)({},t,{thrustChannelSystemStrategy:{channeled:this.channeled}})}},{key:"getIconText",value:function(){return this.channeled+"/"+this.output}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.thrustChannelSystemStrategy||{};return this.channeled=t.channeled||0,this}},{key:"getDirectionString",value:function(){return Array.isArray(this.direction)?this.direction.map((function(e){return _d[e]})).join(", "):_d[this.direction]}},{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({header:"Output",value:this.output}),t.push({header:"Manouver(s)",value:this.getDirectionString()}),t.push({header:"Channeled",value:this.channeled}),t.push({header:"Heat generated",value:this.getHeatGenerated()}),t}},{key:"getThrustChannel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.system.isDisabled()?t:t+this.getChannelOutput()}},{key:"generatesHeat",value:function(){return!0}},{key:"getHeatPerThrustChanneled",value:function(){var e=this.heatPerThrustChanneled;return e*=1+this.system.damage.getCriticals().filter((function(e){return e instanceof _a})).reduce((function(e,t){return e+t.getHeatIncrease()}),0)}},{key:"getHeatForThrust",value:function(e){return e.amount*this.getHeatPerThrustChanneled()}},{key:"getHeatGenerated",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t+this.channeled*this.getHeatPerThrustChanneled()}},{key:"getThrustDirection",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.direction}},{key:"getChannelOutput",value:function(){var e=this.output;return(e-=this.system.damage.getCriticals().filter((function(e){return e instanceof Sa})).reduce((function(e,t){return e+t.getOutputReduction()}),0))<0&&(e=0),e}},{key:"getMaxChannelAmount",value:function(){return this.getChannelOutput()}},{key:"canChannelAmount",value:function(e){return e<=this.getMaxChannelAmount()}},{key:"getChannelCost",value:function(e){return e}},{key:"isThruster",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!0}},{key:"isDirection",value:function(e){return this.direction===e||Array.isArray(this.direction)&&this.direction.includes(e)}},{key:"advanceTurn",value:function(){this.channeled=0}},{key:"getPossibleCriticals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(Object(ta.a)(t),[{severity:20,critical:new _a(.5,1)},{severity:30,critical:new Sa(Math.ceil(this.output/4),2)},{severity:40,critical:new _a(.5,3)},{severity:60,critical:new _a(.5)},{severity:70,critical:new Sa(Math.ceil(this.output/4))},{severity:80,critical:new Sa(Math.ceil(this.output/3))},{severity:90,critical:new Sa(Math.ceil(this.output/2))}])}}]),t}(cr),Nd=Ud,Vd=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).evasion=e||0,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getMaxEvasion",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.system.isDisabled()?t:t+this.evasion}}]),t}(cr),Gd=Vd,Wd=function(e){switch(e){case"oew":return"Offensive EW";case"dew":return"Defensive EW";case"ccew":return"Close combat EW";case"soew":return"Offensive support EW";case"sdew":return"Defensive EW";case"disew":return"Disruption EW";case"adew":return"Area defensive EW"}},qd=function(e){function t(e,n){var i;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this))).output=e||0,i.allowedEwTypes=n||["oew","dew","ccew"],i.entries=[],i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(pi.a)({},t,{electronicWarfareProvider:Object(ta.a)(this.entries.map((function(e){return e.serialize()})))})}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.entries=e.electronicWarfareProvider?e.electronicWarfareProvider.map((function(e){return new Qr(e.type,e.targetShipId,e.amount)})):[],this}},{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({header:"Usage/Output",value:this.getUsageVsOutputText()}),t.push({header:"EW type(s)",value:this.allowedEwTypes.map(Wd).join(", ")}),t}},{key:"getUsageVsOutputText",value:function(){return this.getTotalEwUsed()+"/"+this.getEwOutput()}},{key:"getValidEwTypes",value:function(){return this.getValidEwTypes}},{key:"getEwEntry",value:function(e,t){return this.entries.find((function(n){return n.type===e&&n.targetShipId===t}))}},{key:"assignEw",value:function(e){var t=e.type,n=e.target,i=e.amount;if(n instanceof is&&(n=n.id),!this.canUseEw({type:t,amount:i}))throw new Error("Check validity first!");var a=this.getEwEntry(t,n);!a&&i<=0||(a?a.addAmount(i):(a=new Qr(t,n,i),this.entries.push(a)))}},{key:"getEwEntries",value:function(){return this.entries.map((function(e){return e.clone()}))}},{key:"canUseEw",value:function(e){var t=e.type,n=e.amount;return this.canUseEwType(t)&&this.canUseEwAmount(n)}},{key:"canUseEwType",value:function(e){return this.allowedEwTypes.includes(e)}},{key:"canUseEwAmount",value:function(e){return this.getEwOutput()>=this.getTotalEwUsed()+e}},{key:"getUnusedCapacity",value:function(){return this.getEwOutput()-this.getTotalEwUsed()}},{key:"getTotalEwUsedByType",value:function(e){return"dew"===e?this.canUseEwType("dew")?this.getUnusedCapacity():0:this.entries.filter((function(t){return t.type===e})).reduce((function(e,t){return e+t.getAmount()}),0)}},{key:"getTotalEwUsed",value:function(){return this.entries.reduce((function(e,t){return e+t.getAmount()}),0)}},{key:"getOutputForBoost",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t>this.output?t:this.output}},{key:"getEwOutput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.system.isDisabled())return t;var n=this.output;return n-=this.system.damage.getCriticals().filter((function(e){return e instanceof Sa})).reduce((function(e,t){return e+t.getOutputReduction()}),0),t+this.system.callHandler("getBoost",null,0)+n}},{key:"isEwArray",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!0}},{key:"resetEw",value:function(){this.entries=[]}},{key:"getPossibleCriticals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(Object(ta.a)(t),[{severity:20,critical:new Sa(1)},{severity:40,critical:new Sa(Math.ceil(this.output/4),2)},{severity:50,critical:new Sa(Math.ceil(this.output/3),2)},{severity:60,critical:new Sa(Math.ceil(this.output/2),2)},{severity:80,critical:new Sa(Math.ceil(this.output/4))},{severity:90,critical:new Sa(Math.ceil(this.output/3))},{severity:100,critical:new Sa(Math.ceil(this.output/2))}])}},{key:"censorForUser",value:function(e){e.mine||(this.entries=[])}},{key:"onSystemOffline",value:function(){this.onSystemPowerLevelDecrease()}},{key:"onSystemPowerLevelDecrease",value:function(){this.system&&this.system.shipSystems&&this.system.shipSystems.ship&&this.system.shipSystems.ship.electronicWarfare.repeatElectonicWarfare()}}]),t}(cr),Zd=function(e){function t(e,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this))).front=e,i.side=n,i.hitSizeMultiplier=a,i.turnsOffline=0,i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(pi.a)({},t,{largerHitProfileOnlineSystemStrategy:{turnsOffline:this.turnsOffline}})}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.largerHitProfileOnlineSystemStrategy||{};return this.turnsOffline=t.turnsOffline||0,this}},{key:"getHitSystemSizeMultiplier",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.system.isDestroyed()&&this.turnsOffline>0||this.turnsOffline>1?t:t+this.hitSizeMultiplier}},{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({header:"Increases profile when online",value:"".concat(this.front,"/").concat(this.side)}),t.push({header:"Modifies system hit allocation size",value:"x".concat(this.hitSizeMultiplier)}),this.system.isDestroyed()?t.push({value:"NOTE: Destroyed system will not increase ship profile."}):this.turnsOffline>1?t.push({value:"NOTE: System has been offline long enough for the profile increase to cease."}):t.push({value:"NOTE: System has to be offline ".concat(2-this.turnsOffline," turn(s) before profile increase ceases.")}),t}},{key:"getHitProfile",value:function(e){var t=e.front,n=void 0===t||t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.system.isDestroyed()&&this.turnsOffline>0||this.turnsOffline>1?i:n?i+this.front:i+this.side}},{key:"advanceTurn",value:function(){this.system.isDisabled()?this.turnsOffline++:this.turnsOffline=0}}]),t}(cr),Kd=function(e){function t(e){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,0,e))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getPowerRequiredForBoost",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.system.callHandler("getOutputForBoost",null,0);return n+this.boostLevel+t+1}},{key:"getPowerRequirement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.system.callHandler("getOutputForBoost",null,0),i=this.boostLevel*n+this.boostLevel;return i+t}}]),t}(Md),Xd=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).armorBoost=n,e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getArmorModifier",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.system.isDisabled()?t+this.armorBoost:t}},{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({header:"Increased armor when offline",value:"+".concat(this.armorBoost)}),t}}]),t}(cr),Yd=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).heatOutput=e,n.heatOutputPerBoostLevel=i,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({sort:"heat",header:"Generates heat when online",value:"".concat(this.getHeatGenerated())}),t}},{key:"generatesHeat",value:function(){return!0}},{key:"getHeatGenerated",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.system.isDisabled())return t;var n=this.system.callHandler("getBoost",null,0);return t+this.heatOutput+n*this.heatOutputPerBoostLevel}}]),t}(cr),Qd=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).heatPerFireOrder=e,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"generatesHeat",value:function(){return!0}},{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({sort:"heat",header:"Generates heat when fired",value:"".concat(this.heatPerFireOrder)}),t}},{key:"getHeatGenerated",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.system.callHandler("getFireOrders",null,[]);return 0===n.length?t:t+n*this.heatPerFireOrder}}]),t}(cr),Jd=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).turnsOfflineToCancel=n,e.turnsOffline=0,e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"canBeTargeted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.system.isDestroyed()?t:!(null!==this.turnsOfflineToCancel&&this.turnsOffline>=this.turnsOfflineToCancel)||t}},{key:"serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(pi.a)({},t,{alwaysTargetableSystemStrategy:{turnsOffline:this.turnsOffline}})}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.alwaysTargetableSystemStrategy||{};return this.turnsOffline=t.turnsOffline||0,this}},{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.system.isDestroyed()?t:(null===this.turnsOfflineToCancel?t.push({value:"This system can always be hit, regardless of attack direction"}):this.turnsOffline>=this.turnsOfflineToCancel?t.push({value:"This system has been ofline long enough to not be a valid target"}):t.push({value:"This system has to be ofline ".concat(this.turnsOfflineToCancel-this.turnsOffline," more turn to not be a valid target")}),t)}},{key:"advanceTurn",value:function(){this.system.isDisabled()?this.turnsOffline++:this.turnsOffline=0}}]),t}(cr),$d=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).fireControl=n,e.numberOfShots=i,e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getBaseHitChange",value:function(e){var t=e.shooter;return e.target.getHitProfile(t.getPosition())}},{key:"checkFireOrderHits",value:function(e){var t=e.shooter,n=e.target,i=e.weaponSettings,a=e.combatLogEntry,r=this.getHitChange({shooter:t,target:n,weaponSettings:i}),s=Math.ceil(100*Math.random()),o=s<=r.result,u=new Qh(o,r,s);return a.addHitResult(u),u}},{key:"getFireControl",value:function(){return this.fireControl}},{key:"getHitChange",value:function(e){var t=e.shooter,n=e.target,i=e.prediction,a=void 0!==i&&i,r=e.weaponSettings,s=void 0===r?{}:r,o=this.system.callHandler("getBaseHitChange",{shooter:t,target:n,weaponSettings:s}),u=n.electronicWarfare.inEffect.getDefensiveEw(),c=t.electronicWarfare.inEffect.getOffensiveEw(n),l=a?t.finalHexDistanceTo(n):t.hexDistanceTo(n),h=0===c?2*l:l,d=this.system.callHandler("getRangeModifier",{distance:h,weaponSettings:s})*(1+n.movement.getEvasion()/10),m=t.movement.isRolling()?-20:0,f=o+m+this.getFireControl()+5*c-5*u+d;!1===d&&(f=0);var p=this.system.callHandler("isOnRange",{distance:l}),v=f;return(f=Math.floor(f))<0&&(f=0),new Xh({baseToHit:o,fireControl:this.fireControl,dew:u,oew:c,distance:l,rangeModifier:d,evasion:n.movement.getEvasion(),result:p?f:0,absoluteResult:v,outOfRange:!p,rollingPenalty:m})}}]),t}(cr),em=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).rangesAndPenalties=e||[],n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getUiComponents",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(Object(ta.a)(t),[{name:"RangePenalty",props:{rangeStrategy:this}}])}},{key:"isOnRange",value:function(e){return e.distance<=this.getMaxRange()}},{key:"getMaxRange",value:function(){return this.rangesAndPenalties[this.rangesAndPenalties.length-1].range}},{key:"getRangeModifier",value:function(e){var t=e.distance,n=this.rangesAndPenalties.find((function(e){return e.range===t}));if(n)return n.modifier;var i=null,a=null;if(this.rangesAndPenalties.forEach((function(e){var n=e.range,r=e.modifier;(null===i||n>i.range)&&n<t?i={range:n,modifier:r}:(null===a||n<a.range)&&n>t&&(a={range:n,modifier:r})})),!a)return-200;var r=a.modifier-i.modifier,s=a.range-i.range;return Math.round(i.modifier+r*(t-i.range)/s)}}]),t}(cr),tm=function(){function e(t){Object(T.a)(this,e),this.fireOrderId=t}return Object(E.a)(e,[{key:"serialize",value:function(){return{logEntryClass:this.constructor.name,fireOrderId:this.fireOrderId}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.fireOrderId=e.fireOrderId,this}}]),e}(),nm=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).numberOfShots=n,e.resolutionPriority=i,e.fireOrders=[],e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"executeFireOrders",value:function(e){var t=this,n=e.gameData;this.fireOrders.forEach((function(e){var i=t.system,a=n.ships.getShipById(e.shooterId),r=n.ships.getShipById(e.targetId),s=e.weaponSettings;if(!t.system.callHandler("isOnArc",{shooter:a,target:r}))return n.combatLog.addEntry(new tm(e.id)),!1;if(!t.system.callHandler("canFire",{shooter:a,target:r},!0))return!1;var o=new $h(e.id,e.targetId,e.shooterId,i.callHandler("getSelectedAmmo",null,null)),u=i.callHandler("checkFireOrderHits",{shooter:a,target:r,weaponSettings:s,gameData:n,fireOrder:e,combatLogEntry:o});i.callHandler("applyDamageFromWeaponFire",{shooter:a,target:r,weaponSettings:s,gameData:n,fireOrder:e,combatLogEntry:o,hitResolution:u}),i.callHandler("onWeaponFired"),e.setResolved(),n.combatLog.addEntry(o)}))}},{key:"usesFireOrders",value:function(){return!0}},{key:"getNumberOfShots",value:function(){return this.numberOfShots}},{key:"getFireOrderResolutionPriority",value:function(){return this.resolutionPriority}},{key:"hasFireOrder",value:function(){return this.fireOrders.length>0}},{key:"getFireOrders",value:function(){return this.fireOrders}},{key:"removeFireOrders",value:function(){this.fireOrders=[]}},{key:"addFireOrder",value:function(e){var t=e.shooter,n=e.target,i=e.weaponSettings;this.fireOrders=[];for(var a=this.numberOfShots;a--;){var r=new as(t,n,this.system,i);this.fireOrders.push(r)}return this.fireOrders}},{key:"serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(pi.a)({},t,{fireOrderStrategy:this.fireOrders.map((function(e){return e.serialize()}))})}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.fireOrders=e.fireOrderStrategy?e.fireOrderStrategy.map((function(e){return(new as).deserialize(e)})):[],this}},{key:"advanceTurn",value:function(e){this.fireOrders=[]}},{key:"censorForUser",value:function(e){e.mine||(this.fireOrders=[])}},{key:"onSystemOffline",value:function(){this.removeFireOrders()}}]),t}(cr),im=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).loadingTime=e,n.turnsLoaded=e,n.firedThisTurn=!1,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this._getBoostLoading(),i=1+n;Number.isInteger(i)||(i=i.toFixed(1));var a=this.turnsLoaded;Number.isInteger(a)||(a=a.toFixed(1));var r=this.getLoadingTime();a>r&&(a=r),t.push({header:"Charging",value:"".concat(a," / ").concat(r," +").concat(i," per turn")});var s=this.system.callHandler("getPowerRequiredForBoost",null,0);return s&&t.push({header:"Charging boostable",value:"".concat(s," power required")}),t}},{key:"_getTurnsUntilLoaded",value:function(){var e=this.getLoadingTime()-this.turnsLoaded,t=1+this._getBoostLoading();return Math.ceil(e/t)}},{key:"getIconText",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(this.system.isDisabled())return t;var n=this._getTurnsUntilLoaded();return n<=0?t:"-".concat(n,"T")}},{key:"canFire",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!!this.isLoaded()&&t}},{key:"usesLoading",value:function(){return!0}},{key:"onWeaponFired",value:function(){this.firedThisTurn=!0}},{key:"getLoadingTime",value:function(){var e=this.system.damage.getCriticals().filter((function(e){return e instanceof za})).reduce((function(e,t){return e+t.getLoadingTimeIncrease()}),0);return this.loadingTime+e}},{key:"getTurnsLoaded",value:function(){return this.turnsLoaded}},{key:"isReady",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!1!==t&&this.isLoaded()}},{key:"isLoaded",value:function(){return this.turnsLoaded>=this.getLoadingTime()}},{key:"serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(pi.a)({},t,{standardLoadingStrategy:{turnsLoaded:this.turnsLoaded}})}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.turnsLoaded=e.standardLoadingStrategy?e.standardLoadingStrategy.turnsLoaded:0,this}},{key:"advanceTurn",value:function(){if(this.system.isDisabled())this.turnsLoaded=0;else{this.firedThisTurn&&(this.turnsLoaded=0,this.firedThisTurn=!1);var e=1+this._getBoostLoading();this.turnsLoaded+=e}}},{key:"_getBoostLoading",value:function(){var e=this.system.callHandler("getBoost",null,0);if(!e)return 0;var t=this.getLoadingTime()-e;return this.getLoadingTime()/t-1}},{key:"getPossibleCriticals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(Object(ta.a)(t),[{severity:40,critical:new za(this.loadingTime,1)},{severity:80,critical:new za(3*this.loadingTime,1)},{severity:100,critical:new za(null,1)}])}}]),t}(cr),am=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).arcs=[].concat(n),e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"hasArcs",value:function(){return!0}},{key:"isPositionOnArc",value:function(e){var t=e.targetPosition,n=this.system.shipSystems.ship,i=En(n.getPosition(),t),a=An(n.getFacing());return this.getArcs({facing:a}).some((function(e){var t=e.start,n=e.end;return n===t||(n>t?i>=t&&i<=n:t>n&&(i<=n||i>=t))}))}},{key:"isOnArc",value:function(e){var t=e.target;return this.isPositionOnArc({targetPosition:t.getPosition()})}},{key:"getArcs",value:function(e){var t=this,n=e.facing,i=void 0===n?0:n;return this.arcs.map((function(e){var n=e.start,a=e.end;return t.system.shipSystems.ship.movement.isRolled()?{start:jn(jn(0,-a),i),end:jn(jn(0,-n),i)}:{start:jn(n,i),end:jn(a,i)}}))}}]),t}(cr),rm=function(e){function t(e,n){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new Bd(n)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"Reactor"}},{key:"getBackgroundImage",value:function(){return"/img/system/reactor.png"}},{key:"getIconText",value:function(){return this.callHandler("getPowerOutput")}}]),t}(or),sm=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).damage=e,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"_getDamageForWeaponHit",value:function(e){e.requiredToHit,e.rolledToHit;return this.damage}},{key:"_chooseHitSystem",value:function(e){var t=e.target,n=e.shooterPosition;return t.systems.getSystemsForHit(n).find((function(e){return e instanceof rm}))}},{key:"_getArmorPiercing",value:function(){return 1e3}}]),t}(pr),om=function(e){function t(e,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10;return Object(T.a)(this,t),(i=Object(A.a)(this,Object(P.a)(t).call(this,e,n))).shotsFormula=a,i.maxShots=r,i.grouping=s,i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getTotalBurstSize",value:function(){return this.maxShots}},{key:"applyDamageFromWeaponFire",value:function(e){var t=this,n=(e.fireOrder,e.combatLogEntry),i=this._getNumberOfShots(e);n.setShots(i,this.maxShots),Array.from(Array(i)).map((function(){var i=new fr;return n.addDamage(i),t._doDamage(Object(pi.a)({shooterPosition:e.shooter.getPosition()},e),i),i}))}},{key:"_getDamageTypeMessage",value:function(){return"Burst"}},{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({header:"Damage type",value:this._getDamageTypeMessage()}),t.push({header:"Burst size",value:this.maxShots}),t.push({header:"Burst grouping",value:this.grouping}),t.push({header:"Damage",value:this._getDamageMessage()}),t.push({header:"Armor piercing",value:this._getArmorPiercingMessage()}),t}},{key:"_getNumberOfShots",value:function(e){var t=e.hitResolution,n=t.hitChange.result,i=t.hitRoll;if(i>n)return 0;if(i<=n-this.maxShots*this.grouping)return this.maxShots;var a=Math.floor((n-i)/this.grouping);return Number.isInteger(this.shotsFormula)?a+=this.shotsFormula:a+=this.diceRoller.roll(this.shotsFormula).total,a>this.maxShots&&(a=this.maxShots),a<=0&&(a=1),a}}]),t}(pr),um=function(e){function t(e,n){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,n))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"_getDamageTypeMessage",value:function(){return"Piercing"}},{key:"getMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({header:"Damage type",value:this._getDamageTypeMessage()}),t.push({value:"Piercing will cause damage multiple times applying new damage each time, until it runs out of armor piercing. Piercing will not damage other than structures multiple times."}),t.push({header:"Damage",value:this._getDamageMessage()}),t.push({header:"Armor piercing",value:this._getArmorPiercingMessage()}),t}},{key:"_getNumberOfShots",value:function(){return this.maxDamages}},{key:"_chooseHitSystem",value:function(e,t){var n=e.target,i=e.shooterPosition,a=n.systems.getSystemsForHit(i).filter((function(e){return!t.some((function(t){return e.id===t.id}))}));return this.hitSystemRandomizer.randomizeHitSystem(a)}},{key:"_doDamage",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],r=e.target,s=e.shooterPosition,o=e.combatLogEntry;if(0!==n){void 0===n&&(n=this._getArmorPiercing(e));var u=this._chooseHitSystem({target:r,shooterPosition:s},a);if(u){var c=this._doDamageToSystem(e,t,u,n,this._getDamageForWeaponHit(e));return n=c.armorPiercing,u instanceof Br||a.push(u),this._doDamage(e,t,n,i+1,a)}}else o.addNote("Pierced ".concat(i," times. Ran out of armor piercing."))}}]),t}(pr),cm=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(T.a)(this,t),(e=Object(A.a)(this,Object(P.a)(t).call(this))).numberOfIntercepts=n,e.heatPerIntercept=i,e.timesIntercepted=0,e}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getInterceptHeat",value:function(){return this.timesIntercepted*this.heatPerIntercept}},{key:"getHeatPerIntercept",value:function(){return this.heatPerIntercept}},{key:"addTimesIntercepted",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.timesIntercepted+=e}},{key:"getHeatGenerated",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t+this.timesIntercepted*this.heatPerIntercept}},{key:"canIntercept",value:function(){return!0}},{key:"getNumberOfIntercepts",value:function(){return this.numberOfIntercepts}},{key:"getInterceptChance",value:function(e){var t=e.target,n=e.torpedoFlight,i=e.interceptTry,a=void 0===i?1:i,r=this.system.shipSystems.ship;if(t!==r){var s=n.position.distanceTo(t.getPosition()),o=r.getPosition().distanceTo(n.position),u=r.getPosition().distanceTo(t.getPosition());a+=s>o&&u<s?r.hexDistanceTo(t):2*r.hexDistanceTo(t)}var c=this.system.callHandler("getRangeModifier",{distance:a})*(1+n.torpedo.getEvasion()/10),l=this.system.callHandler("getFireControl",null,0),h=r.electronicWarfare.getCcEw(),d=n.torpedo.getHitSize(),m=r.movement.isRolling()?-20:0;return new Xh({baseToHit:d,fireControl:l,dew:0,oew:h,distance:a,rangeModifier:c,evasion:n.torpedo.getEvasion(),rollingPenalty:m,result:Math.round(d+c+l+5*h+m),absoluteResult:d+c+l+5*h+m})}},{key:"advanceTurn",value:function(){this.timesIntercepted=0}}]),t}(cr),lm=function(e){function t(e,n,i){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new Nd(n,[6,7,8]),new Gd(i)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"Maneuvering Thruster"}},{key:"getBackgroundImage",value:function(){return"/img/system/maneuveringThruster.png"}},{key:"getIconText",value:function(){return this.callHandler("getThrustChannel")}}]),t}(or),hm=function(e){function t(e,n,i){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new Nd(n,i)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"Thruster"}},{key:"getBackgroundImage",value:function(){return this.callHandler("isDirection",3,!1)?"/img/system/thruster2.png":this.callHandler("isDirection",2,!1)?"/img/system/thruster4.png":this.callHandler("isDirection",5,!1)?"/img/system/thruster3.png":"/img/system/thruster1.png"}}]),t}(or),dm=function(e){function t(e,n,i){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new Nd(n,[6,8]),new Gd(i)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"Maneuvering Thruster"}},{key:"getBackgroundImage",value:function(){return"/img/system/maneuveringThrusterLeft.png"}},{key:"getIconText",value:function(){return this.callHandler("getThrustChannel")}}]),t}(or),mm=function(e){function t(e,n,i){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new Nd(n,[7,8]),new Gd(i)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"Maneuvering Thruster"}},{key:"getBackgroundImage",value:function(){return"/img/system/maneuveringThrusterRight.png"}},{key:"getIconText",value:function(){return this.callHandler("getThrustChannel")}}]),t}(or),fm=function(e){function t(e,n,i,a){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new Md(a),new Rd(n),new Hd(i)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"Engine"}},{key:"getBackgroundImage",value:function(){return"/img/system/engine.png"}},{key:"getIconText",value:function(){return this.callHandler("getThrustOutput")}}]),t}(or),pm=function(e){function t(e,n){var i;Object(T.a)(this,t);var a=e.heat,r=e.boostHeat,s=e.boostable,o=void 0===s||s,u=e.power,c=void 0===u?5:u;return i=Object(A.a)(this,Object(P.a)(t).call(this,e,[new qd(n),new Hd(c),new Yd(a||Math.ceil(n/2),r||Math.ceil(n/3))])),o&&i.addStrategy(new Kd),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"Electronic Warfare array"}},{key:"getBackgroundImage",value:function(){return"/img/system/scanner.png"}},{key:"getIconText",value:function(){return this.callHandler("getUsageVsOutputText")}}]),t}(or),vm=function(e){function t(e,n){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new qd(n,["ccew"])]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"CQEW array"}},{key:"getBackgroundImage",value:function(){return"/img/system/scanner.png"}},{key:"getIconText",value:function(){return this.callHandler("getUsageVsOutputText")}}]),t}(or),gm=function(e){function t(e,n){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new qd(n,["soew","sdew","disew","adew"])]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"ELINT array"}},{key:"getBackgroundImage",value:function(){return"/img/system/scanner.png"}},{key:"getIconText",value:function(){return this.callHandler("getUsageVsOutputText")}}]),t}(pm),ym=function(e){function t(e,n){var i;Object(T.a)(this,t);var a=e.heat,r=e.boostHeat,s=e.boostable,o=void 0!==s&&s,u=e.power,c=void 0===u?5:u;return i=Object(A.a)(this,Object(P.a)(t).call(this,e,[new qd(n,["oew"]),new Hd(c),new Yd(a||Math.ceil(n/2),r||Math.ceil(n/3))])),o&&i.addStrategy(new Kd),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"Offensive Electronic Warfare array"}},{key:"getBackgroundImage",value:function(){return"/img/system/OEWArray.png"}},{key:"getIconText",value:function(){return this.callHandler("getUsageVsOutputText")}}]),t}(or),bm=function(e){function t(e,n){var i;return Object(T.a)(this,t),i=Object(A.a)(this,Object(P.a)(t).call(this,e,n)),e.alwaysTargetable&&i.addStrategy(new Jd),i}return Object(I.a)(t,e),Object(E.a)(t,[{key:"isWeapon",value:function(){return!0}},{key:"showOnSystemList",value:function(){return!0}}]),t}(or),Om=function(e){function t(e,n){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new nm(1),new am(n),new $d(1e4),new em([{range:0,modifier:0},{range:300,modifier:-200}]),new im(2),new sm(10)]))}return Object(I.a)(t,e),t}(bm),wm=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this))).animationName=e,n.animationArguments=i,n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getWeaponFireAnimationName",value:function(){return this.animationName}},{key:"getWeaponFireAnimationArguments",value:function(){return this.animationArguments}}]),t}(cr),km=function(e){function t(e,n){var i=e.id;return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,{id:i,hitpoints:10,armor:5},[new nm(1),new am(n),new $d(20),new em([{range:0,modifier:-100},{range:200,modifier:-40},{range:400,modifier:-200}]),new im(4),new Hd(6),new Md(6,2),new um("d7+1","d6+20"),new wm("UniversalBolt",{size:12,length:2e3,speed:5,color:[.8,.1,.4],explosionSize:20,explosionType:"gas"}),new Yd(4,2)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"Fixed light coilgun"}},{key:"getBackgroundImage",value:function(){return"/img/system/matterCannon.png"}}]),t}(bm),jm=function(e){function t(e,n){var i=e.id;return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,{id:i,hitpoints:14,armor:5},[new nm(1),new am(n),new $d(20),new em([{range:0,modifier:-200},{range:120,modifier:-20},{range:610,modifier:-200}]),new im(4),new Hd(10),new Md(8,2),new um("d7+1","d9+25"),new wm("UniversalBolt",{size:12,length:2e3,speed:5,color:[.8,.1,.4],explosionSize:20,explosionType:"gas"}),new Yd(6,2)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"Medium coilgun"}},{key:"getBackgroundImage",value:function(){return"/img/system/matterCannon.png"}}]),t}(bm),Sm=function(e){function t(e,n){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new nm(1),new am(n),new $d(35),new em([{range:0,modifier:-100},{range:10,modifier:0},{range:300,modifier:-200}]),new im(4),new um("6d3","4d4 + 4"),new wm("Bolt",{size:18,length:2e3,speed:6,color:[.8,.1,.4]})]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"64Gw turreted railgun"}},{key:"getBackgroundImage",value:function(){return"/img/system/matterCannon.png"}}]),t}(bm),xm=function(e){function t(e,n){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new nm(1),new am(n),new $d(20),new em([{range:0,modifier:-100},{range:10,modifier:0},{range:220,modifier:-200}]),new im(3),new um("4d3","3d3 + 4"),new wm("Bolt",{size:15,length:2e3,speed:5,color:[.8,.1,.4]})]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"32Gw turreted railgun"}},{key:"getBackgroundImage",value:function(){return"/img/system/matterCannon.png"}}]),t}(bm),Cm=function(){function e(){Object(T.a)(this,e)}return Object(E.a)(e,[{key:"divideCargo",value:function(e,t){if(!this.hasSpaceFor(e,t))throw new Error("Ship has no cargo space for this. Check validity first!");for(var n=this.getBaysWithSpace(e),i=t.amount;i>0;)n.forEach((function(e){i>0&&e.callHandler("hasSpaceFor",{object:t.object,amount:1},!1)&&(e.callHandler("addCargo",{object:t.object,amount:1}),i--)}))}},{key:"hasSpaceForHowMany",value:function(e,t){var n=this.getShipWideCargoSpaceAvailable(e);return Math.floor(n/t.object.getSpaceRequired())}},{key:"hasSpaceFor",value:function(e,t){return this.getShipWideCargoSpaceAvailable(e)>=t.object.getSpaceRequired()*t.amount}},{key:"getShipWideCargoSpaceAvailable",value:function(e){return this.getBaysWithSpace(e).reduce((function(e,t){return e+t.callHandler("getAvailableCargoSpace",{},0)}),0)}},{key:"getBaysWithSpace",value:function(e){return e.systems.getSystems().filter((function(e){return e.callHandler("getAvailableCargoSpace",{},0)>0}))}}]),e}(),Tm=function(e){function t(e,n,i,a){var r,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return Object(T.a)(this,t),(r=Object(A.a)(this,Object(P.a)(t).call(this))).ammunitionClasses=[].concat(e),r.capacity=i,r.startLoadingAfter=s,r.intakeInTurn=a,r.ammoPerFireOrder=n,r.selectedAmmo=new r.ammunitionClasses[r.ammunitionClasses.length-1],r.turnsOffline=0,r.targetLoad=r._buildInitialTargetLoad(),r.changeTargetLoad=null,r.changeSelectedAmmo=null,r.loaded=[],r}return Object(I.a)(t,e),Object(E.a)(t,[{key:"_buildInitialTargetLoad",value:function(){var e=this,t=0;return this.ammunitionClasses.map((function(n,i){var a=Math.floor(e.capacity/e.ammunitionClasses.length),r=a%e.ammoPerFireOrder,s=0===r?0:e.ammoPerFireOrder-r,o=i===e.ammunitionClasses.length-1;return a>e.capacity-t?a=e.capacity-t:o?a=e.capacity-t:0!==r&&r<=s?a-=r:0!==s&&t+a+s<=e.capacity&&(a+=s),t+=a,{object:new n,amount:a}}))}},{key:"getIconText",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.system.isDisabled()?t:!1===this.system.callHandler("isLoaded",null,null)?t:this.getSelectedAmmo().getIconText()}},{key:"getUiComponents",value:function(e){var t=e.myShip,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t?this.system.isDestroyed()?n:[].concat(Object(ta.a)(n),[{name:"Ammo",props:{ammoStrategy:this}}]):n}},{key:"getTooltipMenuButton",value:function(e){var t=this,n=e.myShip,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return n?this.system.isDisabled()?i:[].concat(Object(ta.a)(i),[{img:this.getSelectedAmmo().getBackgroundImage(),onClickHandler:function(){t.toggleSelectedAmmo()},onDisabledHandler:function(){return!1}}]):i}},{key:"serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(pi.a)({},t,{ammunitionStrategy:{targetLoad:this.targetLoad.map((function(e){return{className:e.object.constructor.name,amount:e.amount}})),loaded:this.loaded.map((function(e){return{className:e.object.constructor.name,amount:e.amount}})),changeTargetLoad:this.changeTargetLoad?this.changeTargetLoad.map((function(e){return{className:e.object.constructor.name,amount:e.amount}})):null,turnsOffline:this.turnsOffline,selectedAmmo:this.selectedAmmo.constructor.name,changeSelectedAmmo:this.changeSelectedAmmo?this.changeSelectedAmmo.constructor.name:null}})}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ammunitionStrategy||{};return this.targetLoad=t.targetLoad?t.targetLoad.map((function(e){return{object:new Rr[e.className],amount:e.amount}})):[],this.loaded=t.loaded?t.loaded.map((function(e){return{object:new Rr[e.className],amount:e.amount}})):[],this.changeTargetLoad=t.changeTargetLoad?t.changeTargetLoad.map((function(e){return{object:new Rr[e.className],amount:e.amount}})):null,this.turnsOffline=t.turnsOffline||0,this.selectedAmmo=t.selectedAmmo?new Rr[t.selectedAmmo]:new this.ammunitionClasses[this.ammunitionClasses.length-1],this.changeSelectedAmmo=t.changeSelectedAmmo?new Rr[t.changeSelectedAmmo]:null,this}},{key:"toggleSelectedAmmo",value:function(){var e=this,t=null;this.loaded.forEach((function(n,i){e.getSelectedAmmo().constructor===n.object.constructor&&(t=i)})),t+1>this.loaded.length-1?t=0:t+=1,this.changeSelectedAmmo=this.loaded[t].object}},{key:"getSelectedAmmo",value:function(){return this.changeSelectedAmmo||this.selectedAmmo}},{key:"getLoadingTarget",value:function(){return this.changeTargetLoad||this.targetLoad}},{key:"getAmmoInMagazine",value:function(){return this.loaded}},{key:"loadTargetInstant",value:function(){this.loaded=this.targetLoad}},{key:"getLoadingTargetAmount",value:function(){return this.getLoadingTarget().reduce((function(e,t){return e+t.amount}),0)}},{key:"addToLoading",value:function(e){var t=e.object,n=e.amount;this.changeTargetLoad||(this.changeTargetLoad=this.targetLoad.map((function(e){return Object(pi.a)({},e)})));var i=this.changeTargetLoad.find((function(e){return e.object.constructor===t.constructor}));if(!i&&n>0)i={object:t,amount:0},this.changeTargetLoad.push(i);else if(!i&&n<0)return;this.getLoadingTargetAmount()+n>this.capacity||i.amount+n<0||(i.amount+=n)}},{key:"setNewLoadingTarget",value:function(e){this.changeTargetLoad=e}},{key:"setNewSelectedAmmo",value:function(e){this.changeSelectedAmmo=e}},{key:"receivePlayerData",value:function(e){var n=this,i=(e.clientShip,e.clientSystem);if(i){if(this.system.power.isOffline());else if(this.system.isDisabled())return;var a=i.getStrategiesByInstance(t)[0],r=a.changeTargetLoad,s=a.changeSelectedAmmo;if(r){if(r.forEach((function(e){if(!n.ammunitionClasses.some((function(t){return e.object instanceof t})))throw new Error("Illegal ammo: '".concat(e.object.constructor.name,"', allowed '").concat(n.ammunitionClasses.join(", "),"'"));if(!Number.isInteger(e.amount)||e.amount<0)throw new Error("Illegal ammo amount: '".concat(e.amount,"'"))})),r.reduce((function(e,t){return e+t.amount}),0)>this.capacity)throw new Error("Total capacity exeeded");this.targetLoad=r}if(s){if(!this.ammunitionClasses.some((function(e){return s instanceof e})))throw new Error("Illegal selected ammo: '".concat(s.constructor.name,"'"));this.selectedAmmo=s}}}},{key:"shouldBeOffline",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!0===n||this.loaded.every((function(e){return e.amount<t.ammoPerFireOrder}))}},{key:"canFire",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.loaded.find((function(e){return e.object.constructor===t.selectedAmmo.constructor}));return!!i&&(!(i.amount<this.ammoPerFireOrder)&&n)}},{key:"onIntercept",value:function(){this.onWeaponFired()}},{key:"onWeaponFired",value:function(){var e=this,t=this.loaded.find((function(t){return t.object.constructor===e.selectedAmmo.constructor}));if(!t)throw new Error("Seems like you fired a weapon without ammo. That is not good");t.amount-=this.ammoPerFireOrder,this.system.log.getGenericLogEntry().addMessage("Expended ordnance: ".concat(this.ammoPerFireOrder," x ").concat(this.selectedAmmo.getDisplayName())),this.loaded=this.loaded.filter((function(e){return e.amount>0})),this._changeSelectedAmmoIfOutOfAmmo()}},{key:"advanceTurn",value:function(){if(this.system.power.isOffline())this.turnsOffline++;else{if(this.system.isDisabled())return;this.turnsOffline=0}this.turnsOffline>this.startLoadingAfter&&this._load()}},{key:"_changeSelectedAmmoIfOutOfAmmo",value:function(){var e=this;if(0!==this.loaded.length&&!this.loaded.find((function(t){return t.object.constructor===e.selectedAmmo.constructor}))){var t=this.loaded.find((function(t){return t.amount>e.ammoPerFireOrder}));t&&(this.selectedAmmo=t.object)}}},{key:"_load",value:function(){for(var e=this,t=0,n=0,i=this.system.shipSystems.ship,a=new Cm;n!==this.intakeInTurn&&!this.loaded.every((function(t){var r=e.targetLoad.find((function(e){return e.object.constructor===t.object.constructor}));if(r&&r.amount>=t.amount)return!0;var s=r?t.amount-r.amount:t.amount;if(s>e.intakeInTurn-n&&(s=e.intakeInTurn-n),0===s)return!0;var o=a.hasSpaceForHowMany(i,{object:t.object,amount:s});return 0===o||(o<s&&(s=o),a.divideCargo(i,{object:t.object,amount:s}),n+=s,t.amount-=s,!1)})););for(this.loaded=this.loaded.filter((function(e){return e.amount>0}));t!==this.intakeInTurn&&!this.targetLoad.every((function(n){var i=e.loaded.find((function(e){return n.object.constructor===e.object.constructor}));if(!i&&n.amount>0)i={object:n.object,amount:0},e.loaded.push(i);else if(!i&&0===n.amount)return!0;if(i.amount>=n.amount)return!0;var a=e.system.shipSystems.getSystems().find((function(e){return e.callHandler("getCargoEntry",n.object,null)}));if(!a)return!0;var r=a.callHandler("getCargoEntry",n.object,null),s=n.amount-i.amount;return s>e.intakeInTurn-t&&(s=e.intakeInTurn-t),r.amount>=s?(i.amount+=s,a.callHandler("removeCargo",{object:r.object,amount:s}),t+=s):r.amount<s&&(i.amount+=r.amount,a.callHandler("removeCargo",{object:r.object,amount:r.amount}),t+=r.amount),!1})););this._changeSelectedAmmoIfOutOfAmmo()}}]),t}(cr),Em=function(e){function t(e,n){var i=e.id;return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,{id:i,armor:1,hitpoints:4},[new Hd(1),new nm(1),new am(n),new $d(30),new em([{range:0,modifier:0},{range:10,modifier:-20},{range:15,modifier:-50},{range:18,modifier:-100},{range:20,modifier:-200}]),new im(1),new om(null,null,0,6,5),new cm(1,2),new Tm([Cr],6,24,12),new wm("UniversalBolt",{size:6,speed:.35,color:[1,.9,.8],explosionSize:3}),new Xd(3),new Qd(3)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"30mm PDC"}},{key:"getBackgroundImage",value:function(){return"/img/system/gatlingPulseCannon.png"}},{key:"getSystemDescription",value:function(){return"Fast tracking 30mm rotary autocannon for point defense. Uses conventional bullets with chemical propellant."}}]),t}(bm),Am=function(e){function t(e,n){var i=e.id;return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,{id:i,hitpoints:8,armor:4},[new nm(1),new am(n),new $d(10),new em([{range:0,modifier:-100},{range:30,modifier:0},{range:190,modifier:-200}]),new im(3),new Hd(4),new Md(3,1),new om(null,null,0,2,20),new Tm([Ir,Dr],1,12,4),new wm("UniversalBolt",{size:6,length:100,speed:1.3,color:[1,.8,.4],explosionType:"gas",explosionSize:12}),new Yd(3,2)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"120mm fixed railgun"}},{key:"getBackgroundImage",value:function(){return"/img/system/stdParticleBeam.png"}}]),t}(bm),Pm=function(e){function t(e,n){var i=e.id;return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,{id:i,hitpoints:12,armor:3},[new nm(2),new am(n),new $d(10),new em([{range:0,modifier:-50},{range:10,modifier:0},{range:200,modifier:-200}]),new im(3),new Hd(6),new Md(6,1),new om(null,null,0,3,20),new Tm([Ar,Pr],1,9,4),new wm("UniversalBolt",{size:6,length:100,speed:1.3,color:[1,.8,.4],explosionType:"gas"}),new Yd(5,3)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"2x140mm railgun"}},{key:"getBackgroundImage",value:function(){return"/img/system/twinArray.png"}}]),t}(bm),Im=function(e){function t(e,n){var i=e.id;return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,{id:i,hitpoints:9,armor:3},[new nm(1),new am(n),new $d(15),new em([{range:0,modifier:-50},{range:10,modifier:0},{range:250,modifier:-200}]),new im(3),new Hd(4),new Md(5,2),new om(null,null,0,3,15),new Tm([Ar,Pr],1,9,4),new wm("UniversalBolt",{size:6,length:100,speed:1.3,color:[1,.8,.4],explosionType:"gas"}),new Yd(3,2)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"140mm railgun"}},{key:"getBackgroundImage",value:function(){return"/img/system/turretMedium1.png"}}]),t}(bm),Dm=function(e){function t(e,n,i,a){var r;return Object(T.a)(this,t),(r=Object(A.a)(this,Object(P.a)(t).call(this))).loadingTime=a,r.launcherIndex=e,r.loadedTorpedo=n,r.nextTorpedoClass=null,r.torpedoClass=i,r.turnsLoaded=a,r.changeAmmo=null,r.previousTorpedo=null,r.launchTarget=null,r}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getUiComponents",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(Object(ta.a)(t),[{name:"TorpedoLauncher",props:{launcherIndex:this.launcherIndex,loadedTorpedo:this.loadedTorpedo,loadingTime:this.loadingTime,turnsLoaded:this.turnsLoaded>this.loadingTime?this.loadingTime:this.turnsLoaded,torpedoClass:this.torpedoClass,launchTarget:this.launchTarget,launcher:this}}])}},{key:"serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Object(pi.a)({},t);return n["torpedoLauncherStrategy".concat(this.launcherIndex)]={turnsLoaded:this.turnsLoaded,loadedTorpedo:this.loadedTorpedo?this.loadedTorpedo.constructor.name:null,changeAmmo:this.changeAmmo,launchTarget:this.launchTarget},n}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e["torpedoLauncherStrategy".concat(this.launcherIndex)]||{};return this.turnsLoaded=t.turnsLoaded||0,this.loadedTorpedo=t.loadedTorpedo?new Rr[t.loadedTorpedo]:null,this.changeAmmo=t.changeAmmo||null,this.launchTarget=t.launchTarget||null,this}},{key:"loadAmmoInstant",value:function(e){var t=e.ammo;e.launcherIndex!==this.launcherIndex||this.loadedTorpedo&&this.loadedTorpedo.constructor.name===t.constructor.name||(this.loadedTorpedo=t,this.turnsLoaded=this.loadingTime)}},{key:"unloadAmmo",value:function(e){e.launcherIndex;this.launcherIndex}},{key:"setLaunchTarget",value:function(e){this.turnsLoaded<this.loadingTime||!this.loadedTorpedo||(this.launchTarget=e)}},{key:"launchTorpedo",value:function(e,t){if(this.turnsLoaded<this.loadingTime||!this.loadedTorpedo||!this.launchTarget)return t;var n=new dl(this.loadedTorpedo,this.launchTarget,this.system.shipSystems.ship.id,this.system.id,this.launcherIndex);return[].concat(Object(ta.a)(t),[n])}},{key:"loadAmmo",value:function(e){var t=e.ammo;if(!(e.launcherIndex!==this.launcherIndex||this.loadedTorpedo&&this.loadedTorpedo.constructor.name===t.constructor.name)){var n=this.system.shipSystems.getSystems().find((function(e){return e.callHandler("hasCargo",{object:t},!1)}));n.callHandler("removeCargo",{object:t}),this.loadedTorpedo&&n.callHandler("addCargo",{object:this.loadedTorpedo}),this.previousTorpedo&&this.previousTorpedo.constructor.name===t.constructor.name?(this.loadedTorpedo=this.previousTorpedo,this.turnsLoaded=this.previousTurnsLoaded,this.changeAmmo=null):(this.previousTorpedo||(this.previousTorpedo=this.loadedTorpedo,this.previousTurnsLoaded=this.turnsLoaded),this.turnsLoaded=0,this.changeAmmo={ammo:t.constructor.name,from:n.id},this.loadedTorpedo=t),this.launchTarget=null}}},{key:"getLoadedLaunchers",value:function(e,t){return this.turnsLoaded>=this.loadingTime&&this.loadedTorpedo?[].concat(Object(ta.a)(t),[this]):t}},{key:"receiveAmmoChange",value:function(e){var t=new Rr[e.ammo],n=this.system.shipSystems.getSystemById(e.from);if(!n.callHandler("hasCargo",{object:t}))throw new Error("Trying to take cargo form ".concat(n.id,", but no appropriate cargo found"));n.callHandler("removeCargo",{object:t}),this.loadedTorpedo&&n.callHandler("addCargo",{object:this.loadedTorpedo}),this.loadedTorpedo=t,this.turnsLoaded=0}},{key:"receivePlayerData",value:function(e){e.clientShip;var t=e.clientSystem;if(t&&!this.system.isDisabled()){var n=Mm(t,this.launcherIndex),i=n.changeAmmo;if(i&&this.receiveAmmoChange(i),n.launchTarget){if(this.turnsLoaded<this.loadingTime||!this.loadedTorpedo)throw new Error("Trying to set launch target, but weapon is not loaded");this.launchTarget=n.launchTarget}}}},{key:"getPossibleTorpedosToLoad",value:function(){var e=this,t=[];return this.system.shipSystems.getSystems().forEach((function(n){n.callHandler("getCargoByParentClass",e.torpedoClass,[]).forEach((function(e){var n=t.find((function(t){return t.object.constructor.name===e.object.constructor.name}));n?n.amount+=e.amount:t.push({object:e.object,amount:e.amount})}))})),t}},{key:"advanceTurn",value:function(){this.changeAmmo=null,this.previousTorpedo=null,this.launchTarget=null,!this.system.isDisabled()&&this.loadedTorpedo?this.turnsLoaded++:this.turnsLoaded=0}}]),t}(cr),Mm=function(e,t){return e.strategies.find((function(e){return e instanceof Dm&&e.launcherIndex===t}))},zm=Dm,Rm=function(e){function t(e){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new zm(1,null,dr,3)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"1.53m torpedo launcher"}},{key:"getBackgroundImage",value:function(){return"/img/system/missile1.png"}},{key:"getIconText",value:function(){return null}}]),t}(bm),Fm=function(e){function t(e){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new zm(1,null,wr,3),new zm(2,null,wr,3)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"0.72m dual torpedo launcher"}},{key:"getBackgroundImage",value:function(){return"/img/system/missile2.png"}},{key:"getIconText",value:function(){return null}}]),t}(bm),Hm=function(e){function t(e){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new zm(1,null,dr,3),new zm(2,null,dr,3)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"1.53m dual torpedo launcher"}},{key:"getBackgroundImage",value:function(){return"/img/system/missile2.png"}},{key:"getIconText",value:function(){return null}}]),t}(bm),Lm=function(e){function t(e){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new zm(1,null,dr,3),new zm(2,null,dr,3),new zm(3,null,dr,3),new zm(4,null,dr,3)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"4x 1.53m torpedo launcher"}},{key:"getBackgroundImage",value:function(){return"/img/system/missile4.png"}},{key:"getIconText",value:function(){return null}}]),t}(bm),Bm=function(e){function t(e,n){var i=e.id;return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,{id:i,armor:1,hitpoints:6},[new Hd(2),new nm(1),new am(n),new $d(20),new em([{range:0,modifier:0},{range:20,modifier:-20},{range:50,modifier:-50},{range:100,modifier:-200}]),new im(1),new om(null,null,0,3,10),new cm,new Tm([Er,Tr],3,15,6),new wm("UniversalBolt",{size:8,speed:.5,color:[1,.7,.7],explosionSize:5}),new Xd(3),new Qd(8)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"85mm Autocannon"}},{key:"getBackgroundImage",value:function(){return"/img/system/lightParticleBeamShip.png"}}]),t}(bm),_m=Object(pi.a)({TestWeapon:Om,PDC30mm:Em},p,{},v,{},g,{AutoCannon85mm:Bm}),Um=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5;return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new Hd(1,!1),new Zd(i,i,5),new Lr(n),new Xd(a),new Jd(2)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"Radiator"}},{key:"getBackgroundImage",value:function(){return"/img/system/radiator.png"}},{key:"getIconText",value:function(){return""}}]),t}(or),Nm=function(e){function t(e,n){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new Hr(n)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"Heat sink"}},{key:"getBackgroundImage",value:function(){return"/img/system/heatSink.png"}},{key:"getIconText",value:function(){return""}}]),t}(or),Vm=function(e){function t(e){var n=e.id;return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,{id:n,hitpoints:5,armor:0},10,10,5))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"5x40m radiator sail"}},{key:"getBackgroundImage",value:function(){return"/img/system/radiator.png"}}]),t}(Um),Gm=function(e){function t(e){var n=e.id;return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,{id:n,hitpoints:10,armor:0},20,20,6))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"10x40m radiator sail"}},{key:"getBackgroundImage",value:function(){return"/img/system/radiator.png"}}]),t}(Um),Wm=function(e){function t(e){var n=e.id;return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,{id:n,hitpoints:12,armor:0},24,24,6))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"10x50m radiator panels"}},{key:"getBackgroundImage",value:function(){return"/img/system/radiator.png"}}]),t}(Um),qm=function(e){function t(e,n){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new Fr(n)]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"Cargo bay ".concat(this.callHandler("getTotalCargoSpace"),"m\xb3")}},{key:"getBackgroundImage",value:function(){return"/img/system/cargoBay.png"}}]),t}(or),Zm=Object(pi.a)({},l,{},h,{},d,{},m,{},f,{},_m,{},y,{CargoBay:qm}),Km=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).shipTypeName='Conley Shipyards RX11 "Rhino"',n.shipModel=n.accelcost=3,n.rollcost=3,n.pivotcost=3,n.evasioncost=3,n.shipModel="Rhino",n.pointCost=500,n.systems.addFrontSystem([new Zm.ManeuveringThruster({id:101,hitpoints:10,armor:3},3,2)]),n.systems.addPrimarySystem([new Zm.Thruster({id:1,hitpoints:10,armor:3},5,0),new Zm.Thruster({id:2,hitpoints:10,armor:3},5,0),new Zm.Thruster({id:8,hitpoints:10,armor:3},5,[1,2]),new Zm.Thruster({id:9,hitpoints:10,armor:3},5,[4,5]),new Zm.Thruster({id:3,hitpoints:10,armor:3},5,3),new Zm.Thruster({id:4,hitpoints:10,armor:3},5,3),new Zm.Engine({id:5,hitpoints:10,armor:3},12,6,2),new Zm.Engine({id:6,hitpoints:10,armor:3},12,6,2),new Zm.Reactor({id:7,hitpoints:10,armor:3},20),new Zm.Structure({id:11,hitpoints:30,armor:4})]),n.systems.addAftSystem([new Zm.ManeuveringThruster({id:201,hitpoints:10,armor:3},3,2)]),n}return Object(I.a)(t,e),t}(is),Xm=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"setShipProperties",value:function(){this.shipTypeName="Haka XCD-33 Battleship",this.hexSizes=[new nn(2,0),new nn(1,0),new nn(0,0),new nn(-1,0)],this.accelcost=5,this.rollcost=18,this.pivotcost=10,this.evasioncost=10,this.maxPivots=1,this.frontHitProfile=70,this.sideHitProfile=160,this.description="",this.shipModel="Haka",this.pointCost=500,this.systems.addFrontSystem([new Zm.Thruster({id:103,hitpoints:10,armor:3},5,0),new Zm.RailgunTurreted140mmUC({id:118},{start:210,end:150}),new Zm.RailgunTurreted140mmUC({id:119},{start:210,end:150}),new Zm.Thruster({id:104,hitpoints:10,armor:3},5,0),new Zm.PDC30mm({id:114,hitpoints:5,armor:3},{start:200,end:160}),new Zm.PDC30mm({id:115,hitpoints:5,armor:3},{start:200,end:160}),new Zm.PDC30mm({id:116,hitpoints:5,armor:3},{start:200,end:160}),new Zm.PDC30mm({id:117,hitpoints:5,armor:3},{start:200,end:160}),new Zm.EwArray({id:120,hitpoints:10,armor:5,boostable:!1,heat:7,power:13},5),new Zm.OEWArray({id:121,hitpoints:10,armor:5,boostable:!1,heat:6,power:8},5),new Zm.Structure({id:111,hitpoints:80,armor:4,cargoSpace:400,radiator:15})]),this.systems.addPrimarySystem([new Zm.Engine({id:6,hitpoints:20,armor:5},24,6,2),new Zm.Reactor({id:7,hitpoints:10,armor:8},40),new Zm.Engine({id:4,hitpoints:20,armor:5},24,6,2),new Zm.Reactor({id:5,hitpoints:10,armor:8},40),new Zm.Structure({id:11,hitpoints:80,armor:6,cargoSpace:300,heatStorage:50}),new Zm.EwArray({id:12,hitpoints:25,armor:6,heat:10},10),new Zm.HeatSink({id:13,hitpoints:10,armor:3},100),new Zm.HeatSink({id:14,hitpoints:10,armor:3},100)]),this.systems.addStarboardFrontSystem([new Zm.Thruster({id:201,hitpoints:10,armor:3},5,[1,2]),new Zm.ManeuveringThrusterRight({id:205,hitpoints:10,armor:3},10,0),new Zm.RailgunTurreted2x140mm({id:202},{start:345,end:150}),new Zm.TorpedoLauncherQuadruple158({id:210,hitpoints:15,armor:3}),new Zm.TorpedoLauncherQuadruple158({id:211,hitpoints:15,armor:3}),new Zm.TorpedoLauncherQuadruple158({id:212,hitpoints:15,armor:3}),new Zm.TorpedoLauncherQuadruple158({id:213,hitpoints:15,armor:3})]),this.systems.addPortFrontSystem([new Zm.Structure({id:600,hitpoints:60,armor:7,radiator:15}),new Zm.Thruster({id:601,hitpoints:10,armor:3},5,[4,5]),new Zm.MediumCoilcunTurretedUC({id:602},{start:165,end:0}),new Zm.RailgunTurreted140mmUC({id:603},{start:195,end:3.75}),new Zm.RailgunTurreted140mmUC({id:604},{start:195,end:3.75}),new Zm.ManeuveringThrusterLeft({id:605,hitpoints:10,armor:3},10,0),new Zm.MediumCoilcunTurretedUC({id:606},{start:210,end:15})]),this.systems.addAftSystem([new Zm.Structure({id:411,hitpoints:80,armor:5,heatStorage:100,radiator:5}),new Zm.PDC30mm({id:450},{start:160,end:340}),new Zm.Thruster({id:432,hitpoints:15,armor:3},8,3),new Zm.Thruster({id:433,hitpoints:15,armor:3},8,3),new Zm.PDC30mm({id:451},{start:40,end:200}),new Zm.PDC30mm({id:452},{start:160,end:340}),new Zm.PDC30mm({id:453},{start:160,end:340}),new Zm.PDC30mm({id:456},{start:40,end:200}),new Zm.PDC30mm({id:457},{start:40,end:200}),new Zm.PDC30mm({id:454},{start:160,end:340}),new Zm.PDC30mm({id:455},{start:40,end:200})]),this.systems.addPortAftSystem([new Zm.Thruster({id:533,hitpoints:15,armor:3},8,3),new Zm.ManeuveringThrusterRight({id:501,hitpoints:10,armor:3},10,0),new Zm.Radiator10x50({id:502}),new Zm.Radiator10x50({id:503}),new Zm.PDC30mm({id:550},{start:160,end:340}),new Zm.PDC30mm({id:551},{start:160,end:340}),new Zm.PDC30mm({id:554},{start:160,end:340}),new Zm.PDC30mm({id:555},{start:160,end:340})]),this.systems.addStarboardAftSystem([new Zm.ManeuveringThrusterLeft({id:305,hitpoints:10,armor:3},10,0),new Zm.Thruster({id:333,hitpoints:15,armor:3},8,3),new Zm.Radiator10x50({id:301}),new Zm.Radiator10x50({id:302}),new Zm.PDC30mm({id:352},{start:40,end:200}),new Zm.PDC30mm({id:353},{start:40,end:200}),new Zm.PDC30mm({id:356},{start:40,end:200}),new Zm.PDC30mm({id:357},{start:40,end:200})])}},{key:"setShipLoadout",value:function(){Object(Oa.a)(Object(P.a)(t.prototype),"setShipLoadout",this).call(this);var e=new Cm;e.divideCargo(this,{object:new gr,amount:24}),e.divideCargo(this,{object:new yr,amount:20}),e.divideCargo(this,{object:new Sr,amount:36}),e.divideCargo(this,{object:new Or,amount:6}),e.divideCargo(this,{object:new Cr,amount:1700}),e.divideCargo(this,{object:new Ar,amount:220}),e.divideCargo(this,{object:new Pr,amount:550}),[this.systems.getSystemById(210),this.systems.getSystemById(211),this.systems.getSystemById(212),this.systems.getSystemById(213)].forEach((function(e){e.callHandler("loadAmmoInstant",{ammo:new gr,launcherIndex:1}),e.callHandler("loadAmmoInstant",{ammo:new gr,launcherIndex:2}),e.callHandler("loadAmmoInstant",{ammo:new yr,launcherIndex:3}),e.callHandler("loadAmmoInstant",{ammo:new Sr,launcherIndex:4})}))}}]),t}(is),Ym=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"setShipProperties",value:function(){this.accelcost=3,this.rollcost=3,this.pivotcost=3,this.evasioncost=3,this.frontHitProfile=100,this.sideHitProfile=100,this.pointCost=500,this.systems.addFrontSystem([new Zm.TestWeapon({id:20,hitpoints:6,armor:2},[{start:0,end:180}]),new Zm.RailgunTurreted2x140mm({id:101,hitpoints:6,armor:2},[{start:0,end:180}]),new Zm.PDC30mm({id:102},[{start:0,end:0}]),new Zm.PDC30mm({id:103},[{start:0,end:0}])]),this.systems.addPrimarySystem([new Zm.Thruster({id:1,hitpoints:10,armor:3},5,0),new Zm.Thruster({id:2,hitpoints:10,armor:3},5,0),new Zm.Thruster({id:8,hitpoints:10,armor:3},5,[1,2]),new Zm.Thruster({id:9,hitpoints:10,armor:3},5,[4,5]),new Zm.Thruster({id:3,hitpoints:10,armor:3},5,3),new Zm.Thruster({id:4,hitpoints:10,armor:3},5,3),new Zm.ManeuveringThruster({id:10,hitpoints:10,armor:3},9,3),new Zm.Engine({id:5,hitpoints:10,armor:3},12,6,2),new Zm.Engine({id:6,hitpoints:10,armor:3},12,6,2),new Zm.Reactor({id:7,hitpoints:20,armor:3},28),new Zm.EwArray({id:11,hitpoints:10,armor:3},10),new Zm.TorpedoLauncherDual158({id:202,hitpoints:20,armor:6}),new Zm.TorpedoLauncherDual72({id:203,hitpoints:20,armor:6}),new Zm.TorpedoLauncherDual72({id:206,hitpoints:20,armor:6}),new Zm.CargoBay({id:204,hitpoints:20,armor:4},500),new Zm.Structure({id:205,hitpoints:40,armor:5,heatStorage:200,radiator:5})])}},{key:"setShipLoadout",value:function(){Object(Oa.a)(Object(P.a)(t.prototype),"setShipLoadout",this).call(this);var e=this.systems.getSystemById(204);e.callHandler("addCargo",{object:new gr,amount:14}),e.callHandler("addCargo",{object:new kr,amount:14}),this.systems.getSystemById(202).callHandler("loadAmmoInstant",{ammo:new gr,launcherIndex:1}),this.systems.getSystemById(202).callHandler("loadAmmoInstant",{ammo:new gr,launcherIndex:2}),this.systems.getSystemById(203).callHandler("loadAmmoInstant",{ammo:new kr,launcherIndex:1}),this.systems.getSystemById(203).callHandler("loadAmmoInstant",{ammo:new kr,launcherIndex:2}),this.systems.getSystemById(206).callHandler("loadAmmoInstant",{ammo:new jr,launcherIndex:1}),this.systems.getSystemById(206).callHandler("loadAmmoInstant",{ammo:new jr,launcherIndex:2})}}]),t}(is),Qm=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"setShipProperties",value:function(){this.shipTypeName="OuterLight Industries Caliope OI-E1 cruiser",this.hexSizes=[new nn(2,0),new nn(1,0),new nn(0,0),new nn(-1,0)],this.accelcost=3,this.rollcost=3,this.pivotcost=3,this.evasioncost=3,this.description="\n        Caliope cruiser was initially conceived with grandiose goals of including\n        battleship capabilities on cruiser tonnage class spaceframe. \n\n        First two Caliope A1 prototypes built by Patria Space were equipped with three Silverbreak 12 fusion engines,\n        two kinetic batteries, two light PDCs, three medium PDCs, two Hayfire 45MW railgun turrets and\n        eight 1.2m and two 3.5m missile tubes.  The spaceframes were built around and powered by \n        two Langban-Zukov class III fusion generators.\n\n        On field testing the new ships failed to meet the required specifications. The spaceframe turned out unable to\n        provide stable enough firing platform for the railgun turrets causing buildup of micro fractures\n        and resulting in subpar accuracy and reliability for the guns. Caliope was also found under armored for\n        fighting in the battleship class. \n\n        One of the prototypes where modified to Caliope A2 by substituting the railgun turrets with fixed mount railguns. \n        Filed testing of Caliope A2 showed the ship too unmanouverable to use the fixed railguns efficiently and this \n        modification failed to save the design.\n\n        Caliope project was abandoned as a failure, but subsequently aquired by OuterLight Industries when Patria Space \n        ran into finiancial difficulties. An experienced ship designed Markov Mohammed saw promise in the Caliope. \n\n        Caliope was repurposed to a long range cruiser by removing the railgun turrets. Freed space was used for extra\n        crew quarters, cargo and fuel space. The armor of the ship was reduced to gain much needed manouverability and\n        bring the spaceframe to safe structural stress levels. Abandoning the railguns left the ship with considerable\n        surplus of energy production and heat management capacity. This allowed the upgrade of the engines to more\n        powerful Silverbreak 15R model. Armament wise the new Caliope OI-B1 was equiped with four Maltech 210mm Twin kinetic\n        cannon turrets and seven 20mm Maltech PDCs. The missile launchers and magazines were left untouched.\n\n        These changes resulted in a ship considerably different from the initial design goals. First four Caliope OL-B3 cruisers\n        delivered to the Protectorate found great success in counter piracy role. Even tough Caliope is considered underarmored and\n        less than ideally manouverable for a mainstay cruiser, it can operate extended durations without resupply and it has an excellent\n        acceleration and heat management for extended chases. Perfect for running down pirates. Caliopes missile capabilities has\n        found use in fleet action as a missile picket ship. Caliopes engage in missile barrages but avoid close fighting. If \n        fleets close in, Caliopes are kept in reserve to chase down and finish damaged enemy vessels. Caliopes are also \n        suited to supplying smaller ships, altough more specialized ships can perform this role better.\n    ",this.shipModel="Caliope",this.pointCost=500,this.systems.addFrontSystem([new Zm.Thruster({id:103,hitpoints:10,armor:3},5,0),new Zm.PDC30mm({id:114,hitpoints:5,armor:3},{start:200,end:160}),new Zm.PDC30mm({id:115,hitpoints:5,armor:3},{start:200,end:160}),new Zm.Thruster({id:104,hitpoints:10,armor:3},5,0),new Zm.Structure({id:111,hitpoints:40,armor:5,heatStorage:20,radiator:3}),new Zm.ManeuveringThruster({id:101,hitpoints:10,armor:3},3,2)]),this.systems.addPrimarySystem([new Zm.Engine({id:6,hitpoints:20,armor:5},24,6,2),new Zm.Reactor({id:7,hitpoints:10,armor:8},20),new Zm.Structure({id:11,hitpoints:60,armor:4,cargoSpace:300,heatStorage:80,radiator:15}),new Zm.EwArray({id:12,hitpoints:15,armor:6},8),new Zm.HeatSink({id:13,hitpoints:10,armor:3},100)]),this.systems.addStarboardFrontSystem([new Zm.Thruster({id:201,hitpoints:10,armor:3},5,[1,2]),new Zm.RailgunTurreted2x140mm({id:213,hitpoints:8,armor:4},{start:330,end:90}),new Zm.PDC30mm({id:202,hitpoints:4,armor:3},{start:0,end:180}),new Zm.AutoCannon85mm({id:203,hitpoints:6,armor:3},{start:330,end:160}),new Zm.AutoCannon85mm({id:204,hitpoints:6,armor:3},{start:330,end:160})]),this.systems.addPortFrontSystem([new Zm.RailgunTurreted2x140mm({id:612,hitpoints:8,armor:4},{start:270,end:30}),new Zm.Thruster({id:601,hitpoints:10,armor:3},5,[4,5]),new Zm.AutoCannon85mm({id:603,hitpoints:6,armor:3},{start:200,end:30}),new Zm.PDC30mm({id:602,hitpoints:4,armor:3},{start:180,end:0}),new Zm.AutoCannon85mm({id:604,hitpoints:6,armor:3},{start:200,end:30})]),this.systems.addAftSystem([new Zm.ManeuveringThruster({id:401,hitpoints:10,armor:3},3,2),new Zm.Thruster({id:431,hitpoints:15,armor:3},8,3),new Zm.Thruster({id:432,hitpoints:15,armor:3},8,3),new Zm.Thruster({id:433,hitpoints:15,armor:3},8,3),new Zm.Structure({id:411,hitpoints:80,armor:4,heatStorage:100,radiator:5}),new Zm.Radiator10x40({id:412,hitpoints:10,armor:3}),new Zm.Reactor({id:407,hitpoints:10,armor:3},30),new Zm.AutoCannon85mm({id:421,hitpoints:6,armor:3},{start:0,end:0})]),this.systems.addPortAftSystem([new Zm.Radiator10x40({id:501}),new Zm.CargoBay({id:502,hitpoints:20,armor:4},150),new Zm.TorpedoLauncher158({id:503,hitpoints:10,armor:4}),new Zm.TorpedoLauncherDual72({id:504,hitpoints:10,armor:4}),new Zm.AutoCannon85mm({id:521,hitpoints:6,armor:3},{start:160,end:30})]),this.systems.addStarboardAftSystem([new Zm.Radiator10x40({id:301}),new Zm.CargoBay({id:302,hitpoints:20,armor:4},150),new Zm.TorpedoLauncher158({id:303,hitpoints:10,armor:4}),new Zm.TorpedoLauncherDual72({id:304,hitpoints:10,armor:4}),new Zm.AutoCannon85mm({id:321,hitpoints:6,armor:3},{start:330,end:200})])}},{key:"setShipLoadout",value:function(){Object(Oa.a)(Object(P.a)(t.prototype),"setShipLoadout",this).call(this);var e=new Cm;e.divideCargo(this,{object:new kr,amount:12}),e.divideCargo(this,{object:new jr,amount:12}),e.divideCargo(this,{object:new gr,amount:12}),e.divideCargo(this,{object:new Or,amount:2}),e.divideCargo(this,{object:new Cr,amount:800}),e.divideCargo(this,{object:new Ar,amount:40}),e.divideCargo(this,{object:new Pr,amount:80}),e.divideCargo(this,{object:new Er,amount:200}),e.divideCargo(this,{object:new Tr,amount:400}),this.systems.getSystemById(303).callHandler("loadAmmoInstant",{ammo:new gr,launcherIndex:1}),this.systems.getSystemById(503).callHandler("loadAmmoInstant",{ammo:new gr,launcherIndex:1}),this.systems.getSystemById(304).callHandler("loadAmmoInstant",{ammo:new kr,launcherIndex:1}),this.systems.getSystemById(304).callHandler("loadAmmoInstant",{ammo:new jr,launcherIndex:2}),this.systems.getSystemById(504).callHandler("loadAmmoInstant",{ammo:new kr,launcherIndex:1}),this.systems.getSystemById(504).callHandler("loadAmmoInstant",{ammo:new jr,launcherIndex:2})}}]),t}(is),Jm=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"setShipProperties",value:function(){this.shipTypeName="OuterLight Industries Mouros 118-A mainstay battleship",this.accelcost=3,this.rollcost=3,this.pivotcost=3,this.evasioncost=3,this.hexSizes=[new nn(-2,0),new nn(-1,0),new nn(0,0),new nn(1,0),new nn(2,0),new nn(3,0)],this.description="",this.shipModel="Mouros",this.pointCost=500,this.systems.addFrontSystem([new Zm.ManeuveringThruster({id:101,hitpoints:10,armor:3},3,2),new Zm.Structure({id:102,hitpoints:40,armor:6})]),this.systems.addPrimarySystem([new Zm.Thruster({id:1,hitpoints:10,armor:3},5,0),new Zm.Thruster({id:2,hitpoints:10,armor:3},5,0),new Zm.EwArray({id:12,hitpoints:30,armor:4},8),new Zm.Engine({id:5,hitpoints:10,armor:7},10,6,2),new Zm.Reactor({id:7,hitpoints:10,armor:3},20),new Zm.Structure({id:11,hitpoints:50,armor:5})]),this.systems.addAftSystem([new Zm.ManeuveringThruster({id:201,hitpoints:10,armor:3},3,2),new Zm.Engine({id:206,hitpoints:20,armor:7},15,6,2),new Zm.Thruster({id:203,hitpoints:10,armor:3},5,3),new Zm.Thruster({id:204,hitpoints:10,armor:3},5,3),new Zm.Structure({id:202,hitpoints:80,armor:4})]),this.systems.addStarboardAftSystem([new xm({id:301,hitpoints:10,armor:3},{start:0,end:183}),new Zm.Thruster({id:308,hitpoints:10,armor:3},5,[1,2])]),this.systems.addPortAftSystem([new xm({id:501,hitpoints:10,armor:3},{start:177,end:0}),new Zm.Thruster({id:508,hitpoints:10,armor:3},5,[4,5])])}}]),t}(is),$m=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"setShipProperties",value:function(){this.shipTypeName="Arakaki Systems Fulcrum IV fleet destroyer",this.accelcost=2,this.rollcost=4,this.pivotcost=1,this.evasioncost=3,this.hexSizes=[new nn(1,0),new nn(0,0),new nn(-1,0)],this.description="\n       Fulcrum was ordered to fill the role of a fleet destroyer. A ship that packs enough of a punch in \n       sufficiently armored frame to engage in front line fleet combat. The design requirements allowed\n       a considerable defieciency in endurance making the Fulcrum a ship that needs a supporting fleet\n       to operate in a meaningful role on a modern battlefield. \n\n       Arakaki Systems won the contract with the Fulcrum design. Fulcrum sacrifices endurance, \n       heat management and some speed to bring on a battlefield a destroyed armed with a spinal\n       mounted railgun, three kinetic cannons on a fixed bow mount, considerable six light PDCs \n       and a two missile launchers. All this in well armored spaceframe. \n\n       A squadron of Fulcrums can turn a battle if employed properly, but their role and \n       commitment must be well planned. A Fulcrum can function in a role of escort, rail gun attack craft\n       or close attack craft, but lack the endurance and heat management to keep up sustained railgun fire\n       or the manouvers needed in close quarters. This forces Fulcrums to disengage under fleet\n       protection to extends radiators or in extreme cases to resupply fuel and ammunition.\n\n       While the Fulcrum has a considerable PDC grid its missile capacity is greatly lacking for anything\n       else than defense or employment against unarmed or disabled targets. Fulcrums are also considered\n       undercrewed by many fleet standards. In combat operations the crew must work and live in cramped \n       conditions in extended shifts. Crew compliment does not include any marines, and the ship \n       deck plan is not optimized for repeling boarders, nor does it have any capacity for holding prisoners.\n\n       Regardless of this long list of deficiencies, a Fulcrum can employ a combination of superior\n       weaponry and manouverability to create an engagement where Fulcrum can effectively either \n       out range or out gun its opponent. In close quarter battle a Fulcrum can engage an opponent\n       and with superior armor still disengage with neglible damage to critical systems.\n    ",this.shipModel="Fulcrum",this.pointCost=500,this.systems.addFrontSystem([new Zm.Structure({id:100,hitpoints:30,armor:5,heatStorage:30}),new Zm.CoilgunLightFixed({id:102},{start:330,end:30}),new Zm.RailgunFixed120mm({id:103},{start:330,end:30}),new Zm.RailgunFixed120mm({id:104},{start:330,end:30}),new Zm.RailgunFixed120mm({id:105},{start:330,end:30}),new Zm.Thruster({id:106,hitpoints:10,armor:3},3,0),new Zm.Thruster({id:107,hitpoints:10,armor:3},3,0),new Zm.ManeuveringThruster({id:101,hitpoints:10,armor:3},3,2),new Zm.TorpedoLauncherDual72({id:108,hitpoints:10,armor:4})]),this.systems.addPrimarySystem([new Zm.EwArray({id:12,hitpoints:12,armor:6},7,5),new Zm.Reactor({id:7,hitpoints:15,armor:7},35),new Zm.Structure({id:11,hitpoints:30,armor:6,cargoSpace:100,heatStorage:70,radiator:5}),new Zm.PDC30mm({id:14,alwaysTargetable:!0},{start:0,end:0})]),this.systems.addAftSystem([new Zm.Structure({id:200,hitpoints:40,armor:6,heatStorage:20,radiator:10}),new Zm.Engine({id:202,hitpoints:20,armor:3},14,6,2),new Zm.ManeuveringThruster({id:201,hitpoints:10,armor:3},3,2),new Zm.Thruster({id:203,hitpoints:15,armor:3},21,3),new Zm.PDC30mm({id:214,alwaysTargetable:!0},{start:0,end:0}),new Zm.Radiator5x40({id:316}),new Zm.CargoBay({id:317,hitpoints:10,armor:4},100)]),this.systems.addStarboardFrontSystem([new Zm.PDC30mm({id:15,hitpoints:5,armor:3},{start:0,end:180})]),this.systems.addStarboardAftSystem([new Zm.PDC30mm({id:215,hitpoints:5,armor:3},{start:0,end:180}),new Zm.Radiator5x40({id:216})]),this.systems.addPortFrontSystem([new Zm.PDC30mm({id:13,hitpoints:5,armor:3},{start:180,end:0})]),this.systems.addPortAftSystem([new Zm.PDC30mm({id:213,hitpoints:5,armor:3},{start:180,end:0}),new Zm.Radiator5x40({id:416})])}},{key:"setShipLoadout",value:function(){Object(Oa.a)(Object(P.a)(t.prototype),"setShipLoadout",this).call(this);var e=new Cm;e.divideCargo(this,{object:new kr,amount:12}),e.divideCargo(this,{object:new Cr,amount:120}),e.divideCargo(this,{object:new Ir,amount:20}),e.divideCargo(this,{object:new Dr,amount:20}),this.systems.getSystemById(108).callHandler("loadAmmoInstant",{ammo:new kr,launcherIndex:1}),this.systems.getSystemById(108).callHandler("loadAmmoInstant",{ammo:new kr,launcherIndex:2})}}]),t}(is),ef=function(e){function t(e,n){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e,[new Hd(2),new nm(2),new am(n),new $d(30),new em([{range:0,modifier:0},{range:10,modifier:-20},{range:15,modifier:-50},{range:18,modifier:-100},{range:20,modifier:-200}]),new im(1),new om("d2","d3+2",0,6,5),new cm(2),new Tm([Cr],6,36,12),new wm("UniversalBolt",{size:6,speed:.35,color:[1,.8,.4],shots:6})]))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getDisplayName",value:function(){return"2x30mm PDC"}},{key:"getBackgroundImage",value:function(){return"/img/system/gatlingPulseCannon.png"}}]),t}(bm),tf=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"setShipProperties",value:function(){this.shipTypeName="Impetous",this.accelcost=3,this.rollcost=3,this.pivotcost=3,this.evasioncost=3,this.hexSizes=[new nn(3,0),new nn(2,0),new nn(1,0),new nn(0,0),new nn(-1,0),new nn(-2,0),new nn(-3,0),new nn(-4,0),new nn(3,1),new nn(2,1),new nn(1,1),new nn(0,1),new nn(-1,1),new nn(-2,1),new nn(-3,1),new nn(3,-1),new nn(2,-1),new nn(1,-1),new nn(0,-1),new nn(-1,-1),new nn(-2,-1),new nn(-3,-1)],this.description="",this.shipModel="Impetous",this.pointCost=500,this.systems.addFrontSystem([new Zm.ManeuveringThruster({id:1,hitpoints:10,armor:3},3,2),new Zm.Structure({id:100,hitpoints:90,armor:5})]),this.systems.addPrimarySystem([new Zm.Thruster({id:601,hitpoints:10,armor:3},5,0),new Zm.Thruster({id:602,hitpoints:10,armor:3},5,0),new Zm.Thruster({id:603,hitpoints:10,armor:3},5,3),new Zm.Thruster({id:604,hitpoints:10,armor:3},5,3),new Zm.EwArray({id:612,hitpoints:30,armor:4},8),new Zm.Engine({id:605,hitpoints:10,armor:3},12,6,2),new Zm.Engine({id:606,hitpoints:10,armor:3},12,6,2),new Zm.Reactor({id:607,hitpoints:10,armor:3},20),new Zm.Structure({id:611,hitpoints:75,armor:6}),new Sm({id:613,hitpoints:20,armor:3},[{start:30,end:150},{start:210,end:330}]),new Sm({id:614,hitpoints:20,armor:3},[{start:30,end:150},{start:210,end:330}])]),this.systems.addAftSystem([new Zm.ManeuveringThruster({id:201,hitpoints:10,armor:3},3,2),new Zm.TorpedoLauncherDual158({id:202,hitpoints:20,armor:6}),new Zm.TorpedoLauncherDual158({id:203,hitpoints:20,armor:6}),new Zm.CargoBay({id:204,hitpoints:20,armor:4},500),new Zm.Structure({id:200,hitpoints:90,armor:5})]),this.systems.addStarboardFrontSystem([new ef({id:101,hitpoints:5,armor:3},{start:0,end:180}),new ef({id:102,hitpoints:5,armor:3},{start:0,end:180}),new ef({id:103,hitpoints:5,armor:3},{start:0,end:180}),new Zm.Thruster({id:104,hitpoints:10,armor:3},5,[1,2])]),this.systems.addPortFrontSystem([new ef({id:501,hitpoints:5,armor:3},{start:180,end:0}),new ef({id:502,hitpoints:5,armor:3},{start:180,end:0}),new ef({id:503,hitpoints:5,armor:3},{start:180,end:0}),new Zm.Thruster({id:504,hitpoints:10,armor:3},5,[4,5])])}},{key:"setShipLoadout",value:function(){Object(Oa.a)(Object(P.a)(t.prototype),"setShipLoadout",this).call(this);var e=this.systems.getSystemById(204);e.callHandler("addCargo",{object:new gr,amount:14}),e.callHandler("addCargo",{object:new Or,amount:2}),this.systems.getSystemById(202).callHandler("loadAmmoInstant",{ammo:new gr,launcherIndex:1}),this.systems.getSystemById(202).callHandler("loadAmmoInstant",{ammo:new gr,launcherIndex:2}),this.systems.getSystemById(203).callHandler("loadAmmoInstant",{ammo:new gr,launcherIndex:1}),this.systems.getSystemById(203).callHandler("loadAmmoInstant",{ammo:new gr,launcherIndex:2})}}]),t}(is),nf=Object(pi.a)({},b,{},w,{},O,{},k),af=function(e){var t=e.shipClass;if(console.log("haka is ",new nf.Haka),console.log("ship class is ",t),!t)throw new Error("Ship class missing, can not construct a ship");try{return new nf[t](e)}catch(n){throw console.error('Unable to construct ship of class "'.concat(t,'"')),n}},rf=function(){function e(t){Object(T.a)(this,e),this.gameData=t,this.ships=[]}return Object(E.a)(e,[{key:"isSameTeam",value:function(e,t){return this.gameData.slots.getTeamForShip(e)===this.gameData.slots.getTeamForShip(t)}},{key:"addShip",value:function(e){if(e.id&&this.getShipById(e.id))throw new Error("Duplicate ship id added to gamedata");return this.ships.push(e),this}},{key:"getShips",value:function(){return this.ships}},{key:"getAliveShips",value:function(){return this.ships.filter((function(e){return!e.isDestroyed()}))}},{key:"getShipById",value:function(e){return this.ships.find((function(t){return t.id===e}))}},{key:"getUsersShips",value:function(e){return this.ships.filter((function(t){return t.player.isUsers(e)}))}},{key:"getShipsInSameTeam",value:function(e){var t=this,n=this.gameData.slots.getUsersSlots(e);if(!n)return[];var i=n.pop().team;return this.ships.filter((function(e){return t.gameData.slots.getSlotByShip(e).team===i}))}},{key:"getShipsEnemyTeams",value:function(e){var t=this.getShipsInSameTeam(e);return this.ships.filter((function(e){return!t.includes(e)}))}},{key:"serialize",value:function(){return this.ships.map((function(e){return e.serialize()}))}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return console.log("deserialize"),this.ships=e.map((function(e){return console.log(e),af(e)})),this}},{key:"setShipLoadouts",value:function(){this.getShips().forEach((function(e){return e.setShipLoadout()}))}}]),e}(),sf=function(){function e(t){Object(T.a)(this,e),this.gameData=t,this.shipIds=[]}return Object(E.a)(e,[{key:"isActive",value:function(e){return this.shipIds.includes(e.id)}},{key:"setActive",value:function(e){this.isActive(e)||this.shipIds.push(e.id)}},{key:"setInactive",value:function(e){this.shipIds=this.shipIds.filter((function(t){return t!==e.id}))}},{key:"serialize",value:function(){return this.shipIds}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.shipIds=e,this}}]),e}(),of=function(){function e(t){Object(T.a)(this,e),this.deserialize(t)}return Object(E.a)(e,[{key:"getGravityVector",value:function(e){var t=e.distanceTo(this.position),n=this.gravity/Math.pow(t,2);return this.position.sub(e).normalize().multiplyScalar(n)}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.id=e.id||null,this.type=e.type||"sun",this.mass=1e10,this.position=new Rn(e.position),this.velocity=new Rn(e.velocity),this.diameter=7,this.radius=this.affectedByGravity="sun"!==this.type,this}},{key:"serialize",value:function(){return{id:this.id,type:this.type,position:this.position,velocity:this.velocity,radius:this.diameter,mass:this.mass}}}]),e}(),uf=[[0,0,0,0,0],[.25,0,0,0,0],[3/32,9/32,0,0,0],[1932/2197,-7200/2197,7296/2197,0,0],[439/216,-8,3680/513,-845/4104,0],[-8/27,2,-3544/2565,1859/4104,-.275]],cf=[16/135,0,6656/12825,28561/56430,-.18,2/55],lf=[25/216,0,1408/2565,2197/4104,-.2,0],hf=function(e,t){return t+e},df=new(function(){function e(t,n,i,a,r){Object(T.a)(this,e),this.setValues(t,n,i,a,r)}return Object(E.a)(e,[{key:"derivativeVelocityX",value:function(e){var t=this.parentPosition.sub(e);return this.parentMass/Math.pow(t.length(),3)*t.x}},{key:"derivativeVelocityY",value:function(e){var t=this.parentPosition.sub(e);return this.parentMass/Math.pow(t.length(),3)*t.y}},{key:"sum",value:function(e,t){for(var n=0,i=0;i<e;i++)n+=uf[e][i]*this.k(i,t);return n}},{key:"kx",value:function(e){return this.dt*(this.velocity.x+this.sum(e,"vx"))}},{key:"ky",value:function(e){return this.dt*(this.velocity.y+this.sum(e,"vy"))}},{key:"kvx",value:function(e){return this.dt*this.derivativeVelocityX(new Rn(this.position.x+this.sum(e,"x"),this.position.y+this.sum(e,"y")))}},{key:"kvy",value:function(e){return this.dt*this.derivativeVelocityY(new Rn(this.position.x+this.sum(e,"x"),this.position.y+this.sum(e,"y")))}},{key:"k",value:function(e,t){var n=this.findCached(e,t);if(null!==n)return this.cacheHit++,n;this.cacheMiss++;var i=null;switch(t){case"x":i=this.kx(e);break;case"y":i=this.ky(e);break;case"vx":i=this.kvx(e);break;case"vy":i=this.kvy(e)}return this.setCache(e,t,i),i}},{key:"findCached",value:function(e,t){var n=hf(e,t);return void 0!==this.cache[n]?this.cache[n]:null}},{key:"setCache",value:function(e,t,n){var i=hf(e,t);this.cache[i]=n}},{key:"setValues",value:function(e,t,n,i,a){return this.position=e,this.velocity=t,this.parentPosition=n,this.parentMass=i,this.dt=a,this.cache={},this.cacheHit=0,this.cacheMiss=0,this}},{key:"getAllKs",value:function(e){for(var t=[],n=0;n<6;n++)t[n]=this.k(n,e);return t}},{key:"weightedSum",value:function(e,t){return e.map((function(e,n){return e*t[n]})).reduce((function(e,t){return e+t}),0)}},{key:"subVectors",value:function(e,t){return e.map((function(e,n){return e-t[n]}))}},{key:"calculate",value:function(){var e={x:this.getAllKs("x"),y:this.getAllKs("y"),vx:this.getAllKs("vx"),vy:this.getAllKs("vy")};return{dPosition:new Rn(this.weightedSum(cf,e.x),this.weightedSum(cf,e.y)),dVelocity:new Rn(this.weightedSum(cf,e.vx),this.weightedSum(cf,e.vy)),error:new Kt.Vector4(this.weightedSum(this.subVectors(cf,lf),e.x),this.weightedSum(this.subVectors(cf,lf),e.y),this.weightedSum(this.subVectors(cf,lf),e.vx),this.weightedSum(this.subVectors(cf,lf),e.vy)).length()}}},{key:"reportCache",value:function(){console.log("total:",this.cacheHit+this.cacheMiss,"hit ratio:",this.cacheHit/(this.cacheHit+this.cacheMiss),"hit:",this.cacheHit,"miss:",this.cacheMiss)}}]),e}()),mf=function(){function e(t){Object(T.a)(this,e),this.gameTerrain=t}return Object(E.a)(e,[{key:"calculateNewPositionVelocity",value:function(e,t,n){var i=.1,a=0,r=[e.clone()],s=this.gameTerrain.getParentEntity(e,n);if(!s){var o=e.add(t);return r.push(o),{position:o,velocity:t,positions:r,collision:!1}}for(var u=s.mass,c=s.position;a<1&&i<=1;){if(s&&c.distanceTo(e)<100)return r.push(c.clone()),{position:c.clone(),velocity:new Rn(0,0),positions:r,collision:!0};var l=df.setValues(e,t,c,u,i).calculate(),h=l.dPosition,d=l.dVelocity,m=l.error;if(m>.001)i*=.5;else if(m<1e-5)i*=2;else{if(a+i>1)break;e=e.add(h),t=t.add(d),r.push(e.clone()),a+=i}}i=1-a,a=1;var f=df.setValues(e,t,c,u,i).calculate(),p=f.dPosition,v=f.dVelocity;return e=e.add(p),t=t.add(v),r.push(e.clone()),{position:e,velocity:t,positions:r,collision:!1}}}]),e}(),ff=function(){function e(t){Object(T.a)(this,e),this.gameData=t,this.entities=[],this.ark=new mf(this)}return Object(E.a)(e,[{key:"getEntities",value:function(){return this.entities}},{key:"addEntity",value:function(e){this.entities.push(e)}},{key:"getGravityVectorForTurn",value:function(e,t,n){return this.ark.calculateNewPositionVelocity(e,t,n)}},{key:"getParentEntity",value:function(e,t,n){return this.entities[0]}},{key:"serialize",value:function(){return this.entities.map((function(e){return e.serialize()}))}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.entities=e.map((function(e){return new of(e)})),this}}]),e}(),pf=function(){function e(){Object(T.a)(this,e),this.flights=[]}return Object(E.a)(e,[{key:"getTorpedoFlightById",value:function(e){return this.flights.find((function(t){return t.id===e}))}},{key:"addTorpedoFlights",value:function(e){e=[].concat(e),this.flights=[].concat(Object(ta.a)(this.flights),Object(ta.a)(e))}},{key:"getTorpedoFlights",value:function(){return Object(ta.a)(this.flights)}},{key:"serialize",value:function(){return{flights:this.flights.map((function(e){return e.serialize()}))}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{flights:[]};return this.flights=e.flights.map((function(e){return(new dl).deserialize(e)})),this}},{key:"advanceTurn",value:function(){this.flights=this.flights.filter((function(e){return!e.noLongerActive()&&!e.reachedTarget}))}}]),e}(),vf=n(15),gf=function(){function e(t){Object(T.a)(this,e),this.torpedoFlightId=t}return Object(E.a)(e,[{key:"serialize",value:function(){return{logEntryClass:this.constructor.name,torpedoFlightId:this.torpedoFlightId}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.torpedoFlightId=e.torpedoFlightId,this}}]),e}(),yf=function(){function e(t,n,i,a,r){Object(T.a)(this,e),this.torpedoFlightId=t,this.shipId=n,this.weaponId=i,this.interceptChange=a,this.roll=r}return Object(E.a)(e,[{key:"isSucessfull",value:function(){return this.roll<=this.interceptChange.result}},{key:"serialize",value:function(){return{logEntryClass:this.constructor.name,torpedoFlightId:this.torpedoFlightId,weaponId:this.weaponId,roll:this.roll,shipId:this.shipId,interceptChange:this.interceptChange.serialize()}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.torpedoFlightId=e.torpedoFlightId,this.weaponId=e.weaponId,this.roll=e.roll,this.shipId=e.shipId,this.interceptChange=(new Xh).deserialize(e.interceptChange),this}}]),e}(),bf=function(){function e(t){Object(T.a)(this,e),this.torpedoFlightId=t}return Object(E.a)(e,[{key:"serialize",value:function(){return{logEntryClass:this.constructor.name,torpedoFlightId:this.torpedoFlightId}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.torpedoFlightId=e.torpedoFlightId,this}}]),e}(),Of=function(){function e(t,n,i){Object(T.a)(this,e),this.torpedoFlightId=t,this.turnsActive=n,this.armingTime=i}return Object(E.a)(e,[{key:"serialize",value:function(){return{logEntryClass:this.constructor.name,torpedoFlightId:this.torpedoFlightId,turnsActive:this.turnsActive,armingTime:this.armingTime}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.torpedoFlightId=e.torpedoFlightId,this.turnsActive=e.turnsActive,this.armingTime=e.armingTime,this}}]),e}(),wf=Object(vf.a)({CombatLogTorpedoAttack:md,CombatLogDamageEntry:fr,CombatLogTorpedoLaunch:gf,CombatLogTorpedoIntercept:yf,CombatLogTorpedoMove:hd,CombatLogTorpedoOutOfTime:bf,CombatLogWeaponOutOfArc:tm,CombatLogWeaponFire:$h,CombatLogShipMovement:Vh,CombatLogShipVelocity:Wh,CombatLogTorpedoNotArmed:Of,CombatLogGroupedWeaponFire:td},"CombatLogGroupedWeaponFire",td),kf=function(){function e(){Object(T.a)(this,e),this.entries=[]}return Object(E.a)(e,[{key:"addEntry",value:function(e){this.entries.push(e)}},{key:"serialize",value:function(){return{entries:this.entries.map((function(e){return e.serialize()}))}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.entries=e.entries?e.entries.map((function(e){return(new wf[e.logEntryClass]).deserialize(e)})):[],this}},{key:"advanceTurn",value:function(){this.entries=[]}},{key:"getInterceptsFor",value:function(e){return this.entries.filter((function(e){return e instanceof yf})).filter((function(t){return t.torpedoFlightId===e.torpedoFlightId}))}},{key:"getForReplay",value:function(){var e=Object(ta.a)(this.entries),t=[];e.filter((function(e){return e instanceof $h})).forEach((function(e){var n=t.find((function(t){return t.targetId===e.targetId}));n||(n=new td(e.targetId),t.push(n)),n.addEntry(e)}));var n=[];return e.filter((function(e){return e instanceof md})).forEach((function(e){var t=n.find((function(t){return t.targetId===e.targetId}));t||(t=new pd(e.targetId),n.push(t)),t.addEntry(e)})),[].concat(Object(ta.a)(this.entries.filter((function(e){return!(e instanceof $h)}))),t,n).filter((function(e){return e.replayOrder})).sort((function(e,t){return e.replayOrder>t.replayOrder?1:e.replayOrder<t.replayOrder?-1:0}))}}]),e}(),jf=function(){function e(t){Object(T.a)(this,e),this.deserialize(t)}return Object(E.a)(e,[{key:"setStatus",value:function(e){this.status=e}},{key:"setPhase",value:function(e){this.phase=e}},{key:"advanceTurn",value:function(){this.turn++}},{key:"addPlayer",value:function(e){this.players.find((function(t){return t.id===e.id}))||this.players.push(e)}},{key:"removePlayer",value:function(e){this.players=this.players.filter((function(t){return t.id!==e.id}))}},{key:"isPlayerInGame",value:function(e){return this.players.find((function(t){return t.id===e.id}))}},{key:"isPlayerActive",value:function(e){return this.activePlayerIds.includes(e.id)}},{key:"setPlayerActive",value:function(e){this.isPlayerActive(e)||this.activePlayerIds.push(e.id)}},{key:"setPlayerInactive",value:function(e){this.activePlayerIds=this.activePlayerIds.filter((function(t){return t!==e.id}))}},{key:"validateForGameCreate",value:function(e){if(!this.name)return"Game needs a name";var t=this.slots.getSlots();if(t.length<2)return"Game has to have atleast two slots";var n={};if(t.forEach((function(e){return n[e.team]=!0})),Object.keys(n).length<2)return"Game has to have atleast two teams";var i=void 0;return t.forEach((function(e){var t=e.validate();t&&(i=t)})),i||(t.some((function(t){return t.userId===e.id}))?t.some((function(t){return t.userId&&t.userId!==e.id}))?"Other players can not occupy slots at this stage":void 0:"Game creator has to occupy atleast one slot")}},{key:"getActiveShips",value:function(){var e=this;return this.ships.getShips().filter((function(t){return e.activeShips.isActive(t)}))}},{key:"getActiveShipsForUser",value:function(e){var t=this;return this.ships.getShips().filter((function(n){return t.activeShips.isActive(n)&&n.player.isUsers(e)}))}},{key:"isActiveShip",value:function(e){return this.activeShips.isActive(e)}},{key:"setActiveShip",value:function(e){this.activeShips.setActive(e)}},{key:"setInactiveShip",value:function(e){this.activeShips.setInactive(e)}},{key:"getShipsForUser",value:function(e){return this.ships.getShips().filter((function(t){return t.player.isUsers(e)}))}},{key:"serialize",value:function(){return{id:this.id,phase:this.phase,name:this.name,turn:this.turn,data:Object(pi.a)({activePlayerIds:this.activePlayerIds},this.slots.serialize(),{terrain:this.terrain.serialize(),combatLog:this.combatLog.serialize(),torpedos:this.torpedos.serialize()}),ships:this.ships.serialize(),activeShips:this.activeShips.serialize(),creatorId:this.creatorId,status:this.status,players:this.players.map((function(e){return e.serialize()}))}}},{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log("deserialize gamedata",e);var t=e.data||{};return this.id=e.id||null,this.name=e.name,this.phase=e.phase||"deployment",this.turn=e.turn||1,this.players=e.players?e.players.map((function(e){return(new Ci).deserialize(e)})):[],this.activePlayerIds=t.activePlayerIds||[],this.slots=new Id(this).deserialize(t),this.ships=new rf(this).deserialize(e.ships),this.activeShips=new sf(this).deserialize(e.activeShips),this.creatorId=e.creatorId,this.status=e.status||"lobby",this.torpedos=(new pf).deserialize(t.torpedos),this.terrain=new ff(this).deserialize(t.terrain),this.combatLog=(new kf).deserialize(t.combatLog),this}},{key:"clone",value:function(){return new e(this.serialize())}},{key:"censorForUser",value:function(e){var t=this;return this.ships.getShips().forEach((function(n){n.movement.removeMovementForOtherTurns(t.turn);var i=e&&n.player.is(e);n.censorForUser(e,i)})),this}},{key:"endTurn",value:function(){var e=this;this.ships.getShips().forEach((function(t){t.endTurn(e.turn)}))}},{key:"advanceTurn",value:function(){var e=this;this.turn++,this.players.forEach((function(t){return e.setPlayerActive(t)})),this.combatLog.advanceTurn(),this.torpedos.advanceTurn(),this.ships.getShips().forEach((function(t){t.advanceTurn(e.turn),e.setActiveShip(t)}))}}]),e}(),Sf=$n("/img/3d/torpedo/scene.gltf"),xf=function(){function e(t,n){Object(T.a)(this,e),this.torpedoFlight=t,this.scene=n,this.torpedo=null,this.object=new Wt.Object3D,this.particleEmitter=new qn(this.object,10),this.create(),this.lastAnimationTime=null,this.totalAnimationTime=0,this.hidden=!0}return Object(E.a)(e,[{key:"hide",value:function(){this.hidden||(this.scene.remove(this.object),this.hidden=!0)}},{key:"show",value:function(){this.hidden&&(this.scene.add(this.object),this.hidden=!1)}},{key:"setFacing",value:function(e){this.object.quaternion.setFromAxisAngle(new Wt.Vector3(0,0,1),Tn(e))}},{key:"setPosition",value:function(e){return this.object.position.set(e.x,e.y,e.z),this}},{key:"getEnginePosition",value:function(){var e=this.torpedo.children.find((function(e){return!!e.name&&("thrustEffect"===e.name||void 0)}));return e?new Rn(e.position):new Rn}},{key:"create",value:function(){var e,t,n,i,a,r,s,o,u;return Zt.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Zt.a.awrap(Sf);case 2:for(e=c.sent,t=e.scene.children[0].clone(),this.torpedo=t,n=this.torpedoFlight.torpedo.visuals,i=new Wt.Color(n.engineColor[0],n.engineColor[1],n.engineColor[2]),a=this.getEnginePosition(),this.particleEmitter.mesh.position.set(a.x,a.y,a.z),r=kn(this.torpedoFlight.id),10,s=50*r()+200,this.particleEmitter.getParticle().setSize(10).setOpacity(.5).setFadeIn(0,0).setFadeOut(0,0).setColor(i).setPosition({x:0,y:0,z:0}).setTexture(2).setActivationTime(0),this.particleEmitter.getParticle().setSize(10).setOpacity(.1).setFadeIn(0,0).setFadeOut(0,0).setColor(i).setPosition({x:0,y:0,z:0}).setTexture(2).setActivationTime(0).setSine(s,.99),this.particleEmitter.getParticle().setSize(3).setOpacity(.8).setFadeIn(0,0).setFadeOut(0,0).setColor(new Wt.Color(1,1,1)).setPosition({x:0,y:0,z:0}).setTexture(2).setActivationTime(0),o=90,u=2,0;u--;)o+=90,this.particleEmitter.getParticle().setActivationTime(0).setFadeIn(0,0).setFadeOut(0,0).setSize(10*r()+30).setOpacity(.1).setPosition({x:0,y:0,z:0}).setColor(i).setAngle(o).setAngleChange(0).setTexture(4).setSine(s,.99);this.object.add(t);case 20:case"end":return c.stop()}}),null,this)}},{key:"render",value:function(e){var t=e.zoom;null===this.lastAnimationTime&&(this.lastAnimationTime=Date.now());var n=Date.now()-this.lastAnimationTime;this.totalAnimationTime+=n,this.particleEmitter.render({delta:0,total:this.totalAnimationTime,last:0,zoom:t}),this.lastAnimationTime=Date.now()}},{key:"destroy",value:function(){this.scene.remove(this.object)}},{key:"update",value:function(e){this.torpedoFlight=e}}]),e}(),Cf=function(){function e(t){Object(T.a)(this,e),this.scene=t,this.icons=[]}return Object(E.a)(e,[{key:"getArray",value:function(){return this.icons}},{key:"hasIcon",value:function(e){return Boolean(this.getIconById(e))}},{key:"getIconByTorpedoFlight",value:function(e){var t=this.getIconById(e.id);return t||(t=new xf(e,this.scene),this.icons.push(t)),t}},{key:"getIconById",value:function(e){return this.icons.find((function(t){return t.torpedoFlight.id===e}))}},{key:"render",value:function(e){this.icons.forEach((function(t){return t.render(e)}))}}]),e}(),Tf=function(){function e(t,n,i,a){Object(T.a)(this,e),this.uiState=t,this.currentUser=n,this.shipIconContainer=null,this.torpedoIconContainer=null,this.electronicWarfareIndicatorService=null,this.timeline=[],this.phaseStrategy=null,this.coordinateConverter=i,this.shipWindowManager=null,this.movementService=new fa,this.weaponFireService=new rs,this.movementPathService=null,this.terrainRenderer=null,this.phaseState=new ss,this.gameConnector=a,this.gameConnector.init(this),this.scene=null,this.emitterContainer=null,this.camera=null,this.gameDataCache=new Td}return Object(E.a)(e,[{key:"init",value:function(e,t,n){this.scene=e,this.emitterContainer=t,this.camera=n,this.shipIconContainer=new no(e,this.currentUser),this.torpedoIconContainer=new Cf(e),this.electronicWarfareIndicatorService=new co(e,this.shipIconContainer,this.currentUser),this.shipWindowManager=new ho(this.uiState,this.movementService),this.movementPathService=new go(e,this.shipIconContainer,this.currentUser),this.terrainRenderer=new lo(e),this.uiState.setPhaseDirector(this)}},{key:"closeReplay",value:function(){this.phaseStrategy.deactivate(),this.phaseStrategy=null,this.resolvePhaseStrategy()}},{key:"startReplay",value:function(){var e=this.gameDataCache.getGameDatasForAutomaticReplay();e&&(this.activatePhaseStrategy(xd),this.relayEvent("newTurn",e))}},{key:"receiveGameData",value:function(e){window.gameData=this.gameDataCache,this.gameDataCache.setCurrent(e),this.resolvePhaseStrategy()}},{key:"receiveReplay",value:function(e){this.receiveTurnChange(e)}},{key:"receiveTurnChange",value:function(e){this.gameDataCache.setCurrent(e[e.length-1]);var t=Object(ta.a)(e);t.splice(-1,1),this.gameDataCache.setReplays(t),this.phaseStrategy&&!this.phaseStrategy.canDisturb()||this.activatePhaseStrategy(xd),this.phaseStrategy&&this.relayEvent("newTurn",e)}},{key:"relayEvent",value:function(e,t){this.phaseStrategy&&!this.phaseStrategy.inactive&&(this.phaseStrategy.onEvent(e,t),this.shipIconContainer.onEvent(e,t))}},{key:"commitTurn",value:function(){return this.phaseStrategy.commitTurn(this.gameConnector),this.activatePhaseStrategy(Dh)}},{key:"render",value:function(e,t,n){this.phaseStrategy&&!this.phaseStrategy.inactive&&(this.phaseStrategy.render(t,e,n),this.electronicWarfareIndicatorService.render(n),this.uiState.render())}},{key:"resolvePhaseStrategy",value:function(){var e=this.gameDataCache.getCurrent();if(!this.phaseStrategy||this.phaseStrategy.canDisturb())return"lobby"===e.status?this.activatePhaseStrategy(bo,e):this.currentUser&&e.isPlayerInGame(this.currentUser)&&!this.uiState.isReplay()&&"finished"!==e.status?e.isPlayerActive(this.currentUser)?"deployment"===e.phase?this.activatePhaseStrategy(Eh,e):e.isPlayerActive(this.currentUser)?this.activatePhaseStrategy(zh,e):this.activatePhaseStrategy(Dh,e):this.activatePhaseStrategy(Dh,e):this.activatePhaseStrategy(Ph,e)}},{key:"activatePhaseStrategy",value:function(e){var t=this.gameDataCache.getCurrent();this.uiState.update(t),this.shipIconContainer.update(t),this.movementService.update(t,this),this.movementPathService.update(t),this.terrainRenderer.update(t.terrain),this.weaponFireService.update(t),this.phaseStrategy&&this.phaseStrategy instanceof e?this.phaseStrategy.update(t):(this.phaseStrategy&&this.phaseStrategy.deactivate(),this.phaseStrategy=new e(this.getServices()),this.phaseStrategy.activate().update(t))}},{key:"getServices",value:function(){return{phaseState:this.phaseState,shipIconContainer:this.shipIconContainer,torpedoIconContainer:this.torpedoIconContainer,electronicWarfareIndicatorService:this.electronicWarfareIndicatorService,scene:this.scene,shipWindowManager:this.shipWindowManager,movementService:this.movementService,coordinateConverter:this.coordinateConverter,uiState:this.uiState,currentUser:this.currentUser,gameConnector:this.gameConnector,movementPathService:this.movementPathService,weaponFireService:this.weaponFireService,particleEmitterContainer:this.emitterContainer,gameCamera:this.camera}}},{key:"deactivate",value:function(){}}]),e}(),Ef=function e(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Object(T.a)(this,e),this.view=t,this.game=n,this.hex=i,this.entity=a},Af=function(){function e(t){Object(T.a)(this,e),this.matchEvent=function(e){return Object.keys(this.settings).find((function(t){var n=this.settings[t];return!(!n||!n.keyCode)&&(n.keyCode===e.keyCode&&n.shiftKey===e.shiftKey&&n.altKey===e.altKey&&n.ctrlKey===e.ctrlKey&&n.metaKey===e.metaKey)}),this)},this.populate(t)}return Object(E.a)(e,[{key:"populate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.settings={ShowAllEW:e.ShowAllEW||{keyCode:87,shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1},ShowFriendlyEW:e.ShowFriendlyEW||{keyCode:88,shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1},ShowEnemyEW:e.ShowEnemyEW||{keyCode:89,shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1},ZoomLevelToStrategic:.2}}},{key:"set",value:function(e,t){if(void 0===this.settings[e])throw new Error("Unrecognized settings key '"+e+"'");console.log("setting key",e,"to",t,typeof t),this.settings[e]=t}},{key:"save",value:function(){localStorage.setItem("settings",JSON.stringify(this.settings))}},{key:"load",value:function(){var e=localStorage.getItem("settings")||"{}";return this.populate(JSON.parse(e)),this}}]),e}(),Pf=function(){function e(t){Object(T.a)(this,e),this.gameId=t,this.phaseDirector=null,this.webSocket=null,this.open=!1,this.connection=null,this.connectionResolve=null}return Object(E.a)(e,[{key:"init",value:function(e){this.phaseDirector=e}},{key:"deactivate",value:function(){return Zt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zt.a.awrap(this.connection);case 2:e.sent.close();case 4:case"end":return e.stop()}}),null,this)}},{key:"connect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.connection=new Promise((function(n){setTimeout((function(){e.webSocket=new WebSocket("ws://localhost:4000/game/"+e.gameId),e.connectionResolve=n,e.webSocket.onerror=e.onError.bind(e),e.webSocket.onmessage=e.onMessage.bind(e),e.webSocket.onclose=e.onClose.bind(e),e.webSocket.onopen=e.onOpen.bind(e)}),t)}))}},{key:"commitTurn",value:function(e){return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Zt.a.awrap(this.connection);case 2:t.sent.send(JSON.stringify({type:"commitTurn",payload:e.serialize()}));case 4:case"end":return t.stop()}}),null,this)}},{key:"commitDeployment",value:function(e){return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Zt.a.awrap(this.connection);case 2:t.sent.send(JSON.stringify({type:"commitDeployment",payload:e.serialize()}));case 4:case"end":return t.stop()}}),null,this)}},{key:"takeSlot",value:function(e){return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Zt.a.awrap(this.connection);case 2:t.sent.send(JSON.stringify({type:"takeSlot",payload:e}));case 4:case"end":return t.stop()}}),null,this)}},{key:"leaveSlot",value:function(e){return Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Zt.a.awrap(this.connection);case 2:t.sent.send(JSON.stringify({type:"leaveSlot",payload:e}));case 4:case"end":return t.stop()}}),null,this)}},{key:"buyShips",value:function(e,t){return Zt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Zt.a.awrap(this.connection);case 2:n.sent.send(JSON.stringify({type:"buyShips",payload:{slotId:e,ships:t.map((function(e){return e.serialize()}))}}));case 4:case"end":return n.stop()}}),null,this)}},{key:"disconnect",value:function(){return Zt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this.open=!1,e.next=3,Zt.a.awrap(this.connection);case 3:e.sent.close();case 4:case"end":return e.stop()}}),null,this)}},{key:"onOpen",value:function(){this.open=!0,this.connectionResolve(this.webSocket)}},{key:"onError",value:function(){console.log("error"),console.log(arguments)}},{key:"onClose",value:function(){this.open&&this.connect(2e3)}},{key:"onMessage",value:function(e){var t=e.data,n=JSON.parse(t),i=n.type,a=n.payload;switch(console.log("message received",i),i){case"gameData":this.phaseDirector.receiveGameData(new jf(a));break;case"turnChanged":this.phaseDirector.receiveTurnChange(a.map((function(e){return new jf(e)})));break;case"replay":this.phaseDirector.receiveReplay(a.map((function(e){return new jf(e)})));break;default:throw new Error("Unrecognized websocket message type: '".concat(i,"'"))}}}]),e}(),If=function(){function e(){Object(T.a)(this,e),this.onZoom=function(e){},this.material=null,this.mesh=null,this.minZoom=0,this.maxZoom=0,this.hexSize=128}return Object(E.a)(e,[{key:"renderHexGrid",value:function(e,t,n){this.minZoom=t,this.maxZoom=n;var i=bn(9999),a=On(9999),r=Ss(1024,9999,9999,"rgba(255,255,255,255)","rgba(0,0,0,0)",20),s=new Wt.PlaneGeometry(i,a,1,1);this.material=new Wt.MeshBasicMaterial({map:r,transparent:!0,opacity:.1,depthWrite:!1}),this.mesh=new Wt.Mesh(s,this.material),this.mesh.position.x+=fn()/2,this.mesh.name="hexgrid",e.add(this.mesh)}}]),e}(),Df=function(){function e(t,n,i,a){Object(T.a)(this,e),this.ortho=new Wt.OrthographicCamera(t*n/-2,t*n/2,t*i/2,t*i/-2,-4e4,4e4),this.z=a,this.ortho.position.set(0,0,a),this.orthoCameraAngle=0,this.perspectiveRatio=10,this.perspectiveFieldOfView=25,this.perspective=new Wt.PerspectiveCamera(this.perspectiveFieldOfView,n/i,1,1e5),this.perspectiveCameraDistance=1,this.closeAngle=.5*-a,this.setCameraAngle(this.closeAngle),this.current=this.perspective,window.gameCamera=this}return Object(E.a)(e,[{key:"changeToMapView",value:function(){this.setCameraAngle(0),this.current=this.ortho}},{key:"changeToCloseView",value:function(){this.setCameraAngle(this.closeAngle),this.current=this.perspective}},{key:"solvePerspectiveSize",value:function(){var e=this.perspective.position.z/Math.cos(Tn(this.perspectiveFieldOfView/2)),t=Math.sin(Tn(this.perspectiveFieldOfView/2))*e;return{width:3*t*this.perspective.aspect,height:2*t}}},{key:"changeCamera",value:function(){this.current===this.perspective?this.current=this.ortho:this.current=this.perspective}},{key:"zoomPerspective",value:function(e,t,n){var i=this.solvePerspectiveSize().height/(n*e);this.perspectiveCameraDistance/=i,this.perspectiveCameraDistance<100&&(this.perspectiveCameraDistance=100),this.setPerspectiveCameraPositionByLookat(this.getLookAtPosition())}},{key:"zoomCamera",value:function(e,t,n){this.ortho.left=e*t/-2,this.ortho.right=e*t/2,this.ortho.top=e*n/2,this.ortho.bottom=e*n/-2,this.perspective.aspect=t/n,this.perspective.zoom=1,this.zoomPerspective(e,t,n),this.perspective.updateProjectionMatrix(),this.ortho.updateProjectionMatrix(),this.ortho.updateMatrixWorld()}},{key:"getPosition",value:function(){return new Rn(this.current.position)}},{key:"getLookAtPosition",value:function(){return new Rn(this.ortho.position.x,this.ortho.position.y-this.orthoCameraAngle,this.ortho.position.z-this.z)}},{key:"setByLookAtPosition",value:function(e){this.ortho.position.x=e.x,this.ortho.position.y=e.y+this.orthoCameraAngle,this.setPerspectiveCameraPositionByLookat(this.getLookAtPosition())}},{key:"addPosition",value:function(e){this.ortho.position.x+=e.x,this.ortho.position.y+=e.y,this.perspective.position.x+=e.x,this.perspective.position.y+=e.y}},{key:"setPosition",value:function(e){this.ortho.position.x=e.x,this.ortho.position.y=e.y,this.perspective.position.x+=e.x,this.perspective.position.y+=e.y}},{key:"getCamera",value:function(){return this.current}},{key:"setPerspectiveCameraPositionByLookat",value:function(e){var t=new Rn(0,this.orthoCameraAngle/this.perspectiveRatio,this.z/this.perspectiveRatio).normalize(),n=new Rn(e).add(t.multiplyScalar(this.perspectiveCameraDistance));this.perspective.position.set(n.x,n.y,n.z),this.perspective.lookAt(new Rn(e).toThree())}},{key:"setCameraAngle",value:function(e){e>0&&(e=0),e<-this.z&&(e=-this.z);var t=this.getLookAtPosition().toThree(),n=this.orthoCameraAngle-e;this.ortho.position.set(this.ortho.position.x,this.ortho.position.y-n,this.ortho.position.z),this.ortho.lookAt(t),this.orthoCameraAngle=e,this.setPerspectiveCameraPositionByLookat(t)}}]),e}();window.THREE=Wt;var Mf=function(){function e(t,n){Object(T.a)(this,e),this.phaseDirector=t,this.coordinateConverter=n,this.hexGridRenderer=new If,this.particleEmitterContainer=null,this.scene=null,this.camera=null,this.starFieldScene=null,this.starFieldCamera=null,this.starField=null,this.width=null,this.height=null,this.element=null,this.initialized=!1,this.zoom=1,this.zoomTarget=this.zoom,this.cameraAngle=0,this.deactivated=!1}return Object(E.a)(e,[{key:"init",value:function(e,t,n){var i=t.width,a=t.height;this.element=e,this.scene=new Wt.Scene,this.particleEmitterContainer=new ii(this.scene,2e3),this.width=i,this.height=a,this.camera=new Df(this.zoom,this.width,this.height,1e4),this.coordinateConverter.init(this.camera,this.scene),this.phaseDirector.init(this.scene,this.particleEmitterContainer,this.camera),this.starFieldScene=new Wt.Scene,this.starFieldCamera=new Wt.OrthographicCamera(this.zoom*this.width/-2,this.zoom*this.width/2,this.zoom*this.height/2,this.zoom*this.height/-2,-4e3,3e4),this.starFieldCamera.position.set(0,0,500),this.starFieldCamera.lookAt(0,0,100),this.light=new Wt.PointLight(16777215,1,0),this.light.position.set(0,0,1e5),this.scene.add(this.light);var r=new Wt.DirectionalLight(3494522,.005);r.position.set(0,0,1).normalize(),this.scene.add(r),this.renderer=new Wt.WebGLRenderer({alpha:!0,antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.autoClear=!1,this.renderer.context.getExtension("OES_standard_derivatives"),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=Wt.PCFShadowMap,this.renderer.gammaOutput=!0,this.renderer.gammaFactor=2.2,e.appendChild(this.renderer.domElement),this.initialized=!0,this.hexGridRenderer.renderHexGrid(this.scene,.05,40),this.starField=new ui(this.starFieldScene,n),this.render()}},{key:"scroll",value:function(e){this.moveCamera({x:e.x*(1/this.zoom),y:e.y*(1/this.zoom)})}},{key:"moveCamera",value:function(e){this.initialized&&(this.camera.addPosition({x:e.x*this.zoom*this.zoom*-1,y:e.y*this.zoom*this.zoom}),this.starFieldCamera.position.x-=e.x*this.zoom*this.zoom*.05,this.starFieldCamera.position.y+=e.y*this.zoom*this.zoom*.05,this.phaseDirector.relayEvent("ScrollEvent",this.camera.getPosition()))}},{key:"moveCameraTo",value:function(e){this.initialized&&(this.camera.setPosition({x:e.x,y:e.y}),this.starFieldCamera.position.x=.1*e.x,this.starFieldCamera.position.y=.1*e.y,this.phaseDirector.relayEvent("ScrollEvent",this.camera.getPosition()))}},{key:"zoomCamera",value:function(e,t){this.zoom=e,this.initialized&&(this.camera.zoomCamera(this.zoom,this.width,this.height),this.coordinateConverter.onZoom(this.zoom),this.hexGridRenderer.onZoom(this.zoom),this.phaseDirector.relayEvent("ZoomEvent",{zoom:this.zoom,animationReady:Boolean(t)}))}},{key:"render",value:function(){this.deactivated||(this.phaseDirector.render(this.scene,this.coordinateConverter,this.zoom),this.renderer.clear(),this.renderer.render(this.starFieldScene,this.starFieldCamera),this.renderer.clearDepth(),this.renderer.render(this.scene,this.camera.getCamera()),this.animateZoom(),this.starField.render(),requestAnimationFrame(this.render.bind(this)))}},{key:"animateZoom",value:function(){if(this.zoomTarget&&this.zoomTarget!==this.zoom){var e=.1*(this.zoomTarget-this.zoom);Math.abs(e)<1e-5||1===this.zoomTarget&&Math.abs(e)<1e-5?this.zoomCamera(this.zoomTarget,!0):this.zoomCamera(this.zoom+e)}}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this.width=t,this.height=n,this.zoomCamera(this.zoom),this.renderer.setSize(window.innerWidth,window.innerHeight),this.starField.resize()}},{key:"changeZoom",value:function(e){(e*=.5)<-.5&&(e=-.5),this.zoominprogress=!1;var t=this.zoom+this.zoom*e;t<.05&&(t=.05),t>40&&(t=40),this.zoomTarget=t}},{key:"deactivate",value:function(){this.deactivated||(this.deactivated=!0,this.element.removeChild(this.renderer.domElement),this.renderer.clear(),this.renderer.forceContextLoss(),this.renderer.domElement=null,this.renderer.dispose(),this.renderer=null)}}]),e}(),zf=function(){function e(t,n,i){Object(T.a)(this,e),this.gameId=t,this.currentUser=n,console.log("game user",n),this.uiState=i,this.coordinateConverter=Dn,this.gameConnector=new Pf(t),this.phaseDirector=new Tf(this.uiState,this.currentUser,this.coordinateConverter,this.gameConnector),this.gameScene=new Mf(this.phaseDirector,this.coordinateConverter),this.gameSettings=(new Af).load(),this.sceneElement=null,this.init=!1,this.mouseOvered=null,this.mouseOveredHex=null}return Object(E.a)(e,[{key:"getUiState",value:function(){return this.uiState}},{key:"initRender",value:function(e){this.sceneElement=e,this.init=!0,this.gameScene.init(e,this.getDimensions(),this.gameId),this.gameConnector.connect(),this.onResize()}},{key:"onMouseWheel",value:function(e){this.gameScene.changeZoom(e)}},{key:"onKeyDown",value:function(e){var t=this.gameSettings.matchEvent(e);this.uiState.customEvent(t,{up:!1})}},{key:"onKeyUp",value:function(e){var t=this.gameSettings.matchEvent(e);this.uiState.customEvent(t,{up:!0})}},{key:"onMouseUp",value:function(e,t){if(this.init){var n=this.coordinateConverter.fromViewPortToGame(e),i=this.coordinateConverter.getEntitiesIntersected(e,!0).shift(),a=this.coordinateConverter.fromGameToHex(n,!0),r=new Ef(e,n,a,i);console.log(r.hex),t&&2===t&&i?this.phaseDirector.relayEvent("shipRightClicked",r):i?this.phaseDirector.relayEvent("shipClicked",r):this.phaseDirector.relayEvent("hexClicked",r)}}},{key:"onDrag",value:function(e,t){this.gameScene.scroll(t)}},{key:"onMouseMove",value:function(e){var t=this.coordinateConverter.fromViewPortToGame(e),n=this.coordinateConverter.fromGameToHex(t),i=this.coordinateConverter.getEntitiesIntersected(e).shift(),a=new Ef(e,t,n,i);this.mouseOvered&&i&&this.mouseOvered!=i?(this.phaseDirector.relayEvent("mouseOutShip",Object(pi.a)({},a,{entity:this.mouseOvered})),this.phaseDirector.relayEvent("mouseOverShip",a),this.mouseOvered=i):null==this.mouseOvered&&i?(this.phaseDirector.relayEvent("mouseOverShip",a),this.mouseOvered=i):this.mouseOvered&&!i&&(this.phaseDirector.relayEvent("mouseOutShip",Object(pi.a)({},a,{entity:this.mouseOvered})),this.mouseOvered=null),i?i&&this.mouseOveredHex&&(this.phaseDirector.relayEvent("mouseOutHex",this.mouseOveredHex),this.mouseOveredHex=null):this.mouseOveredHex&&!this.mouseOveredHex.equals(a.hex)?(this.phaseDirector.relayEvent("mouseOutHex",this.mouseOveredHex),this.phaseDirector.relayEvent("mouseOverHex",a.hex),this.mouseOveredHex=a.hex):this.mouseOveredHex||(this.phaseDirector.relayEvent("mouseOverHex",a.hex),this.mouseOveredHex=a.hex)}},{key:"onMouseOut",value:function(){this.phaseDirector.relayEvent("mouseOut")}},{key:"onResize",value:function(){if(this.sceneElement){var e=this.getDimensions();this.coordinateConverter.onResize(e),this.gameScene.onResize(e)}}},{key:"getDimensions",value:function(){return{width:this.sceneElement.offsetWidth,height:this.sceneElement.offsetHeight}}},{key:"deactivate",value:function(){console.log("deactivate game"),this.gameConnector.deactivate(),this.phaseDirector.deactivate(),this.gameScene.deactivate()}}]),e}(),Rf=function(){function e(){Object(T.a)(this,e),console.log("construct new UiState"),this.phaseDirector=null,this.services=null,this.renderListeners=[],this.systemChangeListeners=[],this.state={lobby:!1,gameData:null,selectedShip:null,selectedSystems:[],systemInfo:null,systemInfoMenu:null,shipMovement:null,shipTooltip:[],turnReady:!1,shipTooltipMenuProvider:null,systemMenu:{systemInfoMenuProvider:null,activeSystem:null,activeSystemElement:null},shipBadges:[],gameUiMode:{},gameUiModeButtons:!1,replayUi:!1,combatLog:!1,systemList:[],ewList:[],stateVersion:0},this.state.gameUiMode.ew=!1,this.state.gameUiMode.enemy_weapons=!1,this.state.gameUiMode.weapons=!1,this.state.gameUiMode.movement=!1}return Object(E.a)(e,[{key:"setDispatch",value:function(e){this.dispatch=e}},{key:"getReducer",value:function(){return this.reducer.bind(this)}},{key:"getInitialState",value:function(){return this.state}},{key:"reducer",value:function(e,t){return this.state=Object(pi.a)({},e,{},t),this.state}},{key:"showShipBadge",value:function(e,t){var n=this.services.coordinateConverter,i=this.state.shipBadges.find((function(t){return t.icon.ship.id===e.ship.id})),a=function(){e.getPosition();var t=e.getFacing(),i=(Pn(t),e.getShipHexas().map((function(e){return e.y-=-2.5,n.fromGameToViewPort(e)}))),a=null,r=[];return i.forEach((function(e){null===a||e.y>a?(r=[e],a=e.y):e.y===a&&r.push(e)})),{x:r.reduce((function(e,t){return e+t.x}),0)/r.length,y:a}};i?(i.icon=e,i.version++,i.getPosition=a,i.showName=t):this.state.shipBadges.push({icon:e,version:0,getPosition:a,showName:t}),this.updateState()}},{key:"hideShipBadge",value:function(e){this.state.shipBadges=this.state.shipBadges.filter((function(t){return t.icon.ship.id!==e.ship.id})),this.updateState()}},{key:"setEwList",value:function(e){this.state.ewList=e}},{key:"setSystemList",value:function(e){this.state.systemList=e,this.updateState()}},{key:"isSelectedSystem",value:function(e){return this.state.selectedSystems.includes(e)}},{key:"selectSystem",value:function(e,t){var n=this;this.getSelectedShip()!==e&&this.selectShip(e),t=[].concat(t).filter((function(e){return!n.isSelectedSystem(e)})).forEach((function(e){return n.state.selectedSystems.push(e)})),this.updateState(),this.customEvent("systemSelected",{systems:t})}},{key:"deselectSystem",value:function(e){e=[].concat(e),this.state.selectedSystems=this.state.selectedSystems.filter((function(t){return e.every((function(e){return e.id!==t.id}))})),this.updateState(),this.customEvent("systemDeselected",{systems:e})}},{key:"deselectAllSystems",value:function(){var e=this.state.selectedSystems;this.state.selectedSystems=[],this.updateState(),this.customEvent("systemDeselected",{systems:e})}},{key:"getSelectedSystems",value:function(){return this.state.selectedSystems}},{key:"hasGameUiMode",value:function(e){var t=this;return(e=[].concat(e)).some((function(e){return t.state.gameUiMode[e]}))}},{key:"toggleGameUiMode",value:function(e){this.state.gameUiMode[e]=!this.state.gameUiMode[e],this.updateState()}},{key:"showUiModeButtons",value:function(e){this.state.gameUiModeButtons=e,this.updateState()}},{key:"showReplayUi",value:function(e){this.state.replayUi=e,this.updateState()}},{key:"startCombatLog",value:function(e,t){this.state.combatLog={gameData:t,replayContext:e,log:[]}}},{key:"addToCombatLog",value:function(e){if(!1===this.state.combatLog)throw new Error("Start combat log first");this.state.combatLog.log.push(e),this.updateState()}},{key:"hideCombatLog",value:function(){this.state.combatLog=!1,this.updateState()}},{key:"startReplay",value:function(){this.phaseDirector.startReplay(),this.updateState()}},{key:"closeReplay",value:function(){this.phaseDirector.closeReplay(),this.updateState()}},{key:"isReplay",value:function(){return this.state.replay}},{key:"update",value:function(e){var t=this;this.gameData=e,this.state.selectedShip&&(this.selectShip(this.gameData.ships.getShipById(this.state.selectedShip.id)),this.selectSystem(this.getSelectedShip(),this.state.selectedSystems.map((function(e){return t.getSelectedShip().systems.getSystemById(e.id)}))))}},{key:"setTurnReady",value:function(e){this.state.turnReady=e,this.updateState()}},{key:"setWaiting",value:function(e){this.state.waiting=e,this.updateState()}},{key:"setPhaseDirector",value:function(e){this.phaseDirector=e,this.services=e.getServices()}},{key:"customEvent",value:function(e,t){this.phaseDirector&&this.phaseDirector.relayEvent(e,t)}},{key:"commitTurn",value:function(){this.phaseDirector.commitTurn()}},{key:"selectShip",value:function(e){this.getSelectedShip()!==e&&(this.deselectShip(),this.state.selectedShip=e,this.updateState(),this.customEvent("shipSelected",e))}},{key:"deselectShip",value:function(){var e=this.state.selectedShip;this.state.selectedShip=null,this.updateState(),this.deselectAllSystems(),e&&this.customEvent("shipDeselected",e)}},{key:"getSelectedShip",value:function(){return this.state.selectedShip}},{key:"isSelected",value:function(e){return this.state.selectedShip===e}},{key:"updateState",value:function(){this.dispatch(this.state),this.customEvent("uiStateChanged")}},{key:"setTooltipMenuProvider",value:function(e){this.state.shipTooltipMenuProvider=e,this.updateState()}},{key:"setSystemInfoMenuProvider",value:function(e){this.state.systemMenu.systemInfoMenuProvider=e,this.updateState()}},{key:"setSystemMenuActiveSystem",value:function(e,t){this.state.systemMenu.activeSystem=e,this.state.systemMenu.activeSystemElement=t,this.updateState()}},{key:"setGameData",value:function(e){this.state.gameData=e.serialize(),this.updateState()}},{key:"setLobby",value:function(e){this.state.lobby=e,this.updateState()}},{key:"getState",value:function(){return this.state}},{key:"showSystemInfo",value:function(e){this.state.systemInfo=e,this.updateState()}},{key:"hideSystemInfo",value:function(){this.state.systemInfo=null,this.updateState()}},{key:"showSystemInfoMenu",value:function(e){this.state.systemInfoMenu=e,this.updateState()}},{key:"hideSystemInfoMenu",value:function(){this.state.systemInfoMenu=null,this.updateState()}},{key:"shipStateChanged",value:function(e){this.customEvent("shipStateChanged",e)}},{key:"shipSystemStateChanged",value:function(e,t){this.customEvent("shipSystemStateChanged",{ship:e,system:t}),this.systemChangeListeners.forEach((function(n){return n(e,t)}))}},{key:"showShipTooltip",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.services.coordinateConverter,i=e.ship;this.hideShipTooltip(i),this.state.shipTooltip.push({ship:i,getPosition:function(){return n.fromGameToViewPort(e.getPosition())},ui:t}),this.updateState()}},{key:"hideShipTooltip",value:function(e){this.state.shipTooltip=this.state.shipTooltip.filter((function(t){return t.ship.id!==e.id})),this.updateState()}},{key:"showShipDeploymentMovement",value:function(e){var t=this.services,n=t.shipIconContainer,i=t.coordinateConverter,a=t.movementService;this.state.shipMovement={ship:e,type:"deploy",movementService:a,getPosition:function(){return i.fromGameToViewPort(n.getByShip(e).getPosition())}},this.updateState()}},{key:"showShipMovement",value:function(e){var t=this.services,n=t.shipIconContainer,i=t.coordinateConverter,a=t.movementService;this.state.shipMovement={ship:e,type:"game",movementService:a,getPosition:function(){return i.fromGameToViewPort(n.getByShip(e).getPosition())}},this.updateState()}},{key:"hideShipMovement",value:function(){this.state.shipMovement=null,this.updateState()}},{key:"render",value:function(){this.renderListeners.forEach((function(e){return e()}))}},{key:"subscribeToRender",value:function(e){this.renderListeners.push(e)}},{key:"unsubscribeFromRender",value:function(e){this.renderListeners=this.renderListeners.filter((function(t){return t!==e}))}},{key:"subscribeToSystemChange",value:function(e){this.systemChangeListeners.push(e)}},{key:"unsubscribeFromSystemChange",value:function(e){this.systemChangeListeners=this.systemChangeListeners.filter((function(t){return t!==e}))}}]),e}(),Ff=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"openShipWindow",value:function(e){var t=this;return function(){t.props.uiState.openShipWindow(e)}}},{key:"render",value:function(){var e=this,t=this.props,n=t.ships,i=t.onReady,a=t.bought;return S.a.createElement(ke,null,S.a.createElement(Se,null,S.a.createElement(Re,null,"Current fleet for slot"),S.a.createElement(xe,null,!a&&n.length>0&&S.a.createElement(Nt,{buttonStyle:"button",onClick:i},"Ready"))),n.map((function(t,n){return S.a.createElement(Nt,{key:"fleetlist-ship-".concat(n),buttonStyle:"text",onClick:e.openShipWindow(t)},t.shipTypeName," ",S.a.createElement(Ie,null,t.pointCost)," points")})))}}]),t}(j.Component);function Hf(){var e=Object(R.a)(["\n  ","\n"]);return Hf=function(){return e},e}function Lf(){var e=Object(R.a)(["\n  box-shadow: 0px 0px 3px 3px rgba(222, 235, 255, 0.5);\n  color: #0a3340;\n  background-color: ",";\n  border-color: ",";\n"]);return Lf=function(){return e},e}var Bf=Object(F.a)(Lf(),i.border,i.blue),_f=Object(F.b)(be)(Hf(),(function(e){return e.selected?Bf:""})),Uf=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"handleChange",value:function(){}},{key:"getPlayerName",value:function(e){return this.props.gameData.players.find((function(t){return t.id===e.userId})).username}},{key:"leaveSlot",value:function(e){var t=this;return function(){t.props.uiState.customEvent("leaveSlot",e)}}},{key:"takeSlot",value:function(e){var t=this;return function(){t.props.uiState.customEvent("takeSlot",e)}}},{key:"render",value:function(){var e=this.props,t=e.slot,n=e.edit,i=e.take,r=e.currentUser,s=e.selectedSlot,o=e.children;return S.a.createElement(_f,{selected:s&&s.id===t.id},S.a.createElement(Se,null,n?S.a.createElement(S.a.Fragment,null,S.a.createElement(Ge,{label:"Slot name",id:"slotName-".concat(t.name),placeholder:"slot name",value:t.name,onChange:this.handleChange,error:!t.name&&"Name is required"}),S.a.createElement(Ge,{label:"Points",id:"slotPoints-".concat(t.name),placeholder:"5000",value:t.points,onChange:this.handleChange,error:(t.points!==parseInt(t.points,10)||t.points<=0)&&"Points must be a positive number"})):S.a.createElement(S.a.Fragment,null,S.a.createElement(ze,null,t.name),S.a.createElement(ze,null,"Points: ",S.a.createElement(Ie,null,t.points)),S.a.createElement(xe,null,t.isTaken()&&S.a.createElement(ze,null,"Player: ",S.a.createElement(Ie,null,this.getPlayerName(t))),r&&!t.isTaken()&&i&&S.a.createElement(Nt,{onClick:this.takeSlot(t),type:"button",buttonStyle:"button-grey"},"Take slot"),i&&r&&t.isOccupiedBy(r)&&S.a.createElement(Nt,{onClick:this.leaveSlot(t),type:"button",icon:a.X})))),S.a.createElement(Se,null,n?S.a.createElement(S.a.Fragment,null,S.a.createElement(Ge,{label:"Deployment position (X,Y):",id:"deploymentPosition-".concat(t.name),placeholder:"0",value:"".concat(t.deploymentLocation.q,",").concat(t.deploymentLocation.r),onChange:this.handleChange}),S.a.createElement(Ge,{label:"Deployment vector (X,Y):",id:"deploymentVector-".concat(t.name),placeholder:"0",value:"".concat(t.deploymentVector.q,",").concat(t.deploymentVector.r),onChange:this.handleChange})):S.a.createElement(S.a.Fragment,null,S.a.createElement(Pe,null,"Deployment position:",S.a.createElement(Ie,null," ".concat(t.deploymentLocation.q,",").concat(t.deploymentLocation.r))),S.a.createElement(Pe,null,"Deployment vector:",S.a.createElement(Ie,null,"".concat(t.deploymentVector.q,",").concat(t.deploymentVector.r))),S.a.createElement(Pe,null,"Deployment radius: ",S.a.createElement(Ie,null," ",t.deploymentRadius)))),S.a.createElement(Se,null,n&&S.a.createElement(Ge,{label:"Deployment radius:",id:"deploymentRadius-".concat(t.name),placeholder:"0",value:t.deploymentRadius,onChange:this.handleChange})),o)}}]),t}(j.Component),Nf=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"mapTeamsToComponents",value:function(){var e=this,t=this.props,n=t.gameData,i=t.selectedSlot,a=t.ships,r=t.uiState,s=t.onReady;return n.slots.getSlotsByTeams().map((function(t){return S.a.createElement(ke,{key:"team-".concat(t.team)},S.a.createElement(ze,null,"TEAM: ",t.team),t.slots.map((function(t){return i&&t.id===i.id?S.a.createElement(Uf,Object.assign({key:t.id,slot:t},e.props),S.a.createElement(Ff,{bought:t.isBought(),onReady:s,uiState:r,ships:a})):S.a.createElement(Uf,Object.assign({key:t.id,slot:t},e.props))})))}))}},{key:"render",value:function(){return S.a.createElement(S.a.Fragment,null,this.mapTeamsToComponents())}}]),t}(j.Component),Vf=function e(t,n){Object(T.a)(this,e),this.name=t,this.ships=n},Gf=[new Vf("United Colonies",["UcRhino","Haka"]),new Vf("The Expanse Protecorate",["Caliope","Fulcrum","Mouros"]),new Vf("Federation Navy",["Impetous"])],Wf=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"buyShip",value:function(e){var t=this.props.buyShip;return function(){t(e)}}},{key:"openShipWindow",value:function(e){var t=this;return function(){t.props.uiState.openShipWindow(e)}}},{key:"render",value:function(){var e=this,t=this.props.faction;return S.a.createElement("div",null,S.a.createElement(Re,null,t.name),t.ships.map((function(e){return new nf[e]})).map((function(t){return S.a.createElement(Se,{key:"fleetStoreEntry-".concat(t.shipClass)},S.a.createElement(Nt,{buttonStyle:"text",onClick:e.openShipWindow(t)},t.shipTypeName," ",S.a.createElement(Ie,null,t.pointCost)," points"),S.a.createElement(Nt,{buttonStyle:"button",onClick:e.buyShip(t.shipClass)},"Add to fleet"))})))}}]),t}(j.Component);function qf(){var e=Object(R.a)(["\n  flex-grow: 1;\n  margin-left: 10px;\n"]);return qf=function(){return e},e}var Zf=Object(F.b)(ke)(qf()),Kf=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this;return S.a.createElement(Zf,null,Gf.map((function(t){return S.a.createElement(Wf,Object.assign({key:t.name,faction:t},e.props))})))}}]),t}(j.Component);function Xf(){var e=Object(R.a)(["\n  width: 1200px;\n  position: absolute;\n  top: 20px;\n  max-height: calc(100vh - 40px);\n  left: calc(50vw - 600px);\n  right: calc(50vw - 600px);\n  z-index: 3;\n"]);return Xf=function(){return e},e}var Yf=Object(F.b)(je)(Xf()),Qf=function(e){function t(e){var n;return Object(T.a)(this,t),(n=Object(A.a)(this,Object(P.a)(t).call(this,e))).state={selectedSlot:null,ships:[]},n}return Object(I.a)(t,e),Object(E.a)(t,[{key:"selectSlot",value:function(){}},{key:"buyShip",value:function(e){var t=new nf[e],n=this.state,i=n.selectedSlot,a=n.ships;i&&([].concat(Object(ta.a)(a),[t]).reduce((function(e,t){return e+t.getPointCost()}),0)>i.points?alert("Too costly"):this.setState({ships:[].concat(Object(ta.a)(a),[t])}))}},{key:"onReady",value:function(){var e=this.props.uiState,t=this.state,n=t.selectedSlot,i=t.ships;e.customEvent("buyShips",{slot:n,ships:i})}},{key:"render",value:function(){var e=this.props,t=e.uiState,n=e.gameData,i=e.currentUser,a=e.game,r=this.state,s=r.selectedSlot,o=r.ships;return n?(n=new jf(n),S.a.createElement(Yf,null,S.a.createElement(Se,null,S.a.createElement("div",null,S.a.createElement(ze,null,"GAME: '",n.name,"'"),S.a.createElement(ze,null,"Take a slot and buy ships"),S.a.createElement(Nf,{gameData:n,edit:!1,currentUser:i,take:!0,select:!0,selectedSlot:s,game:a,ships:o,uiState:t,onReady:this.onReady.bind(this)})),S.a.createElement(Kf,{uiState:t,buyShip:this.buyShip.bind(this)})))):null}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.gameData,i=e.currentUser;if(!n)return t;if(n=new jf(n),!t.selectedSlot){var a=n.slots.getSlots().find((function(e){return e.isOccupiedBy(i)}))||null,r=a?a.getShips():[];return Object(pi.a)({},t,{selectedSlot:a,ships:r})}return t}}]),t}(j.Component),Jf=Rl;function $f(){var e=Object(R.a)(["\n  ","\n"]);return $f=function(){return e},e}function ep(){var e=Object(R.a)(["\n  align-items: center;\n"]);return ep=function(){return e},e}function tp(){var e=Object(R.a)(["\n  position: absolute;\n  top: -1px;\n  left: -1px;\n  padding-right: 10px;\n  z-index: 3;\n"]);return tp=function(){return e},e}var np=F.b.div(tp()),ip=Object(F.b)(xe)(ep()),ap=(F.b.div($f(),(function(e){return e.ready?"cursor:pointer;":"cursor:not-allowed;"})),function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"onReady",value:function(){var e=this.props,t=e.uiState;e.ready&&t.commitTurn()}},{key:"render",value:function(){var e=this.props,t=e.gameData,n=(e.ready,e.waiting);return j.createElement(np,null,j.createElement(Se,null,j.createElement(ze,null,"TURN: ".concat(t.turn)," ","deployment"===t.phase&&"DEPLOYMENT",n&&" Waiting"),!n&&j.createElement(ip,null,j.createElement(Et,{onClick:this.onReady.bind(this)},j.createElement(a.CheckMark,null)))))}}]),t}(j.PureComponent));function rp(){var e=Object(R.a)(["\n  font-size: 14px;\n  text-transform: none;\n"]);return rp=function(){return e},e}function sp(){var e=Object(R.a)(["\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  margin: 5px 0 0 0;\n\n  div {\n    padding: 0 5px;\n    white-space: nowrap;\n  }\n"]);return sp=function(){return e},e}function op(){var e=Object(R.a)(["\n  ","\n  font-size: 36px;\n  font-weight: bold;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: absolute;\n  width: 50px;\n  height: 60px;\n  left: -25px;\n  bottom: -30px;\n"]);return op=function(){return e},e}function up(){var e=Object(R.a)(["\n  ","\n  position: absolute;\n  width: 600px;\n  left: calc(50% - 300px);\n  bottom: 0;\n  padding: 2px 0;\n  /* background-color: rgba(0, 0, 0, 0.5); */\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  text-shadow: black 0px 0px 13px, black 0px 0px 13px, black 0px 0px 13px;\n  cursor: default;\n"]);return up=function(){return e},e}function cp(){var e=Object(R.a)(["\n  color: white;\n  font-family: arial;\n  font-size: 16px;\n  text-transform: uppercase;\n"]);return cp=function(){return e},e}function lp(){var e=Object(R.a)(["\n  position: absolute;\n  left: 50%;\n  bottom: 125px;\n  opacity: 0.85;\n  user-select: none;\n  z-index: 3;\n"]);return lp=function(){return e},e}var hp=F.b.div(lp()),dp=Object(F.a)(cp()),mp=(F.b.div(up(),dp),F.b.div(op(),dp)),fp=F.b.div(sp()),pp=(Object(F.b)(fp)(rp()),function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.ship,n=(e.movementService,e.children),i=e.ui,a=void 0===i||i;return j.createElement(j.Fragment,null,j.createElement(hp,{id:"shipMovementActual"},n,a&&j.createElement(mp,null,t.movement.getRemainingThrustOutput())))}}]),t}(j.Component));function vp(){var e=Object(R.a)(["\n      animation: blinker 1s linear infinite;\n\n      @keyframes blinker {\n        50% {\n          opacity: 0;\n        }\n      }\n    "]);return vp=function(){return e},e}function gp(){var e=Object(R.a)(["\n  position: absolute;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  opacity: 0.5;\n\n  svg #svg-path {\n    fill: white;\n    ","\n    ","\n  }\n  ","\n\n  ","\n"]);return gp=function(){return e},e}var yp=F.b.div(gp(),(function(e){return e.overChannel&&"fill:#4c7ca8;"}),(function(e){return e.disabled&&"fill: #8f2626;"}),He,(function(e){return e.active&&Object(F.a)(vp())}));function bp(){var e=Object(R.a)(["\n\n  ","\n\n  ","\n  ","\n"]);return bp=function(){return e},e}var Op=Object(F.b)(yp)(bp(),(function(e){return"transform: rotate(".concat(e.direction+90,"deg);")}),(function(e){return"left: calc(".concat(e.x,"px - 16px);")}),(function(e){return"top: calc(".concat(e.y,"px - 16px);")})),wp=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getPosition",value:function(e){return xn(75,-An(e),0,0)}},{key:"canThrust",value:function(){var e=this.props,t=e.ship,n=e.movementService,i=e.direction;return n.canThrust(t,i)}},{key:"thrust",value:function(e){if(e){var t=this.props,n=t.ship,i=t.movementService,a=t.direction;return i.thrust(n,a)}}},{key:"render",value:function(){var e=this.props.direction,t=this.canThrust(),n=t.overChannel;return j.createElement(Op,Object.assign({overChannel:n,disabled:!t,direction:An(e),onClick:this.thrust.bind(this,t)},this.getPosition(e)),j.createElement(K,null))}}]),t}(j.Component);function kp(){var e=Object(R.a)(["\n  position: absolute;\n  width: 32px;\n  height: 32px;\n  left: 125px;\n  top: 53px;\n  ","\n"]);return kp=function(){return e},e}var jp=F.b.div(kp(),He),Sp=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"canRevert",value:function(){var e=this.props,t=e.movementService,n=e.ship;return t.canRevert(n)}},{key:"revert",value:function(){var e=this.props,t=e.movementService,n=e.ship;return t.revert(n)}},{key:"render",value:function(){return this.canRevert()?j.createElement(jp,{onClick:this.revert.bind(this)},j.createElement(ee,null)):null}}]),t}(j.Component);function xp(){var e=Object(R.a)(["\n  left: -175px;\n  top: 53px;\n"]);return xp=function(){return e},e}var Cp=Object(F.b)(yp)(xp()),Tp=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"canCancel",value:function(){var e=this.props,t=e.movementService,n=e.ship;return t.canCancel(n)}},{key:"cancel",value:function(){var e=this.props,t=e.movementService,n=e.ship;return t.cancel(n)}},{key:"render",value:function(){return this.canCancel()?j.createElement(Cp,{onClick:this.cancel.bind(this)},j.createElement(Q,null)):null}}]),t}(j.Component);function Ep(){var e=Object(R.a)(["\n  left: 25px;\n  top: -16px;\n\n  ",";\n"]);return Ep=function(){return e},e}var Ap=Object(F.b)(yp)(Ep(),(function(e){return 1===e.pivotDirection?"left: -57px;":"transform: rotate(-180deg) scaleY(-1);"})),Pp=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"canPivot",value:function(){var e=this.props,t=e.ship,n=e.movementService,i=e.pivotDirection;return n.canPivot(t,i)}},{key:"pivot",value:function(){var e=this.props,t=e.ship,n=e.movementService,i=e.pivotDirection;if(n.canPivot(t,i))return n.pivot(t,i)}},{key:"render",value:function(){var e=this.props.pivotDirection,t=this.canPivot();return j.createElement(Ap,{pivotDirection:e,onClick:this.pivot.bind(this),disabled:!t},j.createElement($,null))}}]),t}(j.Component);function Ip(){var e=Object(R.a)(["\n  position: absolute;\n  width: 32px;\n  height: 32px;\n  left: -16px;\n  top: -65px;\n  ","\n"]);return Ip=function(){return e},e}var Dp=Object(F.b)(yp)(Ip(),He),Mp=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"canRoll",value:function(){var e=this.props,t=e.movementService,n=e.ship;return t.canRoll(n)}},{key:"roll",value:function(){var e=this.props,t=e.movementService,n=e.ship;if(t.canRoll(n))return t.roll(n)}},{key:"render",value:function(){var e=this.props.ship;return j.createElement(Dp,{active:e.movement.isRolling(),onClick:this.roll.bind(this),disabled:!this.canRoll()},j.createElement(Y,null))}}]),t}(j.Component);function zp(){var e=Object(R.a)(["\n  color: white;\n  font-family: arial;\n  font-size: 24px;\n  text-transform: uppercase;\n  font-weight: bold;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: absolute;\n  width: 50px;\n  height: 20px;\n  left: -25px;\n  top: 57px;\n"]);return zp=function(){return e},e}function Rp(){var e=Object(R.a)(["\n  transform: rotate(180deg);\n  top: 79px;\n"]);return Rp=function(){return e},e}function Fp(){var e=Object(R.a)(["\n  position: absolute;\n  width: 26px;\n  height: 26px;\n  left: -13px;\n  top: 28px;\n  ","\n"]);return Fp=function(){return e},e}var Hp=Object(F.b)(yp)(Fp(),He),Lp=Object(F.b)(Hp)(Rp()),Bp=F.b.div(zp()),_p=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"canEvade",value:function(e){var t=this.props,n=t.movementService,i=t.ship;return n.canEvade(i,e)}},{key:"evade",value:function(e){var t=this.props,n=t.movementService,i=t.ship;if(n.canEvade(i,e))return n.evade(i,e)}},{key:"render",value:function(){var e=this.props.ship,t=this.canEvade(1),n=this.canEvade(-1);return j.createElement(j.Fragment,null,j.createElement(Hp,{key:"evade-more",onClick:this.evade.bind(this,1),disabled:!t},j.createElement(J,null)),j.createElement(Bp,null,e.movement.getEvasion()),j.createElement(Lp,{key:"evade-less",onClick:this.evade.bind(this,-1),disabled:!n},j.createElement(J,null)))}}]),t}(j.Component),Up=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.ship,n=e.movementService,i=Object(D.a)(e,["ship","movementService"]);return j.createElement(pp,Object.assign({ship:t,movementService:n},i),j.createElement(wp,{ship:t,movementService:n,direction:0}),j.createElement(wp,{ship:t,movementService:n,direction:1}),j.createElement(wp,{ship:t,movementService:n,direction:2}),j.createElement(wp,{ship:t,movementService:n,direction:3}),j.createElement(wp,{ship:t,movementService:n,direction:4}),j.createElement(wp,{ship:t,movementService:n,direction:5}),j.createElement(Sp,{ship:t,movementService:n}),j.createElement(Tp,{ship:t,movementService:n}),j.createElement(Pp,{ship:t,movementService:n,pivotDirection:-1}),j.createElement(Pp,{ship:t,movementService:n,pivotDirection:1}),j.createElement(Mp,{ship:t,movementService:n}),j.createElement(_p,{ship:t,movementService:n}))}}]),t}(j.PureComponent);function Np(){var e=Object(R.a)(["\n  left: 125px;\n  top: 103px;\n\n  ","\n"]);return Np=function(){return e},e}var Vp=Object(F.b)(yp)(Np(),(function(e){return 1===e.pivotDirection?"left: -175px; transform: rotate(-90deg);":"transform: rotate(-90deg) scaleY(-1);"})),Gp=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"pivot",value:function(){var e=this.props,t=e.ship,n=e.movementService,i=e.pivotDirection;return n.doDeploymentTurn(t,i)}},{key:"render",value:function(){var e=this.props.pivotDirection;return j.createElement(Vp,{pivotDirection:e,onClick:this.pivot.bind(this)},j.createElement($,null))}}]),t}(j.Component),Wp=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.ship,n=e.movementService,i=Object(D.a)(e,["ship","movementService"]);return j.createElement(pp,Object.assign({ship:t,movementService:n,ui:!1},i),j.createElement(Gp,{ship:t,movementService:n,pivotDirection:-1}),j.createElement(Gp,{ship:t,movementService:n,pivotDirection:1}))}}]),t}(j.PureComponent);function qp(){var e=Object(R.a)(["\n  margin-left: 32px;\n"]);return qp=function(){return e},e}function Zp(){var e=Object(R.a)(["\n  position: absolute;\n  top: 0;\n  left: 500px;\n  display: flex;\n  z-index: 3;\n"]);return Zp=function(){return e},e}var Kp=F.b.div(Zp()),Xp=Object(F.b)(Et)(qp()),Yp=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.ew,n=e.movement,i=e.weapons,a=e.enemy_weapons,r=e.uiState;return j.createElement(Kp,null,j.createElement(Et,{selected:a,img:"/img/targetShip.png",onClick:function(){return r.toggleGameUiMode("enemy_weapons")}}),j.createElement(Et,{selected:i,img:"/img/firing.png",onClick:function(){return r.toggleGameUiMode("weapons")}}),j.createElement(Et,{selected:t,img:"/img/addOEW.png",onClick:function(){return r.toggleGameUiMode("ew")}}),j.createElement(Et,{selected:n,img:"/img/selectShip.png",onClick:function(){return r.toggleGameUiMode("movement")}}),j.createElement(Xp,{onClick:function(){return r.startReplay()}},j.createElement(ae,null)))}}]),t}(j.PureComponent),Qp=(j.Component,function(e){function t(e){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).call(this,e))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.ship,n=e.uiState,i=e.ewList,a=e.selectedShip,r=n.gameData;return t?i.map((function(e,t){var i=r.ships.getShipById(e.targetShipId);return j.createElement(hu,{highlight:!0,name:i.name,uiState:n,key:"ew-list-".concat(t),ship:a,target:i,oew:a.electronicWarfare.getOffensiveEw(e.targetShipId)})})):null}}]),t}(j.Component));function Jp(){var e=Object(R.a)(["\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap-reverse;\n"]);return Jp=function(){return e},e}function $p(){var e=Object(R.a)(["\n  position: absolute;\n  left: 0;\n  bottom: 0;\n  width: calc(50% - 100px);\n  display: flex;\n  flex-direction: column;\n  z-index: 3;\n"]);return $p=function(){return e},e}var ev=F.b.div($p()),tv=F.b.div(Jp()),nv=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.uiState,n=(e.systemList,e.ewList),i=Object(D.a)(e,["uiState","systemList","ewList"]);return t.state.selectedShip?j.createElement(ev,null,j.createElement(tv,null,n&&j.createElement(Qp,Object.assign({ship:t.state.selectedShip,uiState:t,ewList:n},i))),j.createElement(Kl,{ship:t.state.selectedShip,uiState:t})):null}}]),t}(j.PureComponent);function iv(){var e=Object(R.a)(["\n  transform: rotate(180deg);\n"]);return iv=function(){return e},e}function av(){var e=Object(R.a)(["\n  position: absolute;\n  top: 0;\n  left: 500px;\n  display: flex;\n  z-index: 3;\n"]);return av=function(){return e},e}var rv=F.b.div(av()),sv=Object(F.b)(Et)(iv()),ov=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.uiState,n=e.replayContext;return j.createElement(rv,null,j.createElement(Nt,{onClick:function(){return n.rewindToFiring()}},"Firing"),j.createElement(sv,{onClick:function(){return n.resumeReplayRewind()}},j.createElement(ne,null)),j.createElement(Et,{onClick:function(){return n.pauseReplay()}},j.createElement(ie,null)),j.createElement(Et,{onClick:function(){return n.resumeReplay()}},j.createElement(ne,null)),j.createElement(Et,{onClick:function(){return t.closeReplay()}},j.createElement(Q,null)))}}]),t}(j.PureComponent);function uv(){var e=Object(R.a)(["\n  color: #db4949;\n  font-weight: bold;\n"]);return uv=function(){return e},e}function cv(){var e=Object(R.a)(["\n  color: #6daaff;\n"]);return cv=function(){return e},e}var lv=F.b.span(cv()),hv=F.b.span(uv());function dv(){var e=Object(R.a)(["\n  margin-left: 5px;\n"]);return dv=function(){return e},e}var mv=F.b.div(dv()),fv=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.resolution,n=e.totalShots,i=e.shotsHit;return S.a.createElement(mv,null,"Change to hit: ",S.a.createElement(lv,null,t.hitChange.result),". Hit roll: ",S.a.createElement(lv,null,t.hitRoll),".",t.result?S.a.createElement(lv,null,S.a.createElement("b",null," ".concat(i,"/").concat(n," Hit!"))):S.a.createElement(hv,null,S.a.createElement("b",null," Miss!")))}}]),t}(S.a.Component);function pv(){var e=Object(R.a)([""]);return pv=function(){return e},e}var vv=F.b.div(pv()),gv=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.target,n=(e.gameData,e.combatLogEntry),i=n.getDamages(t),a=n.getDestroyedSystems(t),r=i.reduce((function(e,t){return e+t.amount}),0),s=i.reduce((function(e,t){return e+t.armor}),0);return S.a.createElement(vv,null,"Damage caused: ",S.a.createElement(hv,null,r),". Mitigated by armor ",S.a.createElement(lv,null,s),".",a.length>0&&S.a.createElement(S.a.Fragment,null," ","Systems destroyed:"," ",S.a.createElement(hv,null,a.map((function(e){return e.getDisplayName()})).join(", "))))}}]),t}(S.a.Component);function yv(){var e=Object(R.a)(["\n  margin-left: 50px;\n  margin-top: 4px;\n"]);return yv=function(){return e},e}function bv(){var e=Object(R.a)(["\n  display: flex;\n"]);return bv=function(){return e},e}function Ov(){var e=Object(R.a)(["\n  color: #d6d6d6;\n  font-family: arial;\n  font-size: 12px;\n  padding: 8px 8px 8px 8px;\n  display: flex;\n  flex-direction: column;\n  border-bottom: 1px dashed gray;\n"]);return Ov=function(){return e},e}var wv=F.b.div(Ov()),kv=F.b.div(bv()),jv=Object(F.b)(kv)(yv()),Sv=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"getTorpedoAttackLine",value:function(){var e=this.props,t=e.combatLogEntry,n=e.gameData,i=(e.replayContext,n.ships.getShipById(t.targetId)),a=n.torpedos.getTorpedoFlightById(t.torpedoFlightId),r=i.name.trim();return S.a.createElement(wv,null,S.a.createElement(kv,null,S.a.createElement(hv,null,"TORPEDO STRIKE:\xa0"),S.a.createElement(lv,null,"\xa0",a.torpedo.getDisplayName(),"\xa0"),"strikes ",r),t.notes.length>0&&S.a.createElement(jv,null,t.notes.join(". ")),t.damages.length>0&&S.a.createElement(jv,null,S.a.createElement(gv,{target:i,gameData:n,combatLogEntry:t})))}},{key:"getWeaponFireLine",value:function(){var e=this.props,t=e.combatLogEntry,n=e.gameData,i=(e.replayContext,(new rs).update(n).getFireOrderById(t.fireOrderId)),a=n.ships.getShipById(i.targetId),r=n.ships.getShipById(i.shooterId),s=r.systems.getSystemById(i.weaponId),o=t.hitResult.result,u=r.name.trim(),c=a.name.trim(),l=s.getDisplayName();return S.a.createElement(wv,null,S.a.createElement(kv,null,S.a.createElement(hv,null,"FIRE:\xa0"),u," fires"," ",S.a.createElement(lv,null,"\xa0",l,"\xa0",t.ammoName&&"(".concat(t.ammoName,")"),"\xa0")," ","at ",c,".",S.a.createElement(fv,{resolution:t.hitResult,totalShots:t.totalShots,shotsHit:t.shotsHit})),t.notes.length>0&&S.a.createElement(jv,null,t.notes.join(" ")),o&&S.a.createElement(jv,null,S.a.createElement(gv,{target:a,gameData:n,combatLogEntry:t})))}},{key:"render",value:function(){var e=this.props.combatLogEntry;return e instanceof $h?this.getWeaponFireLine():e instanceof md?this.getTorpedoAttackLine():null}}]),t}(S.a.Component);function xv(){var e=Object(R.a)(["\n  position: fixed;\n  left: 0;\n  bottom: 0;\n  height: 150px;\n  width: 33%;\n  background: rgba(0, 0, 0, 0.5);\n  overflow-y: scroll;\n  padding-top: 8px;\n  z-index: 3;\n  scrollbar-width: 0;\n\n  &::-webkit-scrollbar {\n    width: 0;\n  }\n"]);return xv=function(){return e},e}var Cv=F.b.div(xv()),Tv=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.replayContext,n=e.gameData,i=e.log;return S.a.createElement(Cv,null,i.map((function(e,i){return S.a.createElement(Sv,{gameData:n,replayContext:t,key:"combatlog-line-".concat(i),combatLogEntry:e})})))}}]),t}(S.a.Component);function Ev(){var e=Object(R.a)(["\n  animation: blinker 1s linear infinite;\n\n  @keyframes blinker {\n    50% {\n      opacity: 0;\n    }\n  }\n"]);return Ev=function(){return e},e}function Av(){var e=Object(R.a)(["\n  display: flex;\n  hieght: 100%;\n\n  "," {\n    margin-left: 5px;\n\n    &:first-child {\n      margin-left: 0px;\n    }\n  }\n"]);return Av=function(){return e},e}function Pv(){var e=Object(R.a)(["\n  "," {\n    margin: 0;\n  }\n"]);return Pv=function(){return e},e}function Iv(){var e=Object(R.a)(["\n  display: flex;\n  height: 100%;\n  align-items: center;\n"]);return Iv=function(){return e},e}function Dv(){var e=Object(R.a)(["\n  width: 15px;\n  height: 15px;\n  background-size: cover;\n  background-color: transparent;\n  background-image: ",";\n  margin: 0 3px 0 0;\n"]);return Dv=function(){return e},e}function Mv(){var e=Object(R.a)(["\n  display: flex;\n  flex-direction: row;\n  background-color: rgba(0, 0, 0, 0.5);\n  align-items: center;\n  padding: 3px 5px;\n"]);return Mv=function(){return e},e}function zv(){var e=Object(R.a)(["\n  /* background-color: rgba(0, 0, 0, 0.5);\n  padding: 3px 5px; */\n  margin-right: 5px;\n"]);return zv=function(){return e},e}function Rv(){var e=Object(R.a)(["\n  align-items: center;\n  justify-content: center;\n  width: 20px;\n  height: 20px;\n  margin: 0 1px;\n"]);return Rv=function(){return e},e}function Fv(){var e=Object(R.a)(["\n  text-align: left;\n  position: relative;\n  z-index: 0;\n  display: flex;\n  flex-direction: row;\n  color: white;\n  font-family: arial;\n  margin-left: -50%;\n  font-size: 12px;\n\n  animation: fadein 2s;\n\n  @keyframes fadein {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n"]);return Fv=function(){return e},e}var Hv=F.b.div(Fv()),Lv=(Object(F.b)(se)(Rv()),F.b.div(zv()),F.b.div(Mv())),Bv=F.b.div(Dv(),(function(e){return"url(".concat(e.background,")")})),_v=F.b.div(Iv()),Uv=Object(F.b)(_v)(Pv(),Bv),Nv=F.b.div(Av(),_v),Vv=Object(F.b)(Uv)(Ev()),Gv=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.icon,n=(e.version,e.getPosition),i=e.uiState,a=(e.showName,i.services.currentUser),r=t.ship.player.is(a),s=function(e,t){var n=new hl;return new jf(t).torpedos.getTorpedoFlights().filter((function(t){return t.targetId===e.id})).filter((function(t){return n.reachesTargetThisTurn(t,e)})).length}(t.ship,i.state.gameData);return S.a.createElement(fu,{getPosition:n,uiState:i,marginTop:0,marginLeft:0},S.a.createElement(Hv,null,S.a.createElement(Lv,null,!1,S.a.createElement(Nv,null,r&&s>0&&S.a.createElement(Vv,null,S.a.createElement(Bv,{background:"/img/system/missile1.png"}),s),r&&!t.ship.systems.power.isValidPower()&&S.a.createElement(Vv,null,S.a.createElement(Bv,{background:"/img/offline.png"})),r&&S.a.createElement(_v,null,S.a.createElement(Bv,{background:"/img/dewBadge2.png"}),t.ship.electronicWarfare.getDefensiveEw()),S.a.createElement(_v,null,S.a.createElement(Bv,{background:"/img/dewBadge.png"}),t.ship.electronicWarfare.inEffect.getDefensiveEw()),r&&S.a.createElement(_v,null,S.a.createElement(Bv,{background:"/img/ccewBadge2.png"}),t.ship.electronicWarfare.getCcEw()),S.a.createElement(_v,null,S.a.createElement(Bv,{background:"/img/ccewBadge.png"}),t.ship.electronicWarfare.inEffect.getCcEw())))))}}]),t}(S.a.PureComponent),Wv=S.a.createContext({}),qv=S.a.createContext({}),Zv=function(e){var t=e.uiState,n=e.children,i=Object(j.useReducer)(t.getReducer(),t.getInitialState()),a=Object(Pi.a)(i,2),r=a[0],s=a[1];return t.setDispatch(s),S.a.createElement(qv.Provider,{value:s},S.a.createElement(Wv.Provider,{value:r},n))},Kv=function(e){var t=e.game,n=Object(j.useContext)(Ii).currentUser,i=Object(j.useContext)(Wv),a=t.getUiState();return S.a.createElement(S.a.Fragment,null,i.lobby&&S.a.createElement(Qf,{uiState:a,gameData:i.gameData,game:t,currentUser:n}),i.shipTooltip.map((function(e,t){return S.a.createElement(Jf,Object.assign({key:"tooltip-ship-".concat(t),uiState:a},i,e))})),i.gameData&&("game"===i.gameData.phase||"deployment"===i.gameData.phase)&&S.a.createElement(ap,{uiState:a,gameData:a.state.gameData,ready:a.state.turnReady,waiting:a.state.waiting}),i.shipMovement&&"deploy"===i.shipMovement.type&&S.a.createElement(Wp,Object.assign({},i.shipMovement,{uiState:a})),i.shipMovement&&"game"===i.shipMovement.type&&S.a.createElement(Up,Object.assign({},i.shipMovement,{uiState:a})),i.gameUiModeButtons&&S.a.createElement(Yp,Object.assign({uiState:a},i.gameUiMode)),i.replayUi&&S.a.createElement(ov,{uiState:a,replayContext:i.replayUi}),S.a.createElement(nv,Object.assign({uiState:a},i)),a.state.combatLog&&S.a.createElement(Tv,{uiState:a,replayContext:i.combatLog.replayContext,gameData:i.combatLog.gameData,log:i.combatLog.log}),i.shipBadges.map((function(e){var t=e.version,n=e.icon,i=e.getPosition,r=e.showName;return S.a.createElement(Gv,{key:"ship-badge-".concat(n.ship.id),icon:n,getPosition:i,version:t,uiState:a,showName:r})})))},Xv=function(e){var t=e.match,n=Object(j.useContext)(Ii).currentUser,i=Object(j.useState)(null),a=Object(Pi.a)(i,2),r=a[0],s=a[1],o=Object(j.useState)(null),u=Object(Pi.a)(o,2),c=u[0],l=u[1];return Object(j.useEffect)((function(){var e=new Rf,i=new zf(t.params.gameid,n,e);s(e),l(i)}),[n,s,l]),r&&c&&void 0!==n?S.a.createElement(Zv,{uiState:r},S.a.createElement(ea,{game:c,currentUser:n}),S.a.createElement(Kv,{game:c}),S.a.createElement(Li,null)):null},Yv=(S.a.Component,function(e){var t=e.location,n=Object(j.useContext)(Di),i=Object(j.useContext)(Ii).currentUser;return Object(j.useEffect)((function(){Zt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zt.a.awrap(ji());case 2:return e.next=4,Zt.a.awrap(Ei(n));case 4:case"end":return e.stop()}}))}),[n]),i?null:S.a.createElement(M.a,{to:{pathname:"/",state:{from:t}}})}),Qv=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"mapTeamsToComponents",value:function(){var e=this;return this.props.gameData.slots.getSlotsByTeams().map((function(t){return S.a.createElement(ke,{key:"team-".concat(t.team)},S.a.createElement(ze,null,"TEAM: ",t.team),t.slots.map((function(t){return S.a.createElement(Uf,Object.assign({key:t.id,slot:t},e.props))})))}))}},{key:"handleChange",value:function(){}},{key:"render",value:function(){return S.a.createElement(S.a.Fragment,null,this.mapTeamsToComponents())}}]),t}(j.Component);function Jv(){var e=Object(R.a)(["\n  width: 1200px;\n"]);return Jv=function(){return e},e}var $v=Object(F.b)(je)(Jv()),eg=function(e){var t=e.location,n=Object(j.useContext)(Ii).currentUser,i=Object(j.useState)(new jf),a=Object(Pi.a)(i,2),r=a[0],s=a[1];Object(j.useEffect)((function(){r.slots.addSlot(new Ad({name:"Blue",team:1,points:3e3,userId:n.id,deploymentLocation:new un.Offset(-150,0),deploymentVector:new un.Offset(10,0)})),r.slots.addSlot(new Ad({name:"Red",team:2,points:3e3,userId:null,deploymentLocation:new un.Offset(150,0),deploymentVector:new un.Offset(-10,0)})),r.addPlayer(n),r.name="Test game",s(r.clone())}),[s]);var o=Object(j.useCallback)((function(e){r.name=e.target.value,s(r.clone())}),[r,s]),u=Object(j.useCallback)((function(){!function(){var e;Zt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Zt.a.awrap(xi(r));case 3:e=t.sent,console.log(e),r.id=e.data.gameId,s(r.clone()),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.error(t.t0);case 12:case"end":return t.stop()}}),null,null,[[0,9]])}()}),[r,s]);return console.log("render",r),r.id?S.a.createElement(M.a,{to:{pathname:"/game/".concat(r.id),state:{from:t}}}):S.a.createElement($v,null,S.a.createElement(Gt,{to:"/"},S.a.createElement(Nt,{type:"button",buttonStyle:"button-grey"},"Back")),S.a.createElement(ze,null,"Create game"),S.a.createElement(Ge,{placeholder:"name",value:r.name,onChange:o,error:!r.name&&"Name is required"}),S.a.createElement(Qv,{gameData:r}),S.a.createElement(Nt,{type:"button",buttonStyle:"button-grey",onClick:u},"Create game"))},tg=function(e){var t=e.component,n=e.authed,i=Object(D.a)(e,["component","authed"]);return S.a.createElement(M.b,Object.assign({},i,{render:function(e){return!0===n?S.a.createElement(t,e):S.a.createElement(M.a,{to:{pathname:"/",state:{from:e.location}}})}}))},ng=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.context.currentUser;return void 0===e?null:S.a.createElement(z.a,null,S.a.createElement(M.b,{exact:!0,path:"/",component:Zi}),S.a.createElement(tg,{authed:Boolean(e),exact:!0,path:"/createGame",component:eg}),S.a.createElement(M.b,{exact:!0,path:"/logout",component:Yv}),S.a.createElement(tg,{authed:Boolean(e),path:"/game/:gameid",component:Xv}))}}]),t}(j.Component);ng.contextType=Ii;var ig=ng,ag=function(e){function t(){return Object(T.a)(this,t),Object(A.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){return S.a.createElement(zi,null,S.a.createElement(ig,null))}}]),t}(j.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));C.a.render(S.a.createElement(ag,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[153,1,2]]]);
//# sourceMappingURL=main.2fd2f83c.chunk.js.map